<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>redis简介</title>
      <link href="/2021/04/04/redis/redis01/"/>
      <url>/2021/04/04/redis/redis01/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h3 id="redis简介"><a href="#redis简介" class="headerlink" title="redis简介"></a>redis简介</h3><blockquote><p>redis是什么？</p></blockquote><p>Redis（<strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>erver )，即远程字典服务，是一个开源的使用ANSI <a href="https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728">数据库</a>，并提供多种语言的API。</p><p>redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p><p>免费和开源！是当下最热门的NoSql技术之一！也被人们称为结构化数据库！</p><blockquote><p>redis能干嘛？</p></blockquote><ol><li>内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）</li><li>高效率、用于高速缓冲</li><li>发布订阅系统</li><li>地图信息分析</li><li>计时器、计数器(eg：浏览量)</li></ol><blockquote><p>redis特性？</p></blockquote><ol><li>多样的数据类型</li><li>持久化</li><li>集群</li><li>事务</li></ol><p>redis是单线程的，redis是基于内存操作的，cpu不是redis的性能瓶颈，redis的瓶颈是根据机器的内存和网络宽带，既然可以使用单线程来实现，就使用单线程了</p><h3 id="linux安装"><a href="#linux安装" class="headerlink" title="linux安装"></a>linux安装</h3><p>下载地址：<a href="https://redis.io/">https://redis.io/</a></p><p>下载：redis-6.2.1.tar.gz</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">quan</span>]<span class="comment"># cd /opt</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">opt</span>]<span class="comment"># ls -l</span></span><br><span class="line">total <span class="number">2392</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root <span class="number">2438367</span> Apr  <span class="number">3</span> <span class="number">20</span>:<span class="number">58</span> redis<span class="literal">-6</span>.<span class="number">2.1</span>.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">opt</span>]<span class="comment"># tar -zxvf redis-6.2.1.tar.gz  </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">opt</span>]<span class="comment"># cd redis-6.2.1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">redis</span>-<span class="number">6.2</span><span class="type">.1</span>]<span class="comment"># ls</span></span><br><span class="line"><span class="number">00</span><span class="literal">-RELEASENOTES</span>  CONTRIBUTING  INSTALL    README.md   run<span class="built_in">test-cluster</span>    sentinel.conf  TLS.md</span><br><span class="line">BUGS             COPYING       Makefile   redis.conf  run<span class="built_in">test-moduleapi</span>  src            utils</span><br><span class="line">CONDUCT          deps          MANIFESTO  runtest     run<span class="built_in">test-sentinel</span>   tests</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">redis</span>-<span class="number">6.2</span><span class="type">.1</span>]<span class="comment"># yum install gcc-c++                # 基本的环境安装</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">redis</span>-<span class="number">6.2</span><span class="type">.1</span>]<span class="comment"># make</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">redis</span>-<span class="number">6.2</span><span class="type">.1</span>]<span class="comment"># make isntall</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># cd /usr/local/bin     # redis默认安装路径 /usr/local/bin</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># ls</span></span><br><span class="line">redis<span class="literal">-benchmark</span>  redis<span class="literal">-check</span><span class="literal">-aof</span>  redis<span class="literal">-check</span><span class="literal">-rdb</span>  redis<span class="literal">-cli</span>  redis<span class="literal">-sentinel</span>  redis<span class="literal">-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># mkdir myconfig</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># cp /opt/redis-6.2.1/redis.conf /usr/local/bin/myconfig/       # 备份redis.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># cd myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls</span></span><br><span class="line">redis.conf   <span class="comment"># 之后就使用这个配置文件启动</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis.conf</span></span><br><span class="line">daemonize yes   <span class="comment"># 默认是no,改为yes,代表开启守护进程模式,在该模式下，redis会在后台运行，并将进程pid号写入至redis.conf选项pidfile设置的文件中，此时redis将一直运行，除非手动kill该进程。  </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># pwd</span></span><br><span class="line">/usr/local/bin</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-server myconfig/redis.conf   # 通过指定配置文件启动redis-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-cli -p 6379    #使用redis客户端进行连接</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt;                  </span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># ps -ef|grep redis      # 查看redis进程是否开启</span></span><br><span class="line">polkitd   <span class="number">3324</span>  <span class="number">3304</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">27</span> redis<span class="literal">-server</span> *:<span class="number">6379</span></span><br><span class="line">root      <span class="number">3387</span>  <span class="number">1460</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">26</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> docker exec <span class="literal">-it</span> ae5139dfe541 redis<span class="literal">-cli</span></span><br><span class="line">root      <span class="number">3403</span>  <span class="number">3304</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">26</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-cli</span></span><br><span class="line">root     <span class="number">12600</span>  <span class="number">3647</span>  <span class="number">0</span> <span class="number">21</span>:<span class="number">20</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-cli</span> <span class="literal">-p</span> <span class="number">6379</span></span><br><span class="line">root     <span class="number">12621</span> <span class="number">12603</span>  <span class="number">0</span> <span class="number">21</span>:<span class="number">21</span> pts/<span class="number">2</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep -<span class="literal">-color</span>=auto redis</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># </span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; shutdown     <span class="comment"># shutdown关闭redis</span></span><br><span class="line">(<span class="number">0.51</span>s)</span><br><span class="line">not connected&gt; <span class="keyword">exit</span>          <span class="comment"># 退出</span></span><br></pre></td></tr></table></figure><h3 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h3><p>redis-benchmark：Redis官方提供的性能测试工具</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># ls</span></span><br><span class="line">dump.rdb  myconfig  redis<span class="literal">-benchmark</span>  redis<span class="literal">-check</span><span class="literal">-aof</span>  redis<span class="literal">-check</span><span class="literal">-rdb</span>  redis<span class="literal">-cli</span>  redis<span class="literal">-sentinel</span>  redis<span class="literal">-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-benchmark -h localhost -p 6379 -c 100 -n 100000    # 测试：100个并发连接 100000请求</span></span><br></pre></td></tr></table></figure><h3 id="Redis命令"><a href="#Redis命令" class="headerlink" title="Redis命令"></a>Redis命令</h3><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>select index</td><td>切换到指定的数据库，数据库索引号 index 用数字值指定，以 0 作为起始索引值。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis.conf </span></span><br><span class="line">databases <span class="number">16</span>       <span class="comment"># redis默认有16个数据库，默认使用第0个，可以使用selec来切换数据库</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> db_number <span class="number">0</span>   <span class="comment">#  默认使用 0 号数据库</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">select</span> <span class="number">1</span>          <span class="comment"># 使用 1 号数据库</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>[<span class="number">1</span>]&gt; get db_number  <span class="comment"># 已经切换到 1 号数据库，注意 Redis 现在的命令提示符多了个 [1]</span></span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>[<span class="number">1</span>]&gt; <span class="built_in">set</span> db_number <span class="number">1</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>[<span class="number">1</span>]&gt; get db_number</span><br><span class="line"><span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>[<span class="number">1</span>]&gt; <span class="built_in">select</span> <span class="number">3</span>         <span class="comment"># 再切换到 3 号数据库</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>[<span class="number">3</span>]&gt;                  <span class="comment"># 提示符从 [1] 改变成了 [3]</span></span><br></pre></td></tr></table></figure><h4 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>keys pattern</td><td>查找所有符合给定模式 pattern 的 key</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> runoob1 redis</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> runoob2 mysql</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> runoob3 mongodb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys runoob*             <span class="comment"># 查找以 runoob 为开头的 key</span></span><br><span class="line">1) <span class="string">&quot;runoob1&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoob3&quot;</span></span><br><span class="line">3) <span class="string">&quot;runoob2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; keys *                   <span class="comment"># 获取 redis 中所有的 key 可用使用 *</span></span><br><span class="line">1) <span class="string">&quot;counter:__rand_int__&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoob1&quot;</span></span><br><span class="line">3) <span class="string">&quot;myhash&quot;</span></span><br><span class="line">4) <span class="string">&quot;runoob3&quot;</span></span><br><span class="line">5) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">6) <span class="string">&quot;k1&quot;</span></span><br><span class="line">7) <span class="string">&quot;runoob2&quot;</span></span><br><span class="line">8) <span class="string">&quot;mylist&quot;</span></span><br></pre></td></tr></table></figure><h4 id="flushdb"><a href="#flushdb" class="headerlink" title="flushdb"></a>flushdb</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>flushdb</td><td>清空当前数据库中的所有 key。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; dbsize   <span class="comment"># 清空前的 key 数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line">127.0.0.1:6379&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; dbsize   <span class="comment"># 清空后的 key 数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><h4 id="flushall"><a href="#flushall" class="headerlink" title="flushall"></a>flushall</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>flushall</td><td>清空整个 Redis 服务器的数据(删除所有数据库的所有 key )。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; dbsize       <span class="comment"># 0 号数据库的 key 数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; select 1     <span class="comment"># 切换到 1 号数据库</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; dbsize    <span class="comment"># 1 号数据库的 key 数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379[1]&gt; flushall   <span class="comment"># 清空所有数据库的所有 key</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; dbsize    <span class="comment"># 不但 1 号数据库被清空了</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379[1]&gt; select 0   <span class="comment"># 0 号数据库(以及其他所有数据库)也一样</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><h3 id="Redis键（key）"><a href="#Redis键（key）" class="headerlink" title="Redis键（key）"></a>Redis键（key）</h3><h4 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>exists key</td><td>检查给定 key 是否存在</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists k1    <span class="comment"># key不存在，返回0</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; exists k1    <span class="comment"># key存在，返回1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="move"><a href="#move" class="headerlink" title="move"></a>move</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>move key db</td><td>将当前数据库的 key 移动到给定的数据库 db 当中。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get k1      <span class="comment"># key 存在于当前数据库 0</span></span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; move k1 1    <span class="comment"># 将 k1 移动到数据库 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; exists k1    <span class="comment"># k1 已经被移走</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; select 1     <span class="comment"># 使用数据库 1</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; exists k1  <span class="comment"># 证实 k1 被移到了数据库 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：当key不存在时，move失败，当源数据库和目标数据库有相同的 key 时，move失败</span></span><br></pre></td></tr></table></figure><h4 id="expire"><a href="#expire" class="headerlink" title="expire"></a>expire</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>expire key time</td><td>设置 key 的过期时间，key 过期后将不再可用。单位以秒计</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name redis</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; expire name 60    <span class="comment"># 为 key 设置过期时间,1分钟后该键会自动删除。</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h4 id="ttl"><a href="#ttl" class="headerlink" title="ttl"></a>ttl</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>ttl</td><td>以秒为单位返回 key 的剩余过期时间</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name redis</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; expire name 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl name        <span class="comment"># 返回 key 的剩余生存时间,以秒为单位</span></span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; ttl name         <span class="comment"># 当 key 不存在时，返回 -2 </span></span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name redis</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl name          <span class="comment"># 当 key 存在但没有设置剩余生存时间时，返回 -1 </span></span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure><h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>type key</td><td>返回 key 所储存的值的类型。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> weather <span class="string">&quot;sunny&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> weather      <span class="comment"># key 的数据类型是string (字符串)</span></span><br><span class="line">string</span><br><span class="line"><span class="comment"># 常见数据类型有：</span></span><br><span class="line"><span class="comment"># none (key不存在)</span></span><br><span class="line"><span class="comment"># string (字符串)</span></span><br><span class="line"><span class="comment"># list (列表)</span></span><br><span class="line"><span class="comment"># set (集合)</span></span><br><span class="line"><span class="comment"># zset (有序集)</span></span><br><span class="line"><span class="comment"># hash (哈希表)</span></span><br></pre></td></tr></table></figure><h3 id="Redis字符串（String）"><a href="#Redis字符串（String）" class="headerlink" title="Redis字符串（String）"></a>Redis字符串（String）</h3><h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>set key</td><td>设置给定 key 的值。如果 key 已经存储其他值， SET 就覆写旧值，且无视类型</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key <span class="string">&quot;value&quot;</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key</span><br><span class="line"><span class="string">&quot;value&quot;</span></span><br></pre></td></tr></table></figure><h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>get key</td><td>获取指定 key 的值。如果 key 不存在，返回 nil 。如果key 储存的值不是字符串类型，返回一个错误。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get db       <span class="comment"># 对不存在的 key 或字符串类型 key 进行 GET</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lpush db redis mongodb mysql</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; get db        <span class="comment"># 对不是字符串类型的 key 进行 GET</span></span><br><span class="line">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure><h4 id="append"><a href="#append" class="headerlink" title="append"></a>append</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>append key value</td><td>为指定的 key 追加值</td></tr></tbody></table><p>如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。</p><p>如果 key 不存在， APPEND 就简单地将给定 key 设为 value ，就像执行 SET key value 一样。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; append myphone <span class="string">&quot;iphone&quot;</span>     <span class="comment"># 对不存在的 key 进行 APPEND ，等同于 SET myphone &quot;iphone&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 6                                 <span class="comment"># 字符长度</span></span><br><span class="line">127.0.0.1:6379&gt; append myphone <span class="string">&quot; - 1110&quot;</span>    <span class="comment"># 对已存在的字符串进行 APPEND</span></span><br><span class="line">(<span class="built_in">integer</span>) 13                                <span class="comment"># 长度从 6 个字符增加到 13 个字符</span></span><br><span class="line">127.0.0.1:6379&gt; get myphone</span><br><span class="line"><span class="string">&quot;iphone - 1110&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure><h4 id="strlen"><a href="#strlen" class="headerlink" title="strlen"></a>strlen</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>strlen key</td><td>获取指定 key 所储存的字符串值的长度。当 key 储存的不是字符串值时，返回一个错误。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get myphone</span><br><span class="line"><span class="string">&quot;iphone - 1110&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; strlen myphone    <span class="comment"># 获取字符串的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 13</span><br><span class="line">127.0.0.1:6379&gt; strlen nonno      <span class="comment"># 不存在的 key 长度为 0</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><h4 id="incr"><a href="#incr" class="headerlink" title="incr"></a>incr</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>incr key</td><td>将 key 中储存的数字值增一</td></tr></tbody></table><p>如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作。</p><p>如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> page_view 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; incr page_view</span><br><span class="line">(<span class="built_in">integer</span>) 21</span><br><span class="line">127.0.0.1:6379&gt; incr page_view</span><br><span class="line">(<span class="built_in">integer</span>) 22</span><br><span class="line">127.0.0.1:6379&gt; get page_view      <span class="comment"># 数字值在 Redis 中以字符串的形式保存</span></span><br><span class="line"><span class="string">&quot;22&quot;</span></span><br></pre></td></tr></table></figure><h4 id="decr"><a href="#decr" class="headerlink" title="decr"></a>decr</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>decr key</td><td>将 key 中储存的数字值减一</td></tr></tbody></table><p>如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECR 操作。</p><p>如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> failure_times 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decr failure_times     <span class="comment"># 对存在的数字值 key 进行 DECR</span></span><br><span class="line">(<span class="built_in">integer</span>) 9</span><br><span class="line">127.0.0.1:6379&gt; decr cou               <span class="comment"># 对不存在的 key 值进行 DECR</span></span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> commany YOUR_CODE_SUCKS.LLC</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decr commany           <span class="comment"># 对存在但不是数值的 key 进行 DECR</span></span><br><span class="line">(error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br></pre></td></tr></table></figure><h4 id="incrby"><a href="#incrby" class="headerlink" title="incrby"></a>incrby</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>incrby key amount</td><td>将 key 中储存的数字加上指定的增量值。</td></tr></tbody></table><p>如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCRBY 命令。</p><p>如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误((error) ERR value is not an integer or out of range)。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> rank <span class="number">50</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; incrby rank <span class="number">20</span></span><br><span class="line">(integer) <span class="number">70</span></span><br></pre></td></tr></table></figure><h4 id="decrby"><a href="#decrby" class="headerlink" title="decrby"></a>decrby</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>decrby key amount</td><td>将 key 所储存的值减去指定的减量值</td></tr></tbody></table><p>如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECRBY 操作。</p><p>如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> count <span class="number">50</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; decrby count <span class="number">20</span></span><br><span class="line">(integer) <span class="number">30</span></span><br></pre></td></tr></table></figure><h4 id="getrange"><a href="#getrange" class="headerlink" title="getrange"></a>getrange</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>getrange key start end</td><td>获取存储在指定 key 中字符串的子字符串，字符串的截取范围由 start 和 end 两个偏移量决定(包括 start 和 end 在内)。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> mykey <span class="string">&quot;This is my test key&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getrange mykey <span class="number">0</span> <span class="number">3</span>   <span class="comment"># 截取字符串 [0,3]</span></span><br><span class="line"><span class="string">&quot;This&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getrange mykey <span class="number">0</span> <span class="literal">-1</span>  <span class="comment"># 获取全部的字符串 和 get key 是一样的</span></span><br><span class="line"><span class="string">&quot;This is my test key&quot;</span></span><br></pre></td></tr></table></figure><h4 id="setrange"><a href="#setrange" class="headerlink" title="setrange"></a>setrange</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>getrange key offset value</td><td>用指定的字符串覆盖给定 key 所储存的字符串值，覆盖的位置从偏移量 offset 开始。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> key1 <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setrange key1 <span class="number">6</span> <span class="string">&quot;Redis&quot;</span></span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get key1</span><br><span class="line"><span class="string">&quot;Hello Redis&quot;</span></span><br></pre></td></tr></table></figure><h4 id="setnx"><a href="#setnx" class="headerlink" title="setnx"></a>setnx</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>setnx key value</td><td>在指定的 key 不存在时，为 key 设置指定的值。set if not exists</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; exists job               <span class="comment"># job 不存在</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setnx job <span class="string">&quot;programer&quot;</span>    <span class="comment"># job 设置成功</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setnx job <span class="string">&quot;code-farmer&quot;</span>  <span class="comment"># 尝试覆盖 job ，失败</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get job                  <span class="comment"># 没有被覆盖</span></span><br><span class="line"><span class="string">&quot;programer&quot;</span></span><br></pre></td></tr></table></figure><h4 id="setex"><a href="#setex" class="headerlink" title="setex"></a>setex</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>setex key  timout value</td><td>为指定的 key 设置值及其过期时间。如果 key 已经存在， SETEX 命令将会替换旧的值</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setex mykey <span class="number">60</span> redis</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ttl mykey</span><br><span class="line">(integer) <span class="number">57</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get mykey</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ttl mykey</span><br><span class="line">(integer) <span class="literal">-2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get mykey</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h4 id="mset"><a href="#mset" class="headerlink" title="mset"></a>mset</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>mset key1 val1 key2 val3…</td><td>同时设置一个或多个 key-value 对</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; mset key1 <span class="string">&quot;Hello&quot;</span> key2 <span class="string">&quot;World&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get key1</span><br><span class="line"><span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get key2</span><br><span class="line"><span class="string">&quot;World&quot;</span></span><br></pre></td></tr></table></figure><h4 id="mget"><a href="#mget" class="headerlink" title="mget"></a>mget</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>mget key1 key2 …</td><td>返回所有(一个或多个)给定 key 的值。 如果给定的 key 里面，有某个 key 不存在，那么这个 key 返回特殊值 nil</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; mget key1 key2 key3</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;World&quot;</span></span><br><span class="line"><span class="number">3</span>) (nil)</span><br></pre></td></tr></table></figure><h4 id="msetnx"><a href="#msetnx" class="headerlink" title="msetnx"></a>msetnx</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>msetnx key1 val1 key2 val3…</td><td>所有给定 key 都不存在时，同时设置一个或多个 key-value 对。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; msetnx rmdbs <span class="string">&quot;Mysql&quot;</span> nosql <span class="string">&quot;Mongodb&quot;</span> key<span class="literal">-value</span><span class="literal">-store</span> <span class="string">&quot;redis&quot;</span>   <span class="comment"># 原子性操作，要么一起成功，要么一起失败</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; mget rmdbs nosql key<span class="literal">-value</span><span class="literal">-store</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Mysql&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Mongodb&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; msetnx key1 val1 key2 val2    <span class="comment"># key1已经存在，失败</span></span><br><span class="line">(integer) <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="getset"><a href="#getset" class="headerlink" title="getset"></a>getset</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>getset key value</td><td>设置指定 key 的值，并返回 key 的旧值。</td></tr></tbody></table><p>返回给定 key 的旧值。 当 key 没有旧值时，即 key 不存在时，返回 nil 。</p><p>当 key 存在但不是字符串类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getset key1 redis     <span class="comment"># 没有旧值，返回 nilp[如果不存在值，则返回nil]</span></span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get key1</span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getset key1 haha    <span class="comment"># 返回旧值 redis[如果存在值，获取原来的值，并设置新的值]</span></span><br><span class="line"><span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get key1</span><br><span class="line"><span class="string">&quot;haha&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Redis列表（List）"><a href="#Redis列表（List）" class="headerlink" title="Redis列表（List）"></a>Redis列表（List）</h3><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p><p>一个列表最多可以包含  4294967295个元素, 每个列表超过40亿个元素。</p><h4 id="lpush"><a href="#lpush" class="headerlink" title="lpush"></a>lpush</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>lpush key val1 val2…</td><td>将一个或多个值插入到列表头部（左）</td></tr></tbody></table><p>如果 key 不存在，一个空列表会被创建并执行 LPUSH 操作。 当 key 存在但不是列表类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lpush list <span class="string">&quot;one&quot;</span></span><br><span class="line">(integer) <span class="number">1</span>                                 <span class="comment"># 列表的长度</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lpush list <span class="string">&quot;two&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lpush list <span class="string">&quot;three&quot;</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure><h4 id="lrange"><a href="#lrange" class="headerlink" title="lrange"></a>lrange</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>lrange key start end</td><td>返回列表中指定区间内的元素，区间以偏移量 START 和 END 指定</td></tr></tbody></table><p>其中 0 表示列表的第一个元素， 1 表示列表的第二个元素，以此类推。 你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span>    <span class="comment"># 先进后出</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure><h4 id="rpush"><a href="#rpush" class="headerlink" title="rpush"></a>rpush</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>rpush key val1 val2…</td><td>将一个或多个值插入到列表的尾部(最右边)</td></tr></tbody></table><p>如果列表不存在，一个空列表会被创建并执行 RPUSH 操作。 当列表存在但不是列表类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; rpush mylist <span class="string">&quot;hello&quot;</span></span><br><span class="line">(integer) <span class="number">1</span>                               <span class="comment"># 列表的长度</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; rpush mylist <span class="string">&quot;foo&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; rpush mylist <span class="string">&quot;bar&quot;</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;bar&quot;</span></span><br></pre></td></tr></table></figure><h4 id="lpop"><a href="#lpop" class="headerlink" title="lpop"></a>lpop</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>lpop key</td><td>移除并返回列表的第一个元素</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lpop mylist         <span class="comment"># 返回列表的第一个元素。 当列表 key 不存在时，返回 nil </span></span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h4 id="rpop"><a href="#rpop" class="headerlink" title="rpop"></a>rpop</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>rpop key</td><td>移除列表的最后一个元素，返回值为移除的元素</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; rpop mylist    <span class="comment"># 返回被移除的元素。当列表不存在时，返回 nil </span></span><br><span class="line"><span class="string">&quot;bar&quot;</span></span><br></pre></td></tr></table></figure><h4 id="lindex"><a href="#lindex" class="headerlink" title="lindex"></a>lindex</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>lindex key index</td><td>通过索引获取列表中的元素</td></tr></tbody></table><p>你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lindex list <span class="number">0</span>    </span><br><span class="line"><span class="string">&quot;three&quot;</span>                                  <span class="comment"># 返回列表中下标为指定索引值的元素</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lindex list <span class="number">2</span></span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lindex list <span class="number">3</span></span><br><span class="line">(nil)                                     <span class="comment"># 如果指定索引值不在列表的区间范围内，返回 nil 。</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lindex list <span class="literal">-1</span></span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure><h4 id="llen"><a href="#llen" class="headerlink" title="llen"></a>llen</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>llen key</td><td>返回列表的长度</td></tr></tbody></table><p> 如果列表 key 不存在，则 key 被解释为一个空列表，返回 0 。 如果 key 不是列表类型，返回一个错误</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; llen list</span><br><span class="line">(integer) <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="lrem"><a href="#lrem" class="headerlink" title="lrem"></a>lrem</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>llrem key count value</td><td>根据参数 count 的值，移除列表中与参数 value 相等的元素</td></tr></tbody></table><p>count 的值可以是以下几种：</p><ul><li>count &gt; 0 : 从表头开始向表尾搜索，移除与 value 相等的元素，数量为 count 。</li><li>count &lt; 0 : 从表尾开始向表头搜索，移除与 value 相等的元素，数量为 count 的绝对值。</li><li>count = 0 : 移除表中所有与 value 相等的值。</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;five&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrem list <span class="number">1</span> one</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;five&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lpush list five</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;five&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;five&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrem list <span class="number">2</span> five</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ltrim"><a href="#ltrim" class="headerlink" title="ltrim"></a>ltrim</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>ltrim key start stop</td><td>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除</td></tr></tbody></table><p>下标 0 表示列表的第一个元素，以 1 表示列表的第二个元素，以此类推。 你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;four&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ltrim list <span class="number">1</span> <span class="literal">-1</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure><h4 id="rpoplpush"><a href="#rpoplpush" class="headerlink" title="rpoplpush"></a>rpoplpush</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>rpoplpush source destination</td><td>移除列表的最后一个元素，并将该元素添加到另一个列表并返回</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; rpoplpush list otherlist</span><br><span class="line"><span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange list <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange otherlist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;one&quot;</span></span><br></pre></td></tr></table></figure><h4 id="lset"><a href="#lset" class="headerlink" title="lset"></a>lset</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>lset key index element</td><td>通过索引来设置元素的值。当索引参数超出范围，或对一个空列表进行 LSET 时，返回一个错误。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;this&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lset mylist <span class="number">0</span> bar</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;this&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lset oother <span class="number">1</span> other         <span class="comment"># list不存在，报错</span></span><br><span class="line">(error) ERR no such key</span><br></pre></td></tr></table></figure><h4 id="linsert"><a href="#linsert" class="headerlink" title="linsert"></a>linsert</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>linsert key before|after pivot element</td><td>在列表的元素前或者后插入元素。当指定元素不存在于列表中时，不执行任何操作</td></tr></tbody></table><p>列表不存在时，被视为空列表，不执行任何操作。</p><p>如果 key 不是列表类型，返回一个错误。</p><p>将值 value 插入到列表 key 当中，位于值 pivot 之前或之后。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;this&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; linsert mylist before this three   <span class="comment"># 将three插入到列表mylist中，位于值this之前</span></span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; lrange mylist <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;bar&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;this&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Redis集合（Set）"><a href="#Redis集合（Set）" class="headerlink" title="Redis集合（Set）"></a>Redis集合（Set）</h3><p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p><p>Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p><p>集合中最大的成员数为 4294967295, 每个集合可存储40多亿个成员。</p><h4 id="sadd"><a href="#sadd" class="headerlink" title="sadd"></a>sadd</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>sadd key member [member …]</td><td>将一个或多个成员元素加入到集合中，已经存在于集合的成员元素将被忽略</td></tr></tbody></table><p>假如集合 key 不存在，则创建一个只包含添加的元素作成员的集合。</p><p>当集合 key 不是集合类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sadd myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sadd myset <span class="string">&quot;foo&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sadd myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure><h4 id="smembers"><a href="#smembers" class="headerlink" title="smembers"></a>smembers</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>smembers key</td><td>返回集合中的所有的成员。 不存在的集合 key 被视为空集合</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure><h4 id="sismember"><a href="#sismember" class="headerlink" title="sismember"></a>sismember</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>sismember key member</td><td>判断成员元素是否是集合的成员</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sismember myset <span class="string">&quot;hello&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sismember myset <span class="string">&quot;hellossss&quot;</span></span><br><span class="line">(integer) <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="scard"><a href="#scard" class="headerlink" title="scard"></a>scard</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>scard key</td><td>返回集合中元素的数量</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; scard myset</span><br><span class="line">(integer) <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="srem"><a href="#srem" class="headerlink" title="srem"></a>srem</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>srem key member [member …]</td><td>移除集合中的一个或多个成员元素，不存在的成员元素会被忽略</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srem myset world</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srem myset hello foo</span><br><span class="line">(integer) <span class="number">2</span>                                   <span class="comment"># 返回被成功移除的元素的数量，不包括被忽略的元素</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure><h4 id="srandmember"><a href="#srandmember" class="headerlink" title="srandmember"></a>srandmember</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>srandmember key [count]</td><td>返回集合中的一个随机元素</td></tr></tbody></table><p>可选的 count 参数：</p><ul><li>如果 count 为正数，且小于集合基数，那么命令返回一个包含 count 个元素的数组，数组中的元素各不相同。如果 count 大于等于集合基数，那么返回整个集合。</li><li>如果 count 为负数，那么命令返回一个数组，数组中的元素可能会重复出现多次，而数组的长度为 count 的绝对值。</li></ul><p>该操作和 SPOP 相似，但 SPOP 将随机元素从集合中移除并返回，而 Srandmember 则仅仅返回随机元素，而不对集合进行任何改动。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset</span><br><span class="line"><span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset <span class="literal">-2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; srandmember myset <span class="literal">-3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h4 id="spop"><a href="#spop" class="headerlink" title="spop"></a>spop</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>spop key [count]</td><td>移除集合中的指定 key 的一个或多个随机元素，移除后会返回移除的元素</td></tr></tbody></table><p>该命令类似 srandmember  命令，但 SPOP 将随机元素从集合中移除并返回，而 srandmember  则仅仅返回随机元素，而不对集合进行任何改动。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;haha&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;shi&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;ni&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;de&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; spop myset</span><br><span class="line"><span class="string">&quot;haha&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; spop myset <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;de&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;shi&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;ni&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="smove"><a href="#smove" class="headerlink" title="smove"></a>smove</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>smove source destination member</td><td>将指定成员 member 元素从 source 集合移动到 destination 集合</td></tr></tbody></table><p>SMOVE 是原子性操作。</p><p>如果 source 集合不存在或不包含指定的 member 元素，则 SMOVE 命令不执行任何操作，仅返回 0 。否则， member 元素从 source 集合中被移除，并添加到 destination 集合中去。</p><p>当 destination 集合已经包含 member 元素时， SMOVE 命令只是简单地将 source 集合中的 member 元素删除。</p><p>当 source 或 destination 不是集合类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;ni&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;hao&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;ya&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;zhe&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smove myset myset2 <span class="string">&quot;hello&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hao&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;ni&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;ya&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;zhe&quot;</span></span><br></pre></td></tr></table></figure><h4 id="sdiff"><a href="#sdiff" class="headerlink" title="sdiff"></a>sdiff</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>sdiff key [key …]</td><td>返回第一个集合与其他集合之间的差集，也可以认为说第一个集合中独有的元素</td></tr></tbody></table><p>不存在的集合 key 将视为空集</p><p>差集的结果来自前面的 first_key,而不是后面的 other_key1，也不是整个 first_key other_key1..other_kenn 的差集</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key1 &#x3D; &#123;a,b,c,d&#125;</span><br><span class="line">key2 &#x3D; &#123;c&#125;</span><br><span class="line">key3 &#x3D; &#123;a,c,e&#125;</span><br><span class="line">sdiff key1 key2 key3 &#x3D; &#123;b,d&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset   <span class="comment"># a,b,c,d</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset2   <span class="comment"># c,d,e,f</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sdiff myset myset2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><h4 id="sinter"><a href="#sinter" class="headerlink" title="sinter"></a>sinter</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>sinter key [key …]</td><td>返回给定所有给定集合的交集</td></tr></tbody></table><p>不存在的集合 key 将视为空集。当给定集合当中有一个空集时，结果也为空集(根据集合运算定律)。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset      <span class="comment"># a,b,c,d</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset2     <span class="comment"># c,d,e,f</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sinter myset myset2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;c&quot;</span></span><br></pre></td></tr></table></figure><h4 id="sunion"><a href="#sunion" class="headerlink" title="sunion"></a>sunion</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>sunion key [key …]</td><td>返回给定集合的并集。不存在的集合 key 被视为空集。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset      <span class="comment"># a,b,c,d</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; smembers myset2     <span class="comment"># c,d,e,f</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; sunion myset myset2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Redis哈希（Hash）"><a href="#Redis哈希（Hash）" class="headerlink" title="Redis哈希（Hash）"></a>Redis哈希（Hash）</h3><p>Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。</p><p>Redis 中每个 hash 可以存储 40多亿键值对。</p><h4 id="hset"><a href="#hset" class="headerlink" title="hset"></a>hset</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hset key field value [field value …]</td><td>为哈希表中的字段赋值</td></tr></tbody></table><p>如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。</p><p>如果字段已经存在于哈希表中，旧值将被覆盖。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset myhash fidle1 <span class="string">&quot;foo&quot;</span>          </span><br><span class="line">(integer) <span class="number">1</span>                                           <span class="comment"># 如果字段是哈希表中的一个新建字段，并且值设置成功，返回 1 </span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset website google <span class="string">&quot;www.g.cn&quot;</span>        <span class="comment"># 设置一个新域</span></span><br><span class="line">(integer) <span class="number">1</span> </span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset website google <span class="string">&quot;www.google.com&quot;</span>  <span class="comment"># 覆盖一个旧域</span></span><br><span class="line">(integer) <span class="number">0</span>                                           <span class="comment"># 如果哈希表中域字段已经存在且旧值已被新值覆盖，返回 0 </span></span><br></pre></td></tr></table></figure><h4 id="hget"><a href="#hget" class="headerlink" title="hget"></a>hget</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hget key field</td><td>返回哈希表中指定字段的值</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget myhash fidle1</span><br><span class="line"><span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget website google</span><br><span class="line"><span class="string">&quot;www.google.com&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hmset"><a href="#hmset" class="headerlink" title="hmset"></a>hmset</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hmset key field value [field value …]</td><td>同时将多个 field-value (字段-值)对设置到哈希表中</td></tr></tbody></table><p>此命令会覆盖哈希表中已存在的字段。</p><p>如果哈希表不存在，会创建一个空哈希表，并执行 HMSET 操作。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hmset myhash field1 <span class="string">&quot;hello&quot;</span> field2 <span class="string">&quot;world&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget myhash field1</span><br><span class="line"><span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget myhash field2</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hmget"><a href="#hmget" class="headerlink" title="hmget"></a>hmget</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hmget key field  [field  …]</td><td>返回哈希表中，一个或多个给定字段的值</td></tr></tbody></table><p>如果指定的字段不存在于哈希表，那么返回一个 nil 值。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hmget myhash field1 field2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span>    </span><br></pre></td></tr></table></figure><h4 id="hgetall"><a href="#hgetall" class="headerlink" title="hgetall"></a>hgetall</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hgetall key</td><td>返回哈希表中，所有的字段和值</td></tr></tbody></table><p>在返回值里，紧跟每个字段名(field name)之后是字段的值(value)，所以返回值的长度是哈希表大小的两倍。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hdel"><a href="#hdel" class="headerlink" title="hdel"></a>hdel</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hdel key field [field …]</td><td>删除哈希表 key 中的一个或多个指定字段，不存在的字段将被忽略</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hdel myhash field1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hlen"><a href="#hlen" class="headerlink" title="hlen"></a>hlen</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hlen key</td><td>获取哈希表中字段的数量</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hlen myhash</span><br><span class="line">(integer) <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="hexists"><a href="#hexists" class="headerlink" title="hexists"></a>hexists</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hexists key filed</td><td>查看哈希表的指定字段是否存在</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hexists myhash field</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="hkeys"><a href="#hkeys" class="headerlink" title="hkeys"></a>hkeys</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hkeys key</td><td>获取哈希表中的所有域（field）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hkeys myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;field&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hvals"><a href="#hvals" class="headerlink" title="hvals"></a>hvals</h4><table><thead><tr><th>语法</th><th>说明</th></tr></thead><tbody><tr><td>hvals key</td><td>返回哈希表所有域(field)的值</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;field2&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;field&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hvals myhash</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h4 id="hincrby"><a href="#hincrby" class="headerlink" title="hincrby"></a>hincrby</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">hincrby key field increment</td><td align="left">为哈希表中的字段值加上指定增量值</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset myhash field <span class="number">5</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hincrby myhash field <span class="number">1</span></span><br><span class="line">(integer) <span class="number">6</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hincrby myhash field <span class="literal">-1</span></span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hincrby myhash field <span class="literal">-10</span></span><br><span class="line">(integer) <span class="literal">-5</span></span><br></pre></td></tr></table></figure><h4 id="hsetnx"><a href="#hsetnx" class="headerlink" title="hsetnx"></a>hsetnx</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">hsetnx key field value</td><td align="left">为哈希表中不存在的的字段赋值</td></tr></tbody></table><p>如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。</p><p>如果字段已经存在于哈希表中，操作无效。</p><p>如果 key 不存在，一个新哈希表被创建并执行 HSETNX 命令。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hsetnx myhash field1 <span class="string">&quot;foo&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hsetnx myhash field1 <span class="string">&quot;bar&quot;</span>    <span class="comment"># 操作无效， field1 已存在</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget myhash field1 </span><br><span class="line"><span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Redis有序集合-ZSet"><a href="#Redis有序集合-ZSet" class="headerlink" title="Redis有序集合(ZSet)"></a>Redis有序集合(ZSet)</h3><p>Redis 有序集合和集合一样也是 string 类型元素的集合,且不允许重复的成员。</p><p>不同的是每个元素都会关联一个 double 类型的分数。redis 正是通过分数来为集合中的成员进行从小到大的排序。</p><p>有序集合的成员是唯一的,但分数(score)却可以重复。</p><p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。 </p><p>集合中最大的成员数为 4294967295, 每个集合可存储40多亿个成员。</p><h4 id="zadd"><a href="#zadd" class="headerlink" title="zadd"></a>zadd</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zadd key sorce member [score member …]</td><td align="left">将一个或多个成员元素及其分数值加入到有序集当中</td></tr></tbody></table><p>如果某个成员已经是有序集的成员，那么更新这个成员的分数值，并通过重新插入这个成员元素，来保证该成员在正确的位置上。</p><p>分数值可以是整数值或双精度浮点数。</p><p>如果有序集合 key 不存在，则创建一个空的有序集并执行 ZADD 操作。</p><p>当 key 存在但不是有序集类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zadd myzset <span class="number">1</span> <span class="string">&quot;one&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zadd myzset <span class="number">1</span> <span class="string">&quot;uno&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zadd myzset <span class="number">2</span> <span class="string">&quot;two&quot;</span> <span class="number">3</span> <span class="string">&quot;three&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange myzset <span class="number">0</span> <span class="literal">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;uno&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="number">7</span>) <span class="string">&quot;three&quot;</span></span><br><span class="line"><span class="number">8</span>) <span class="string">&quot;3&quot;</span></span><br></pre></td></tr></table></figure><h4 id="zrange"><a href="#zrange" class="headerlink" title="zrange"></a>zrange</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zrange key min max [withscores]</td><td align="left">返回有序集中，指定区间内的成员</td></tr></tbody></table><p>其中成员的位置按分数值递增(从小到大)来排序。具有相同分数值的成员按字典序(lexicographical order )来排列。</p><p>如果你需要成员按值递减(从大到小)来排列，请使用 zrevrange 命令。</p><p>下标参数 min 和 max都以 0 为底，也就是说，以 0 表示有序集第一个成员，以 1 表示有序集第二个成员，以此类推。</p><p>你也可以使用负数下标，以 -1 表示最后一个成员， -2 表示倒数第二个成员，以此类推。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores   <span class="comment"># 显示整个有序集成员</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">1</span> <span class="number">2</span> withscores   <span class="comment"># 显示有序集下标区间 1 至 2 的成员</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="number">200000</span> withscores   <span class="comment"># 测试 end 下标超出最大下标时的情况</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">200000</span> <span class="number">3000000</span> withscores   <span class="comment"># 测试当给定区间不存在于有序集时的情况</span></span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure><h4 id="zrangebyscore"><a href="#zrangebyscore" class="headerlink" title="zrangebyscore"></a>zrangebyscore</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zrangebyscore key min max [withscores] [limit offset count]</td><td align="left">返回有序集合中指定分数区间的成员列表</td></tr></tbody></table><p>有序集成员按分数值递增(从小到大)次序排列。</p><p>具有相同分数值的成员按字典序来排列(该属性是有序集提供的，不需要额外的计算)。</p><p>默认情况下，区间的取值使用闭区间 (小于等于或大于等于)，你也可以通过给参数前增加 ( 符号来使用可选的开区间 (小于或大于)。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zrangebyscore zset (1 5     返回所有符合条件 1 &lt; score &lt;&#x3D; 5 的成员</span><br><span class="line">zrangebyscore zset (5 (10   返回所有符合条件 5 &lt; score &lt; 10 的成员</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrangebyscore salary <span class="literal">-inf</span> +inf    <span class="comment"># 显示整个有序集</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrangebyscore salary <span class="literal">-inf</span> +inf withscores   <span class="comment"># 显示整个有序集及成员的 score 值  -inf表示负无穷  +inf表示正无穷</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrangebyscore salary <span class="literal">-inf</span> <span class="number">5000</span> withscores  <span class="comment"># 显示工资 &lt;=5000 的所有成员 </span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrangebyscore salary (<span class="number">5000</span> (<span class="number">400000</span>   <span class="comment"># 显示工资大于 5000 小于等于 400000 的成员</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;boss&quot;</span></span><br></pre></td></tr></table></figure><h4 id="zrem"><a href="#zrem" class="headerlink" title="zrem"></a>zrem</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zrem key member [member …]</td><td align="left">移除有序集中的一个或多个成员，不存在的成员将被忽略</td></tr></tbody></table><p>当 key 存在但不是有序集类型时，返回一个错误。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrem salary jack                   <span class="comment"># 移除单个元素</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;10086&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrem salary tom boss              <span class="comment"># 移除多个元素</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure><h4 id="zcard"><a href="#zcard" class="headerlink" title="zcard"></a>zcard</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zcard key</td><td align="left">计算集合中元素的数量</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zcard salary</span><br><span class="line">(integer) <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="zrevrange"><a href="#zrevrange" class="headerlink" title="zrevrange"></a>zrevrange</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zrevrange ksy start stop [withscores]</td><td align="left">返回有序集中，指定区间内的成员</td></tr></tbody></table><p>中成员的位置按分数值递减(从大到小)来排列。</p><p>具有相同分数值的成员按字典序的逆序(reverse lexicographical order)排列。</p><p>除了成员按分数值递减的次序排列这一点外， zrevrange 命令的其他方面和 zrange 命令一样。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores        <span class="comment"># 递增排列</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;2500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;6000&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrevrange salary <span class="number">0</span> <span class="literal">-1</span> withscores    <span class="comment"># 递减排列</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;6000&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;2500&quot;</span></span><br></pre></td></tr></table></figure><h4 id="zcount"><a href="#zcount" class="headerlink" title="zcount"></a>zcount</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">zcount key min max</td><td align="left">计算有序集合中指定分数区间的成员数量</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange salary <span class="number">0</span> <span class="literal">-1</span> withscores</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;tom&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;2500&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;jack&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3000&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;boss&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;6000&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zcount salary <span class="number">2000</span> <span class="number">3500</span></span><br><span class="line">(integer) <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="geospatial地理空间"><a href="#geospatial地理空间" class="headerlink" title="geospatial地理空间"></a>geospatial地理空间</h3><h4 id="geoadd"><a href="#geoadd" class="headerlink" title="geoadd"></a>geoadd</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">geoadd key longitude latitude member [longitude latitude member …]</td><td align="left">添加一个或多个地理位置元素到一个key中</td></tr></tbody></table><ul><li>有效的经度是<code> -180</code>度到<code>180</code>度</li><li>有效的纬度是<code>-85.05112878</code>度到<code>85.05112878</code>度</li><li>经度（longitude）  纬度（latitude）</li></ul><blockquote><p>上海市经纬度   经度：121.48941   维度：31.40527</p><p>北京市经纬度   经度：116.23128   维度：40.22077</p><p>广州市经纬度   经度：113.27324   维度：23.15792</p><p>深圳市经纬度   经度：113.88308   维度：22.55329</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geoadd china:city <span class="number">121.48941</span> <span class="number">31.40527</span> shanghai</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geoadd china:city <span class="number">116.23128</span> <span class="number">40.22077</span> beijing</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geoadd china:city <span class="number">113.27324</span> <span class="number">23.15792</span> guangzhou</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geoadd china:city <span class="number">113.88308</span> <span class="number">22.55329</span> shenzhen</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="geopos"><a href="#geopos" class="headerlink" title="geopos"></a>geopos</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">geopos key member [member …]</td><td align="left">返回一个或多个位置的经纬度信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geopos china:city shanghai</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;121.48941010236740112&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;31.40526993848380499&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geopos china:city beijing shenzhen</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;116.23128265142440796&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;40.22076905438526495&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;113.88307839632034302&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;22.55329111565713873&quot;</span></span><br></pre></td></tr></table></figure><h4 id="geodist"><a href="#geodist" class="headerlink" title="geodist"></a>geodist</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">geodist key member1 member2 [m|km|ft|mi]</td><td align="left">返回一个key中指定两个位置之间的距离</td></tr></tbody></table><blockquote><p>m 表示单位为米。</p><p>km表示单位为千米。</p><p>mi 表示单位为英里。</p><p>ft  表示单位为英尺。</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geodist china:city beijing shanghai</span><br><span class="line"><span class="string">&quot;1088644.3544&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geodist china:city beijing shanghai km  <span class="comment"># 北京到上海的直线距离 </span></span><br><span class="line"><span class="string">&quot;1088.6444&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geodist china:city shenzhen guangzhou km  <span class="comment"># 深圳到广州的直线距离</span></span><br><span class="line"><span class="string">&quot;91.8118&quot;</span></span><br></pre></td></tr></table></figure><h4 id="georadius"><a href="#georadius" class="headerlink" title="georadius"></a>georadius</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">georadius key longitude latitude radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]</td><td align="left">以给定位置为中心，半径不超过给定半径的附近所有位置</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadius china:city <span class="number">110</span> <span class="number">30</span> <span class="number">1000</span> km  <span class="comment">#以经度110维度30位中心，查找半径在1000km以内的位置</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadius china:city <span class="number">110</span> <span class="number">30</span> <span class="number">1000</span> km withcoord  <span class="comment"># 显示他人的的定位信息</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;113.88307839632034302&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;22.55329111565713873&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;113.27324062585830688&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;23.1579209662846921&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadius china:city <span class="number">110</span> <span class="number">30</span> <span class="number">1000</span> km withdist  <span class="comment">#  显示到中间距离的位置</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;914.1294&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;827.6084&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadius china:city <span class="number">110</span> <span class="number">30</span> <span class="number">1000</span> km withhash</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line">   <span class="number">2</span>) (integer) <span class="number">4046340107163728</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   <span class="number">2</span>) (integer) <span class="number">4046534010880445</span></span><br><span class="line">   <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadius china:city <span class="number">110</span> <span class="number">30</span> <span class="number">1000</span> km withcoord count <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;113.27324062585830688&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;23.1579209662846921&quot;</span></span><br></pre></td></tr></table></figure><h4 id="georadiusbymember"><a href="#georadiusbymember" class="headerlink" title="georadiusbymember"></a>georadiusbymember</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">georadiusbymember key member radius m|km|ft|mi [withdist] [withhash] [count count]</td><td align="left">使用输入的经度和纬度来决定中心点，找出位于指定范围内的元素</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; georadiusbymember china:city beijing <span class="number">1000</span> km  <span class="comment"># 北京周围1000km的城市</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;beijing&quot;</span></span><br></pre></td></tr></table></figure><h4 id="geohash"><a href="#geohash" class="headerlink" title="geohash"></a>geohash</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">geohash key member [member…]</td><td align="left">返回一个或多个位置元素的 Geohash表示</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; geohash china:city beijing shanghai</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;wx4sucvncn0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;wtw6st1uuq0&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>geo底层的实现原理其实就是Zset，我们可以使用Zset命令来操作geo</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange china:city <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;beijing&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrem china:city beijing</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; zrange china:city <span class="number">0</span> <span class="literal">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;shenzhen&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;guangzhou&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;shanghai&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h3><p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p><p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p><p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p><blockquote><p>A={1,3,5,7,8,7,8}</p><p>B={1,3,5,8}</p><p>A与B的基数是5，基数就是不重复元素，基数估计就是在误差可接受的范围内，快速计算基数</p></blockquote><h4 id="pfadd"><a href="#pfadd" class="headerlink" title="pfadd"></a>pfadd</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">pfadd key element [element …]</td><td align="left">将所有元素参数添加到 HyperLogLog 数据结构中</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfadd mykey a b b c d e f g <span class="built_in">h</span> i j</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="pfcount"><a href="#pfcount" class="headerlink" title="pfcount"></a>pfcount</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">pfcount key [key …]</td><td align="left">返回给定 HyperLogLog 的基数估算值</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfadd mykey a b b c d e f g <span class="built_in">h</span> i j</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfcount mykey         <span class="comment"># 不重复的元素个数</span></span><br><span class="line">(integer) <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="pfmerge"><a href="#pfmerge" class="headerlink" title="pfmerge"></a>pfmerge</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">pfmerge destkey sourcekey [sourcekey …]</td><td align="left">将多个 HyperLogLog 合并为一个 HyperLogLog</td></tr></tbody></table><p>合并后的 HyperLogLog 的基数估算值是通过对所有 给定 HyperLogLog 进行并集计算得出的。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfadd mykey a b c d e</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfadd mykey2 e f g <span class="built_in">h</span> i j k</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfmerge mykey3 mykey mykey2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; pfcount mykey3</span><br><span class="line">(integer) <span class="number">11</span></span><br></pre></td></tr></table></figure><h3 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h3><p>Redis提供的Bitmaps这个“数据结构”可以实现对位的操作。Bitmaps本身不是一种数据结构，实际上就是字符串，但是它可以对字符串的位进行操作。</p><p>可以把Bitmaps想象成一个以位为单位数组，数组中的每个单元只能存0或者1，数组的下标在bitmaps中叫做偏移量。单个bitmaps的最大长度是512MB，即2^32个比特位。</p><p>统计用户信息，例如统计活跃、不活跃！登录、未登录！打卡、未打卡！两个状态的，都可以使用Bitmps</p><p>Bitmaps位图，数据结构！都是操作二进制位来进行记录，就只有0和1两个状态！</p><h4 id="setbit"><a href="#setbit" class="headerlink" title="setbit"></a>setbit</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">setbit key offset value</td><td align="left">对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)，返回指定偏移量原来储存的位</td></tr></tbody></table><p>例如使用Bitmaps来记录周一到周日的打卡记录</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">0</span> <span class="number">1</span>     <span class="comment"># 星期一打卡，记为1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">1</span> <span class="number">0</span>     <span class="comment"># 星期二未打卡，记为0</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">2</span> <span class="number">0</span>     <span class="comment"># 星期三未打卡，记为0</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">3</span> <span class="number">1</span>     <span class="comment"># 星期四打卡，记为1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">4</span> <span class="number">1</span>     <span class="comment"># 星期五打卡，记为1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">5</span> <span class="number">1</span>     <span class="comment"># 星期六打卡，记为1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; setbit sign <span class="number">6</span> <span class="number">0</span>     <span class="comment"># 星期日未打卡，记为0</span></span><br><span class="line">(integer) <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="getbit"><a href="#getbit" class="headerlink" title="getbit"></a>getbit</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">getbit key offset</td><td align="left">对 key 所储存的字符串值，获取指定偏移量上的位(bit)</td></tr></tbody></table><p>查看某一天是否打卡</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getbit sign <span class="number">0</span>    <span class="comment"># 获取星期一打的打卡记录，星期一打卡</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getbit sign <span class="number">1</span>    <span class="comment"># 获取星期二打的打卡记录，星期二未打卡</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; getbit sign <span class="number">3</span>    <span class="comment"># 获取星期四打的打卡记录，星期四打卡</span></span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="bitcount"><a href="#bitcount" class="headerlink" title="bitcount"></a>bitcount</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">bitcount key [start end]</td><td align="left">计算给定字符串中，被设置为 1的比特位的数量</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; bitcount sign   <span class="comment"># 统计值为1的数量，共计4天打卡</span></span><br><span class="line">(integer) <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h3><p>Redis 事务可以一次执行多个命令， 并且带有以下三个重要的保证：</p><ul><li>批量操作在发送 EXEC 命令前被放入队列缓存。</li><li>收到 EXEC 命令后进入事务执行，事务中任意命令执行失败，其余的命令依然被执行。</li><li>在事务执行过程，其他客户端提交的命令请求不会插入到事务执行命令序列中。</li></ul><p>一个事务从开始到执行会经历以下三个阶段：</p><ul><li>开始事务（multi）</li><li>命令入队（一系列命令）</li><li>执行事务（exec）</li></ul><p>Redis单条命令是保证原子性的，但是redis事务是不保证原子性的。</p><p>redis事务的本质：一组命令的集合！一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行。</p><p>一次性、顺序性、排他性！执行一系列的命令。</p><p>Redis的事务没有隔离级别的概念！所有命令在事务中，并没有被直接执行！只有发起执行命令exec时候才会执行！</p><p>Redis可以实现乐观锁！</p><h4 id="multi"><a href="#multi" class="headerlink" title="multi"></a>multi</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">multi</td><td align="left">标记一个事务块的开始</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi    <span class="comment"># 标记一个事务块的开始</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">exec</td><td align="left">执行所有事务块内的命令</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi               <span class="comment"># 开始事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k1 v1       <span class="comment"># set一个值k1        </span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k2 v2       <span class="comment"># set一个值k2</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; get k2          <span class="comment"># get一个值k2</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k3 v3       <span class="comment"># set一个值k3</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec            <span class="comment"># 执行事务，返回事务块内所有命令的返回值，按命令执行的先后顺序排列。 当操作被打断时，返回空值 nil </span></span><br><span class="line"><span class="number">1</span>) OK                               <span class="comment"># 可以发现，入队的时候并没有被执行，而是执行exec命令时事务才被执行</span></span><br><span class="line"><span class="number">2</span>) OK                               <span class="comment"># 这个事务已经结束</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;v2&quot;</span></span><br><span class="line"><span class="number">4</span>) OK</span><br></pre></td></tr></table></figure><blockquote><p>编译型异常（代码有问题！命令有错！），事务中的所有命令都不会被执行！</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi            <span class="comment"># 开始事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k1 v1    <span class="comment"># set一个值k1   </span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k2 v2    <span class="comment"># set一个值k2</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k3 v3    <span class="comment"># set一个值k3</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; getset k2    <span class="comment"># getset这条命令执行错误（命令错误），正确应该是 getset key value</span></span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;getset&#x27;</span> command    <span class="comment"># 返回一个错误</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k4 v4    <span class="comment"># set一个值k4</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec         <span class="comment"># 执行事务报错，所有命令都没有被执行</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get k4           <span class="comment"># 事务没有被执行，k4没有被赋值</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><blockquote><p>运行时异常（比如1除以0  1/0）,如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的！错误命令抛出异常</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k1 <span class="string">&quot;v1&quot;</span>        <span class="comment"># set 一个 字符串</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi              <span class="comment"># 开始事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; incr k1        <span class="comment"># incr加一，由于k1是一个字符串，所以这里不会加1，执行的时候失败</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k2 v2      <span class="comment"># set一个值k2</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k3 v3      <span class="comment"># set一个值k3</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; get k3         <span class="comment"># get一个值k3</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec           <span class="comment"># 执行事务,按照顺序执行！虽然第一条命令报错了，但是依旧执行成功了</span></span><br><span class="line"><span class="number">1</span>) (error) ERR value is not an integer or out of range</span><br><span class="line"><span class="number">2</span>) OK</span><br><span class="line"><span class="number">3</span>) OK</span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;v3&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get k2            <span class="comment"># k2 设置成功</span></span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get k3            <span class="comment"># k3 设置成功</span></span><br><span class="line"><span class="string">&quot;v3&quot;</span></span><br></pre></td></tr></table></figure><h4 id="discard"><a href="#discard" class="headerlink" title="discard"></a>discard</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">discard</td><td align="left">用于取消事务，放弃执行事务块内的所有命令。</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi             <span class="comment"># 开始事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k1 v1     <span class="comment"># set一个值k1   </span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k2 v2     <span class="comment"># set一个值k2</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; <span class="built_in">set</span> k4 v4     <span class="comment"># set一个值k3</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; discard       <span class="comment"># 取消事务,队列中的命令都不会被执行</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get k4            <span class="comment"># 由于事务被取消了，k4没有被set值，所以返回nil</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">watch</td><td align="left">用于监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断</td></tr></tbody></table><p>悲观锁：顾名思义，很悲观，什么时候都会出问题，无论做什么都加锁！</p><p>乐观锁：顾名思义，很乐观，认为什么时候都不会出问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据。一般是在数据表中加上一个数据版本号 version 字段，表示数据被修改的次数。当数据被修改时，version 值会+1。当线程A要更新数据值时，在读取数据的同时也会读取 version 值，在提交更新时，若刚才读取到的 version 值与当前数据库中的 version 值相等时才更新，否则重试更新操作，直到更新成功。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> money <span class="number">100</span>        <span class="comment"># 有100块钱</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> out <span class="number">0</span>            <span class="comment"># 花掉了0元，此时还剩100元</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; watch money          <span class="comment"># 监视money对象</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi                <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; decrby money <span class="number">20</span>  <span class="comment"># 花了100块钱，还剩80元</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; incrby out <span class="number">20</span>    <span class="comment"># 花掉的钱是20元</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec              <span class="comment"># 执行事务，事务正常结束，数据期间没有发生变动，正常执行成功！</span></span><br><span class="line"><span class="number">1</span>) (integer) <span class="number">80</span></span><br><span class="line"><span class="number">2</span>) (integer) <span class="number">20</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一个redis客户端窗口（第一个线程）</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; watch money            <span class="comment"># 监视money对象</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi                  <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; decrby money <span class="number">10</span>    <span class="comment"># 花了10块钱，money减10元</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; incrby out <span class="number">10</span>      <span class="comment"># 花掉的钱，out加10元</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt;                    <span class="comment"># 此时没有执行exec命令。而是新开了一个新的redis客户端窗口(另外一个线程)</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec               <span class="comment"># 在第二个redis客户端窗口执行set money命令后再执行exec命令</span></span><br><span class="line">(nil)                                  <span class="comment"># 监视失败，使用watch可以当做redis乐观锁操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二个redis客户端窗口（第二个线程）</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get money             <span class="comment"># 在第二个redis客户端窗口获取money值，为80</span></span><br><span class="line"><span class="string">&quot;80&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> money <span class="number">1000</span>        <span class="comment"># 在第二个redis客户端窗口修改了money值，改为了 1000</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="unwatch"><a href="#unwatch" class="headerlink" title="unwatch"></a>unwatch</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">unwatch</td><td align="left">取消 WATCH 命令对所有 key 的监视</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; unwatch             <span class="comment"># 如果发现事务执行失败，就先解锁</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; watch money          <span class="comment"># 获取最新的值，再次监视</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; decrby money <span class="number">20</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; incrby out <span class="number">20</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>(TX)&gt; exec             <span class="comment"># 对比监视的值是否发生了变化，如果没有变化那么可以执行成功，如果变化了，就执行失败</span></span><br><span class="line"><span class="number">1</span>) (integer) <span class="number">80</span>                      <span class="comment"># 如果修改失败，获取最新的值就好</span></span><br><span class="line"><span class="number">2</span>) (integer) <span class="number">20</span></span><br></pre></td></tr></table></figure><h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><p>jedis是redis的java版本的客户端实现</p><p>导入对应的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编码测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis=<span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        System.out.println(jedis.ping()); <span class="comment">//PONG</span></span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));<span class="comment">//zhangsan</span></span><br><span class="line">        System.out.println(jedis.exists(<span class="string">&quot;name&quot;</span>));<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>通过jedis理解事务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Jedis jedis=<span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">    Transaction multi = jedis.multi();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        multi.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        multi.set(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line">        <span class="comment">//int i=1/0; //代码抛出异常，执行失败</span></span><br><span class="line">        multi.exec(); <span class="comment">//执行事务</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        multi.discard(); <span class="comment">//放弃事务</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">        jedis.close();<span class="comment">//关闭连接</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Redis-cong详解"><a href="#Redis-cong详解" class="headerlink" title="Redis.cong详解"></a>Redis.cong详解</h3><p>Redis 的配置文件位于 Redis 安装目录下，文件名为 <strong>redis.conf</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis.conf</span></span><br></pre></td></tr></table></figure><h4 id="config-get"><a href="#config-get" class="headerlink" title="config get"></a>config get</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">config get name</td><td align="left">查看或设置配置项</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get loglevel</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;loglevel&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;notice&quot;</span></span><br></pre></td></tr></table></figure><p>使用 ***** 号获取所有配置项</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get *</span><br><span class="line">  <span class="number">1</span>) <span class="string">&quot;rdbchecksum&quot;</span></span><br><span class="line">  <span class="number">2</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="number">3</span>) <span class="string">&quot;daemonize&quot;</span></span><br><span class="line">  <span class="number">4</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="number">5</span>) <span class="string">&quot;io-threads-do-reads&quot;</span></span><br><span class="line">  <span class="number">6</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line">  <span class="number">7</span>) <span class="string">&quot;lua-replicate-commands&quot;</span></span><br><span class="line">  <span class="number">8</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="number">9</span>) <span class="string">&quot;always-show-logo&quot;</span></span><br><span class="line"> <span class="number">10</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">11</span>) <span class="string">&quot;protected-mode&quot;</span></span><br><span class="line"> <span class="number">12</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">13</span>) <span class="string">&quot;rdbcompression&quot;</span></span><br><span class="line"> <span class="number">14</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">15</span>) <span class="string">&quot;rdb-del-sync-files&quot;</span></span><br><span class="line"> <span class="number">16</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">17</span>) <span class="string">&quot;activerehashing&quot;</span></span><br><span class="line"> <span class="number">18</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">19</span>) <span class="string">&quot;stop-writes-on-bgsave-error&quot;</span></span><br><span class="line"> <span class="number">20</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">21</span>) <span class="string">&quot;set-proc-title&quot;</span></span><br><span class="line"> <span class="number">22</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">23</span>) <span class="string">&quot;dynamic-hz&quot;</span></span><br><span class="line"> <span class="number">24</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">25</span>) <span class="string">&quot;lazyfree-lazy-eviction&quot;</span></span><br><span class="line"> <span class="number">26</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">27</span>) <span class="string">&quot;lazyfree-lazy-expire&quot;</span></span><br><span class="line"> <span class="number">28</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">29</span>) <span class="string">&quot;lazyfree-lazy-server-del&quot;</span></span><br><span class="line"> <span class="number">30</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">31</span>) <span class="string">&quot;lazyfree-lazy-user-del&quot;</span></span><br><span class="line"> <span class="number">32</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">33</span>) <span class="string">&quot;lazyfree-lazy-user-flush&quot;</span></span><br><span class="line"> <span class="number">34</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">35</span>) <span class="string">&quot;repl-disable-tcp-nodelay&quot;</span></span><br><span class="line"> <span class="number">36</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">37</span>) <span class="string">&quot;repl-diskless-sync&quot;</span></span><br><span class="line"> <span class="number">38</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">39</span>) <span class="string">&quot;gopher-enabled&quot;</span></span><br><span class="line"> <span class="number">40</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">41</span>) <span class="string">&quot;aof-rewrite-incremental-fsync&quot;</span></span><br><span class="line"> <span class="number">42</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">43</span>) <span class="string">&quot;no-appendfsync-on-rewrite&quot;</span></span><br><span class="line"> <span class="number">44</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">45</span>) <span class="string">&quot;cluster-require-full-coverage&quot;</span></span><br><span class="line"> <span class="number">46</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">47</span>) <span class="string">&quot;rdb-save-incremental-fsync&quot;</span></span><br><span class="line"> <span class="number">48</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">49</span>) <span class="string">&quot;aof-load-truncated&quot;</span></span><br><span class="line"> <span class="number">50</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">51</span>) <span class="string">&quot;aof-use-rdb-preamble&quot;</span></span><br><span class="line"> <span class="number">52</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">53</span>) <span class="string">&quot;cluster-replica-no-failover&quot;</span></span><br><span class="line"> <span class="number">54</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">55</span>) <span class="string">&quot;cluster-slave-no-failover&quot;</span></span><br><span class="line"> <span class="number">56</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">57</span>) <span class="string">&quot;replica-lazy-flush&quot;</span></span><br><span class="line"> <span class="number">58</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">59</span>) <span class="string">&quot;slave-lazy-flush&quot;</span></span><br><span class="line"> <span class="number">60</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">61</span>) <span class="string">&quot;replica-serve-stale-data&quot;</span></span><br><span class="line"> <span class="number">62</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">63</span>) <span class="string">&quot;slave-serve-stale-data&quot;</span></span><br><span class="line"> <span class="number">64</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">65</span>) <span class="string">&quot;replica-read-only&quot;</span></span><br><span class="line"> <span class="number">66</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">67</span>) <span class="string">&quot;slave-read-only&quot;</span></span><br><span class="line"> <span class="number">68</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">69</span>) <span class="string">&quot;replica-ignore-maxmemory&quot;</span></span><br><span class="line"> <span class="number">70</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">71</span>) <span class="string">&quot;slave-ignore-maxmemory&quot;</span></span><br><span class="line"> <span class="number">72</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">73</span>) <span class="string">&quot;jemalloc-bg-thread&quot;</span></span><br><span class="line"> <span class="number">74</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">75</span>) <span class="string">&quot;activedefrag&quot;</span></span><br><span class="line"> <span class="number">76</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">77</span>) <span class="string">&quot;syslog-enabled&quot;</span></span><br><span class="line"> <span class="number">78</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">79</span>) <span class="string">&quot;cluster-enabled&quot;</span></span><br><span class="line"> <span class="number">80</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">81</span>) <span class="string">&quot;appendonly&quot;</span></span><br><span class="line"> <span class="number">82</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">83</span>) <span class="string">&quot;cluster-allow-reads-when-down&quot;</span></span><br><span class="line"> <span class="number">84</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">85</span>) <span class="string">&quot;crash-log-enabled&quot;</span></span><br><span class="line"> <span class="number">86</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">87</span>) <span class="string">&quot;crash-memcheck-enabled&quot;</span></span><br><span class="line"> <span class="number">88</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">89</span>) <span class="string">&quot;use-exit-on-panic&quot;</span></span><br><span class="line"> <span class="number">90</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"> <span class="number">91</span>) <span class="string">&quot;disable-thp&quot;</span></span><br><span class="line"> <span class="number">92</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line"> <span class="number">93</span>) <span class="string">&quot;aclfile&quot;</span></span><br><span class="line"> <span class="number">94</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"> <span class="number">95</span>) <span class="string">&quot;unixsocket&quot;</span></span><br><span class="line"> <span class="number">96</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"> <span class="number">97</span>) <span class="string">&quot;pidfile&quot;</span></span><br><span class="line"> <span class="number">98</span>) <span class="string">&quot;/var/run/redis_6379.pid&quot;</span></span><br><span class="line"> <span class="number">99</span>) <span class="string">&quot;replica-announce-ip&quot;</span></span><br><span class="line"><span class="number">100</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">101</span>) <span class="string">&quot;slave-announce-ip&quot;</span></span><br><span class="line"><span class="number">102</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">103</span>) <span class="string">&quot;masteruser&quot;</span></span><br><span class="line"><span class="number">104</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">105</span>) <span class="string">&quot;cluster-announce-ip&quot;</span></span><br><span class="line"><span class="number">106</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">107</span>) <span class="string">&quot;syslog-ident&quot;</span></span><br><span class="line"><span class="number">108</span>) <span class="string">&quot;redis&quot;</span></span><br><span class="line"><span class="number">109</span>) <span class="string">&quot;dbfilename&quot;</span></span><br><span class="line"><span class="number">110</span>) <span class="string">&quot;dump.rdb&quot;</span></span><br><span class="line"><span class="number">111</span>) <span class="string">&quot;appendfilename&quot;</span></span><br><span class="line"><span class="number">112</span>) <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"><span class="number">113</span>) <span class="string">&quot;server_cpulist&quot;</span></span><br><span class="line"><span class="number">114</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">115</span>) <span class="string">&quot;bio_cpulist&quot;</span></span><br><span class="line"><span class="number">116</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">117</span>) <span class="string">&quot;aof_rewrite_cpulist&quot;</span></span><br><span class="line"><span class="number">118</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">119</span>) <span class="string">&quot;bgsave_cpulist&quot;</span></span><br><span class="line"><span class="number">120</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">121</span>) <span class="string">&quot;ignore-warnings&quot;</span></span><br><span class="line"><span class="number">122</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">123</span>) <span class="string">&quot;proc-title-template&quot;</span></span><br><span class="line"><span class="number">124</span>) <span class="string">&quot;&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;&quot;</span></span><br><span class="line"><span class="number">125</span>) <span class="string">&quot;masterauth&quot;</span></span><br><span class="line"><span class="number">126</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">127</span>) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line"><span class="number">128</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">129</span>) <span class="string">&quot;supervised&quot;</span></span><br><span class="line"><span class="number">130</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="number">131</span>) <span class="string">&quot;syslog-facility&quot;</span></span><br><span class="line"><span class="number">132</span>) <span class="string">&quot;local0&quot;</span></span><br><span class="line"><span class="number">133</span>) <span class="string">&quot;repl-diskless-load&quot;</span></span><br><span class="line"><span class="number">134</span>) <span class="string">&quot;disabled&quot;</span></span><br><span class="line"><span class="number">135</span>) <span class="string">&quot;loglevel&quot;</span></span><br><span class="line"><span class="number">136</span>) <span class="string">&quot;notice&quot;</span></span><br><span class="line"><span class="number">137</span>) <span class="string">&quot;maxmemory-policy&quot;</span></span><br><span class="line"><span class="number">138</span>) <span class="string">&quot;noeviction&quot;</span></span><br><span class="line"><span class="number">139</span>) <span class="string">&quot;appendfsync&quot;</span></span><br><span class="line"><span class="number">140</span>) <span class="string">&quot;everysec&quot;</span></span><br><span class="line"><span class="number">141</span>) <span class="string">&quot;oom-score-adj&quot;</span></span><br><span class="line"><span class="number">142</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="number">143</span>) <span class="string">&quot;acl-pubsub-default&quot;</span></span><br><span class="line"><span class="number">144</span>) <span class="string">&quot;allchannels&quot;</span></span><br><span class="line"><span class="number">145</span>) <span class="string">&quot;sanitize-dump-payload&quot;</span></span><br><span class="line"><span class="number">146</span>) <span class="string">&quot;no&quot;</span></span><br><span class="line"><span class="number">147</span>) <span class="string">&quot;databases&quot;</span></span><br><span class="line"><span class="number">148</span>) <span class="string">&quot;16&quot;</span></span><br><span class="line"><span class="number">149</span>) <span class="string">&quot;port&quot;</span></span><br><span class="line"><span class="number">150</span>) <span class="string">&quot;6379&quot;</span></span><br><span class="line"><span class="number">151</span>) <span class="string">&quot;io-threads&quot;</span></span><br><span class="line"><span class="number">152</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">153</span>) <span class="string">&quot;auto-aof-rewrite-percentage&quot;</span></span><br><span class="line"><span class="number">154</span>) <span class="string">&quot;100&quot;</span></span><br><span class="line"><span class="number">155</span>) <span class="string">&quot;cluster-replica-validity-factor&quot;</span></span><br><span class="line"><span class="number">156</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">157</span>) <span class="string">&quot;cluster-slave-validity-factor&quot;</span></span><br><span class="line"><span class="number">158</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">159</span>) <span class="string">&quot;list-max-ziplist-size&quot;</span></span><br><span class="line"><span class="number">160</span>) <span class="string">&quot;-2&quot;</span></span><br><span class="line"><span class="number">161</span>) <span class="string">&quot;tcp-keepalive&quot;</span></span><br><span class="line"><span class="number">162</span>) <span class="string">&quot;300&quot;</span></span><br><span class="line"><span class="number">163</span>) <span class="string">&quot;cluster-migration-barrier&quot;</span></span><br><span class="line"><span class="number">164</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">165</span>) <span class="string">&quot;active-defrag-cycle-min&quot;</span></span><br><span class="line"><span class="number">166</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">167</span>) <span class="string">&quot;active-defrag-cycle-max&quot;</span></span><br><span class="line"><span class="number">168</span>) <span class="string">&quot;25&quot;</span></span><br><span class="line"><span class="number">169</span>) <span class="string">&quot;active-defrag-threshold-lower&quot;</span></span><br><span class="line"><span class="number">170</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">171</span>) <span class="string">&quot;active-defrag-threshold-upper&quot;</span></span><br><span class="line"><span class="number">172</span>) <span class="string">&quot;100&quot;</span></span><br><span class="line"><span class="number">173</span>) <span class="string">&quot;lfu-log-factor&quot;</span></span><br><span class="line"><span class="number">174</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">175</span>) <span class="string">&quot;lfu-decay-time&quot;</span></span><br><span class="line"><span class="number">176</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">177</span>) <span class="string">&quot;replica-priority&quot;</span></span><br><span class="line"><span class="number">178</span>) <span class="string">&quot;100&quot;</span></span><br><span class="line"><span class="number">179</span>) <span class="string">&quot;slave-priority&quot;</span></span><br><span class="line"><span class="number">180</span>) <span class="string">&quot;100&quot;</span></span><br><span class="line"><span class="number">181</span>) <span class="string">&quot;repl-diskless-sync-delay&quot;</span></span><br><span class="line"><span class="number">182</span>) <span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="number">183</span>) <span class="string">&quot;maxmemory-samples&quot;</span></span><br><span class="line"><span class="number">184</span>) <span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="number">185</span>) <span class="string">&quot;maxmemory-eviction-tenacity&quot;</span></span><br><span class="line"><span class="number">186</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">187</span>) <span class="string">&quot;timeout&quot;</span></span><br><span class="line"><span class="number">188</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">189</span>) <span class="string">&quot;replica-announce-port&quot;</span></span><br><span class="line"><span class="number">190</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">191</span>) <span class="string">&quot;slave-announce-port&quot;</span></span><br><span class="line"><span class="number">192</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">193</span>) <span class="string">&quot;tcp-backlog&quot;</span></span><br><span class="line"><span class="number">194</span>) <span class="string">&quot;511&quot;</span></span><br><span class="line"><span class="number">195</span>) <span class="string">&quot;cluster-announce-bus-port&quot;</span></span><br><span class="line"><span class="number">196</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">197</span>) <span class="string">&quot;cluster-announce-port&quot;</span></span><br><span class="line"><span class="number">198</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">199</span>) <span class="string">&quot;repl-timeout&quot;</span></span><br><span class="line"><span class="number">200</span>) <span class="string">&quot;60&quot;</span></span><br><span class="line"><span class="number">201</span>) <span class="string">&quot;repl-ping-replica-period&quot;</span></span><br><span class="line"><span class="number">202</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">203</span>) <span class="string">&quot;repl-ping-slave-period&quot;</span></span><br><span class="line"><span class="number">204</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">205</span>) <span class="string">&quot;list-compress-depth&quot;</span></span><br><span class="line"><span class="number">206</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">207</span>) <span class="string">&quot;rdb-key-save-delay&quot;</span></span><br><span class="line"><span class="number">208</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">209</span>) <span class="string">&quot;key-load-delay&quot;</span></span><br><span class="line"><span class="number">210</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">211</span>) <span class="string">&quot;active-expire-effort&quot;</span></span><br><span class="line"><span class="number">212</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">213</span>) <span class="string">&quot;hz&quot;</span></span><br><span class="line"><span class="number">214</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">215</span>) <span class="string">&quot;min-replicas-to-write&quot;</span></span><br><span class="line"><span class="number">216</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">217</span>) <span class="string">&quot;min-slaves-to-write&quot;</span></span><br><span class="line"><span class="number">218</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">219</span>) <span class="string">&quot;min-replicas-max-lag&quot;</span></span><br><span class="line"><span class="number">220</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">221</span>) <span class="string">&quot;min-slaves-max-lag&quot;</span></span><br><span class="line"><span class="number">222</span>) <span class="string">&quot;10&quot;</span></span><br><span class="line"><span class="number">223</span>) <span class="string">&quot;maxclients&quot;</span></span><br><span class="line"><span class="number">224</span>) <span class="string">&quot;10000&quot;</span></span><br><span class="line"><span class="number">225</span>) <span class="string">&quot;active-defrag-max-scan-fields&quot;</span></span><br><span class="line"><span class="number">226</span>) <span class="string">&quot;1000&quot;</span></span><br><span class="line"><span class="number">227</span>) <span class="string">&quot;slowlog-max-len&quot;</span></span><br><span class="line"><span class="number">228</span>) <span class="string">&quot;128&quot;</span></span><br><span class="line"><span class="number">229</span>) <span class="string">&quot;acllog-max-len&quot;</span></span><br><span class="line"><span class="number">230</span>) <span class="string">&quot;128&quot;</span></span><br><span class="line"><span class="number">231</span>) <span class="string">&quot;lua-time-limit&quot;</span></span><br><span class="line"><span class="number">232</span>) <span class="string">&quot;5000&quot;</span></span><br><span class="line"><span class="number">233</span>) <span class="string">&quot;cluster-node-timeout&quot;</span></span><br><span class="line"><span class="number">234</span>) <span class="string">&quot;15000&quot;</span></span><br><span class="line"><span class="number">235</span>) <span class="string">&quot;slowlog-log-slower-than&quot;</span></span><br><span class="line"><span class="number">236</span>) <span class="string">&quot;10000&quot;</span></span><br><span class="line"><span class="number">237</span>) <span class="string">&quot;latency-monitor-threshold&quot;</span></span><br><span class="line"><span class="number">238</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">239</span>) <span class="string">&quot;proto-max-bulk-len&quot;</span></span><br><span class="line"><span class="number">240</span>) <span class="string">&quot;536870912&quot;</span></span><br><span class="line"><span class="number">241</span>) <span class="string">&quot;stream-node-max-entries&quot;</span></span><br><span class="line"><span class="number">242</span>) <span class="string">&quot;100&quot;</span></span><br><span class="line"><span class="number">243</span>) <span class="string">&quot;repl-backlog-size&quot;</span></span><br><span class="line"><span class="number">244</span>) <span class="string">&quot;1048576&quot;</span></span><br><span class="line"><span class="number">245</span>) <span class="string">&quot;maxmemory&quot;</span></span><br><span class="line"><span class="number">246</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">247</span>) <span class="string">&quot;hash-max-ziplist-entries&quot;</span></span><br><span class="line"><span class="number">248</span>) <span class="string">&quot;512&quot;</span></span><br><span class="line"><span class="number">249</span>) <span class="string">&quot;set-max-intset-entries&quot;</span></span><br><span class="line"><span class="number">250</span>) <span class="string">&quot;512&quot;</span></span><br><span class="line"><span class="number">251</span>) <span class="string">&quot;zset-max-ziplist-entries&quot;</span></span><br><span class="line"><span class="number">252</span>) <span class="string">&quot;128&quot;</span></span><br><span class="line"><span class="number">253</span>) <span class="string">&quot;active-defrag-ignore-bytes&quot;</span></span><br><span class="line"><span class="number">254</span>) <span class="string">&quot;104857600&quot;</span></span><br><span class="line"><span class="number">255</span>) <span class="string">&quot;hash-max-ziplist-value&quot;</span></span><br><span class="line"><span class="number">256</span>) <span class="string">&quot;64&quot;</span></span><br><span class="line"><span class="number">257</span>) <span class="string">&quot;stream-node-max-bytes&quot;</span></span><br><span class="line"><span class="number">258</span>) <span class="string">&quot;4096&quot;</span></span><br><span class="line"><span class="number">259</span>) <span class="string">&quot;zset-max-ziplist-value&quot;</span></span><br><span class="line"><span class="number">260</span>) <span class="string">&quot;64&quot;</span></span><br><span class="line"><span class="number">261</span>) <span class="string">&quot;hll-sparse-max-bytes&quot;</span></span><br><span class="line"><span class="number">262</span>) <span class="string">&quot;3000&quot;</span></span><br><span class="line"><span class="number">263</span>) <span class="string">&quot;tracking-table-max-keys&quot;</span></span><br><span class="line"><span class="number">264</span>) <span class="string">&quot;1000000&quot;</span></span><br><span class="line"><span class="number">265</span>) <span class="string">&quot;client-query-buffer-limit&quot;</span></span><br><span class="line"><span class="number">266</span>) <span class="string">&quot;1073741824&quot;</span></span><br><span class="line"><span class="number">267</span>) <span class="string">&quot;repl-backlog-ttl&quot;</span></span><br><span class="line"><span class="number">268</span>) <span class="string">&quot;3600&quot;</span></span><br><span class="line"><span class="number">269</span>) <span class="string">&quot;auto-aof-rewrite-min-size&quot;</span></span><br><span class="line"><span class="number">270</span>) <span class="string">&quot;67108864&quot;</span></span><br><span class="line"><span class="number">271</span>) <span class="string">&quot;logfile&quot;</span></span><br><span class="line"><span class="number">272</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">273</span>) <span class="string">&quot;watchdog-period&quot;</span></span><br><span class="line"><span class="number">274</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">275</span>) <span class="string">&quot;dir&quot;</span></span><br><span class="line"><span class="number">276</span>) <span class="string">&quot;/root&quot;</span></span><br><span class="line"><span class="number">277</span>) <span class="string">&quot;save&quot;</span></span><br><span class="line"><span class="number">278</span>) <span class="string">&quot;3600 1 300 100 60 10000&quot;</span></span><br><span class="line"><span class="number">279</span>) <span class="string">&quot;client-output-buffer-limit&quot;</span></span><br><span class="line"><span class="number">280</span>) <span class="string">&quot;normal 0 0 0 slave 268435456 67108864 60 pubsub 33554432 8388608 60&quot;</span></span><br><span class="line"><span class="number">281</span>) <span class="string">&quot;unixsocketperm&quot;</span></span><br><span class="line"><span class="number">282</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">283</span>) <span class="string">&quot;slaveof&quot;</span></span><br><span class="line"><span class="number">284</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">285</span>) <span class="string">&quot;notify-keyspace-events&quot;</span></span><br><span class="line"><span class="number">286</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">287</span>) <span class="string">&quot;bind&quot;</span></span><br><span class="line"><span class="number">288</span>) <span class="string">&quot;127.0.0.1 -::1&quot;</span></span><br><span class="line"><span class="number">289</span>) <span class="string">&quot;oom-score-adj-values&quot;</span></span><br><span class="line"><span class="number">290</span>) <span class="string">&quot;0 200 800&quot;</span></span><br></pre></td></tr></table></figure><h4 id="config-set"><a href="#config-set" class="headerlink" title="config set"></a>config set</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">config set name value</td><td align="left">修改配置</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config <span class="built_in">set</span> loglevel <span class="string">&quot;notice&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get loglevel</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;loglevel&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;notice&quot;</span></span><br></pre></td></tr></table></figure><p>启动的时候，就是通过配置文件来启动！</p><blockquote><p>单位，配置文件 unit 单位大小写不敏感</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./redis-server /path/to/redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="comment"># it in the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span><br></pre></td></tr></table></figure><blockquote><p>INCLUDES 包含</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br></pre></td></tr></table></figure><blockquote><p>NETWORK 网络</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Examples:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># bind 192.168.1.100 10.0.0.1     # listens on two specific IPv4 addresses</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 ::1              # listens on loopback IPv4 and IPv6</span></span><br><span class="line"><span class="comment"># bind * -::*                     # like the default, all available interfaces</span></span><br><span class="line">bind <span class="number">127.0</span>.<span class="number">0.1</span> -::<span class="number">1</span>   <span class="comment"># 绑定的ip</span></span><br><span class="line"></span><br><span class="line">protected<span class="literal">-mode</span> yes   <span class="comment"># 保护的模式</span></span><br><span class="line"></span><br><span class="line">port <span class="number">6379</span>            <span class="comment"># 端口</span></span><br></pre></td></tr></table></figure><blockquote><p>GENERAL 通用</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes   <span class="comment"># 以守护进程的方式运行，默认是no，我们需要自己开启为yes</span></span><br><span class="line"></span><br><span class="line">pidfile /var/run/redis_6379.pid  <span class="comment"># 如果以后台方式运行，我们就需要指定一个 pid 进程文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably)  生产环境</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice  <span class="comment"># 日志级别</span></span><br><span class="line"></span><br><span class="line">logfile <span class="string">&quot;&quot;</span>        <span class="comment"># 日志的文件位置名</span></span><br><span class="line"></span><br><span class="line">databases <span class="number">16</span>      <span class="comment"># 数据库的数量，默认是16个数据库</span></span><br><span class="line"></span><br><span class="line">always<span class="literal">-show</span><span class="literal">-logo</span> no   <span class="comment"># 是否总是显示logo</span></span><br></pre></td></tr></table></figure><blockquote><p>SNAPSHOTTING   快照</p><p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 <code>.rdb</code> <code>.aof</code>，redis是内存数据库，如果没有持久化，那么数据断电即失！</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># save 3600 1   # After 3600 seconds (an hour) if at least 1 key changed</span></span><br><span class="line"><span class="comment"># save 300 100  # After 300 seconds (5 minutes) if at least 100 keys changed</span></span><br><span class="line"><span class="comment"># save 60 10000 # After 60 seconds if at least 10000 keys changed</span></span><br><span class="line"></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span>   <span class="comment"># 如果900秒内，如果至少有 1 个key进行了修改，我们将进行持久化操作</span></span><br><span class="line">save <span class="number">300</span> <span class="number">10</span>  <span class="comment"># 如果300秒内，如果至少有 10 个key进行了修改，我们将进行持久化操作</span></span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span> <span class="comment"># 如果60秒内，如果至少有 10000 个key进行了修改，我们将进行持久化操作</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">stop-writes</span><span class="literal">-on</span><span class="literal">-bgsave</span><span class="literal">-error</span> yes  <span class="comment"># 持久化如果出错，是否还需要继续工作</span></span><br><span class="line"></span><br><span class="line">rdbcompression yes  <span class="comment"># 是否压缩rdb文件，需要消耗一些cpu资源</span></span><br><span class="line"></span><br><span class="line">rdbchecksum yes  <span class="comment"># 保存rdb文件的时候，进行错误的检查校验</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> ./   <span class="comment"># rdb文件保存的目录</span></span><br></pre></td></tr></table></figure><blockquote><p>SECURITY 安全</p><p>可以在这里设置redis的密码，默认是没有密码的！</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get requirepass    <span class="comment"># 获取redis密码</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config <span class="built_in">set</span> requirepass <span class="string">&quot;123456&quot;</span>  <span class="comment"># 设置redis密码</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; auth <span class="number">123456</span>               <span class="comment"># 使用密码进行登录</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get requirepass</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>CLIENTS 限制 </p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclients <span class="number">10000</span>   <span class="comment"># 设置能连接上redis的最大客户端数量</span></span><br></pre></td></tr></table></figure><blockquote><p>MEMORY MANAGEMENT</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;  <span class="comment"># redis配置最大的内存容量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># volatile-lru -&gt; 只对设置了过期时间的key进行LRU(默认值)</span></span><br><span class="line"><span class="comment"># allkeys-lru -&gt; 删除lru算法的 key</span></span><br><span class="line"><span class="comment"># volatile-lfu -&gt; </span></span><br><span class="line"><span class="comment"># allkeys-lfu -&gt; </span></span><br><span class="line"><span class="comment"># volatile-random -&gt; 随机删除即将过期的 key</span></span><br><span class="line"><span class="comment"># allkeys-random -&gt; 随机删除</span></span><br><span class="line"><span class="comment"># volatile-ttl -&gt; 删除即将过期的</span></span><br><span class="line"><span class="comment"># noeviction -&gt; 永不过期，返回错误</span></span><br><span class="line">maxmemory<span class="literal">-policy</span> noeviction   <span class="comment"># 内存到达上限之后的处理策略</span></span><br></pre></td></tr></table></figure><blockquote><p>APPEND ONLY MODE   模式  aof 配置</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment"># 默认是不开启aof模式的，默认是rdb方式持久化的，在大部分所有的情况下，rdb完全够用！</span></span><br><span class="line"></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span>  <span class="comment"># 持久化的文件的名字  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always   # 每次修改都会写入同步 sync 。消耗性能</span></span><br><span class="line">appendfsync everysec   <span class="comment"># 每秒执行一次同步 sync，可能会丢失这 1s 的数据</span></span><br><span class="line"><span class="comment"># appendfsync no       # 不执行同步，这个时候操作系统自己同步数据，速度最快</span></span><br></pre></td></tr></table></figure><h3 id="RDB持久化"><a href="#RDB持久化" class="headerlink" title="RDB持久化"></a>RDB持久化</h3><p>RDB全称Redis DataBase</p><p>redis是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失，所以redis提供了持久化功能。</p><p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的 Snapshot 快照，它恢复时是将快照文件直接读到内存里。 Redis 会单独创建（ fork ）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。 RDB 的缺点是最后一次持久化后的数据可能丢失。</p><p>我们默认就是RDB，一般情况下不需要修改这个配置。rdb保存的文件是 dump.rdb。</p><p>在配置文件redis.conf配置</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># save 3600 1</span></span><br><span class="line"><span class="comment"># save 300 100</span></span><br><span class="line"><span class="comment"># save 60 10000</span></span><br><span class="line"></span><br><span class="line">save <span class="number">60</span> <span class="number">5</span> <span class="comment"># 60秒内有一个值进行了修改，则进行持久化操作</span></span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb   <span class="comment"># rdb保存的文件名 dump.rdb</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis.conf </span></span><br><span class="line">save <span class="number">60</span> <span class="number">5</span> <span class="comment"># 60秒内有一个值进行了修改，则进行持久化操作【自己测试用的】</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cd /usr/local/bin</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># ls</span></span><br><span class="line">dump.rdb  redis<span class="literal">-benchmark</span>  redis<span class="literal">-check</span><span class="literal">-rdb</span>  redis<span class="literal">-sentinel</span></span><br><span class="line">myconfig  redis<span class="literal">-check</span><span class="literal">-aof</span>  redis<span class="literal">-cli</span>        redis<span class="literal">-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># rm -rf dump.rdb   # 删除 dump.rdb</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k4 v4</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k5 v5      <span class="comment"># 60秒内修改了5个值，就会产生rdb.dump</span></span><br><span class="line">OK</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># cd myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls      # 产生的dump.rdb文件在这里</span></span><br><span class="line">dump.rdb  redis.conf</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls /root  # root目录下也有一个dump.rdb</span></span><br><span class="line">appendonly.aof  dump.rdb  yum.log</span><br></pre></td></tr></table></figure><blockquote><p>rdb文件触发机制，备份就会自动生成一个dump.rdb</p></blockquote><ol><li>save的规则满足的情况下，会触发rdb规则</li><li>执行flushall命令，也会触发rdb规则</li><li>退出redis，也会产生rdb文件</li></ol><blockquote><p>怎么恢复rdb文件？</p></blockquote><p>只需要将rdb文件放在redis启动目录即可，redis启动的时候会自动检查dump.rdb，恢复其中的数据。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get <span class="built_in">dir</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;dir&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;/usr/local/bin/myconfig&quot;</span>   <span class="comment"># 查看需要存放的位置，如果在这个目录下存在dump.rdb，启动就会自动恢复其中的数据。</span></span><br></pre></td></tr></table></figure><blockquote><p>优点</p></blockquote><ol><li>适合大规模数据恢复</li><li>对数据的完整性要求不高</li></ol><blockquote><p>缺点</p></blockquote><ol><li>需要一定的时间间隔进行操作，如果redis意外宕机了，这个最后一次修改的数据就没有了</li><li>fork进程的时候，会占用一定的内存空间</li></ol><h3 id="AOF持久化"><a href="#AOF持久化" class="headerlink" title="AOF持久化"></a>AOF持久化</h3><p>AOF全称 Append Only File</p><p>将我们所有的命令都记录下来，恢复的时候就会把这个文件全部执行一遍！</p><p>以日志的形式来记录每个写操作，将redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p><p>aof保存的文件是 appendonly.aof</p><p>aof文件默认就是文件的无限追加，文件会越来越大！</p><p>redis.conf</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">appendonly no    <span class="comment"># aof默认是不开启的，需要手动改为yes，重启redis就可以生效</span></span><br><span class="line"></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span>  <span class="comment"># aof保存的文件名是 appendonly.aof</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="comment"># appendfsync no</span></span><br><span class="line"></span><br><span class="line">no<span class="literal">-appendfsync</span><span class="literal">-on</span><span class="literal">-rewrite</span> no</span><br><span class="line"></span><br><span class="line">auto<span class="literal">-aof</span><span class="literal">-rewrite</span><span class="literal">-percentage</span> <span class="number">100</span></span><br><span class="line">auto<span class="literal">-aof</span><span class="literal">-rewrite</span><span class="literal">-min</span><span class="literal">-size</span> <span class="number">64</span>mb  <span class="comment">#如果aof文件大于64mb,太大了，fork一个新的进程将文件重写</span></span><br><span class="line"></span><br><span class="line">aof<span class="literal">-load</span><span class="literal">-truncated</span> yes</span><br><span class="line"></span><br><span class="line">aof<span class="literal">-use</span><span class="literal">-rdb</span><span class="literal">-preamble</span> yes</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis.conf </span></span><br><span class="line">appendonly yes   <span class="comment"># 开启aof</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; shutdown  <span class="comment"># 修改配置文件许重启</span></span><br><span class="line">not connected&gt; <span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># ps -ef|grep redis</span></span><br><span class="line">root     <span class="number">25039</span> <span class="number">24860</span>  <span class="number">0</span> <span class="number">14</span>:<span class="number">05</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep -<span class="literal">-color</span>=auto redis</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; config get appendonly</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;appendonly&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;yes&quot;</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># find / -name appendonly.aof   # 查找aof文件位置</span></span><br><span class="line">/root/appendonly.aof</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cat /root/appendonly.aof   # 查看aof文件内容</span></span><br><span class="line">*<span class="number">2</span></span><br><span class="line"><span class="variable">$6</span></span><br><span class="line"><span class="built_in">SELECT</span></span><br><span class="line"><span class="variable">$1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">*<span class="number">3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k1</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v1</span><br><span class="line">*<span class="number">3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k2</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v2</span><br><span class="line">*<span class="number">2</span></span><br><span class="line"><span class="variable">$6</span></span><br><span class="line"><span class="built_in">SELECT</span></span><br><span class="line"><span class="variable">$1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">*<span class="number">3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379   # 如果不小心删除了aof文件内容，redis启动会报错，需要修复</span></span><br><span class="line">Could not connect to Redis at <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>: Connection refused</span><br></pre></td></tr></table></figure><p>如果aof文件有错，这时候redis是启动不起来的，我们需要修复这个aof文件</p><p>redis给我们提供看一个工具<code>redis-check-aof --fix</code>来修复</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># ls</span></span><br><span class="line">myconfig  redis<span class="literal">-benchmark</span>  redis<span class="literal">-check</span><span class="literal">-aof</span>  redis<span class="literal">-check</span><span class="literal">-rdb</span>  redis<span class="literal">-cli</span>  redis<span class="literal">-sentinel</span>  redis<span class="literal">-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-check-aof --fix /root/appendonly.aof   # 使用redis-check-aof进行修复</span></span><br><span class="line"><span class="string">&#x27;x              7d: Expected prefix &#x27;</span><span class="variable">$</span><span class="string">&#x27;, got: &#x27;</span></span><br><span class="line">AOF analyzed: size=<span class="number">159</span>, ok_up_to=<span class="number">104</span>, <span class="built_in">diff</span>=<span class="number">55</span></span><br><span class="line">This will shrink the AOF from <span class="number">159</span> bytes, with <span class="number">55</span> bytes, to <span class="number">104</span> bytes</span><br><span class="line"><span class="keyword">Continue</span>? [<span class="type">y</span>/<span class="type">N</span>]: y</span><br><span class="line">Successfully truncated AOF</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379 </span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ping   <span class="comment">#启动成功</span></span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><blockquote><p>优点</p></blockquote><ol><li>每一次修改都同步，文件的完整会更好</li><li>每秒同步一次数据，可能会丢失一秒的数据</li><li>从不同步，效率最高的</li></ol><blockquote><p>缺点</p></blockquote><ol><li>相对于数据文件来说，aof文件远远大于rdb，修复的速度也比rdb慢</li><li>aof的运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li></ol><h3 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h3><p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。</p><p>redis客户端可以定义任意数量的频道。</p><p>订阅/发布消息图：</p><p>第一个：消息发送者  第二个：频道 第三个：消息订阅者</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis01.png"></p><p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis02.png"></p><p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis03.png"></p><h4 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">subscribe channel [channel …]</td><td align="left">订阅给定的一个或多个频道的信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; subscribe myChannel   <span class="comment"># 订阅一个频道</span></span><br><span class="line">Reading messages... (press Ctrl<span class="literal">-C</span> to quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;myChannel&quot;</span></span><br><span class="line"><span class="number">3</span>) (integer) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span>           <span class="comment"># 等待读取推送的信息</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;myChannel&quot;</span>         </span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;hello,world,nihao&quot;</span>   <span class="comment"># 这里接收下面发送的消息</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;myChannel&quot;</span>            <span class="comment"># 哪个频道的消息</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;hello,redis&quot;</span>          <span class="comment"># 消息内容</span></span><br></pre></td></tr></table></figure><h4 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h4><table><thead><tr><th align="left">语法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">publish channel message</td><td align="left">用于将信息发送到指定的频道</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; publish myChannel <span class="string">&quot;hello,world,nihao&quot;</span>  <span class="comment"># 发布者发布消息到频道</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; publish myChannel <span class="string">&quot;hello,redis&quot;</span>  <span class="comment"># 发布者发布消息到频道</span></span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h3><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！只能由主节点复制到从节点（主节点以写为主、从节点以读为主）。</p><p>默认情况下，每台Redis服务器都是主节点，一个主节点可以有0个或者多个从节点，但每个从节点只能有一个主节点。</p><blockquote><p>主从复制的作用主要包括：</p></blockquote><ol><li><p>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余的方式。</p></li><li><p>故障恢复：当主节点故障时，从节点可以暂时替代主节点提供服务，是一种服务冗余的方式</p></li><li><p>负载均衡：在主从复制的基础上，配合读写分离，由主节点进行写操作，从节点进行读操作（即写redis数据时应用连接主节点，读redis数据时应用连接从节点），分担服务器的负载；尤其是写少读多的场景下，通过多个从节点分担负载，可以大大提高redis服务器的并发量。</p></li><li><p>高可用（集群）基石：除上述作用意外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是redis高可用的基础。</p></li></ol><p>​    </p><p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的（宕机），原因如下： </p><ol><li>从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</li><li>从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为 256G ，也不能将所有内存用作 Redis 存储内存。一般来说，单台 Redis 最大使用内存不应该超过 20G 。</li></ol><p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是”多读少写”。</p><p>对于这种场景，我们可以使如下这种架构：</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis04.png"></p><p>主从复制，读写分离，80%的情况下都是在进行读操作！减缓服务器压力，架构中经常使用。一主二从。</p><p>只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用 Redis</p><blockquote><p>为什么使用集群</p></blockquote><ol><li><p>单台服务器难以负载大量的请求</p></li><li><p>单台服务器故障率高，系统崩坏概率大</p></li><li><p>单台服务器内存容量有限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication   <span class="comment"># 查看当前库的信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master    <span class="comment"># 角色  master</span></span><br><span class="line">connected_slaves:<span class="number">0</span>  <span class="comment"># 没有从机</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:<span class="number">169</span>fe236d591291c56ec23d87b251305a04c6868</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><p>因为只有一台服务器，所以需要编写3个配置文件，通过3个不同的配置文件来启动服务，搭建一个伪集群。</p><p>默认情况下，每台redis服务器都是主节点；我们一般情况下只用配置从机就好了；找老大！一主（79）二从（80,81）</p><p>从机配置：<code>slave of</code></p><p>只配置从库，不用配置主库。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cp redis.conf redis79.conf   # 拷贝redis.conf   redis79.conf模拟主机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cp redis.conf redis80.conf   # redis80.conf模拟从机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cp redis.conf redis81.conf   # redis81.conf模拟从机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ls</span></span><br><span class="line">redis79.conf  redis80.conf  redis81.conf  redis.conf</span><br></pre></td></tr></table></figure><p>  第一个redis窗口：主机（redis79.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis79.conf </span></span><br><span class="line">port <span class="number">6379</span>                         <span class="comment">#端口</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_6379.pid   <span class="comment"># pid名字</span></span><br><span class="line">logfile <span class="string">&quot;6379.log&quot;</span>                <span class="comment"># log文件名字</span></span><br><span class="line">dbfilename dump6379.rdb           <span class="comment"># dump.rdb名字</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis79.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master  <span class="comment"># 默认角色主机  master</span></span><br><span class="line">connected_slaves:<span class="number">0</span>  <span class="comment"># 没有从机</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:<span class="number">46</span>c717d739570dbd04aa91d28abe424500068e19</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">2</span>                                                <span class="comment"># 该主机有2个从机</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">378</span>,lag=<span class="number">0</span>       <span class="comment"># 从机6380</span></span><br><span class="line">slave1:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6381</span>,state=online,offset=<span class="number">378</span>,lag=<span class="number">0</span>       <span class="comment"># 从机6381</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:e60babaf15a4dada473a82d261008f1e2c5309e1</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">378</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">1</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">1</span></span><br><span class="line">repl_backlog_histlen:<span class="number">378</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># 主机可以写，从机不能写只能读！主机中的所有信息和数据，都会被从机保存！</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k1 v1   <span class="comment"># 在主机中设置值，在从机中可以读到值。</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get k1</span><br><span class="line"><span class="string">&quot;v1</span></span><br></pre></td></tr></table></figure><p>第二个redis窗口：从机（redis80.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis80.conf </span></span><br><span class="line">port <span class="number">6380</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_6380.pid</span><br><span class="line">logfile <span class="string">&quot;6380.log&quot;</span></span><br><span class="line">dbfilename dump6380.rdb</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis80.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6380</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master                                             <span class="comment"># 默认角色主机  master</span></span><br><span class="line">connected_slaves:<span class="number">0</span>                                      <span class="comment"># 没有从机</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:<span class="number">0</span>e411f26920fdc8e1c626e02acc36477ae85f9e4</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; slaveof <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span>                  <span class="comment"># 配置从机，指定主机为 127.0.0.1 6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave                                              <span class="comment"># 角色从主机变为从机  slave</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span>                                   <span class="comment"># 主机ip</span></span><br><span class="line">master_port:<span class="number">6379</span>                                        <span class="comment"># 主机端口</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:<span class="number">2</span></span><br><span class="line">master_sync_in_progress:<span class="number">0</span></span><br><span class="line">slave_repl_offset:<span class="number">14</span></span><br><span class="line">slave_priority:<span class="number">100</span></span><br><span class="line">slave_read_only:<span class="number">1</span></span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:e60babaf15a4dada473a82d261008f1e2c5309e1</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">14</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">1</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">1</span></span><br><span class="line">repl_backlog_histlen:<span class="number">14</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># 主机可以写，从机不能写只能读！主机中的所有信息和数据，都会被从机保存！</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; get k1     <span class="comment"># 读取主机设置的值</span></span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; <span class="built_in">set</span> k2 v2  <span class="comment"># 从机只能读，不能写</span></span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string">127.0.0.1:6380&gt; set k2 v2  # 从机只能读取内容，不能写</span></span><br><span class="line"><span class="string">(error) READONLY You can&#x27;</span>t <span class="built_in">write</span> against a read only replica.</span><br></pre></td></tr></table></figure><p>第三个redis窗口：从机（redis81.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim redis80.conf </span></span><br><span class="line">port <span class="number">6381</span></span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /var/run/redis_6381.pid</span><br><span class="line">logfile <span class="string">&quot;6381.log&quot;</span></span><br><span class="line">dbfilename dump6381.rdb</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis81.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6381</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; ping</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master                                               <span class="comment"># 默认角色主机  master</span></span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:<span class="number">7486</span>ac9fe45463bae0299d42294294628bea2572</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; slaveof <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span>                     <span class="comment"># 配置从机，指定主机为 127.0.0.1 6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave                                                 <span class="comment"># 角色从主机变为从机  slave</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span>                                      <span class="comment"># 主机ip</span></span><br><span class="line">master_port:<span class="number">6379</span>                                           <span class="comment"># 主机端口</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:<span class="number">5</span></span><br><span class="line">master_sync_in_progress:<span class="number">0</span></span><br><span class="line">slave_repl_offset:<span class="number">308</span></span><br><span class="line">slave_priority:<span class="number">100</span></span><br><span class="line">slave_read_only:<span class="number">1</span></span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_failover_state:no<span class="literal">-failover</span></span><br><span class="line">master_replid:e60babaf15a4dada473a82d261008f1e2c5309e1</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">308</span></span><br><span class="line">second_repl_offset:<span class="literal">-1</span></span><br><span class="line">repl_backlog_active:<span class="number">1</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">309</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># 主机可以写，从机不能写只能读！主机中的所有信息和数据，都会被从机保存！</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; get k1     <span class="comment"># 读取主机设置的值</span></span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; <span class="built_in">set</span> k2 v2  <span class="comment"># 从机只能读取内容，不能写</span></span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br></pre></td></tr></table></figure><p>第四个redis窗口：测试</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># ps -ef|grep redis</span></span><br><span class="line">root     <span class="number">16831</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">46</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-server</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span></span><br><span class="line">root     <span class="number">16844</span> <span class="number">15792</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">46</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-cli</span> <span class="literal">-p</span> <span class="number">6379</span></span><br><span class="line">root     <span class="number">16871</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">47</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-server</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span></span><br><span class="line">root     <span class="number">16885</span> <span class="number">16501</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">47</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-cli</span> <span class="literal">-p</span> <span class="number">6380</span></span><br><span class="line">root     <span class="number">16903</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">48</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-server</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span></span><br><span class="line">root     <span class="number">16913</span> <span class="number">16674</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">48</span> pts/<span class="number">2</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> redis<span class="literal">-cli</span> <span class="literal">-p</span> <span class="number">6381</span></span><br><span class="line">root     <span class="number">16992</span> <span class="number">16960</span>  <span class="number">0</span> <span class="number">20</span>:<span class="number">49</span> pts/<span class="number">3</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep -<span class="literal">-color</span>=auto redis</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p></blockquote><p>主机断开连接（shutdown），从机依旧连接到主机的，但是没有写操作，这个时候，如果主机回来了，从机依旧可以读取到主机写的信息。</p><p>如果是使用命令行来配置的主从，这个时候如果从机断开连接后，就会变成主机！此时只要变为从机，立马就会从主机中获取值。</p><blockquote><p>复制原理</p></blockquote><p>slave 启动成功连接到 master 后会发送一个 sync 同步命令 </p><p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后， master 将传送整个数据文件到 slave ，并完成一次完全同步。</p><p><strong>全量复制</strong>：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p><p><strong>增量复制</strong>： Master 继续将新的所有收集到的修改命令依次传给slave ，完成同步</p><p>但是只要是重新连接 master ，一次完全同步（全量复制）将被自动执行！我们的数据一定可以在从机中看到</p><p>真实的主从配置应该是在配置文件中配置，这样的话是永久的，我们这里使用的是命令，暂时的</p><p>配置redis.cofig配置位置如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################# REPLICATION #################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></span><br><span class="line"><span class="comment"># another Redis server. A few things to understand ASAP about Redis replication.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="comment">#   |      Master      | ---&gt; |    Replica    |</span></span><br><span class="line"><span class="comment">#   | (receive writes) |      |  (exact copy) |</span></span><br><span class="line"><span class="comment">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) Redis replication is asynchronous, but you can configure a master to</span></span><br><span class="line"><span class="comment">#    stop accepting writes if it appears to be not connected with at least</span></span><br><span class="line"><span class="comment">#    a given number of replicas.</span></span><br><span class="line"><span class="comment"># 2) Redis replicas are able to perform a partial resynchronization with the</span></span><br><span class="line"><span class="comment">#    master if the replication link is lost for a relatively small amount of</span></span><br><span class="line"><span class="comment">#    time. You may want to configure the replication backlog size (see the next</span></span><br><span class="line"><span class="comment">#    sections of this file) with a sensible value depending on your needs.</span></span><br><span class="line"><span class="comment"># 3) Replication is automatic and does not need user intervention. After a</span></span><br><span class="line"><span class="comment">#    network partition replicas automatically try to reconnect to masters</span></span><br><span class="line"><span class="comment">#    and resynchronize with them.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;      <span class="comment"># 在这里配置主机ip和端口</span></span><br></pre></td></tr></table></figure><h3 id="宕机后手动配置主机"><a href="#宕机后手动配置主机" class="headerlink" title="宕机后手动配置主机"></a>宕机后手动配置主机</h3><p>上一个主节点连接下一个从节点</p><p>如果主机断开连接，我们可以使用<code>slave of one</code> 让自己变成主机！其他的节点就可以手动连接到最新的这个主节点（手动）</p><p>如果这个时候老大修复了，那就重新连接！</p><p> 第一个redis窗口：主机（redis79.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis79.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master        <span class="comment"># 主机，下面有2个从机</span></span><br><span class="line">connected_slaves:<span class="number">2</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">111226</span>,lag=<span class="number">1</span></span><br><span class="line">slave1:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6381</span>,state=online,offset=<span class="number">111226</span>,lag=<span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">1</span>   <span class="comment"># 6381指定主机为6380，6379从机只剩一个</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">111660</span>,lag=<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k6 v6</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; shutdown   <span class="comment"># 6379如果挂了，那么6380和6381就没有老大了</span></span><br><span class="line">not connected&gt; <span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis79.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication   <span class="comment"># 6379重启后老大位置已经没了</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第二个redis窗口：从机（redis80.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis80.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6380</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave        <span class="comment"># 从机</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave       <span class="comment"># 6380还是从机            6380同时是6381的主机，6379的从机</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:<span class="number">7</span></span><br><span class="line">master_sync_in_progress:<span class="number">0</span></span><br><span class="line">slave_repl_offset:<span class="number">111590</span></span><br><span class="line">slave_priority:<span class="number">100</span></span><br><span class="line">slave_read_only:<span class="number">1</span></span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6381</span>,state=online,offset=<span class="number">111590</span>,lag=<span class="number">1</span>   <span class="comment"># 从机6380同时也是6381的主机</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; get k6</span><br><span class="line"><span class="string">&quot;v6&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; <span class="built_in">set</span> k7 v7</span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">127.0.0.1:6380&gt; slaveof no one   # 6380自己当老大了</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6380&gt; info replication</span></span><br><span class="line"><span class="string"># Replication</span></span><br><span class="line"><span class="string">role:master</span></span><br><span class="line"><span class="string">connected_slaves:1</span></span><br><span class="line"><span class="string">slave0:ip=127.0.0.1,port=6381,state=online,offset=112305,lag=1</span></span><br></pre></td></tr></table></figure><p>第三个redis窗口：从机（redis81.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis81.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6381</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave    <span class="comment"># 从机</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; slaveof <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span>   <span class="comment"># 配置从机为6380</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span>            </span><br><span class="line">master_port:<span class="number">6380</span>          <span class="comment"># 此时主机变为6380，6380也是从机，6380的主机是6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; get k6</span><br><span class="line"><span class="string">&quot;v6&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; <span class="built_in">set</span> k7 v7</span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">###################################</span></span><br><span class="line"><span class="string"># 如果此时6379挂了，没有老大了，这个时候能不能选一个老大出来呢？手动！滑稽</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; slaveof no one  # 对一个从属服务器执行命令 SLAVEOF NO ONE 将使得这个从属服务器关闭复制功能，并从从属服务器转变回主服务器，原来同步所得的数据集不会被丢弃。</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; info replication      # 6379挂了，老大没了，要自己当老大了</span></span><br><span class="line"><span class="string"># Replication</span></span><br><span class="line"><span class="string">role:master</span></span><br><span class="line"><span class="string">connected_slaves:0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; slaveof 127.0.0.1 6380       # 继续指定主机为6380，6380此时是6379的从机，6380即是主机也是从机</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; info replication</span></span><br><span class="line"><span class="string"># Replication</span></span><br><span class="line"><span class="string">role:slave</span></span><br><span class="line"><span class="string">master_host:127.0.0.1</span></span><br><span class="line"><span class="string">master_port:6380</span></span><br></pre></td></tr></table></figure><h3 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h3><p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。</p><p>自动选举老大，能够监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</p><p>哨兵模式是一种特殊的模式，首先redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，他会独立运行，其原理是<strong>哨兵通过发送命令，等待redis服务器响应，从而监控运行的多个redis实例。</strong></p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis05.png"></p><p>然而一个哨兵对redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控，各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis06.png"></p><p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行 failover 过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为<strong>主观下线</strong>．当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 failover[故障转移]操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>．</p><p>哨兵的作用：</p><ul><li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li><li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让它们切换主机。</li></ul><p>我们目前的状态是一主二从</p><ol><li><p>配置哨兵配置文件 <code>sentinel.conf</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sentinel monitor 被监控的名字 host port 1    </span></span><br><span class="line">sentinel monitor myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>后面的这个数字1代表主机挂了，slave投票看让谁接替成为主机，票数最多的，就会成为主机</p></li><li><p>启动哨兵</p></li></ol><p>如果master节点断开了，这个时候就会从从机中随机选择一个服务器！（投票算法）</p><p>如果主机此时回来了，只能归并袄新的主机下，当做从机，这就是哨兵模式的规则。</p><blockquote><p>哨兵模式的优点</p></blockquote><ol><li>哨兵集群，基于主从复制模式，所有主从配置的优点，它都有</li><li>主从可以切换，故障可以转移，系统的可用性更好</li><li>哨兵模式是主从模式的升级，手动到自动，更加健壮</li></ol><blockquote><p>哨兵模式的缺点</p></blockquote><ol><li>Redis不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦</li><li>实现哨兵模式的配置其实是很麻烦的，里面有很多配置项</li></ol><blockquote><p>哨兵模式的全部配置</p></blockquote><p>完整的哨兵模式配置文件 sentinel.conf</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line">port <span class="number">26379</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel的工作目录</span></span><br><span class="line"><span class="built_in">dir</span> /tmp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel监控的redis主节点的 ip port </span></span><br><span class="line"><span class="comment"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span></span><br><span class="line"><span class="comment"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span> <span class="number">2</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span></span><br><span class="line"><span class="comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth<span class="literal">-pass</span> mymaster MySUPER-<span class="literal">-secret</span><span class="literal">-0123passw0rd</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down<span class="literal">-after</span><span class="literal">-milliseconds</span> mymaster <span class="number">30000</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span></span><br><span class="line"><span class="comment">#这个数字越小，完成failover所需的时间就越长，</span></span><br><span class="line"><span class="comment">#但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span></span><br><span class="line"><span class="comment">#可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span></span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel<span class="literal">-syncs</span> mymaster <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span></span><br><span class="line"><span class="comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#3.当想要取消一个正在进行的failover所需要的时间。  </span></span><br><span class="line"><span class="comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span></span><br><span class="line"><span class="comment"># 默认三分钟</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover<span class="literal">-timeout</span> mymaster <span class="number">180000</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># SCRIPTS EXECUTION</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="comment">#对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span></span><br><span class="line"><span class="comment">#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span></span><br><span class="line"><span class="comment">#一个是事件的类型，</span></span><br><span class="line"><span class="comment">#一个是事件的描述。</span></span><br><span class="line"><span class="comment">#如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span></span><br><span class="line"><span class="comment">#通知脚本</span></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel notification<span class="literal">-script</span> mymaster /var/redis/notify.sh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="comment"># 以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”,</span></span><br><span class="line"><span class="comment"># &lt;role&gt;是“leader”或者“observer”中的一个。 </span></span><br><span class="line"><span class="comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel client<span class="literal">-reconfig</span><span class="literal">-script</span> mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure><p>第一个redis窗口：主机（redis79.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis79.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master        <span class="comment"># 主机，下面有2个从机</span></span><br><span class="line">connected_slaves:<span class="number">2</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">111226</span>,lag=<span class="number">1</span></span><br><span class="line">slave1:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6381</span>,state=online,offset=<span class="number">111226</span>,lag=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; shutdown   <span class="comment"># 主机挂了</span></span><br><span class="line">not connected&gt; <span class="keyword">exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-server /usr/local/bin/myconfig/redis79.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># redis-cli -p 6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; info replication   <span class="comment"># 6379主机重新连接后就只能当6380的小弟了，老大没了</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6380</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第二个redis窗口：从机（redis80.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis80.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6380</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave        <span class="comment"># 从机</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master          <span class="comment"># 6380被选为了主机</span></span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span>.<span class="number">0.1</span>,port=<span class="number">6381</span>,state=online,offset=<span class="number">19485</span>,lag=<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第三个redis窗口：从机（redis81.conf）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-server redis81.conf </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># redis-cli -p 6381</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave    <span class="comment"># 从机</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave       <span class="comment"># 主机变为了6380</span></span><br><span class="line">master_host:<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">master_port:<span class="number">6380</span></span><br></pre></td></tr></table></figure><p>第三个redis窗口：测试</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">quan</span> ~]<span class="comment"># cd /usr/local/bin/myconfig/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># vim sentinel.conf</span></span><br><span class="line">sentinel monitor myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span> <span class="number">1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># ll</span></span><br><span class="line">total <span class="number">636</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root   <span class="number">4064</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">14</span> <span class="number">6379</span>.log</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root <span class="number">141078</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">28</span> <span class="number">6380</span>.log</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root  <span class="number">92207</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">28</span> <span class="number">6381</span>.log</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root    <span class="number">111</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">28</span> appendonly.aof</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root    <span class="number">197</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">14</span> dump6379.rdb</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root    <span class="number">194</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">28</span> dump6380.rdb</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root    <span class="number">194</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">28</span> dump6381.rdb</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root     <span class="number">92</span> Apr <span class="number">11</span> <span class="number">14</span>:<span class="number">05</span> dump.rdb</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root  <span class="number">92232</span> Apr <span class="number">12</span> <span class="number">20</span>:<span class="number">40</span> redis79.conf</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root  <span class="number">92232</span> Apr <span class="number">12</span> <span class="number">20</span>:<span class="number">43</span> redis80.conf</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root  <span class="number">92232</span> Apr <span class="number">12</span> <span class="number">20</span>:<span class="number">45</span> redis81.conf</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root  <span class="number">92220</span> Apr <span class="number">11</span> <span class="number">14</span>:<span class="number">03</span> redis.conf</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root     <span class="number">42</span> Apr <span class="number">13</span> <span class="number">19</span>:<span class="number">50</span> sentinel.conf</span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">myconfig</span>]<span class="comment"># cd ..</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># ls</span></span><br><span class="line">myconfig  redis<span class="literal">-benchmark</span>  redis<span class="literal">-check</span><span class="literal">-aof</span>  redis<span class="literal">-check</span><span class="literal">-rdb</span>  redis<span class="literal">-cli</span>  redis<span class="literal">-sentinel</span>  redis<span class="literal">-server</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">quan</span> <span class="type">bin</span>]<span class="comment"># redis-sentinel myconfig/sentinel.conf    # 启动sentinel</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.598</span> <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.598</span> <span class="comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=20268, just started</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.598</span> <span class="comment"># Configuration loaded</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.599</span> * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis <span class="number">6.2</span>.<span class="number">1</span> (<span class="number">00000000</span>/<span class="number">0</span>) <span class="number">64</span> bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._                                   </span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: <span class="number">20268</span></span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">&#x27;                                           </span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span>                                               </span><br><span class="line"></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.599</span> <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.604</span> <span class="comment"># Sentinel ID is 6faff83add2c1e8f6ce7cbedac3f51cb7a0ad9fa</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.604</span> <span class="comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.605</span> * +slave slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">55</span>:<span class="number">57.610</span> * +slave slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6381</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################</span></span><br><span class="line"><span class="comment"># 此时如果主机6379挂了，哨兵投票选取主机</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.811</span> <span class="comment"># +sdown master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.811</span> <span class="comment"># +odown master myredis 127.0.0.1 6379 #quorum 1/1</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.811</span> <span class="comment"># +new-epoch 1</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.811</span> <span class="comment"># +try-failover master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.817</span> <span class="comment"># +vote-for-leader 6faff83add2c1e8f6ce7cbedac3f51cb7a0ad9fa 1</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.817</span> <span class="comment"># +elected-leader master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.817</span> <span class="comment"># +failover-state-select-slave master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.883</span> <span class="comment"># +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.883</span> * +failover<span class="literal">-state</span><span class="literal">-send</span><span class="literal">-slaveof</span><span class="literal">-noone</span> slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">01.983</span> * +failover<span class="literal">-state</span><span class="literal">-wait</span><span class="literal">-promotion</span> slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6380</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">02.041</span> <span class="comment"># +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">02.041</span> <span class="comment"># +failover-state-reconf-slaves master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">02.112</span> * +slave<span class="literal">-reconf</span><span class="literal">-sent</span> slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6381</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.056</span> * +slave<span class="literal">-reconf</span><span class="literal">-inprog</span> slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6381</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.056</span> * +slave<span class="literal">-reconf</span><span class="literal">-done</span> slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6381</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.111</span> <span class="comment"># +failover-end master myredis 127.0.0.1 6379</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.111</span> <span class="comment"># +switch-master myredis 127.0.0.1 6379 127.0.0.1 6380</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.111</span> * +slave slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6381</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6381</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">03.111</span> * +slave slave <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6379</span> <span class="selector-tag">@</span> myredis <span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">6380</span></span><br><span class="line"><span class="number">20268</span>:X <span class="number">13</span> Apr <span class="number">2021</span> <span class="number">19</span>:<span class="number">58</span>:<span class="number">33.123</span> <span class="comment"># +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ myredis 127.0.0.1 6380</span></span><br><span class="line"><span class="comment"># 主机变为了6380</span></span><br></pre></td></tr></table></figure><h3 id="缓存穿透和雪崩"><a href="#缓存穿透和雪崩" class="headerlink" title="缓存穿透和雪崩"></a>缓存穿透和雪崩</h3><p>Redis 缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面．但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。 </p><h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><blockquote><p>概念</p></blockquote><p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis 内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。<u>查不到数据</u>！</p><blockquote><p>解决方案</p></blockquote><h5 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h5><p>对所有可能查询的参数以Hash的形式存储，以便快速确定是否存在这个值，在控制层先进行拦截校验，校验不通过直接打回，减轻了存储系统的压力。</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis08.png"></p><h5 id="缓存空对象"><a href="#缓存空对象" class="headerlink" title="缓存空对象"></a>缓存空对象</h5><p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源！</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis09.png"></p><p>但是这种方法会存在两个问题： </p><ol><li>如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；</li><li>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</li></ol><h4 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h4><blockquote><p>概述</p></blockquote><p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个 key 非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key 在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p><p>当某个 key 在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。<u>量太大，缓存过期！</u></p><blockquote><p>解决方案</p></blockquote><h5 id="设置热点数据永不过期"><a href="#设置热点数据永不过期" class="headerlink" title="设置热点数据永不过期"></a>设置热点数据永不过期</h5><p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p><h5 id="加互斥锁"><a href="#加互斥锁" class="headerlink" title="加互斥锁"></a>加互斥锁</h5><p>分布式锁：使用分布式锁，保证对于每个 key 同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p><h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><blockquote><p>概念</p></blockquote><p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。</p><p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十一零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p><p><img src="https://cdn.lianjinquan.com/img/posts/redis/01/redis10.png"></p><p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p><blockquote><p>解决方案 </p></blockquote><h5 id="redis高可用"><a href="#redis高可用" class="headerlink" title="redis高可用"></a>redis高可用</h5><p> 这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作,其实就是搭建的集群。</p><h5 id="限流降级"><a href="#限流降级" class="headerlink" title="限流降级"></a>限流降级</h5><p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。 </p><h5 id="数据预热"><a href="#数据预热" class="headerlink" title="数据预热"></a>数据预热</h5><p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key ，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud系列之Ribbon负载均衡服务调用</title>
      <link href="/2021/01/22/springcloud/ribbon/"/>
      <url>/2021/01/22/springcloud/ribbon/</url>
      
        <content type="html"><![CDATA[<h3 id="Ribbon简介"><a href="#Ribbon简介" class="headerlink" title="Ribbon简介"></a>Ribbon简介</h3><p>Spring Cloud Ribbon是基于 Netflix Ribbon实现的一套客户端负载均衡的工具。<br>简单的说， Ribbon是 Netfliⅸ发布的开源项目，主要功能是提供客户端的软件负载均衡算法和服务调用。 Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出 Load Balancer(简称LB)后面所有的机器， Ribbon会自动的帮助你基于某种规则(如简单轮询,随机连接等)去连接这些机器。我们很容易使用 Ribbon实现自定义的负载均衡算法。</p><p>Ribbon目前也进入维护模式。</p><p>LB负载均衡( Load balance)是什么？<br>简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的HA(高可用)。<br>常见的负载均衡有软件 Nginx，LVS，硬件F5等。</p><p>Ribbon本地负载均衡客户端 <strong>VS</strong> Nginx服务端负载均衡区别？<br>Nginx是服务器负载均衡，客户端所有请求都会交给 nginx，然后由 nginx实现转发请求。即负载均衡是由服务端实现的。Ribbon本地负载均衡，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到 JVM本地，从而在本地实现RPC远程服务调用技术。</p><p>集中式LB<br>即在服务的消费方和提供方之间使用独立的LB设施(可以是硬件，如F5，也可以是软件，如 nginx），由该设施负责把访问请求通过某种策略转发至服务的提供方。</p><p>进程内LB<br>将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选择出一个合适的服务器。Ribbon就属于进程内LB，它只是个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址。</p><p>一句话：负载均衡+RestTemplate调用</p><h3 id="Ribbon的负载均衡和Rest调用"><a href="#Ribbon的负载均衡和Rest调用" class="headerlink" title="Ribbon的负载均衡和Rest调用"></a>Ribbon的负载均衡和Rest调用</h3><p>Ribbon其实就是一个软负载均衡的客户端组件，它可以和其他所需请求的客户端结合使用，和eureka结合只是其中的一个实例。</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/04/ribbon01.png"></p><p>Ribbon在工作时分成两步<br>第一步先选择EurekaServer，它优先选择在同一个区域内负载较少的 server。<br>第二步再根据用户指定的策略，在从 server取到的服务注册列表中选择一个地址。<br>其中 Ribbon提供了多种策略:如轮询、随机和根据响应时间加权</p>]]></content>
      
      
      <categories>
          
          <category> springCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud系列之Consul实现服务注册与发现</title>
      <link href="/2021/01/21/springcloud/consul/"/>
      <url>/2021/01/21/springcloud/consul/</url>
      
        <content type="html"><![CDATA[<h3 id="Consul简介"><a href="#Consul简介" class="headerlink" title="Consul简介"></a>Consul简介</h3><p><a href="https://www.consul.io/docs/intro">Consul官网</a></p><p><a href="https://www.springcloud.cc/spring-cloud-consul.html">Consul中文文档</a></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul01.png"></p><p>Consu是一套开源的分布式服务发现和配置管理系统，由 HashiCorp公司用Go语言开发。</p><p>提供了微服务系统中的服务治理、配置中心、控制总线等功能。这些功能中的每一个都可以根据需要单独使用，也可以一起使用以构建全方位的服务网格，总之 Consul提供了一种完整的服务网格解决方案。</p><p>它具有很多优点。包括:基于raft协议，比较简洁；支持健康检查，同时支持HTTP和DNS协议，支持跨数据中心的WAN集群，提供图形界面，跨平台,支持 Linux、Mac、 Windows</p><p>Spring Cloud Consul具有如下特性：</p><p>服务发现：提供HTTP和DNS两种发现方式。</p><p>健康监测：支持多种方式，HTTP、TCP、Docker、Shell脚本定制化。</p><p>KV存贮：key、value的存储方式。</p><p>多数据中心：Consul支持多数据中心。</p><p>可视化Web界面。</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul02.png"></p><h3 id="安装并运行Consul"><a href="#安装并运行Consul" class="headerlink" title="安装并运行Consul"></a>安装并运行Consul</h3><p><a href="https://learn.hashicorp.com/tutorials/consul/get-started-install">Consul官网安装说明</a></p><p><a href="https://www.consul.io/downloads">Consul下载地址</a></p><p>下载完成后只有一个consul.exe文件，硬盘路径下双击运行，查看版本号信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consul --version  查看版本号信息</span><br></pre></td></tr></table></figure><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul03.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consul agent -dev  使用开发模式启动</span><br></pre></td></tr></table></figure><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul04.png"></p><p>通过以下地址可以访问Consul的首页：<code>http://localhost:8500</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul05.png"></p><h3 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h3><p>新建Module，名称为cloud-provider8006</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cs.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider8006<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consule-privider</span></span><br><span class="line">  <span class="attr">cloud:</span> <span class="comment"># consule注册中心地址</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsulMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConsulMain.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写一些简单的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsulController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/consul/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with conul&quot;</span>+serverPort+ UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务</p><p>访问<code>http://localhost:8500</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul06.png"></p><p>简单测试一下</p><p>访问：<code>http://localhost:8006/consul/test</code>得到如下结果：springcloud with conul80061143c407-2abc-43b9-8684-21bcebdced01</p><h3 id="服务消费者"><a href="#服务消费者" class="headerlink" title="服务消费者"></a>服务消费者</h3><p>新建Module，名称为cloud-consumer-consul80</p><p>pom.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;myproject&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.cs.springcloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-consul80&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consule-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span> <span class="comment"># consule注册中心地址</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerController80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConsumerController80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ApplicationContextConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsulController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String INVOKE_URL = <span class="string">&quot;http://cloud-consule-privider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/consul/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/consul/test&quot;</span>, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务</p><p>访问<code>http://localhost:8500</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/03/consul07.png"></p><p>简单测试一下</p><p>访问：<code>http://localhost/consumer/consul/test</code>得到如下结果：springcloud with conul800661c710ef-1855-4d4e-95c5-fc49119ef686</p>]]></content>
      
      
      <categories>
          
          <category> springCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker简介</title>
      <link href="/2020/12/28/docker/docker01/"/>
      <url>/2020/12/28/docker/docker01/</url>
      
        <content type="html"><![CDATA[<p>docker简介、安装、常用命令</p><a id="more"></a><h2 id="Doker安装"><a href="#Doker安装" class="headerlink" title="Doker安装"></a>Doker安装</h2><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><p>安装linux环境 centos7</p><p>参考文档：<a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p><p>安装前准备：环境查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 系统内核是 3.10 以上的</span></span><br><span class="line">[root@quan ~]# uname -r</span><br><span class="line">3.10.0-862.14.4.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 系统版本</span></span><br><span class="line">[root@quan ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br></pre></td></tr></table></figure><p>安装步骤：</p><ol><li><p>卸载旧版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure></li><li><p>需要的安装包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure></li><li><p>设置镜像的仓库（使用阿里云的地址）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">   --add-repo \</span><br><span class="line">   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>更新yum包索引（推荐，可略过）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure></li><li><p>安装最新版docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li><li><p>启动docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li><li><p>使用docker version查看是否安装成功<code>docker version</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.5</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        55c4c88</span><br><span class="line"> Built:             Tue Mar  2 20:33:55 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.5</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       363e9a8</span><br><span class="line">  Built:            Tue Mar  2 20:32:17 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.4</span><br><span class="line">  GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc93</span><br><span class="line">  GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure></li><li><p>运行hello-world镜像<code>docker run hello-world</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">b8dfde127a29: Pull complete </span><br><span class="line">Digest: sha256:308866a43596e83578c7dfa15e27a73011bdd402185a84c5cd7f32a88b501a24</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta"> $</span><span class="bash"> docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure></li><li><p>查看hello-world镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hello-world   latest    d1165f221234   3 weeks ago   13.3kB</span><br></pre></td></tr></table></figure></li></ol><h3 id="卸载docker"><a href="#卸载docker" class="headerlink" title="卸载docker"></a>卸载docker</h3><p>卸载步骤：</p><ol><li><p>卸载依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li><li><p>删除资源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure></li></ol><h3 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h3><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/docker01.png"></p><p>配置使用docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://n319v3jn.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="Docker常用命名"><a href="#Docker常用命名" class="headerlink" title="Docker常用命名"></a>Docker常用命名</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version  # 版本</span><br><span class="line">docker info    # 详细信息</span><br><span class="line">docker --help  # 帮助信息</span><br></pre></td></tr></table></figure><h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><h4 id="列出本地主机上的镜像"><a href="#列出本地主机上的镜像" class="headerlink" title="列出本地主机上的镜像"></a>列出本地主机上的镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images --help</span><br><span class="line"></span><br><span class="line">Usage:  docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">List images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all images (default hides intermediate images)</span><br><span class="line">      --digests         Show digests</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print images using a Go template</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line">  -q, --quiet           Only show image IDs</span><br></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker images [options]</td><td>列出本地主机上的镜像</td><td>-a</td><td>列出本地所有镜像（含中间映像层）</td></tr><tr><td></td><td></td><td>-q</td><td>只显示镜像ID</td></tr><tr><td></td><td></td><td>–digests</td><td>显示镜像的摘要信息</td></tr><tr><td></td><td></td><td>–no-trunc</td><td>显示完整的镜像信息</td></tr></tbody></table><p>各个选项说明:</p><p>REPOSITORY：表示镜像的仓库源</p><p>TAG：镜像的标签</p><p>IMAGE ID：镜像ID</p><p>CREATED：镜像创建时间</p><p>SIZE：镜像大小</p><p> 同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   3 weeks ago    13.3kB</span><br><span class="line">tomcat        latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line">nginx         latest    f6d0b4767a6c   2 months ago   133M</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker images -a</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   3 weeks ago    13.3kB</span><br><span class="line">tomcat        latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line">nginx         latest    f6d0b4767a6c   2 months ago   133MB</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker images -q</span><br><span class="line">d1165f221234</span><br><span class="line">040bdb29ab37</span><br><span class="line">f6d0b4767a6c</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker images -qa</span><br><span class="line">d1165f221234</span><br><span class="line">040bdb29ab37</span><br><span class="line">f6d0b4767a6c</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker images --digests</span><br><span class="line">REPOSITORY    TAG       DIGEST        IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    sha256:308866a43596e83578c7dfa15e27a73011bdd402185a84c5cd7f32a88b501a24   d1165f221234   3 weeks ago    13.3kB</span><br><span class="line">tomcat        latest    sha256:94cc18203335e400dbafcd0633f33c53663b1c1012a13bcad58cced9cd9d1305   040bdb29ab37   2 months ago   649MB</span><br><span class="line">nginx         latest    sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aa   f6d0b4767a6c   2 months ago   133MB</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker images --no-trunc</span><br><span class="line">REPOSITORY    TAG       IMAGE ID           CREATED        SIZE</span><br><span class="line">hello-world   latest    sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726   3 weeks ago    13.3kB</span><br><span class="line">tomcat        latest    sha256:040bdb29ab375db2a8de090070dcbee19d43f609385a934c3f2b423e515f57bb   2 months ago   649MB</span><br><span class="line">nginx         latest    sha256:f6d0b4767a6c466c178bf718f99bea0d3742b26679081e52dbf8e0c7c4c42d74   2 months ago   133MB</span><br></pre></td></tr></table></figure><h4 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker search --help</span><br><span class="line"></span><br><span class="line">Usage:  docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">Search the Docker Hub for images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print search using a Go template</span><br><span class="line">      --limit int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br></pre></td></tr></table></figure><p>搜索的网站：<a href="https://hub.docker.com/">https://hub.docker.com/</a> 在dockerhub上搜索</p><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker search [options] 镜像名</td><td>搜索镜像</td><td>–no-trunc</td><td>显示完整的镜像信息</td></tr><tr><td></td><td></td><td>–filter</td><td>列出收藏数不小于指定值的镜像</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker search tomcat</span><br><span class="line">NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat is an open source implementati…   2983      [OK]       </span><br><span class="line">tomee                         Apache TomEE is an all-Apache Java EE certif…   86        [OK]       </span><br><span class="line">dordoka/tomcat                Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   56                   [OK]</span><br><span class="line">bitnami/tomcat                Bitnami Tomcat Docker Image                     37                   [OK]</span><br><span class="line">kubeguide/tomcat-app          Tomcat image for Chapter 1                      30                   </span><br><span class="line">consol/tomcat-7.0             Tomcat 7.0.57, 8080, &quot;admin/admin&quot;              18                   [OK]</span><br><span class="line">cloudesire/tomcat             Tomcat server, 6/7/8                            15                   [OK]</span><br><span class="line">aallam/tomcat-mysql           Debian, Oracle JDK, Tomcat &amp; MySQL              13                   [OK]</span><br><span class="line">arm32v7/tomcat                Apache Tomcat is an open source implementati…   10                   </span><br><span class="line">rightctrl/tomcat              CentOS , Oracle Java, tomcat application ssl…   6                    [OK]</span><br><span class="line">unidata/tomcat-docker         Security-hardened Tomcat Docker container.      5                    [OK]</span><br><span class="line">arm64v8/tomcat                Apache Tomcat is an open source implementati…   3                    </span><br><span class="line">jelastic/tomcat               An image of the Tomcat Java application serv…   2                    </span><br><span class="line">fabric8/tomcat-8              Fabric8 Tomcat 8 Image                          2                    [OK]</span><br><span class="line">amd64/tomcat                  Apache Tomcat is an open source implementati…   2                    </span><br><span class="line">cfje/tomcat-resource          Tomcat Concourse Resource                       2                    </span><br><span class="line">ppc64le/tomcat                Apache Tomcat is an open source implementati…   1                    </span><br><span class="line">oobsri/tomcat8                Testing CI Jobs with different names.           1                    </span><br><span class="line">picoded/tomcat7               tomcat7 with jre8 and MANAGER_USER / MANAGER…   1                    [OK]</span><br><span class="line">chenyufeng/tomcat-centos      tomcat基于centos6的镜像                              1                    [OK]</span><br><span class="line">camptocamp/tomcat-logback     Docker image for tomcat with logback integra…   1                    [OK]</span><br><span class="line">99taxis/tomcat7               Tomcat7                                         1                    [OK]</span><br><span class="line">softwareplant/tomcat          Tomcat images for jira-cloud testing            0                    [OK]</span><br><span class="line">secoresearch/tomcat-varnish   Tomcat and Varnish 5.0                          0                    [OK]</span><br><span class="line">s390x/tomcat                  Apache Tomcat is an open source implementati…   0                    </span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker search --filter=stars=100  tomcat</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat    Apache Tomcat is an open source implementati…   2983      [OK]     </span><br></pre></td></tr></table></figure><h4 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker pull --help</span><br><span class="line"></span><br><span class="line">Usage:  docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br><span class="line"></span><br><span class="line">Pull an image or a repository from a registry</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all-tags                Download all tagged images in the repository</span><br><span class="line">      --disable-content-trust   Skip image verification (default true)</span><br><span class="line">      --platform string         Set platform if server is multi-platform capable</span><br><span class="line">  -q, --quiet                   Suppress verbose output</span><br></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker pull 镜像名 [:TAG]</td><td>下载镜像</td><td></td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker pull mysql       # 下载mysql:latest版本，等价于 docker pull mysql:latest</span><br><span class="line">[root@quan ~]# docker pull mysql:5.7   # 下载mysql 5.7版本</span><br></pre></td></tr></table></figure><h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker rmi --help</span><br><span class="line"></span><br><span class="line">Usage:  docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">Remove one or more images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --force      Force removal of the image</span><br><span class="line">      --no-prune   Do not delete untagged parents</span><br></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker rmi [options] 镜像名</td><td>删除镜像</td><td>-f</td><td>强制删除</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker rmi -f hello-world            # 删除tomcat镜像，不指定TAG，默认删除latest版本</span><br><span class="line">[root@quan ~]# docker rmi -f tomcat mysql:5.7       # 删除多个镜像,删除tomcat:latest和mysql:5.7版本</span><br><span class="line">[root@quan ~]# docker rmi -f $(docker images -qa)   # 删除全部镜像</span><br></pre></td></tr></table></figure><h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><h4 id="新建并启动容器"><a href="#新建并启动容器" class="headerlink" title="新建并启动容器"></a>新建并启动容器</h4><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker run [OPTIONS] IMAGE [COMMAND] [ARG…]</td><td>新建并启动容器</td><td>–name=容器新名字</td><td>为容器指定一个名称</td></tr><tr><td></td><td></td><td>-d</td><td>后台运行容器，并返回容器ID，也即启动守护式容器</td></tr><tr><td></td><td></td><td>-i</td><td>以交互模式运行容器，通常与 -t 同时使用</td></tr><tr><td></td><td></td><td>-t</td><td>为容器重新分配一个伪输入终端，通常与 -i 同时使用</td></tr><tr><td></td><td></td><td>-P（大P）</td><td>随机端口映射</td></tr><tr><td></td><td></td><td>-p（小P）</td><td>指定端口映射</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker pull centos     # 下载centos镜像</span><br><span class="line">[root@quan ~]# docker images          # 显示本地镜像</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line">[root@quan ~]# docker run -it 300e315adb2f   #启动centos，交互式，通过image id 启动      </span><br><span class="line">[root@7234c5d014bf /]# ls              #此时进入了docker中的centos中</span><br><span class="line">bin  etc   lib      lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">[root@7234c5d014bf /]# docker -ps      # docker中的centos镜像没有安装docker，所以报错</span><br><span class="line">bash: docker: command not found</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker run -it --name=mycentos centos  # 启动centos并重命名为mycentos</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">879120ef4c74   centos    &quot;/bin/bash&quot;   23 seconds ago   Up 19 seconds             mycentos</span><br><span class="line"></span><br><span class="line">[root@quan ~]# docker run -d centos     # 启动守护式容器</span><br><span class="line">d51dcbb62f5c9252a10188b041315e51a9530bf842f228263725c7bc3495c8e4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用docker ps进行查看, 会发现容器已经退出，Docker容器后台运行,就必须有一个前台进程。容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的。这个是docker的机制问题,比如你的web容器,我们以nginx为例，正常情况下,我们配置启动服务只需要启动响应的service即可。例如service nginx start但是,这样做,nginx为后台进程模式运行,就导致docker前台没有运行的应用,这样的容器后台启动后,会立即自杀因为他觉得他没事可做了.所以，最佳的解决方案是,将你要运行的程序以前台进程的形式运行</span></span><br><span class="line">[root@quan ~]# docker ps           </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure><h4 id="列出当前所有正在运行的容器"><a href="#列出当前所有正在运行的容器" class="headerlink" title="列出当前所有正在运行的容器"></a>列出当前所有正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps --help</span><br><span class="line"></span><br><span class="line">Usage:  docker ps [OPTIONS]</span><br><span class="line"></span><br><span class="line">List containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all containers (default shows just running)</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print containers using a Go template</span><br><span class="line">  -n, --last int        Show n last created containers (includes all states) (default -1)</span><br><span class="line">  -l, --latest          Show the latest created container (includes all states)</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line">  -q, --quiet           Only display container IDs</span><br><span class="line">  -s, --size            Display total file sizes</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker ps [OPTIONS]</td><td>列出当前所有正在运行的容器</td><td>-a</td><td>列出当前所有正在运行的容器+历史上运行过的</td></tr><tr><td></td><td></td><td>-l</td><td>显示最近创建的容器</td></tr><tr><td></td><td></td><td>-n</td><td>显示最近n个创建的容器</td></tr><tr><td></td><td></td><td>-q</td><td>静默模式，只显示容器编号</td></tr><tr><td></td><td></td><td>–no-trunc</td><td>不截断输出</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   6 minutes ago   Up 5 minutes             gracious_ganguly</span><br><span class="line">[root@quan ~]# docker ps -l</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   17 minutes ago   Exited (127) 2 minutes ago             gracious_ganguly</span><br></pre></td></tr></table></figure><h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>exit</td><td>容器停止退出</td></tr><tr><td>ctrl+P+Q</td><td>容器不停止退出</td></tr></tbody></table><h4 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker start 镜像ID或容器名</td><td>启动容器</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps -n 2     #显示最近2个创建的容器，7234c5d014bf目前是关闭的</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                        PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   7 minutes ago    Up 7 minutes                            mycentos</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   27 minutes ago   Exited (127) 11 minutes ago             gracious_ganguly</span><br><span class="line">[root@quan ~]# docker start 7234c5d014bf    # 启动7234c5d014bf容器</span><br><span class="line">7234c5d014bf</span><br><span class="line">[root@quan ~]# docker ps                    # status 从 Exited 变为 Up</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   8 minutes ago    Up 7 minutes              mycentos</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   28 minutes ago   Up 10 seconds             gracious_ganguly</span><br></pre></td></tr></table></figure><h4 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker restart 镜像ID或容器名</td><td>重启容器</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps -n 2     #显示最近2个创建的容器</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   11 minutes ago   Up 11 minutes             mycentos</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   31 minutes ago   Up 3 minutes              gracious_ganguly</span><br><span class="line">[root@quan ~]# docker restart 7234c5d014bf   # 重新启动7234c5d014bf容器</span><br><span class="line">7234c5d014bf</span><br></pre></td></tr></table></figure><h4 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker stop 镜像ID或容器名</td><td>停止容器</td></tr><tr><td>docker kill 镜像ID或容器名</td><td>强制停止容器</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   15 minutes ago   Up 15 minutes             mycentos</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   35 minutes ago   Up 3 minutes              gracious_ganguly</span><br><span class="line">[root@quan ~]# docker stop 7234c5d014bf    # 温柔停止7234c5d014bf容器,就好比关机中选择开始-电源-关机</span><br><span class="line">7234c5d014bf</span><br><span class="line">[root@quan ~]# docker kill 879120ef4c74    # 强制停止879120ef4c74容器，就好比直接关电源</span><br><span class="line">879120ef4c74</span><br></pre></td></tr></table></figure><h4 id="删除已停止的容器"><a href="#删除已停止的容器" class="headerlink" title="删除已停止的容器"></a>删除已停止的容器</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker rm 镜像ID</td><td>删除已停止的容器</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps -n 2</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   21 minutes ago   Exited (137) 3 minutes ago             mycentos</span><br><span class="line">7234c5d014bf   300e315adb2f   &quot;/bin/bash&quot;   42 minutes ago   Exited (0) 6 minutes ago               gracious_ganguly</span><br><span class="line">[root@quan ~]# docker rm 7234c5d014bf    # 删除7234c5d014bf容器</span><br><span class="line">7234c5d014bf</span><br><span class="line">[root@quan ~]# docker ps -n 2            # 从最近2条记录中可以看到7234c5d014bf容器已经被删除</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">879120ef4c74   centos         &quot;/bin/bash&quot;   22 minutes ago   Exited (137) 4 minutes ago             mycentos</span><br><span class="line">87e3f8981c7b   d1165f221234   &quot;/hello&quot;      5 hours ago      Exited (0) 5 hours ago                 heuristic_murdock</span><br><span class="line">[root@quan ~]# docker rm -f $(docker ps -aq)   # 删除所有容器</span><br><span class="line">879120ef4c74</span><br><span class="line">87e3f8981c7b</span><br></pre></td></tr></table></figure><h4 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h4><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker logs -f -t –tail 容器ID</td><td>查看容器日志</td><td>-t</td><td>加入时间戳</td></tr><tr><td></td><td></td><td>-f</td><td>跟随最新的日志打印</td></tr><tr><td></td><td></td><td>–tail 数字</td><td>显示最后多少条</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker run -d centos /bin/sh -c &quot;while true;do echo hello world;sleep 2;done&quot; # 每隔2秒输出一次hello world</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">312cb0ff2d79   centos    &quot;/bin/sh -c &#x27;while t…&quot;   4 seconds ago   Up 2 seconds             stoic_meninsky</span><br><span class="line">[root@quan ~]# docker logs 312cb0ff2d79</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">[root@quan ~]# docker logs -t 312cb0ff2d79</span><br><span class="line">2021-03-29T12:14:11.020823934Z hello world</span><br><span class="line">2021-03-29T12:14:13.247499537Z hello world</span><br><span class="line">2021-03-29T12:14:15.249548573Z hello world</span><br><span class="line">2021-03-29T12:14:17.251700550Z hello world</span><br><span class="line">2021-03-29T12:14:19.253714565Z hello world</span><br><span class="line">[root@quan ~]# docker logs -t -f 312cb0ff2d79     #不停的追加</span><br><span class="line">2021-03-29T12:14:11.020823934Z hello world</span><br><span class="line">2021-03-29T12:14:13.247499537Z hello world</span><br><span class="line">2021-03-29T12:14:15.249548573Z hello world</span><br><span class="line">2021-03-29T12:14:17.251700550Z hello world</span><br><span class="line">[root@quan ~]# docker logs -t -f --tail 3 312cb0ff2d79   # 实时查看最后3行</span><br><span class="line">2021-03-29T12:17:33.543121687Z hello world</span><br><span class="line">2021-03-29T12:17:35.545235530Z hello world</span><br><span class="line">2021-03-29T12:17:37.547421077Z hello world</span><br></pre></td></tr></table></figure><h4 id="查看容器内运行的进程"><a href="#查看容器内运行的进程" class="headerlink" title="查看容器内运行的进程"></a>查看容器内运行的进程</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker top 容器ID</td><td>查看容器内运行的进程</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">22bca8cc7f2b   centos    &quot;/bin/sh -c &#x27;while t…&quot;   28 seconds ago   Up 25 seconds             charming_bohr</span><br><span class="line">[root@quan ~]# docker top 22bca8cc7f2b   # 查看容器22bca8cc7f2b内的进程</span><br><span class="line">UID   PID   PPID     C    STIME    TTY    TIME         CMD</span><br><span class="line">root  9829  9781     0    20:20    ?      00:00:00     /bin/sh -c while true;do echo hello world;sleep 2;done</span><br><span class="line">root  9939  9829     0    20:21    ?      00:00:00     /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 2</span><br></pre></td></tr></table></figure><h4 id="查看容器内部细节"><a href="#查看容器内部细节" class="headerlink" title="查看容器内部细节"></a>查看容器内部细节</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker inspect 容器ID</td><td>查看容器内部细节</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">22bca8cc7f2b   centos    &quot;/bin/sh -c &#x27;while t…&quot;   6 minutes ago   Up 6 minutes             charming_bohr</span><br><span class="line">[root@quan ~]# docker inspect 22bca8cc7f2b   # 查看容器内部细节，返回的是一个json</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;22bca8cc7f2b327a666917b206105778b8cd449329f3bdf429ad28d9f8f40b48&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-03-29T12:20:51.215754456Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo hello world;sleep 2;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 9829,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-03-29T12:20:54.167067276Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">     内容过多省略.....</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="进入正在运行的容器并以命令行交互"><a href="#进入正在运行的容器并以命令行交互" class="headerlink" title="进入正在运行的容器并以命令行交互"></a>进入正在运行的容器并以命令行交互</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker exec -it 容器ID bashShell</td><td>exec是在容器中打开新的终端，并且可以启动新的进程</td></tr><tr><td>docker attach 容器ID</td><td>attach直接进入容器启动命令的终端，不会启动新的进程。重新进入</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker run -it centos /bin/bash     # 启动交互式容器</span><br><span class="line">[root@ede86e41f39c /]# [root@quan ~]# docker ps    # ctrl+P+Q容器不停止退出，docker ps查看正在运行的容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">ede86e41f39c   centos    &quot;/bin/bash&quot;   14 seconds ago   Up 12 seconds             pensive_greider</span><br><span class="line">[root@quan ~]# docker attach ede86e41f39c   # attach重新进入终端</span><br><span class="line">[root@ede86e41f39c /]# ls -l /tmp           # 在centos中进行操作</span><br><span class="line">total 8</span><br><span class="line">-rwx------ 1 root root 701 Dec  4 17:37 ks-script-esd4my7v</span><br><span class="line">-rwx------ 1 root root 671 Dec  4 17:37 ks-script-eusq_sc5</span><br><span class="line">[root@ede86e41f39c /]# [root@quan ~]#     # ctrl+P+Q容器不停止退出</span><br><span class="line">[root@quan ~]# docker exec -t ede86e41f39c ls -l /tmp  # exec不进入centos，在宿主机上执行centos中的命令</span><br><span class="line">total 8</span><br><span class="line">-rwx------ 1 root root 701 Dec  4 17:37 ks-script-esd4my7v</span><br><span class="line">-rwx------ 1 root root 671 Dec  4 17:37 ks-script-eusq_sc5</span><br></pre></td></tr></table></figure><h4 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker cp  容器ID:容器内路径 目的主机路径</td><td>从容器内拷贝文件到主机上</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">ede86e41f39c   centos    &quot;/bin/bash&quot;   10 minutes ago   Up 10 minutes             pensive_greider</span><br><span class="line">[root@quan ~]# docker cp ede86e41f39c:/tmp/yum.log /root    # 拷贝容器ede86e41f39c中tmp目录下yum.log文件到宿主机root目录下</span><br></pre></td></tr></table></figure><h3 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h3><h4 id="什么是docker镜像"><a href="#什么是docker镜像" class="headerlink" title="什么是docker镜像"></a>什么是docker镜像</h4><h5 id="UnionFS"><a href="#UnionFS" class="headerlink" title="UnionFS"></a>UnionFS</h5><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p><h5 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h5><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p><p>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。 </p><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/docker02.png"></p><p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p><h5 id="分层的镜像"><a href="#分层的镜像" class="headerlink" title="分层的镜像"></a>分层的镜像</h5><p>以我们的pull为例，在下载的过程中我们可以看到docker的镜像好像是在一层一层的在下载。</p><h5 id="为什么-Docker-镜像要采用这种分层结构呢？"><a href="#为什么-Docker-镜像要采用这种分层结构呢？" class="headerlink" title="为什么 Docker 镜像要采用这种分层结构呢？"></a>为什么 Docker 镜像要采用这种分层结构呢？</h5><p>最大的一个好处就是 - 共享资源</p><p>比如：有多个镜像都从相同的 base 镜像构建而来，那么宿主机只需在磁盘上保存一份base镜像，同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p><h5 id="镜像特点"><a href="#镜像特点" class="headerlink" title="镜像特点"></a>镜像特点</h5><p>Docker镜像都是只读的。当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p><h4 id="Docker镜像commit操作"><a href="#Docker镜像commit操作" class="headerlink" title="Docker镜像commit操作"></a>Docker镜像commit操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker commit --help</span><br><span class="line"></span><br><span class="line">Usage:  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">Create a new image from a container&#x27;s changes</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --author string    Author (e.g., &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;)</span><br><span class="line">  -c, --change list      Apply Dockerfile instruction to the created image</span><br><span class="line">  -m, --message string   Commit message</span><br><span class="line">  -p, --pause            Pause container during commit (default true)</span><br></pre></td></tr></table></figure><table><thead><tr><th>命令</th><th>命令说明</th><th>可选参数[options]</th><th>可选参数说明</th></tr></thead><tbody><tr><td>docker commit [options] 容器ID 要创建的目标镜像名:[标签名]</td><td>提交容器副本使之成为一个新的镜像</td><td>-m</td><td>提交的描述信息</td></tr><tr><td></td><td></td><td>-a</td><td>作者</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker pull tomcat</span><br><span class="line">[root@quan ~]# docker run -it -p 8888:8080 tomcat      # 交互式启动tomcat,指定对外暴露端口8888</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND      CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">883a317a3106   tomcat    &quot;catalina.sh run&quot;   About a minute ago   Up About a minute   0.0.0.0:8888-&gt;8080/tcp   determined_shamir</span><br><span class="line">[root@quan ~]# docker run -it -P tomcat        # 使用大P随机分配端口</span><br><span class="line">[root@quan ~]# docker ps                       # 随机分配的端口是49153</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                     NAMES</span><br><span class="line">bc6da24d50ce   tomcat    &quot;catalina.sh run&quot;   39 seconds ago   Up 36 seconds   0.0.0.0:49153-&gt;8080/tcp   agitated_archimedes</span><br><span class="line">[root@quan ~]# docker commit -a=&quot;ljq&quot; -m=&quot;this is my tomcat&quot; bc6da24d50ce ljq/mytomcat:1.2  # 提交容器副本使之成为一个新的镜像</span><br><span class="line">sha256:9831f07ded6d7164d33568cb3a3081ad849bca550aeaedf6aa13ff972a6997ec</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY     TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">ljq/mytomcat   1.2       9831f07ded6d   11 seconds ago   649MB</span><br><span class="line">tomcat         latest    040bdb29ab37   2 months ago     649MB</span><br><span class="line">[root@quan ~]# docker run -d -p 6666:8080 tomcat   # 后台运行方式启动tomcat，对外暴露端口6666</span><br><span class="line">9238678b87f1e2e01c384ecc26b73193df00c7b6c36c4d3a475b673bd09f3a40</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                     NAMES</span><br><span class="line">9238678b87f1   tomcat    &quot;catalina.sh run&quot;   12 seconds ago   Up 5 seconds    0.0.0.0:6666-&gt;8080/tcp    agitated_carson</span><br></pre></td></tr></table></figure><h3 id="Docker容器数据卷"><a href="#Docker容器数据卷" class="headerlink" title="Docker容器数据卷"></a>Docker容器数据卷</h3><h4 id="docker容器数据卷是什么？"><a href="#docker容器数据卷是什么？" class="headerlink" title="docker容器数据卷是什么？"></a>docker容器数据卷是什么？</h4><p>当我们在使用docker容器的时候，会产生一系列的数据文件，这些数据文件在我们关闭docker容器时是会消失的，但是其中产生的部分内容我们是希望能够把它给保存起来另作用途的，Docker将应用与运行环境打包成容器发布，我们希望在运行过程中产生的部分数据是可以持久化的，而且容器之间我们希望能够实现数据共享。通俗地来说，docker容器数据卷可以看成是我们生活中常用的u盘，它存在于一个或多个的容器中，由docker挂载到容器，但不属于联合文件系统，Docker不会在容器删除时删除其挂载的数据卷。</p><p>容器的持久化。容器间继承+共享数据。</p><p>Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。为了能保存数据在docker中我们使用卷。卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性。卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷。</p><p>特点：</p><ol><li>数据卷可在容器之间共享或重用数据</li><li>卷中的更改可以直接生效</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ol><h4 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h4><h5 id="直接命令添加"><a href="#直接命令添加" class="headerlink" title="直接命令添加"></a>直接命令添加</h5><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>docker run -it -v /宿主机绝对路径目录:/容器内目录   镜像名</td><td></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY     TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">centos         latest    300e315adb2f   3 months ago     209MB</span><br><span class="line">[root@quan ~]# docker run -it -v /tmp/myData:/tmp/myDataVontainer centos  # 宿主机/tmp/myData目录与容器centos中的/tmp/myDataVontainer数据共享。容器和宿主机之间数据共享。容器停止退出后，主机修改后数据同步</span><br><span class="line">[root@384f730dd3d7 /]# ls -l /tmp   #容器centos的/tmp目录</span><br><span class="line">total 12</span><br><span class="line">-rwx------ 1 root root  701 Dec  4 17:37 ks-script-esd4my7v</span><br><span class="line">-rwx------ 1 root root  671 Dec  4 17:37 ks-script-eusq_sc5</span><br><span class="line">drwxr-xr-x 2 root root 4096 Mar 30 13:14 myDataVontainer</span><br><span class="line">[root@quan /]# ls -l /tmp           # 宿主机centos的/tmp目录</span><br><span class="line">total 24848</span><br><span class="line">srwxr-xr-x 1 root root        0 Mar 28 15:03 Aegis-&lt;Guid(5A2C30A2-A87D-490A-9281-6765EDAD7CBA)&gt;</span><br><span class="line">-rw------- 1 root root        0 Mar 28 15:00 AliyunAssistClientSingleLock.lock</span><br><span class="line">drwxr-xr-x 2 root root     4096 Mar 30 21:14 myData</span><br><span class="line">[root@quan ~]# docker run -it -v /tmp/myData:/tmp/myDataVontainer:ro centos  # ro只读，容器内的数据只读，不能增删改</span><br></pre></td></tr></table></figure><h5 id="DockerFile添加"><a href="#DockerFile添加" class="headerlink" title="DockerFile添加"></a>DockerFile添加</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@quan /]# mkdir /myDocker        # 在宿主机创建myDocker目录      </span><br><span class="line">[root@quan /]# cd myDocker            # 进入目录</span><br><span class="line">[root@quan myDocker]# vim DockerFile  # vim编辑DockerFile，输入以下内容，保存退出</span><br><span class="line"><span class="meta">#</span><span class="bash"> vloumn <span class="built_in">test</span></span></span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [&quot;/myDataVloumnContainer&quot;,&quot;/myDataVloumnContainer2&quot;]</span><br><span class="line">CMD echo &quot;finshed.........success1&quot;</span><br><span class="line">CMD /bin/bash    </span><br><span class="line">[root@quan myDocker]# docker build -f /myDocker/DockerFile -t ljq/centos .      # build后生成容器</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;/myDataVloumnContainer&quot;,&quot;/myDataVloumnContainer2&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 71eaa5e8131a</span></span><br><span class="line">Removing intermediate container 71eaa5e8131a</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 054fb740d1c0</span></span><br><span class="line">Step 3/4 : CMD echo &quot;finshed.........success1&quot;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 565d0c478189</span></span><br><span class="line">Removing intermediate container 565d0c478189</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> ff09761ac5e5</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 1fcdedc30ce3</span></span><br><span class="line">Removing intermediate container 1fcdedc30ce3</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 08a899a94f47</span></span><br><span class="line">Successfully built 08a899a94f47</span><br><span class="line">Successfully tagged ljq/centos:latest</span><br><span class="line">[root@quan myDocker]# docker images               # 此时就会在ljq/centos中新建myDataVloumnContainer，myDataVloumnContainer2</span><br><span class="line">[root@quan myDocker]# docker images</span><br><span class="line">REPOSITORY     TAG       IMAGE ID       CREATED             SIZE</span><br><span class="line">ljq/centos     latest    08a899a94f47   51 seconds ago      209MB</span><br><span class="line">tomcat         latest    040bdb29ab37   2 months ago        649MB</span><br><span class="line">[root@quan myDocker]# docker run -it ljq/centos</span><br><span class="line">[root@96dbbdca76e3 /]# ls -l                      # 容器ljq/centos已经有myDataVloumnContainer,myDataVloumnContainer2目录</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx  1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x  5 root root  360 Mar 30 14:12 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Mar 30 14:12 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx  1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx  1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------  2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar 30 14:12 myDataVloumnContainer</span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar 30 14:12 myDataVloumnContainer2</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 85 root root    0 Mar 30 14:12 proc</span><br><span class="line">dr-xr-x---  2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x 11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx  1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Mar 28 12:11 sys</span><br><span class="line">drwxrwxrwt  7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x 12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x 20 root root 4096 Dec  4 17:37 var</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">96dbbdca76e3   ljq/centos   &quot;/bin/sh -c /bin/bash&quot;   2 minutes ago   Up 2 minutes             zealous_bell</span><br><span class="line">[root@quan ~]# docker inspect 96dbbdca76e3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 宿主机的/var/lib/docker/volumes/813012e58ffd493564318f46a54fbf9a14c5affffc71949aff26cc8a952a961c/_data</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        /var/lib/docker/volumes/b27737e57537c6453c20d97c2d1579a7bf22b7af4966b90022b055eed30d8e0d/_data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 就是宿主机的数据共享目录</span></span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;813012e58ffd493564318f46a54fbf9a14c5affffc71949aff26cc8a952a961c&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/813012e58ffd493564318f46a54fbf9a14c5affffc71949aff26cc8a952a961c/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/myDataVloumnContainer2&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;b27737e57537c6453c20d97c2d1579a7bf22b7af4966b90022b055eed30d8e0d&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/b27737e57537c6453c20d97c2d1579a7bf22b7af4966b90022b055eed30d8e0d/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/myDataVloumnContainer&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        </span><br><span class="line">            &quot;Image&quot;: &quot;ljq/centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/myDataVloumnContainer&quot;: &#123;&#125;,</span><br><span class="line">                &quot;/myDataVloumnContainer2&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure><h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>命名的容器挂载数据卷，其它容器通过挂载这个(父容器)实现数据共享，挂载数据卷的容器，称之为数据卷容器。</p><p>容器间传递共享(–volumes-from)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">ljq/centos   latest    08a899a94f47   22 hours ago   209MB</span><br><span class="line">tomcat       latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line">[root@quan ~]# docker run -it --name dc01 ljq/centos                        # 父容器dc01 </span><br><span class="line">[root@quan ~]# docker run -it --name dc02 --volumes-from dc01 ljq/centos    # doc02继承dc01</span><br><span class="line">[root@quan ~]# docker run -it --name dc03 --volumes-from dc01 ljq/centos    # doc03继承dc01</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                  CREATED              STATUS              PORTS     NAMES</span><br><span class="line">214d99cdc828   ljq/centos   &quot;/bin/sh -c /bin/bash&quot;   About a minute ago   Up About a minute             dc03</span><br><span class="line">05fb95aefba8   ljq/centos   &quot;/bin/sh -c /bin/bash&quot;   3 minutes ago        Up 3 minutes                  dc02</span><br><span class="line">0587cee7d97a   ljq/centos   &quot;/bin/sh -c /bin/bash&quot;   6 minutes ago        Up 6 minutes                  dc01</span><br><span class="line">[root@0587cee7d97a /]# ls -l     # 此时3个容器myDataVloumnContainer和myDataVloumnContainer2 数据共享</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除dc01，dc02修改后dc03仍然可以访问，删除dc02后dc03仍然可以访问，新建dc04继承dc03后再删除dc03仍然可以访问</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止</span></span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar 31 12:25 myDataVloumnContainer</span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar 31 12:25 myDataVloumnContainer2</span><br></pre></td></tr></table></figure><h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><h4 id="什么是dockerFile"><a href="#什么是dockerFile" class="headerlink" title="什么是dockerFile"></a>什么是dockerFile</h4><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p><p>构建三步骤：编写Dockerfile文件，docker build，docker run</p><p>Dockerfile内容基础知识</p><ul><li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li><li>指令按照从上到下，顺序执行</li><li>#表示注释</li><li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li></ul><p>Docker执行Dockerfile的大致流程</p><ol><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器作出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ol><p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段</p><ul><li>Dockerfile是软件的原材料</li><li>Docker镜像是软件的交付品</li><li>Docker容器则可以认为是软件的运行态。</li></ul><p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/docker03.png"></p><ul><li>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等</li><li>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时，会真正开始提供服务</li><li>Docker容器，容器是直接提供服务的。</li></ul><h4 id="保留字指令"><a href="#保留字指令" class="headerlink" title="保留字指令"></a>保留字指令</h4><table><thead><tr><th>命令</th><th>命令说明</th></tr></thead><tbody><tr><td>FROM</td><td>基础镜像，当前新镜像是基于哪个镜像的</td></tr><tr><td>MAINTAINER</td><td>镜像维护者的姓名和邮箱地址</td></tr><tr><td>RUN</td><td>容器构建时需要运行的命令</td></tr><tr><td>EXPOSE</td><td>当前容器对外暴露出的端口</td></tr><tr><td>WORKDIR</td><td>指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</td></tr><tr><td>ENV</td><td>用来在构建镜像过程中设置环境变量</td></tr><tr><td>ADD</td><td>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</td></tr><tr><td>COPY</td><td>类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</td></tr><tr><td>VOLUME</td><td>容器数据卷，用于数据保存和持久化工作</td></tr><tr><td>CMD</td><td>指定一个容器启动时要运行的命令。Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换</td></tr><tr><td>ENTRYPOINT</td><td>指定一个容器启动时要运行的命令。ENTRYPOINT 的目的和 CMD 一样，都是在指定容器启动程序及参数</td></tr><tr><td>ONBUILD</td><td>当构建一个被继承的Dockerfile时运行命令，父镜像在被子继承后父镜像的onbuild被触发</td></tr></tbody></table><p>Base镜像(scratch)：Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的</p><h4 id="案例一：自定义mycentos"><a href="#案例一：自定义mycentos" class="headerlink" title="案例一：自定义mycentos"></a>案例一：自定义mycentos</h4><p>自定义mycentos目的使我们自己的镜像具备如下：修改登陆后的默认路径， 支持vim编辑器，支持查看网络配置ifconfig</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line">[root@quan ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@66192209812d /]# pwd    # docker容器中centos进入的是根目录 /</span><br><span class="line">/</span><br><span class="line">[root@66192209812d /]# vim abc.txt  # docker容器中centos不支持vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@66192209812d /]# ifconfig     # docker容器中centos不支持ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">[root@quan ~]# cd /myDocker/</span><br><span class="line">[root@quan myDocker]# vim DockerFile     # 编写DockerFile文件</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER ljq&lt;ljq@126.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;success......ok&quot;</span><br><span class="line">CMD /bin/bash   </span><br><span class="line">[root@quan myDocker]# docker build -f /myDocker/DockerFile -t mycentos:1.3 .    # 构建  .表示当前目录</span><br><span class="line">[root@quan myDocker]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mycentos     1.3       ebb2e07256d4   56 seconds ago   291MB</span><br><span class="line">centos       latest    300e315adb2f   3 months ago     209MB</span><br><span class="line">[root@quan myDocker]# docker run -it mycentos:1.3     # 运行</span><br><span class="line">[root@0314fd41c780 local]# pwd      # 落脚点为 /usr/local</span><br><span class="line">/usr/local</span><br><span class="line">[root@0314fd41c780 local]# vim a.txt  # vim编辑器可以使用</span><br><span class="line">[root@0314fd41c780 local]# ifconfig   # ifconfig可以使用</span><br><span class="line">[root@quan myDocker]# docker images mycentos</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos     1.3       ebb2e07256d4   6 minutes ago   291MB</span><br><span class="line">[root@quan myDocker]# docker history ebb2e07256d4    # 【docker history 镜像名】 列出镜像的变更历史</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">ebb2e07256d4   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B        </span><br><span class="line">ef3857259a56   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        </span><br><span class="line">c06c070a0204   6 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        </span><br><span class="line">87da59e0ee99   6 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class="line">8d6053b16555   6 minutes ago   /bin/sh -c yum -y install net-tools             23.3MB    </span><br><span class="line">26db8f887f2f   6 minutes ago   /bin/sh -c yum -y install vim                   58MB      </span><br><span class="line">3d87e5f916e1   7 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B        </span><br><span class="line">89f645430934   7 minutes ago   /bin/sh -c #(nop)  ENV mypath=/usr/local        0B        </span><br><span class="line">d02266cb199f   7 minutes ago   /bin/sh -c #(nop)  MAINTAINER ljq&lt;ljq@126.co…   0B        </span><br><span class="line">300e315adb2f   3 months ago    /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      3 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      3 months ago    /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB </span><br></pre></td></tr></table></figure><h4 id="案例二：CMD-ENTRYPOINT"><a href="#案例二：CMD-ENTRYPOINT" class="headerlink" title="案例二：CMD/ENTRYPOINT"></a>案例二：CMD/ENTRYPOINT</h4><p>CMD/ENTRYPOINT  都是指定一个容器启动时要运行的命令</p><p>CMD：Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换</p><p>ENTRYPOINT ：docker run 之后的参数会被当做参数传递给 ENTRYPOINT，之后形成新的命令组合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker run -it -p 8888:8080 tomcat    # 这个是正常启动tomcat</span><br><span class="line">[root@quan ~]# docker run -it -p 8888:8080 tomcat ls -l   # 在后面加 ls -l相当于CMD指令，会替换掉tomcat最后的指令 CMD [&quot;catalina.sh&quot;, &quot;run&quot;])，这样则启动tomcat失败</span><br></pre></td></tr></table></figure><p>curl命令可以用来执行下载、发送各种HTTP请求，指定HTTP头部等操作。如果系统没有curl可以使用yum install curl安装，也可以下载安装。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# curl http://www.baidu.com    # curl命令，执行后，www.baidu.com的html就会显示在屏幕上了</span><br><span class="line">[root@quan ~]# cd /myDocker/</span><br><span class="line">[root@quan myDocker]# vim DockerFile</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;cip.cc&quot;]</span><br><span class="line">[root@quan myDocker]# docker build -f /myDocker/DockerFile -t myip:1.1 .</span><br><span class="line">[root@quan myDocker]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myip         1.1       c0bdae061dad   10 seconds ago   209MB</span><br><span class="line">[root@quan myDocker]# docker run -it myip:1.1</span><br><span class="line">IP    : 47.100.24.6</span><br><span class="line">地址    : 中国  上海</span><br><span class="line">运营商    : 阿里云/电信/联通/移动/铁通/教育网</span><br><span class="line"></span><br><span class="line">数据二    : 上海市 | 阿里云</span><br><span class="line"></span><br><span class="line">数据三    : 中国上海上海 | 阿里云</span><br><span class="line"></span><br><span class="line">URL    : http://www.cip.cc/47.100.24.6</span><br><span class="line">[root@quan myDocker]# docker run -it myip:1.1 -i   # 此时在后面加一个参数相当于传递一个新参数，此时命令为 [&quot;curl&quot;,&quot;-s&quot;, -i &quot;cip.cc&quot;]</span><br><span class="line">HTTP/1.1 200 OK                                    # 不是CMD的覆盖，而是ENTRYPOINT的追加</span><br><span class="line">Server: openresty</span><br><span class="line">Date: Sat, 03 Apr 2021 02:10:13 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-cip-c: H</span><br><span class="line"></span><br><span class="line">IP    : 47.100.24.6</span><br><span class="line">地址    : 中国  上海</span><br><span class="line">运营商    : 阿里云/电信/联通/移动/铁通/教育网</span><br><span class="line"></span><br><span class="line">数据二    : 上海市 | 阿里云</span><br><span class="line"></span><br><span class="line">数据三    : 中国上海上海 | 阿里云</span><br><span class="line"></span><br><span class="line">URL    : http://www.cip.cc/47.100.24.6</span><br></pre></td></tr></table></figure><h4 id="案例三：ONBUILD"><a href="#案例三：ONBUILD" class="headerlink" title="案例三：ONBUILD"></a>案例三：ONBUILD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# cd /myDocker/</span><br><span class="line">[root@quan myDocker]# vim DockerFile</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;cip.cc&quot;]</span><br><span class="line">ONBUILD RUN echo &quot;father images onbuild......&quot;</span><br><span class="line">[root@quan myDocker]# docker build -f /myDocker/DockerFile -t myip/father:1.1 .</span><br><span class="line">[root@quan myDocker]# vim DockerFile2</span><br><span class="line">FROM myip/father:1.1</span><br><span class="line">ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;cip.cc&quot;]</span><br><span class="line">[root@quan myDocker]# docker build -f /myDocker/DockerFile2 -t myip/son:1.1 .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM myip/father:1.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Executing 1 build trigger</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 064d951dc6a7</span></span><br><span class="line">father images onbuild......</span><br><span class="line">Removing intermediate container 064d951dc6a7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> edd020a63c36</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;cip.cc&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 2af6a39c0d54</span></span><br><span class="line">Removing intermediate container 2af6a39c0d54</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 1db2bca3d182</span></span><br><span class="line">Successfully built 1db2bca3d182</span><br><span class="line">Successfully tagged myip/son:1.1</span><br><span class="line">[root@quan myDocker]# cat DockerFile</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;curl&quot;,&quot;-s&quot;,&quot;cip.cc&quot;]</span><br><span class="line">ONBUILD RUN echo &quot;father images onbuild......&quot;            # myip/son:1.1 继承自 myip/father:1.1，执行myip/father:1.1的ONBUILD，父类的ONBUILD被执行</span><br></pre></td></tr></table></figure><h4 id="案例五：自定义镜像Tomcat9"><a href="#案例五：自定义镜像Tomcat9" class="headerlink" title="案例五：自定义镜像Tomcat9"></a>案例五：自定义镜像Tomcat9</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@quan /]# cd /myDocker/tomcat9/</span><br><span class="line">[root@quan tomcat9]# touch c.txt</span><br><span class="line">[root@quan tomcat9]# ls -l</span><br><span class="line">total 166516</span><br><span class="line">-rw-r--r-- 1 root root  11487016 Apr  3 11:27 apache-tomcat-9.0.44.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root         0 Apr  3 11:21 c.txt</span><br><span class="line">-rw-r--r-- 1 root root 159019376 Apr  3 11:28 jdk-8u11-linux-x64.tar.gz</span><br><span class="line">[root@quan tomcat9]# vim DockerFile</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER ljq&lt;ljq@126.com&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash">把宿主机当前上下文的c.txt拷贝到容器/usr/<span class="built_in">local</span>/路径下并重命名</span></span><br><span class="line">COPY c.txt /usr/local/cincontainer.txt</span><br><span class="line"><span class="meta">#</span><span class="bash">把java与tomcat添加到容器中</span></span><br><span class="line">ADD jdk-8u11-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.44.tar.gz /usr/local/</span><br><span class="line"><span class="meta">#</span><span class="bash">安装vim编辑器</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"><span class="meta">#</span><span class="bash">设置工作访问时候的WORKDIR路径，登录落脚点</span></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"><span class="meta">#</span><span class="bash">配置java与tomcat环境变量</span></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_11</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.44</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.44</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta">#</span><span class="bash">容器运行时监听的端口</span></span><br><span class="line">EXPOSE  8080</span><br><span class="line"><span class="meta">#</span><span class="bash">启动时运行tomcat</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ENTRYPOINT [<span class="string">&quot;/usr/local/apache-tomcat-9.0.44/bin/startup.sh&quot;</span> ]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CMD [<span class="string">&quot;/usr/local/apache-tomcat-9.0.44/bin/catalina.sh&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.44/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.44/bin/logs/catalina.out</span><br><span class="line">[root@quan tomcat9]# docker build -f /myDocker/tomcat9/DockerFile -t mytomcat9 .</span><br><span class="line">[root@quan tomcat9]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED             SIZE</span><br><span class="line">mytomcat9     latest    53af9d756618   5 minutes ago       607MB</span><br><span class="line">[root@quan tomcat9]# docker run -d -p 9080:8080 --name myt9 -v /myDocker/tomcat9/test:/usr/local/apache-tomcat-9.0.44/webapps/test -v /myDocker/tomcat9/tomcat9logs/:/usr/local/apache-tomcat-9.0.44/logs --privileged=true mytomcat9</span><br><span class="line">[root@quan tomcat9]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">c524b2450a6c   mytomcat9   &quot;/bin/sh -c &#x27;/usr/lo…&quot;   27 seconds ago   Up 24 seconds   0.0.0.0:9080-&gt;8080/tcp   myt9</span><br><span class="line">[root@quan tomcat9]# ls -l</span><br><span class="line">total 166528</span><br><span class="line">-rw-r--r-- 1 root root  11487016 Apr  3 11:27 apache-tomcat-9.0.44.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root         0 Apr  3 11:21 c.txt</span><br><span class="line">-rw-r--r-- 1 root root      1037 Apr  3 11:39 DockerFile</span><br><span class="line">-rw-r--r-- 1 root root 159019376 Apr  3 11:28 jdk-8u11-linux-x64.tar.gz</span><br><span class="line">drwxr-xr-x 2 root root      4096 Apr  3 12:07 test</span><br><span class="line">drwxr-xr-x 2 root root      4096 Apr  3 12:07 tomcat9logs</span><br><span class="line">[root@quan tomcat9]# docker exec c524b2450a6c ls -l    # 这里查询的是/usr/local目录下的文件，因为落脚点是/usr/local</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x 3 root root 4096 Apr  3 04:08 aegis</span><br><span class="line">drwxr-xr-x 1 root root 4096 Apr  3 03:53 apache-tomcat-9.0.44</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 bin</span><br><span class="line">-rw-r--r-- 1 root root    0 Apr  3 03:21 cincontainer.txt</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 etc</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 games</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 include</span><br><span class="line">drwxr-xr-x 8   10  143 4096 Jun 17  2014 jdk1.8.0_11</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 lib</span><br><span class="line">drwxr-xr-x 3 root root 4096 Dec  4 17:37 lib64</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 libexec</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 sbin</span><br><span class="line">drwxr-xr-x 5 root root 4096 Dec  4 17:37 share</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  3 15:22 src</span><br><span class="line">[root@quan ~]# docker exec c524b2450a6c java -version</span><br><span class="line">java version &quot;1.8.0_11&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_11-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.11-b03, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="Docker常用安装"><a href="#Docker常用安装" class="headerlink" title="Docker常用安装"></a>Docker常用安装</h3><h4 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker search tomcat</span><br><span class="line">NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat is an open source implementati…   2989      [OK]       </span><br><span class="line">[root@quan ~]# docker pull tomcat</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat       latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line">[root@quan ~]# docker run -it -p 8080:8080 tomcat</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">3fa8eeb70cf9   tomcat    &quot;catalina.sh run&quot;   44 seconds ago   Up 40 seconds   0.0.0.0:8080-&gt;8080/tcp   brave_maxwell</span><br></pre></td></tr></table></figure><h4 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker search mysql</span><br><span class="line">[root@quan ~]# docker pull mysql</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql        latest    c8562eaf9d81   2 months ago   546MB</span><br><span class="line">[root@quan ~]# docker run -p 3306:3306 --name mysql -v /usr/local/mysql/conf:/etc/mysql/conf.d -v /usr/local/mysql/logs:/logs -v /usr/local/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">e34e861b5719   mysql:5.6   &quot;docker-entrypoint.s…&quot;   9 seconds ago   Up 7 seconds   0.0.0.0:3306-&gt;3306/tcp   mysql</span><br><span class="line">[root@quan ~]# docker exec -it e34e861b5719 /bin/bash</span><br><span class="line">root@e34e861b5719:/# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 7</span><br><span class="line">Server version: 5.6.50 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.03 sec)</span><br></pre></td></tr></table></figure><h4 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker search redis</span><br><span class="line">[root@quan ~]# docker pull redis</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">redis        latest    621ceef7494a   2 months ago   104MB</span><br><span class="line">[root@quan ~]# docker run -p 6379:6379 -v /usr/local/myredis/data:/data -v /usr/local/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf  -d redis redis-server /usr/local/etc/redis/redis.conf --appendonly yes</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">ae5139dfe541   redis     &quot;docker-entrypoint.s…&quot;   8 seconds ago   Up 6 seconds   0.0.0.0:6379-&gt;6379/tcp   cranky_allen</span><br><span class="line">[root@quan ~]# docker exec -it ae5139dfe541 redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br></pre></td></tr></table></figure><h3 id="本地镜像发布到阿里云"><a href="#本地镜像发布到阿里云" class="headerlink" title="本地镜像发布到阿里云"></a>本地镜像发布到阿里云</h3><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/docker04.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">redis        latest    621ceef7494a   2 months ago   104MB</span><br><span class="line">[root@quan ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">59e937d759b7   redis     &quot;docker-entrypoint.s…&quot;   35 seconds ago   Up 32 seconds   0.0.0.0:6379-&gt;6379/tcp   thirsty_roentgen</span><br><span class="line">[root@quan ~]# docker commit -a ljq -m &quot;my new redis&quot; 59e937d759b7 myredis:1.1</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myredis      1.1       0a7a7dca8c28   13 seconds ago   104MB</span><br><span class="line">redis        latest    621ceef7494a   2 months ago     104MB</span><br><span class="line">[root@quan ~]#  docker login --username=1032905347@qq.com registry.cn-shanghai.aliyuncs.com</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">[root@quan ~]# docker tag 0a7a7dca8c28 registry.cn-shanghai.aliyuncs.com/lianjq/myredis:1.1.2</span><br><span class="line">[root@quan ~]# docker push registry.cn-shanghai.aliyuncs.com/lianjq/myredis:1.1.2</span><br><span class="line">The push refers to repository [registry.cn-shanghai.aliyuncs.com/lianjq/myredis]</span><br><span class="line">b2ee95f92839: Pushed </span><br><span class="line">3480f9cdd491: Pushed </span><br><span class="line">a24a292d0184: Pushed </span><br><span class="line">f927192cc30c: Pushed </span><br><span class="line">1450b8f0019c: Pushed </span><br><span class="line">8e14cb7841fa: Pushed </span><br><span class="line">cb42413394c4: Pushed </span><br><span class="line">1.1.2: digest: sha256:11e88398a0298e90308e68c58082ec92eb70dd30919a523e2b98e2fec9b4973a size: 1779</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myredis      1.1       0a7a7dca8c28   28 minutes ago   104MB</span><br><span class="line">redis        latest    621ceef7494a   2 months ago     104MB</span><br><span class="line">[root@quan ~]# docker pull registry.cn-shanghai.aliyuncs.com/lianjq/myredis:1.1.2</span><br><span class="line">[root@quan ~]# docker images</span><br><span class="line">REPOSITORY                                         TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myredis                                            1.1       0a7a7dca8c28   28 minutes ago   104MB</span><br><span class="line">registry.cn-shanghai.aliyuncs.com/lianjq/myredis   1.1.2     0a7a7dca8c28   28 minutes ago   104MB</span><br><span class="line">redis                                              latest    621ceef7494a   2 months ago     104MB</span><br></pre></td></tr></table></figure><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/dokcer05.png"></p><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/dokcer06.png"></p><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/dokcer07.png"></p><p><img src="https://cdn.lianjinquan.com/img/posts/docker/01/dokcer08.png"></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux权限管理</title>
      <link href="/2020/12/25/linux/linux05/"/>
      <url>/2020/12/25/linux/linux05/</url>
      
        <content type="html"><![CDATA[<p>linux权限管理</p><h3 id="ACL权限"><a href="#ACL权限" class="headerlink" title="ACL权限"></a>ACL权限</h3><h4 id="ACL权限简介与开启"><a href="#ACL权限简介与开启" class="headerlink" title="ACL权限简介与开启"></a>ACL权限简介与开启</h4><ul><li>ACL权限是为了解决所有者，所属组，其他人三个权限用户身份分配不足的问题</li></ul><p><img src="https://cdn.lianjinquan.com/img/posts/linux/05/linux01.jpg"></p><ul><li><p>查看分区ACL权限是否开启</p><p>dumpe2fs命令是查询指定分区详细文件系统信息的命令</p><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>dumpe2fs -h [分区]</td><td>查看分区ACL权限是否开启</td><td>-h</td><td>仅显示超级块中信息，而不显示磁盘块组的详细信息</td></tr></tbody></table><p>先使用df命令来检查linux服务器的文件系统的磁盘空间占用情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# df -h</span><br><span class="line">文件系统          容量  已用  可用 已用%% 挂载点</span><br><span class="line">/dev/sda5              17G  3.0G   13G  19% /</span><br><span class="line">tmpfs                 504M  100K  504M   1% /dev/shm</span><br><span class="line">/dev/sda1             194M   27M  158M  15% /boot</span><br><span class="line">/dev/sda2             2.0G   35M  1.8G   2% /home</span><br><span class="line">/dev/sr0              3.5G  3.5G     0 100% /media/CentOS_6.3_Final </span><br></pre></td></tr></table></figure><p>可以看到Default mount options:    user_xattr acl 选项默认开启ACL权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dumpe2fs -h /dev/sda5</span><br><span class="line">dumpe2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          /</span><br><span class="line">Filesystem UUID:          c366cfac-a7b2-4c81-821e-0cdb30c41189</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision #:    1 (dynamic)</span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:          Continue</span><br><span class="line">Filesystem OS type:       Linux</span><br><span class="line">Inode count:              1105920</span><br><span class="line">Block count:              4423168</span><br><span class="line">Reserved block count:     221158</span><br><span class="line">Free blocks:              3579940</span><br><span class="line">Free inodes:              1010371</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Reserved GDT blocks:      1022</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         8192</span><br><span class="line">Inode blocks per group:   512</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Filesystem created:       Sat Dec 19 03:08:34 2020</span><br><span class="line">Last mount time:          Fri Dec 25 03:05:23 2020</span><br><span class="line">Last write time:          Thu Dec 24 03:57:47 2020</span><br><span class="line">Mount count:              7</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Sat Dec 19 03:08:34 2020</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          4944 MB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:              256</span><br><span class="line">Required extra isize:     28</span><br><span class="line">Desired extra isize:      28</span><br><span class="line">Journal inode:            8</span><br><span class="line">First orphan inode:       262644</span><br><span class="line">Default directory hash:   half_md4</span><br><span class="line">Directory Hash Seed:      1d093332-fd3e-4c87-9037-c6723db0036e</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">Journal features:         journal_incompat_revoke</span><br><span class="line">日志大小:             128M</span><br><span class="line">Journal length:           32768</span><br><span class="line">Journal sequence:         0x00000dc1</span><br><span class="line">Journal start:            1</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>临时开启分区ACL权限<br><code>mount -o remount,acl /</code> 重新挂载根分区，并挂载加入acl权限</p></li><li><p>永久开启分区ACL权限</p><p>在<code>UUID=c366cfac-a7b2-4c81-821e-0cdb30c41189 /                       ext4    defaults        1 1</code>在defaults加,acl 成为</p><p><code>UUID=c366cfac-a7b2-4c81-821e-0cdb30c41189 /                       ext4    defaults,acl        1 1</code></p><p>然后输入：<code>mount -o remount / </code>重新挂载文件系统或重启系统，使修改生效。.Linux现在一般所有分区全部默认开启ACL，不用修改配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">UUID=c366cfac-a7b2-4c81-821e-0cdb30c41189 /                       ext4    defaults        1 1</span><br><span class="line">UUID=3e401044-f7fb-4d49-82db-407777070199 /boot                   ext4    defaults        1 2</span><br><span class="line">UUID=dc8ad216-0bf7-43ee-8ec4-b72f355b8b3b /home                   ext4    defaults        1 2</span><br><span class="line">UUID=89afb8d7-db25-4bd2-9ffe-8df3df50bf21 swap                    swap    defaults        0 0</span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        0 0</span><br><span class="line">devpts                  /dev/pts                devpts  gid=5,mode=620  0 0</span><br><span class="line">sysfs                   /sys                    sysfs   defaults        0 0</span><br><span class="line">proc                    /proc                   proc    defaults        0 0</span><br></pre></td></tr></table></figure></li></ul><h3 id="ACL权限查看与设定"><a href="#ACL权限查看与设定" class="headerlink" title="ACL权限查看与设定"></a>ACL权限查看与设定</h3><h4 id="查看ACL权限"><a href="#查看ACL权限" class="headerlink" title="查看ACL权限"></a>查看ACL权限</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>getfacl 文件名</td><td>查看ACL权限</td><td></td><td></td></tr></tbody></table><h4 id="设定ACL权限"><a href="#设定ACL权限" class="headerlink" title="设定ACL权限"></a>设定ACL权限</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>setfacl [选项] 文件名</td><td>设定ACL权限</td><td>-m</td><td>设定ACL权限</td></tr><tr><td></td><td></td><td>-x</td><td>删除指定的ACL权限</td></tr><tr><td></td><td></td><td>-b</td><td>删除所有的ACL权限</td></tr><tr><td></td><td></td><td>-d</td><td>设定默认的ACL权限</td></tr><tr><td></td><td></td><td>-k</td><td>删除默认ACL权限</td></tr><tr><td></td><td></td><td>-R</td><td>递归设定ACL权限</td></tr></tbody></table><ul><li><p>给用户设置acl权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# mkdir /project                                 # 创建目录/project</span><br><span class="line">[root@192 ~]# useradd bimm                                   # 添加用户bimm</span><br><span class="line">[root@192 ~]# useradd cangls                                 # 添加用户cangls</span><br><span class="line">[root@192 ~]# groupadd tgroup                                # 创建组tgroup</span><br><span class="line">[root@192 ~]# gpasswd -a bimm tgroup                         # 把用户bimm添加进组tgroup</span><br><span class="line">Adding user bimm to group tgroup</span><br><span class="line">[root@192 ~]# gpasswd -a cangls tgroup                       # 把用户cangls添加进组tgroup          </span><br><span class="line">Adding user cangls to group tgroup</span><br><span class="line">[root@192 ~]# cat /etc/group                                 # 查看组中用户是否添加成功</span><br><span class="line">tgroup:x:667:bimm,cangls</span><br><span class="line">[root@192 ~]# chown root:tgroup /project                     # 改变目录/project所有者为root用户，所属组为tgroup</span><br><span class="line">[root@192 ~]# chmod 770 /project/                            # 改变文件权限为770 rwxrwx---</span><br><span class="line">[root@192 ~]# ll -d /project/</span><br><span class="line">drwxrwx---. 2 root tgroup 4096 12月 25 04:27 /project/</span><br><span class="line">[root@192 ~]# useradd st                                     # 创建用户st，用户st是一个临时用户，在所有者，所属组，其他人之外的临时用户</span><br><span class="line">[root@192 ~]# passwd st                                      # 设置用户st 密码</span><br><span class="line">[root@192 ~]# setfacl -m u:st:rx /project/                   # 设置用户st的acl权限为rx</span><br><span class="line">[root@192 ~]# ll -d /project/                                # 这里可以看到权限后面多了一个+号  rwxrwx---+</span><br><span class="line">drwxrwx---+ 2 root tgroup 4096 12月 25 04:27 /project/</span><br><span class="line">[root@192 ~]# getfacl /project/                              # 查看目录的acl权限</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: project/                                             <span class="comment"># 文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root                                                <span class="comment"># 所有者</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup                                              <span class="comment"># 所属组</span></span></span><br><span class="line">user::rwx                                                    # 文件所有者权限 rwx</span><br><span class="line">user:st:r-x                                                  # 用户st的acl权限 r-x</span><br><span class="line">group::rwx                                                   # 文件所属组权限 rwx              </span><br><span class="line">mask::rwx</span><br><span class="line">other::---                                                   # 其他人权限 rwx                      </span><br></pre></td></tr></table></figure></li></ul><ul><li><p>给用户组设定ACL权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# groupadd tgroup2                             # 创建用户组tgroup2     </span><br><span class="line">[root@192 ~]# setfacl -m g:tgroup2:rwx /project            # 给用户组设置rwx权限</span><br><span class="line">[root@192 ~]# getfacl /project/                            # 查看目录的acl权限</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: project/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">group:tgroup2:rwx                                          # 用户组 tgroup2 的 acl 权限</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure></li></ul><h4 id="最大有效权限"><a href="#最大有效权限" class="headerlink" title="最大有效权限"></a>最大有效权限</h4><p>mask是用来指定最大有效权限的。如果给用户赋予了ACL权限，是需要和mask 的权限“相与”才能得到用户的真正权限</p><table><thead><tr><th>A</th><th>B</th><th>and</th></tr></thead><tbody><tr><td>r</td><td>r</td><td>r</td></tr><tr><td>r</td><td>-</td><td>-</td></tr><tr><td>-</td><td>r</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td></tr></tbody></table><p>以下例子设定mask最大有效权限为rx，加注释的effective表示现在拥有的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# setfacl -m m:rx /project</span><br><span class="line">[root@192 ~]# getfacl /project/</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: project/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx                #effective:r-x</span><br><span class="line">group:tgroup2:rwx        #effective:r-x</span><br><span class="line">mask::r-x</span><br><span class="line">other::---</span><br></pre></td></tr></table></figure><h4 id="删除ACL权限"><a href="#删除ACL权限" class="headerlink" title="删除ACL权限"></a>删除ACL权限</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# setfacl -x g:tgroup2 /project/               # 删除tgroup2的acl权限，setfacl -x u:用户名 文件名 删除指定用户的ACL权限</span><br><span class="line">[root@192 ~]# getfacl /project/</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: project/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">user:st:r-x</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::---</span><br><span class="line">[root@192 ~]# setfacl -b /project/                          # 删除目录下所有acL权限</span><br><span class="line">[root@192 ~]# getfacl /project/</span><br><span class="line">getfacl: Removing leading &#x27;/&#x27; from absolute path names</span><br><span class="line"><span class="meta">#</span><span class="bash"> file: project/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> owner: root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> group: tgroup</span></span><br><span class="line">user::rwx</span><br><span class="line">group::rwx</span><br><span class="line">other::---</span><br><span class="line">[root@192 ~]# ll -d /project/</span><br><span class="line">drwxrwx---. 2 root tgroup 4096 12月 25 04:27 /project/</span><br></pre></td></tr></table></figure><h4 id="递归ACL权限"><a href="#递归ACL权限" class="headerlink" title="递归ACL权限"></a>递归ACL权限</h4><p>递归ACL权限，递归是父目录在设定ACL权限时，所有的子文件和子目录也会拥有相同的ACL权限。<br>命令：<code>setfacl -m u:用户名:权限 -R 目录名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# setfacl -m u:st:rx /project</span><br><span class="line">[root@192 ~]# cd /project/</span><br><span class="line">[root@192 project]# touch abc</span><br><span class="line">[root@192 project]# touch bcd</span><br><span class="line">[root@192 project]# setfacl -m u:st:rx /project/</span><br><span class="line">[root@192 project]# ll -d /project/</span><br><span class="line">drwxrwx---+ 2 root tgroup 4096 12月 27 04:38 /project/</span><br><span class="line">[root@192 project]# setfacl -m u:st:rx -R /project/             #给project目录下的所有文件都设置acl权限</span><br><span class="line">[root@192 project]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r-xr--+ 1 root root 0 12月 27 04:38 abc</span><br><span class="line">-rw-r-xr--+ 1 root root 0 12月 27 04:38 bcd</span><br></pre></td></tr></table></figure><h4 id="默认ACL权限"><a href="#默认ACL权限" class="headerlink" title="默认ACL权限"></a>默认ACL权限</h4><p>默认ACL权限的作用是如果给父目录设定默认ACL权限，那么父目录中所有新建的子文件和子目录都会继承父目录的ACL权限<br>命令：<code>setfacl -m d:u:用户名:权限 目录名</code> 可以在权限后面加-R来进行递归</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 project]# setfacl -m d:u:st:rx -R /project/       # 设置默认acl权限</span><br><span class="line">[root@192 project]# touch cde                               # 新创建的文件也具备了acl权限</span><br><span class="line">[root@192 project]# ll</span><br><span class="line">总用量 12</span><br><span class="line">-rw-r-xr--+ 1 root root 0 12月 27 04:38 abc</span><br><span class="line">-rw-r-xr--+ 1 root root 0 12月 27 04:38 bcd</span><br><span class="line">-rw-rw----+ 1 root root 0 12月 27 04:45 cde</span><br></pre></td></tr></table></figure><h3 id="文件特殊权限"><a href="#文件特殊权限" class="headerlink" title="文件特殊权限"></a>文件特殊权限</h3><h4 id="SetUID"><a href="#SetUID" class="headerlink" title="SetUID"></a>SetUID</h4><ol><li><p>只有可以执行的二进制程序才能设定SUID权限，普通文件或者目录没有意义</p></li><li><p>命令执行者要对该程序拥有x(执行)权限</p></li><li><p>命令执行者在执行该程序时获得该程序文件属主的身份(在执行程序的过程中灵魂附体为文件的属主)</p></li><li><p>SetUID权限只在该程序执行过程中有效，也就是说身份改变只在程序执行过程中有效</p></li></ol><p>passwd命令拥有SetUID权限，所以普通用户可以修改自己的密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ll /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x. 1 root root 25980 2月  22 2012 /usr/bin/passwd</span><br></pre></td></tr></table></figure><p>cat命令没有SetUID权限，所以普通用户不能查看/etc/shadow文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ll /bin/cat</span><br><span class="line">-rwxr-xr-x. 1 root root 47976 6月  22 2012 /bin/cat</span><br></pre></td></tr></table></figure><p><img src="https://cdn.lianjinquan.com/img/posts/linux/05/linux02.png"></p><h5 id="设定SetUID的方法"><a href="#设定SetUID的方法" class="headerlink" title="设定SetUID的方法"></a>设定SetUID的方法</h5><p>4代表SUID权限</p><p><code>chmod 4755 文件名</code>  7代表所有者权限，5代表所属组权限，5代表其他人</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# touch test                      # 创建空文件test</span><br><span class="line">[root@192 tmp]# ll test                         # test文件默认权限 rw-r--r--</span><br><span class="line">-rw-r--r--. 1 root root 0 12月 29 05:35 test</span><br><span class="line">[root@192 tmp]# chmod 4755 test                 # 设定SUID权限</span><br><span class="line">[root@192 tmp]# ll test                         # 文件权限变为rwsr-xr-x，其中s代表SUID权限</span><br><span class="line">-rwsr-xr-x. 1 root root 0 12月 29 05:35 test</span><br></pre></td></tr></table></figure><p><code>chmod u+s 文件名</code>  如果用户对文件没有执行权限，就会报错，此时给他加特殊权限，就会显示大S</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]<span class="comment"># chmod u+s test                   # 设定SUID权限</span></span><br><span class="line">[root@192 tmp]<span class="comment"># ll test                          # 注意：这里大S代表没有可执行权限，因为test是一个空文件，不具备x(执行)权限</span></span><br><span class="line">-rwSr--r--. 1 root root 0 12月 29 05:35 <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h5 id="取消SetUID的方法"><a href="#取消SetUID的方法" class="headerlink" title="取消SetUID的方法"></a>取消SetUID的方法</h5><p><code>chmod 755 文件名</code><br><code>chmod u-s 文件名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# chmod 644 test                #取消SetUID权限，把权限指回去就行</span><br><span class="line">[root@192 tmp]# ll test</span><br><span class="line">-rw-r--r--. 1 root root 0 12月 29 05:35 test</span><br></pre></td></tr></table></figure><h5 id="危险的SetUID"><a href="#危险的SetUID" class="headerlink" title="危险的SetUID"></a>危险的SetUID</h5><ol><li>关键目录应当严格控制写权限。比如：“/”，“/usr”等</li><li>用户的密码设置要严格遵守密码三原则</li><li>对系统中默认应该具有SetUID权限的文件作一列表，定时检查有没有这之外的文件被设置了SetUID权限</li></ol><h4 id="SetGID"><a href="#SetGID" class="headerlink" title="SetGID"></a>SetGID</h4><ol><li><p>SetGID针对文件的作用</p><ul><li><p>只有可以执行的二进制程序才能设定SGID权限</p></li><li><p>命令执行者要对该程序拥有x(执行)权限</p></li><li><p>命令执行在执行程序的时候，组身份升级为该程序文件的所属组</p></li><li><p>SetGID权限同样只在该程序执行过程中有效，也就是说组身份改变只在程序执行过程中有效</p><p>locate 命令拥有SetGID权限，所以普通用户可以使用locate来查询。</p><ul><li>/usr/bin/locate是可执行二进制程序,可以赋予SGID</li><li>执行用户lamp对/usr/bin/locate命令拥有执行权限</li><li>执行/usr/bin/locate命令时，组身份会升级为 slocate组，而 slocate对/var/lib/mlocate/mlocate.db数据库拥有r权限，所以普通用户可以使用 locate命令查询 locate.db数据库</li><li>命令结束，lamp用户的组身份返回为lamp组</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# whereis locate                                              # 查找locate命令所在位置</span><br><span class="line">locate: /usr/bin/locate /usr/share/man/man1/locate.1.gz</span><br><span class="line">[root@192 tmp]# ll /usr/bin/locate                                          # 组中s代表SetGID权限</span><br><span class="line">-rwx--s--x. 1 root slocate 35612 8月  24 2010 /usr/bin/locate</span><br><span class="line">[root@192 tmp]# ll /var/lib/mlocate/mlocate.db</span><br><span class="line">-rw-r-----. 1 root slocate 2435463 12月 27 05:24 /var/lib/mlocate/mlocate.db</span><br></pre></td></tr></table></figure></li></ul></li></ol><ol start="2"><li><p>SetGID针对目录的作用</p><ul><li>普通用户必须对此目录拥有r和x权限，才能进入此目录</li><li>普通用户在此目录中的有效组会变成此目录的所属组</li><li>若普通用户对此目录拥有w权限时，新建的文件的默认所属组是这个目录的所属组</li></ul></li></ol><h5 id="设定SetGID的方法"><a href="#设定SetGID的方法" class="headerlink" title="设定SetGID的方法"></a>设定SetGID的方法</h5><p>2代表SGID权限</p><p><code>chmod 2755 文件名 </code><br><code>chmod g+s 文件名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# mkdir test                          # 在/tmp目录下创建目录test</span><br><span class="line">[root@192 tmp]# chmod 2777 test                     # 设定SGID权限</span><br><span class="line">[root@192 tmp]# ll -d test                          # s代表SGID权限</span><br><span class="line">drwxrwsrwx. 2 root root 4096 12月 29 06:08 test</span><br><span class="line">[root@192 tmp]# su - sc                             # 切换为普通用户sc</span><br><span class="line">[sc@192 tmp]$ touch bv                              # 普通用户创建文件bv,文件的所属组是sc</span><br><span class="line">[sc@192 tmp]$ ll</span><br><span class="line">总用量 68</span><br><span class="line">-rw-rw-r--. 1 sc   sc      0 12月 29 06:14 bv</span><br><span class="line">[sc@192 ~]$ cd /tmp/test/</span><br><span class="line">[sc@192 test]$ touch abc                            # 使用普通用户创建的文件在/tmp/test目录下所属组是root</span><br><span class="line">[sc@192 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-r--. 1 sc root 0 12月 29 06:10 abc</span><br></pre></td></tr></table></figure><h5 id="取消SetUID的方法-1"><a href="#取消SetUID的方法-1" class="headerlink" title="取消SetUID的方法"></a>取消SetUID的方法</h5><p><code>chmod 755 文件名</code><br><code>chmod g-s 文件名</code></p><h4 id="Sticky-BIT"><a href="#Sticky-BIT" class="headerlink" title="Sticky BIT"></a>Sticky BIT</h4><h5 id="SBIT粘着位作用"><a href="#SBIT粘着位作用" class="headerlink" title="SBIT粘着位作用"></a>SBIT粘着位作用</h5><ul><li><p>粘着位目前只对<strong>目录</strong>有效</p></li><li><p>普通用户对该目录拥有w和x权限，即普通用户可以在此目录拥有写入权限</p></li><li><p>如果没有粘着位，因为普通用户拥有w权限，所以可以删除此目录下所有文件，包括其他用户建立的文件。一旦赋予了粘着位，除了root可以删除所有文件，普通用户就算拥有了w权限，也只能删除自己建立的文件，但是不能删除其他用户建立的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ll -d /tmp/                         # /tmp/目录其他人的权限是rwt，其中t是SBIT权限</span><br><span class="line">drwxrwxrwt. 22 root root 4096 12月 29 06:14 /tmp/</span><br><span class="line">[root@192 ~]# su - sc                             # 切换为 su 用户</span><br><span class="line">[sc@192 ~]$ cd /tmp/</span><br><span class="line">[sc@192 tmp]$ touch sc-test                       # 使用su用户创建文件sc-test</span><br><span class="line">[sc@192 tmp]$ ls</span><br><span class="line">sc-test</span><br><span class="line">[sc@192 ~]$ su - user1                             # 切换为 usr1 用户</span><br><span class="line">[user1@192 ~]$ cd /tmp/</span><br><span class="line">[user1@192 tmp]$ ll</span><br><span class="line">总用量 68</span><br><span class="line">-rw-rw-r--. 1 sc   sc      0 12月 29 06:28 sc-test</span><br><span class="line">[user1@192 tmp]$ rm -rf /tmp/                     # 删除的时候报错，虽然其他人对/tmp目录有删除权限，由于SBIT的作用，其他人依然不能删除/tmp,只允许创建目录的用户sc删除</span><br><span class="line">rm: 无法删除&quot;/tmp/sc-test&quot;: 不允许的操作</span><br></pre></td></tr></table></figure></li></ul><h5 id="设定粘着位的方法"><a href="#设定粘着位的方法" class="headerlink" title="设定粘着位的方法"></a>设定粘着位的方法</h5><p>1代表粘着位</p><p><code>chmod 1755 目录名</code><br><code>chmod o+t 目录名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# mkdir /test</span><br><span class="line">[root@192 ~]# ll -d /test/</span><br><span class="line">drwxr-xr-x. 2 root root 4096 12月 29 06:41 /test/</span><br><span class="line">[root@192 ~]# chmod 1755 /test/</span><br><span class="line">[root@192 ~]# ll -d /test/                            # t代表SBIT</span><br><span class="line">drwxr-xr-t. 2 root root 4096 12月 29 06:41 /test/</span><br></pre></td></tr></table></figure><h5 id="取消粘着位的方法"><a href="#取消粘着位的方法" class="headerlink" title="取消粘着位的方法"></a>取消粘着位的方法</h5><p><code>chmod 755 目录名</code><br><code>chmod o-t 目录名</code></p><h3 id="文件系统属性chattr权限"><a href="#文件系统属性chattr权限" class="headerlink" title="文件系统属性chattr权限"></a>文件系统属性chattr权限</h3><ol><li><p>命令：<code>chattr [+ - =] [选项] 文件名或者目录名</code></p><ul><li><code>+</code>增加权限  <code>-</code>删除权限 <code>=</code>等于某权限</li><li><code>i</code>: 如果对文件设置i属性，那么不允许对文件进行删除，改名，也不能添加和修改数据；如果对目录设置i属性,那么只能修改目录下文件的数据，但是不允许建立和删除文件</li><li><code>a</code>：如果对文件设置a属性，那么只能在文件中增加数据，但是不能删除或者修改数据；如果对目录设置a属性,那么只允许在目录中建立和修改文件，但是不允许删除文件</li></ul></li><li><p>查看文件系统属性</p><p><code>lsattr [选项] 文件名</code></p><ul><li>-a：显示所有文件和目录</li><li>-d：若目标是目录，仅列出目录本身的属性，而不是子文件的</li></ul></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# touch test.txt          # 创建test.txt空文件</span><br><span class="line">[root@192 tmp]# chattr +i test.txt      # 给test.txt文件增加i权限</span><br><span class="line">[root@192 tmp]# lsattr -a test.txt      # 查看test.txt文件权限</span><br><span class="line">----i--------e- test.txt             </span><br><span class="line">[root@192 tmp]# echo 111 &gt;&gt; test.txt    # root超级管理员也不能写入内容</span><br><span class="line">-bash: test.txt: 权限不够</span><br><span class="line">[root@192 tmp]# rm -rf test.txt          # root超级管理员也不能删除文件</span><br><span class="line">rm: 无法删除&quot;test.txt&quot;: 不允许的操作</span><br><span class="line"></span><br><span class="line">[root@192 tmp]# mkdir test               # 创建test目录</span><br><span class="line">[root@192 tmp]# touch /test/test.text    # 在test目录目录下创建test.text文件</span><br><span class="line">[root@192 tmp]# chattr +i /test/         # 给test目录增加i权限</span><br><span class="line">[root@192 tmp]# lsattr -a /test/         # 查看test目前权限</span><br><span class="line">-------------e- /test/test.text</span><br><span class="line">--------------- /test/..</span><br><span class="line">----i--------e- /test/.</span><br><span class="line">[root@192 tmp]# echo 222 &gt;&gt; /test/test.text  # 可以在test.text文件中写入内容</span><br><span class="line">[root@192 tmp]# rm -rf /test/test.text       # 不能删除test目录下的内容</span><br><span class="line">rm: 无法删除&quot;/test/test.text&quot;: 权限不够      </span><br><span class="line">[root@192 tmp]# touch /test/test.yml         # 不能在test目录下新增文件</span><br><span class="line">touch: 无法创建&quot;/test/test.yml&quot;: 权限不够</span><br><span class="line"></span><br><span class="line">[root@192 tmp]# chattr -i /test/             # 删除test目录i权限</span><br><span class="line">[root@192 tmp]# rm -rf test                  # test目录此时可以删除</span><br></pre></td></tr></table></figure><h3 id="系统命令sudo权限"><a href="#系统命令sudo权限" class="headerlink" title="系统命令sudo权限"></a>系统命令sudo权限</h3><ol><li>sudo权限<ul><li>root把本来只能超级用户执行的命令赋予普通用户执行</li><li>sudo的操作对象是系统命令</li></ul></li><li>sudo使用<ul><li><code>visudo</code> 实际修改的是/etc/sudoers文件</li><li>root ALL=(ALL) ALL 用户名 被管理主机的地址=(可使用身份) 授权命令(绝对路径)</li><li>%wheel ALL=(ALL) ALL  %组名 被管理主机的地址=(可使用的身份) 授权命令(绝对路径)</li><li>被管理主机的地址：本机IP或者ALL，限制的不是来源IP，而是访问IP</li></ul></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tmp]# visudo             # 授权用户sc可以可以重启服务器</span><br><span class="line">sc      ALL=/sbin/shutdown -r now</span><br><span class="line">[root@192 ~]# su - sc              # 切换为sc用户</span><br><span class="line">[sc@192 ~]$ sudo -l                # 查看可用的sudo命令</span><br><span class="line">[sudo] password for sc: </span><br><span class="line">Matching Defaults entries for sc on this host:</span><br><span class="line">    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC</span><br><span class="line">    KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;,</span><br><span class="line">    env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY LC_NAME</span><br><span class="line">    LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET</span><br><span class="line">    XAUTHORITY&quot;, secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin</span><br><span class="line"></span><br><span class="line">User sc may run the following commands on this host:</span><br><span class="line">    (root) /sbin/shutdown -r now</span><br><span class="line">[sc@192 ~]$ sudo /sbin/shutdown -r now  # 普通用户sc执行sudo赋予的重启命令</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux用户和用户组管理</title>
      <link href="/2020/12/24/linux/linux04/"/>
      <url>/2020/12/24/linux/linux04/</url>
      
        <content type="html"><![CDATA[<p>linux用户和用户组管理</p><a id="more"></a><h3 id="用户配置文件"><a href="#用户配置文件" class="headerlink" title="用户配置文件"></a>用户配置文件</h3><h4 id="用户信息文件-etc-passwd"><a href="#用户信息文件-etc-passwd" class="headerlink" title="用户信息文件/etc/passwd"></a>用户信息文件/etc/passwd</h4><ol><li><p>越是对服务器安全性要求高的服务器，越需要建立合理的用户权限登记制度和服务器操作规范，在Linux中主要是通过用户配置文件来查看和修改用户信息</p></li><li><p>/etc/passwd</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># man 5 passwd #查看passwd配置文件帮助信息 5代表配置文件</span></span><br><span class="line">[root@192 ~]<span class="comment"># vim /etc/passwd # 查看passwd文件内容</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin</span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">[root@192 ~]<span class="comment"># ll /etc/passwd</span></span><br><span class="line">-rw-r--r--. 1 root root 1662 12月  8 08:51 /etc/passwd</span><br><span class="line">[root@192 ~]<span class="comment"># ll /etc/shadow</span></span><br><span class="line">----------. 1 root root 1064 12月  8 08:59 /etc/shadow</span><br></pre></td></tr></table></figure><p> passwd配置文件分为七个字段：<code>root:x:0:0:root:/root:/bin/bash</code></p><ul><li><p>第一个字段：用户名称</p></li><li><p>第二个字段：密码标志 x代表用户有密码，真正的密码放在/etc/shadow里，它里面进行了SHA512加密，如果没有x，代表没有密码，只能进行本地登陆，远程登陆会被禁止，SHA协议禁止</p></li><li><p>第三个字段：UID（用户ID）</p><table><thead><tr><th>用户id</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>超级用户</td></tr><tr><td>1-499</td><td>系统用户（伪用户）</td></tr><tr><td>500-65535</td><td>普通用户</td></tr></tbody></table></li><li><p>第四个字段：GID（用户初始组ID）</p><p>初始组：就是指用户一登陆就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组<br>附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个</p></li><li><p>第五个字段：用户说明</p></li><li><p>第六个字段：家目录</p><p>普通用户：/home/用户名/<br>超级用户：/root/</p></li><li><p>第七个字段：登陆之后的Shell</p><p>Shell就是Linux的命令解释器，在/etc/passwd当中，除了标准Shell是/bin/bash之外。还可以写如/sbin/nologin，普通用户全为/sbin/nologin。/bin/bash为可以登陆，/sbin/nologin为禁止登陆，修改之后便可以禁止普通用户登陆</p></li></ul></li></ol><h4 id="影子文件-etc-shadow"><a href="#影子文件-etc-shadow" class="headerlink" title="影子文件/etc/shadow"></a>影子文件/etc/shadow</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># vim /etc/shadow</span></span><br><span class="line">root:<span class="variable">$6</span><span class="variable">$fSPFTuqP4WOQ2DKs</span><span class="variable">$BYsNI13</span>/ZsDqCm9/qy9rVb4LUCBD7Ur7gzpBT5Ei3iP5ZqjZZiIu4NdBLlV1Ac4wUcIqizy1qPKQe3HAQjBiB/:18597:0:99999:7:::</span><br><span class="line">bin:*:15980:0:99999:7:::</span><br><span class="line">daemon:*:15980:0:99999:7:::</span><br><span class="line">pulse:!!:18597::::::</span><br></pre></td></tr></table></figure><p>Shadow配置文件分为个字段：</p><ul><li><p>第一个字段：用户名</p></li><li><p>第二个字段：加密算法<br>加密算法升级为SHA512散列加密算法，如果密码是“!!”或者“0”代表没有密码，不能登陆，可以用感叹号禁用用户密码</p></li><li><p>第三个字段：密码最后一次修改日期<br>使用1970年1月1日作为标准时间，每过一天时间戳加1</p><p>时间戳换算：date -d “1970-01-01 [时间戳] days”</p><p>日期换算时间戳：echo $(($(date –date=“年/月/日” +%s)/[时间戳]+1))</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# date -d &quot;1970-01-01 16066 days&quot;  #时间戳换算日期 16066是时间戳</span><br><span class="line">2013年 12月 27日 星期五 00:00:00 CST</span><br><span class="line">[root@192 ~]# echo $(($(date --date=&quot;2014/01/06&quot; +%s)/86400+1)) # 日期换算时间戳</span><br><span class="line">16076</span><br></pre></td></tr></table></figure></li><li><p>第四个字段：两次密码的修改时间间隔时间（和第三个字段相比）</p></li><li><p>第五个字段：密码有效期（和第三个字段相比）</p></li><li><p>第六个字段：密码修改到期前的警告天数（和第五个字段相比）</p></li><li><p>第七个字段：密码过期后的宽限天数（和第五个字段相比）<br>0：代表密码过期后立即失效<br>-1：代表密码永远不会失效</p></li><li><p>第八个字段：账号失效时间<br>要用时间戳表示</p></li><li><p>第九个字段：保留</p></li></ul><h4 id="组信息文件-etc-group"><a href="#组信息文件-etc-group" class="headerlink" title="组信息文件/etc/group"></a>组信息文件/etc/group</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# vim /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:bin,daemon</span><br><span class="line">daemon:x:2:bin,daemon</span><br><span class="line">sys:x:3:bin,adm</span><br><span class="line">adm:x:4:adm,daemon</span><br></pre></td></tr></table></figure><p>组文件信息配置文件分4个字段：</p><p>第一个字段：组名<br>第二个字段：组密码标志<br>第三个字段：GID<br>第四个字段：组中附加用户</p><h4 id="组密码文件-etc-gshadow"><a href="#组密码文件-etc-gshadow" class="headerlink" title="组密码文件/etc/gshadow"></a>组密码文件/etc/gshadow</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# vim /etc/gshadow</span><br><span class="line">root:::</span><br><span class="line">bin:::bin,daemon</span><br><span class="line">daemon:::bin,daemon</span><br><span class="line">sys:::bin,adm</span><br><span class="line">adm:::adm,daemon</span><br><span class="line">tty:::</span><br></pre></td></tr></table></figure><p>组密码文件配置文件分4个字段：</p><p>第一个字段：组名<br>第二个字段：组密码<br>第三个字段：组管理员用户名<br>第四个字段：组中附加用户</p><h3 id="用户管理相关文件"><a href="#用户管理相关文件" class="headerlink" title="用户管理相关文件"></a>用户管理相关文件</h3><h4 id="用户的家目录-home"><a href="#用户的家目录-home" class="headerlink" title="用户的家目录/home/"></a>用户的家目录/home/</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ll /home/</span><br><span class="line">总用量 24</span><br><span class="line">drwx------. 2 root     root     16384 12月  2 05:14 lost+found</span><br><span class="line">drwx------. 4 yangmi   yangmi    4096 12月  8 10:13 yangmi</span><br><span class="line">[root@192 ~]# ll -d /root/</span><br><span class="line">dr-xr-x---. 34 root root 4096 12月 21 08:52 /root/</span><br></pre></td></tr></table></figure><p>普通用户：/home/用户名/，所有者和所属组都是此用户，权限是700<br>超级用户：/root/，所有者和所属组都是root用户，权限是550<br>普通用户变为超级用户家目录不会变</p><h4 id="用户的邮箱-var-spool-mail"><a href="#用户的邮箱-var-spool-mail" class="headerlink" title="用户的邮箱/var/spool/mail/"></a>用户的邮箱/var/spool/mail/</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># cd /var/spool/mail/</span></span><br><span class="line">[root@192 mail]<span class="comment"># ls  #/var/spool/mail/用户名/</span></span><br><span class="line">root  rpc   yangmi</span><br></pre></td></tr></table></figure><h4 id="用户模板目录-etc-skel"><a href="#用户模板目录-etc-skel" class="headerlink" title="用户模板目录/etc/skel"></a>用户模板目录/etc/skel</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 yangmi]# cd /etc/skel/ #进入用户模板目录</span><br><span class="line">[root@192 skel]# vi warning.txt #在用户模板目录里面新加一个文件warning.txt</span><br><span class="line">[root@192 skel]# ls -a #用户模板目录里面有warning.txt文件</span><br><span class="line">.  ..  .bash_logout  .bash_profile  .bashrc  .gnome2  .mozilla  warning.txt</span><br><span class="line">[root@192 skel]# useradd user1 #添加新用户user1</span><br><span class="line">[root@192 skel]# passwd user1 #给用户user1设置密码</span><br><span class="line">[root@192 skel]# cd /home/user1/</span><br><span class="line">[root@192 user1]# ls -a #用户user1的家目录中也有warning.txt文件</span><br><span class="line">.  ..  .bash_logout  .bash_profile  .bashrc  .gnome2  .mozilla  warning.txt</span><br></pre></td></tr></table></figure><p>在/etc/skel里创建了文件的话，在创建新用户时会自动出现在新用户家目录的默认隐藏信息里（用于写警告信息）</p><h3 id="用户管理命令"><a href="#用户管理命令" class="headerlink" title="用户管理命令"></a>用户管理命令</h3><h4 id="用户添加命令useradd"><a href="#用户添加命令useradd" class="headerlink" title="用户添加命令useradd"></a>用户添加命令useradd</h4><table><thead><tr><th align="left">语法</th><th>说明</th><th>选项</th><th>选项说明</th></tr></thead><tbody><tr><td align="left">useradd [选项] 用户名</td><td>添加新用户</td><td>-u UID</td><td>手工指定用户的UID号</td></tr><tr><td align="left"></td><td></td><td>-d 家目录</td><td>手工指定用户的家目录</td></tr><tr><td align="left"></td><td></td><td>-c 用户说明</td><td>手工指定用户的说明</td></tr><tr><td align="left"></td><td></td><td>-g 组名</td><td>手工指定用户的初始组</td></tr><tr><td align="left"></td><td></td><td>-G 组名</td><td>指定用户的附加组</td></tr><tr><td align="left"></td><td></td><td>-s shell</td><td>手工指定</td></tr></tbody></table><p>用户的登陆shell。默认是/bin/bash，passwd，shadow，group，gshadow，home，mail里面都有新用户信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# useradd user #添加新用户user</span><br><span class="line">[root@192 ~]# passwd user  #设置密码</span><br><span class="line">[root@192 ~]# grep user /etc/passwd </span><br><span class="line">user:x:503:504::/home/user:/bin/bash</span><br><span class="line">[root@192 ~]# grep user /etc/shadow </span><br><span class="line">user:$6$XSmOILya$2F0UXlwx54wJerNRNz6xY0quG5ou2gGocowLGli71Dqy1N.4iGJDMa/XfiFxQrV1.MVSsweHOVStQug3pgeg60:18617:0:99999:7:::</span><br><span class="line">[root@192 ~]# grep user /etc/group</span><br><span class="line">user:x:504:</span><br><span class="line">[root@192 ~]# grep user /etc/gshadow</span><br><span class="line">user:!::</span><br><span class="line">[root@192 ~]# ll -d /home/user/</span><br><span class="line">drwx------. 4 user user 4096 12月 21 10:27 /home/user/</span><br><span class="line">[root@192 ~]# ll -d /var/spool/mail/user</span><br><span class="line">-rw-rw----. 1 user mail 0 12月 21 10:27 /var/spool/mail/user</span><br><span class="line">[root@192 ~]# useradd -u 666 -G root,bin -c &quot;test user&quot; -d /liming -s /bin/bash liming</span><br><span class="line">[root@192 ~]# grep liming /etc/passwd</span><br><span class="line">liming:x:666:666:test user:/liming:/bin/bash</span><br><span class="line">[root@192 ~]# ll -d /liming</span><br><span class="line">drwx------. 4 liming liming 4096 12月 24 04:04 /liming</span><br></pre></td></tr></table></figure><p><code>/etc/default/useradd</code>里面定义了建立用户的默认信息</p><table><thead><tr><th></th><th>说明</th></tr></thead><tbody><tr><td>GROUP=100</td><td>用户默认组</td></tr><tr><td>HOME=/home</td><td>用户家目录</td></tr><tr><td>INACTIVE=-1</td><td>密码过期宽限天数（shadow文件第七个字段）</td></tr><tr><td>EXPIRE=</td><td>密码失效时间（shadow文件第八个字段）</td></tr><tr><td>SHELL=/bin/bash</td><td>默认shell</td></tr><tr><td>SKEL=/etc/skel</td><td>模板目录</td></tr><tr><td>CREATE_MALL_SPOOL=yes</td><td>是否建立邮箱</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# vim /etc/default/useradd</span><br><span class="line"><span class="meta">#</span><span class="bash"> useradd defaults file</span></span><br><span class="line">GROUP=100</span><br><span class="line">HOME=/home</span><br><span class="line">INACTIVE=-1</span><br><span class="line">EXPIRE=</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">SKEL=/etc/skel</span><br><span class="line">CREATE_MAIL_SPOOL=yes</span><br></pre></td></tr></table></figure><p><code>/etc/login.defs</code> </p><table><thead><tr><th></th><th>说明</th></tr></thead><tbody><tr><td>PASS_MAX_DAYS 99999</td><td>密码有效期(shadow文件第五个字段)</td></tr><tr><td>PASS_MIN_DAYS 0</td><td>密码修改间隔(shadow文件第四个字段)</td></tr><tr><td>PASS_MIN_LEN 5</td><td>密码最小5位（PAM）现在为PAM生效，5位密码不生效</td></tr><tr><td>PASS_WARN_AGE 7</td><td>密码到期警告(shadow文件第六个字段）</td></tr><tr><td>UID_MIN 500</td><td>最小UID范围</td></tr><tr><td>GID_MAX 60000</td><td>最大UID范围</td></tr><tr><td>ENCRYPT_METHOD SHA512</td><td>加密模式</td></tr></tbody></table><h4 id="修改用户密码passwd"><a href="#修改用户密码passwd" class="headerlink" title="修改用户密码passwd"></a>修改用户密码passwd</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>passwd [选项] 用户名</td><td>修改用户密码</td><td>-S</td><td>查询用户密码的密码状态。仅root用户可以</td></tr><tr><td></td><td></td><td>-l</td><td>暂时锁定用户。仅root用户可用</td></tr><tr><td></td><td></td><td>-u</td><td>解锁用户。仅root用户可用</td></tr><tr><td></td><td></td><td>–stdin</td><td>可以通过管道符(|)输出的数据作为用户的密码</td></tr></tbody></table><p><code>passwd 用户名</code>  root用户给普通用户修改密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd liming</span><br></pre></td></tr></table></figure><p>普通用户自己修改密码，例如使用liming用户登录修改密码，直接使用<code>passwd</code>，需要先确认密码后才能修改密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><p><code>passwd -S 用户名</code> 查询用户密码的密码状态，例如下面的查询，用户密码设定时间（2020-12-23），密码修改时间间隔（0），密码有效期（99999），警告时间（7），密码不失效（-1），实际显示的就是<code>/etc/shadow</code>文件信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# passwd -S liming</span><br><span class="line">liming PS 2020-12-23 0 99999 7 -1 (密码已设置，使用 SHA512 加密。)</span><br><span class="line">[root@192 ~]# cat /etc/shadow | grep liming</span><br><span class="line">liming:$6$0w2tQQRH$Eyjew7YZWX/s5s3XDrjpxkbbsnVBbulByFaZ7bfkSuuC/uPH9HfR.2lfmvRymMa3Z6vdvNTxsp8isr.0ip6.c/:18619:0:99999:7:::</span><br></pre></td></tr></table></figure><p><code>passwd -l 用户名</code>  锁定用户，查看shadow文件可以看出密码前有!!，表示这个用户被锁定了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# passwd -l liming #</span><br><span class="line">锁定用户 liming 的密码 。</span><br><span class="line">passwd: 操作成功</span><br><span class="line">[root@192 ~]# vim /etc/shadow</span><br><span class="line">liming:!!$6$0w2tQQRH$Eyjew7YZWX/s5s3XDrjpxkbbsnVBbulByFaZ7bfkSuuC/uPH9HfR.2lfmvRymMa3Z6vdvNTxsp8isr.0ip6.c/:18619:0:99999:7:::</span><br></pre></td></tr></table></figure><p><code>passwd -u 用户名</code>  解锁用户，查看shadow文件可以看出密码前的!!被删除了，表示这个用户被解锁了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># passwd -u  liming</span></span><br><span class="line">解锁用户 liming 的密码 。</span><br><span class="line">passwd: 操作成功</span><br><span class="line">[root@192 ~]<span class="comment"># vim /etc/shadow </span></span><br><span class="line">liming:<span class="variable">$6</span><span class="variable">$0w2tQQRH</span><span class="variable">$Eyjew7YZWX</span>/s5s3XDrjpxkbbsnVBbulByFaZ7bfkSuuC/uPH9HfR.2lfmvRymMa3Z6vdvNTxsp8isr.0ip6.c/:18619:0:99999:7:::</span><br></pre></td></tr></table></figure><p><code>echo &quot;123&quot; | passwd —stdin [用户名]</code> 使用字符串作为用户的密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;123&quot; | passwd —stdin liming</span><br></pre></td></tr></table></figure><h4 id="修改用户信息usermod"><a href="#修改用户信息usermod" class="headerlink" title="修改用户信息usermod"></a>修改用户信息usermod</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>usermod [选项] 用户名</td><td>修改用户信息</td><td>-u UID</td><td>修改用户的UID号</td></tr><tr><td></td><td></td><td>-c 用户说明</td><td>修改用户的说明信息</td></tr><tr><td></td><td></td><td>-G 组名</td><td>修改用户的附加组</td></tr><tr><td></td><td></td><td>-L</td><td>临时锁定用户（Lock）</td></tr><tr><td></td><td></td><td>-U</td><td>解锁用户锁定（Unlock）</td></tr></tbody></table><p>以下例子修改用户liming的用户说明为my user，加入root附加组，修改的uid号为550</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# cat /etc/passwd</span><br><span class="line">liming:x:666:666:test user:/liming:/bin/bash</span><br><span class="line">[root@192 ~]# usermod -c &quot;my user&quot; -G root -u 550 liming</span><br><span class="line">[root@192 ~]# cat /etc/passwd</span><br><span class="line">liming:x:550:666:my user:/liming:/bin/bash</span><br></pre></td></tr></table></figure><p>锁定liming用户,此时<code>/etc/shadow </code>文件liming用户密码前多一个！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# usermod -L liming</span><br><span class="line">[root@192 ~]# vim /etc/shadow </span><br><span class="line">liming:!$6$0w2tQQRH$Eyjew7YZWX/s5s3XDrjpxkbbsnVBbulByFaZ7bfkSuuC/uPH9HfR.2lfmvRymMa3Z6vdvNTxsp8isr.0ip6.c/:18619:0:99999:7:::</span><br></pre></td></tr></table></figure><p>解锁liming用户，此时<code>/etc/shadow</code> 文件liming用户密码前的！被删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# usermod -U liming</span><br><span class="line">[root@192 ~]# vim /etc/shadow </span><br><span class="line">liming:$6$0w2tQQRH$Eyjew7YZWX/s5s3XDrjpxkbbsnVBbulByFaZ7bfkSuuC/uPH9HfR.2lfmvRymMa3Z6vdvNTxsp8isr.0ip6.c/:18619:0:99999:7:::</span><br></pre></td></tr></table></figure><h4 id="修改用户密码状态chage"><a href="#修改用户密码状态chage" class="headerlink" title="修改用户密码状态chage"></a>修改用户密码状态chage</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>chage [选项] 用户名</td><td>修改用户密码状态</td><td>-l</td><td>列出用户的详细密码状态</td></tr><tr><td></td><td></td><td>-d 日期</td><td>修改密码最后一次更新时间（shadow文件第三个字段）</td></tr><tr><td></td><td></td><td>-m 天数</td><td>两次修改密码间隔（shadow文件第四个字段）</td></tr><tr><td></td><td></td><td>-M 天数</td><td>密码有效期（shadow文件第五个字段）</td></tr><tr><td></td><td></td><td>-W 天数</td><td>密码过期前警告天数（shadow文件第六个字段）</td></tr><tr><td></td><td></td><td>-I 天数</td><td>密码过期后宽限天数（shadow文件第七个字段）</td></tr><tr><td></td><td></td><td>-E 日期</td><td>账号失效时间（shadow文件第八 个字段）</td></tr></tbody></table><p>例子重要用法：<br><code>chage -d 0 [用户名]</code>这个命令其实是把密码修改日期归0了，这样用户一登陆就要修改密码（学校，公司身份系统修改初始密码）</p><h4 id="删除用户userdel"><a href="#删除用户userdel" class="headerlink" title="删除用户userdel"></a>删除用户userdel</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>userdel [-r] 用户名</td><td>删除用户</td><td>-r</td><td>删除用户的同时删除用户家目录</td></tr></tbody></table><h4 id="查看用户ID"><a href="#查看用户ID" class="headerlink" title="查看用户ID"></a>查看用户ID</h4><p><code>id  用户名</code> 以下例子查询liming用户的用户ID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# id liming</span><br><span class="line">uid=550(liming) gid=666(liming) 组=666(liming),0(root)</span><br></pre></td></tr></table></figure><h4 id="用户切换命令su"><a href="#用户切换命令su" class="headerlink" title="用户切换命令su"></a>用户切换命令su</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>su [选项] 用户</td><td>用户切换命令</td><td>-</td><td>选项只使用“-”代表连带用户的环境变量一起切换</td></tr><tr><td></td><td></td><td>-c</td><td>仅执行一次命令，而不切换用户身份</td></tr></tbody></table><p><code>env</code>查看用户环境变量</p><p>普通用户liming切换成超级用户root</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[liming@192 ~]$ su - root</span><br></pre></td></tr></table></figure><p>不切换成root，但是执行useradd命令添加user1用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# su - root -c &quot;useradd user1&quot; </span><br></pre></td></tr></table></figure><h3 id="用户组管理命令"><a href="#用户组管理命令" class="headerlink" title="用户组管理命令"></a>用户组管理命令</h3><h4 id="添加用户组"><a href="#添加用户组" class="headerlink" title="添加用户组"></a>添加用户组</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>groupadd [选项] 组名</td><td>添加用户组</td><td>-g GID</td><td>指定组ID</td></tr></tbody></table><p>添加用户组tg，可以在/etc/group下查看组信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# groupadd tg</span><br><span class="line">[root@quan ~]# vi /etc/group</span><br><span class="line">tg:x:1000:</span><br></pre></td></tr></table></figure><h4 id="修改用户组"><a href="#修改用户组" class="headerlink" title="修改用户组"></a>修改用户组</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>groupmod [选项] 组名</td><td>修改用户组</td><td>-g GID</td><td>修改组ID</td></tr><tr><td></td><td></td><td>-n 新组名</td><td>修改组名</td></tr></tbody></table><p>把用户组tg修改为新组名lampgroup，可以在/etc/group下查看组名被修改了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# groupmod -n lampgroup tg</span><br><span class="line">[root@quan ~]# vi /etc/group</span><br><span class="line">lampgroup:x:1000:</span><br></pre></td></tr></table></figure><h4 id="删除用户组"><a href="#删除用户组" class="headerlink" title="删除用户组"></a>删除用户组</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>groupdel 组名</td><td>删除用户组</td><td></td><td></td></tr></tbody></table><p>删除组lampgroup，如果用户组有初始用户，需要先删除初始用户，然后才能删除用户组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@quan ~]# groupdel lampgroup</span><br></pre></td></tr></table></figure><h4 id="用户添加入组、从组中删除"><a href="#用户添加入组、从组中删除" class="headerlink" title="用户添加入组、从组中删除"></a>用户添加入组、从组中删除</h4><table><thead><tr><th>语法</th><th>说明</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>gpasswd 选项 组名</td><td>把用户添加入组或者从组中删除</td><td>-a 用户名</td><td>把用户加入组</td></tr><tr><td></td><td></td><td>-d 用户名</td><td>把用户从组中删除</td></tr></tbody></table><p>把用户user1和user2添加进root组，在/etc/group中可以看到用户user1和user被加入了root组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6fhk4slpwaz2668zqyZ ~]# gpasswd -a user1 root</span><br><span class="line">Adding user user1 to group root</span><br><span class="line">[root@iZuf6fhk4slpwaz2668zqyZ ~]# gpasswd -a user2 root</span><br><span class="line">Adding user user2 to group root</span><br><span class="line">[root@quan ~]# vi /etc/group</span><br><span class="line">root:x:0:user1,user2</span><br></pre></td></tr></table></figure><p>把用户user1从root用户组中删除，在/etc/group中可看到只剩下user2用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6fhk4slpwaz2668zqyZ ~]# gpasswd -d user1 root</span><br><span class="line">Removing user user1 from group root</span><br><span class="line">[root@quan ~]# vi /etc/group</span><br><span class="line">root:x:0:user2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux基础命令的操作</title>
      <link href="/2020/12/07/linux/linux01/"/>
      <url>/2020/12/07/linux/linux01/</url>
      
        <content type="html"><![CDATA[<p>linux基础命令的操作</p><a id="more"></a><h3 id="linux各目录的作用"><a href="#linux各目录的作用" class="headerlink" title="linux各目录的作用"></a>linux各目录的作用</h3><table><thead><tr><th align="center">目录名</th><th>目录作用</th></tr></thead><tbody><tr><td align="center">/bin/</td><td>存放系统命令的目录，普通用户和超级用户都可以执行。不过放在/bin下的命令在单用户模式下也可以执行。</td></tr><tr><td align="center">/sbin/</td><td>保存和系统环境设置相关的命令，只有超级用户可以使用这些命令进行系统环境设置，但是有些命令可以允许普通用户查看。</td></tr><tr><td align="center">/usr/bin/</td><td>存放系统命令的目录，普通用户和超级用户都可以执行。这些命令和系统启动无关，在单用户模式下不能执行。</td></tr><tr><td align="center">/usr/sbin/</td><td>存放根文件系统不必要的系统管理命令，例如多数服务程序。只有超级用户可以使用。大家其实可以注意到Linux的系统，在所有“sbin”目录中保存的命令只有超级用户可以使用，“bin”目录中保存的命令所有用户都可以使用。</td></tr><tr><td align="center">/boot/</td><td>系统启动目录，保存系统启动相关的文件，如内核文件和启动引导程序(grub)文件等。</td></tr><tr><td align="center">/dev/</td><td>设备文件保存位置，我们已经说过 Linux中所有内容以文件形式保存，包括硬件。那么这个目录就是用来保存所有硬件设备文件的。</td></tr><tr><td align="center">/etc/</td><td>配置文件保存位置。系统内所有采用默认安装方式(rpm安装)的服务的配置文件全部都保存在这个目录当中，如用户账户和密码，服务的启动脚本，常用服务的配置文件等。</td></tr><tr><td align="center">/home/</td><td>普通用户的家目录。建立每个用户时，每个用户要有一个默认登录位置，这个位置就是这个用户的家目录，所有普通用户的家目录就是在/home下建立一个和用户名相同的目录。如用户 user1的家目录就是/home/user1。</td></tr><tr><td align="center">/lib/</td><td>系统调用的函数库保存位置。</td></tr><tr><td align="center">/lost+found/</td><td>当系统意外崩溃或机器意外关机，而产生一些文件碎片放在这里。当系统启动的过程中fsck工具会检查这里，并修复已经损坏的文件系统。这个目录只在每个分区中出现，例如/lost+found就是根分区的备份恢复目录，/boot/lost+found就是/boot分区的备份恢复目录。</td></tr><tr><td align="center">/media/</td><td>挂载目录。系统建议是用来挂载媒体设备的，例如软盘和光盘。</td></tr><tr><td align="center">/mnt/</td><td>挂载目录，早期 Linux中只有这一个挂载目录，并没有细分。现在这个目录系统建议挂载额外设备，如U盘，移动硬盘和其他操作系统的分区。</td></tr><tr><td align="center">/misc/</td><td>挂载目录。系统建议用来挂载NFS服务的共享目录。我们在刚刚已经解释了挂载，童鞋们应该知道只要是一个已经建立的空目录就可以作为挂载点。那么系统虽然准备了三个默认挂载目录/media、/mnt、/misc，但是到底在哪个目录中挂载什么设备都可以由管理员自己决定。例如老哥接触 Linux的时候，默认挂载目录只有/mnt一个，所以养成了在/mnt下建立不同目录挂载不同设备的习惯。如/mnt/cdrom挂载光盘，/mnt/usb挂载U盘，这都是可以的。</td></tr><tr><td align="center">/opt/</td><td>第三方安装的软件保存位置。这个目录就是放置和安装其他软件的位置，我手工安装的源码包软件都可以安装到这个目录当中。不过我还是更加习惯把软件放置到/usr/local/目录当中，也就是说/usr/local/目录也可以用来安装软件。</td></tr><tr><td align="center">/proc/</td><td>虚拟文件系统，该目录中的数据并不保存到硬盘当中，而是保存到内存当中。主要保存系统的内核，进程，外部设备状态和网络状态灯。如/proc/cpuinfo是保存CPU信息的， /proc/devices是保存设备驱动的列表的，/proc/filesystems是保存文件系统列表的， /proc/net是保存网络协议信息的。</td></tr><tr><td align="center">/sys/</td><td>虚拟文件系统。和/proc目录相似,都是保存在内存当中的,主要是保存于内核相关信息的。</td></tr><tr><td align="center">/root/</td><td>超级用户的家目录。普通用户家目录在<code>/home</code>下，超级用于家目录直接在<code>/</code>下。</td></tr><tr><td align="center">/srv/</td><td>服务数据目录。一些系统服务启动之后，可以在这个目录中保存所需要的数据。</td></tr><tr><td align="center">/tmp/</td><td>临时目录。系统存放临时文件的目录，该目录下所有用户都可以访问和写入。我们建议此目录中不能保存重要数据，最好每次开机都把该目录清空。</td></tr><tr><td align="center">/usr/</td><td>系统软件资源目录。注意usr不是user的缩写,而是<code>Unix Softwre Resource</code>的缩写，所以不是存放用户数据，而是存放系统软件资源的目录。系统中安装的软件大多数保存在这里。</td></tr><tr><td align="center">/var/</td><td>动态数据保存位置。主要保存缓存、日志以及软件运行所产生的文件。</td></tr></tbody></table><h3 id="服务器注意事项"><a href="#服务器注意事项" class="headerlink" title="服务器注意事项"></a>服务器注意事项</h3><ol><li>远程服务器不允许关机，只能重启。</li><li>重启时应该关闭服务。</li><li>不要在服务器访问高峰运行高负载命令。</li><li>远程配置防火墙时不要把自己踢出服务器。</li><li>指定合理的密码规范并定期更新。</li><li>合理分配权限。</li><li>定期备份重要数据和日志。</li></ol><h4 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h4><blockquote><p>命令格式： 命令 [-选项] [参数]<br>        例如： ls -la /etc<br>说明：</p><ol><li>个别命令使用不遵循此格式  。</li><li>当有多个选项时，可以写在一起  。</li><li>简化选项与完整选项 -a 等于 –all。</li></ol></blockquote><table><thead><tr><th>按键</th><th>进行工作</th></tr></thead><tbody><tr><td>tab</td><td>tab接在一串命令的第一个字段后面，则为【命令补全】。tab接在一串命令的第二个字段后面，则为【文件补全】。</td></tr><tr><td>ctrl+c</td><td>中断目前程序。</td></tr><tr><td>ctrl+d</td><td>键盘输入结束，相当于exit。</td></tr><tr><td>shift + page up</td><td>向上翻页。</td></tr><tr><td>shift + page down</td><td>向下翻页。</td></tr></tbody></table><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">rm</td><td align="center">remove</td><td align="center">/bin/rm</td><td align="center">所有用户</td><td align="center">rm -rf [文件或目录]</td><td>删除文件</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-r</td><td>删除目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-f</td><td>强制执行</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm grub.conf               # 删除文件，会有提示，按y确认删除</span></span><br><span class="line"><span class="built_in">rm</span>：是否删除普通文件 <span class="string">&quot;grub.conf&quot;</span>？y</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm /root/mulu              # 删除目录需要加 -r</span></span><br><span class="line"><span class="built_in">rm</span>: 无法删除<span class="string">&quot;/root/mulu&quot;</span>: 是一个目录</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm -r /tmp/test            # 目录下有多个目录时，会有多个提示</span></span><br><span class="line"><span class="built_in">rm</span>：是否进入目录<span class="string">&quot;/tmp/test&quot;</span>? y</span><br><span class="line"><span class="built_in">rm</span>：是否删除目录 <span class="string">&quot;/tmp/test/can&quot;</span>？y</span><br><span class="line"><span class="built_in">rm</span>：是否删除目录 <span class="string">&quot;/tmp/test/long&quot;</span>？y</span><br><span class="line"><span class="built_in">rm</span>：是否删除目录 <span class="string">&quot;/tmp/test&quot;</span>？</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm -f grub.conf            # 强制删除文件，无提示</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm -rf /root/you           # 强制删除目录，无提示</span></span><br></pre></td></tr></table></figure><h4 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">cp</td><td align="center">copy</td><td align="center">/bin/cp</td><td align="center">所有用户</td><td align="center">cp -rp [原文件或目录] [目标目录]</td><td>复制文件或目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-r</td><td>复制目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-p</td><td>保留文件或属性</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># cp -r /tmp/test/long /root                             # 复制long目录到/root目录下</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># cp /root/install.log /root/install.log.syslog /tmp     # 同时复制2个文件到/tmp目录下</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># ls -l /root/install.log                                # 原目录时间是 12月  2 05:31</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">46478</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> /root/install.log</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># ls -l /tmp/install.log                                 # 新目录的时间是 12月  3 10:17 可以发现时间是当前时间，时间有变化</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">46478</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">17</span> /tmp/install.log</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># cp -p /root/install.log /tmp                           # -p 保留原文件属性</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># ls -l /root/install.log                                # 原目录时间是 12月  2 05:31</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">46478</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> /root/install.log</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># ls -l /tmp/install.log                                 # 新目录时间是 12月  2 05:31  与原目录一致</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">46478</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> /tmp/install.log</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># cp -r /tmp/test/long /root/mi                          # 复制的同时改名字</span></span><br></pre></td></tr></table></figure><h4 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">mv</td><td align="center">move</td><td align="center">/bin/mv</td><td align="center">所有用户</td><td align="center">mv [原文件与目录] [目标目录]</td><td>剪切文件、改名</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># mv /tmp/test/long /root           # 移动（剪切）目录 long 到 /root目录下</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># mv /tmp/test/long /root/shen      # 移动目录的同时改名</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># mv long xiao                      # 在同一个目录下移动就是改名，把long改为xiao</span></span><br></pre></td></tr></table></figure><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">ls</td><td align="center">list</td><td align="center">/bin/ls</td><td align="center">所有用户</td><td align="center">ls 选项[-ald] [文件或目录]</td><td>显示目录文件</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-a</td><td>显示所有文件，包括隐藏文件</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-l</td><td>详细信息显示</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-d</td><td>查看目录属性</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-h</td><td>显示文件大小</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-i</td><td>显示节点信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls /         # 列出根目录文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls           # 不带任何参数运行 ls 命令将列出当前工作目录的内容</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -a        # 显示所有文件，包括隐藏文件，隐藏文件是以点 . 开头的文件 </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l        # 打印输出的每一个文件的详细信息，例如文件权限、链接数、所有者名称和组所有者、文件大小、最后修改的时间和文件/目录名称</span></span><br><span class="line"><span class="literal">-rw</span>-------. <span class="number">1</span> root root  <span class="number">1455</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> anaconda<span class="literal">-ks</span>.cfg</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">46478</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> install.log</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">10033</span> <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">29</span> install.log.syslog</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -lh       # -h 显示文件大小信息</span></span><br><span class="line"><span class="literal">-rw</span>-------. <span class="number">1</span> root root <span class="number">1.5</span>K <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> anaconda<span class="literal">-ks</span>.cfg</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root  <span class="number">46</span>K <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">31</span> install.log</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">9.8</span>K <span class="number">12</span>月  <span class="number">2</span> <span class="number">05</span>:<span class="number">29</span> install.log.syslog</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l /etc/grub.conf    # 列出grub.conf文件的详细信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -ld /etc             # -d 查看目录信息</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">118</span> root root <span class="number">12288</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">07</span>:<span class="number">35</span> /etc</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -i                  # 显示节点信息</span></span><br><span class="line"><span class="number">276492</span> anaconda<span class="literal">-ks</span>.cfg  <span class="number">262148</span> install.log.syslog   <span class="number">276508</span> 桌面</span><br></pre></td></tr></table></figure><h4 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">mkdir</td><td align="center">make directories</td><td align="center">/bin/mkdir</td><td align="center">所有用户</td><td align="center">mkdir -p [目录名]</td><td>创建新目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-p</td><td>递归创建</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># mkdir /tmp/xiao             # 创建目录xiao</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># mkdir /tmp/test/you         # 创建目录you，创建多级目录需要加 -p</span></span><br><span class="line">mkdir: 无法创建目录<span class="string">&quot;/tmp/test/you&quot;</span>: 没有那个文件或目录</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># mkdir -p /tmp/mi/you        # -p 递归创建目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># mkdir -p /tmp/hi/jing /tmp/hi/long  # 同时创建多个目录</span></span><br></pre></td></tr></table></figure><h4 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">cd</td><td align="center">change directory</td><td align="center">shell内置命令</td><td align="center">所有用户</td><td align="center">cd [目录名]</td><td>切换目录</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /tmp/test/mi    # 切换到指定目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">cangjing</span>]<span class="comment"># cd /tmp/    # 切换到tmp目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># cd ..            # 回到上一级目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># cd .             # 一个点还是当前目录</span></span><br></pre></td></tr></table></figure><h4 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">pwd</td><td align="center">print working directory</td><td align="center">/bin/pwd</td><td align="center">所有用户</td><td align="center">pwd</td><td>显示当前目录</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># pwd</span></span><br><span class="line">/root</span><br></pre></td></tr></table></figure><h4 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">rmdir</td><td align="center">remove empty directories</td><td align="center">/bin/rmdir</td><td align="center">所有用户</td><td align="center">rmdir [目录名]</td><td>删除空目录</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># rmdir /tmp/test/mi    # 删除空目录mi</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> /]<span class="comment"># rmdir /tmp            # 不能删除非空目录</span></span><br><span class="line"><span class="built_in">rmdir</span>: 删除 <span class="string">&quot;/tmp&quot;</span> 失败: 目录非空</span><br></pre></td></tr></table></figure><h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">touch</td><td align="center">/bin/touch</td><td align="center">所有用户</td><td align="center">touch [文件名]</td><td>创建空文件</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch lovestory.list   # 没有加路径时表示在当前目录下操作</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch /tmp/iloveyou    # 创建空文件iloveyou</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch program files    # 当文件名带空格时，实际是创建了2个文件program和files</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch &quot;program files&quot;  # 当文件名带空格时，用双引号引用起来【不建议文件名带空格】</span></span><br></pre></td></tr></table></figure><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">cat</td><td align="center">/bin/cat</td><td align="center">所有用户</td><td align="center">cat [文件名]</td><td>显示文件内容</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-n</td><td>显示行号</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># clear              # 清屏 【ctrl+l】 也可以清屏</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># cat /etc/issue   # 查看文件内容</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># cat -n /etc/issue  # -n显示行号    </span></span><br></pre></td></tr></table></figure><h4 id="tac"><a href="#tac" class="headerlink" title="tac"></a>tac</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">tac</td><td align="center">/usr/bin/tac</td><td align="center">所有用户</td><td align="center">tac [文件名]</td><td>显示文件内容(反向显示)</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tac /etc/issue  # cat反过来写tac反向查看</span></span><br></pre></td></tr></table></figure><h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">more</td><td align="center">/bin/more</td><td align="center">所有用户</td><td align="center">more [文件名]</td><td>分页显示文件内容</td></tr></tbody></table><p>【(空格)或f翻页、Enter换行、q或Q退出】</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># more /etc/services  # 【回车键一行一行翻】【f一页一页翻】</span></span><br></pre></td></tr></table></figure><h4 id="less"><a href="#less" class="headerlink" title="less"></a>less</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">less</td><td align="center">/usr/bin/less</td><td align="center">所有用户</td><td align="center">less [文件名]</td><td>分页显示文件内容</td></tr></tbody></table><p>(空格)或f翻页、Enter换行、q或Q退出、page up上翻、page down下翻、/ 搜索</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># less /etc/services   # 使用 /关键字 进行搜索，此时按 n 可以往下找</span></span><br></pre></td></tr></table></figure><h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">head</td><td align="center">/usr/bin/head</td><td align="center">所有用户</td><td align="center">head [文件名]</td><td>显示文件前面几行</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-n</td><td>指定行数</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># head -n 7 /etc/services   # 显示前7行</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># head /etc/services        # 不指定 -n 时 默认前10行</span></span><br></pre></td></tr></table></figure><h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">tail</td><td align="center">/usr/bin/head</td><td align="center">所有用户</td><td align="center">tail [文件名]</td><td>显示文件后面几行</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-n</td><td>指定行数</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-f</td><td>动态显示文件末尾内容</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tail -f /var/log/messages  # 默认动态显示末尾10行，并没有回到命令行，常用来查看日志文件</span></span><br></pre></td></tr></table></figure><h3 id="链接命令"><a href="#链接命令" class="headerlink" title="链接命令"></a>链接命令</h3><h4 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">ln</td><td align="center">link</td><td align="center">/bin/ln</td><td align="center">所有用户</td><td align="center">ln -s [原文件] [目标文件]</td><td>生成链接文件</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-s</td><td>创建软链接</td></tr></tbody></table><blockquote><p>软连接特征：类似windows快捷方式</p><ol><li><code>lrwxrwxrwx</code> , <code>l</code>开头软链接， 3个rwx ，软链接权限不决定原文件权限，实际由原文件权限决定</li><li>文件很小，只是符号链接</li><li>箭头指向原文件</li></ol><p>硬链接特征：</p><ol><li>拷贝 cp -p +同步更新</li><li>通过 i 节点识别</li><li>不能跨分区</li><li>不能针对目录使用</li></ol></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ln -s /etc/issue /tmp/issue.soft     # 创建软链接 issue.soft </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ln /etc/issue /tmp/issue.hard        # 创建硬链接 issue.hard</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l /etc/issue</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">2</span> root root <span class="number">47</span> <span class="number">5</span>月  <span class="number">19</span> <span class="number">2016</span> /etc/issue</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l /tmp/issue.soft                # 软链接 箭头指向原文件</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">10</span> <span class="number">12</span>月  <span class="number">4</span> <span class="number">07</span>:<span class="number">18</span> /tmp/issue.soft -&gt; /etc/issue      </span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l /tmp/issue.hard                # 硬链接与原文件一样，原文件与硬链接文件同步更新</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">2</span> root root <span class="number">47</span> <span class="number">5</span>月  <span class="number">19</span> <span class="number">2016</span> /tmp/issue.hard     </span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /etc/issue                       # 查看原文件（一共3行）</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># echo &quot;www.abc.com&quot; &gt;&gt; /etc/issue    # 对原文件写入一行</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /etc/issue                      # 原文件变为4行</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">www.abc.com</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /tmp/issue.hard                # 硬链接文件也变为4行（硬链接文件与原文件同步更新）</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">www.abc.com</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /tmp/issue.soft                # 软链接此时也更新，因为软链接最后是找的原文件，打开原文件内容</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">www.abc.com</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cp /etc/issue /tmp/issue.bank      # 先备份一下  </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># rm /etc/issue                      # 删除原文件</span></span><br><span class="line"><span class="built_in">rm</span>：是否删除普通文件 <span class="string">&quot;/etc/issue&quot;</span>？y</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /tmp/issue.soft                # 原文件被删除，软链接自然也没有了</span></span><br><span class="line"><span class="built_in">cat</span>: /tmp/issue.soft: 没有那个文件或目录</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cat /tmp/issue.hard                # 原文件被删除，硬链接还在</span></span><br><span class="line">CentOS release <span class="number">6.8</span> (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">www.abc.com</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ls -l /tmp/issue.soft               # 原文件被删除，查看软链接时，原文件变成红色/etc/issue会一直闪</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">10</span> <span class="number">12</span>月  <span class="number">4</span> <span class="number">07</span>:<span class="number">18</span> /tmp/issue.soft -&gt; /etc/issue</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /tmp</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ln issue.bank issue.bank.hard     # 创建硬链接</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ln -s issue.bank issue.bank.soft  # 创建软链接</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -i issue.bank issue.bank.hard issue.bank.soft   # 此时发现原文件的i节点和硬链接的i节点一样，原文件的i节点和软链接的i节点不一样，说明硬链接通过i链接识别</span></span><br><span class="line"><span class="number">787926</span> issue.bank  <span class="number">787926</span> issue.bank.hard  <span class="number">787927</span> issue.bank.soft</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ln /tmp/issue.bank /boot/issue.bank.hard      # 这里说明硬链接不能跨分区</span></span><br><span class="line">ln: 创建硬链接<span class="string">&quot;/boot/issue.bank.hard&quot;</span> =&gt; <span class="string">&quot;/tmp/issue.bank&quot;</span>: 无效的跨设备连接</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ln -s /tmp/issue.bank /boot/issue.bank.soft   # 这里说明软链接可以跨分区</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ln /tmp /root/tmp.hard                          # 这里说明硬链接不能针对目录操作</span></span><br><span class="line">ln: <span class="string">&quot;/tmp&quot;</span>: 不允许将硬链接指向目录</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ln -s /tmp /root/tmp.soft                       # 这里说明软链接可以针对目录操作</span></span><br></pre></td></tr></table></figure><h3 id="权限管理命令"><a href="#权限管理命令" class="headerlink" title="权限管理命令"></a>权限管理命令</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">chmod</td><td align="center">change the permission mode of a file</td><td align="center">/bin/chmod</td><td align="center">所有用户</td><td align="center">chmod [{ugoa}{+-=}{rwx}] [文件或目录]</td><td>改变文件或目录权限</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-R</td><td>递归修改</td></tr></tbody></table><p>数字类型改变文件权限</p><blockquote><p>r:4  w:2  x:1 数字累加</p><p>chmod 777 test.txt    ==&gt;[-rwxrwxrwx]  owner = rwx = 4+2+1 = 7 , group = rwx = 4+2+1 = 7, other = 4+2+1 = 7<br>chmod 770 test.txt    ==&gt;[-rwxrwx—]  owner = rwx = 4+2+1 = 7 , group = rwx = 4+2+1 = 7, other = 0+0+0 = 0<br>chmod 664 test.txt    ==&gt;[-rw-rw-r–]  owner = rwx = 4+2+0 = 6 , group = rwx = 4+2+0 = 6, other = 4+0+0 = 4<br>chmod 644 test.txt    ==&gt;[-rw-r–r–]  owner = rwx = 4+2+0 = 6 , group = rwx = 4+0+0 = 4, other = 0+0+0 = 0<br>chmod 754 test.txt    ==&gt;[-rwxr-xr–]  owner = rwx = 4+2+1 = 7 , group = rwx = 4+0+1 = 5, other = 4+0+0 = 4</p></blockquote><p>符号类型改变文件权限</p><blockquote><p>u = user 拥有者<br>g = group 用户组<br>o = other 其他人<br>a = all 全部</p><p><code>+</code> 加入</p><p><code>-</code>移除</p><p><code>=</code>设置</p><p>chmod u=rwx,go=rx       test.txt   ==&gt;[-rwxr-xr-x]<br>chmod u=rwx,g=rx,o=r  text.txt   ==&gt;[-rwxr-xr–]<br>chmod a+w                     text.txt   ==&gt;则[-rwxr-xr-x] 变为 [-rwxrwxrwx]<br>chmod a-x                       text.txt   ==&gt;则[-rwxr-xr-x] 变为 [-rw-rw-rw-]</p></blockquote><p>文件目录权限总结：</p><table><thead><tr><th align="center">代表字符</th><th>权限</th><th>对文件的含义</th><th>对目录的含义</th></tr></thead><tbody><tr><td align="center">r</td><td>读权限</td><td>可以查看文件内容</td><td>可以列出目录中的内容</td></tr><tr><td align="center">w</td><td>写权限</td><td>可以修改文件内容</td><td>可以在目录中创建、删除文件</td></tr><tr><td align="center">x</td><td>执行权限</td><td>可以执行文件</td><td>可以进入目录</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l lovestory.list</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">0</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">57</span> Japanlovestory.list</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chmod u+x lovestory.list      # 给所有者添加执行权限</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l lovestory.list</span></span><br><span class="line"><span class="literal">-rwxr</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">0</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">57</span> lovestory.list</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chmod g+w,o-r lovestory.list  # 同时 给用户组添加写权限并删除其他人读的权限</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l lovestory.list</span></span><br><span class="line"><span class="literal">-rwxrw</span>----. <span class="number">1</span> root root <span class="number">0</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">57</span> lovestory.list</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chmod g=rwx lovestory.list    # 给用户组添加读、写、执行的权限，不用考虑以前的权限是什么</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l lovestory.list </span></span><br><span class="line"><span class="literal">-rwxrwx</span>---. <span class="number">1</span> root root <span class="number">0</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">57</span> lovestory.list</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chmod 640 lovestory.list       # 6=r+w,4=r,0</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l lovestory.list</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-----. <span class="number">1</span> root root <span class="number">0</span> <span class="number">12</span>月  <span class="number">3</span> <span class="number">10</span>:<span class="number">57</span> lovestory.list</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir -p /tmp/a/b              # 同时创建a和b两个目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chmod -R 777 /tmp/a            # -R 递归修改，把a目录下的所有目录都改为 rwxrwxrwx 权限</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld /tmp/a</span></span><br><span class="line">drwxrwxrwx. <span class="number">3</span> root root <span class="number">4096</span> <span class="number">12</span>月  <span class="number">4</span> <span class="number">11</span>:<span class="number">36</span> /tmp/a    <span class="comment"># a目录是 rwxrwxrwx 权限po</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld /tmp/a/b</span></span><br><span class="line">drwxrwxrwx. <span class="number">2</span> root root <span class="number">4096</span> <span class="number">12</span>月  <span class="number">4</span> <span class="number">11</span>:<span class="number">36</span> /tmp/a/b  <span class="comment"># b目录也是 rwxrwxrwx 权限</span></span><br></pre></td></tr></table></figure><h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">chown</td><td align="center">change file ownership</td><td align="center">/bin/chown</td><td align="center">所有用户</td><td align="center">chown [用户] [文件或目录]</td><td>改变文件或目录的所有者</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch wenjian             # 创建文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># useradd chao              # 添加用户chao</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chown shenchao wenjian    # 改变文件所有者为chao这个用户</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l wenjian</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> chao root <span class="number">0</span> Dec  <span class="number">7</span> <span class="number">08</span>:<span class="number">35</span> wenjian</span><br></pre></td></tr></table></figure><h4 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">chgrp</td><td align="center">change file group ownership</td><td align="center">/bin/chgrp</td><td align="center">所有用户</td><td align="center">chgrp [用户组] [文件或目录]</td><td>改变文件或目录的所属组</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># groupadd lampbrother       # 创建用户组</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># chgrp lampbrother wenjian  # 改变文件所属组</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l wenjian</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> chao lampbrother <span class="number">0</span> Dec  <span class="number">7</span> <span class="number">08</span>:<span class="number">35</span> wenjian</span><br></pre></td></tr></table></figure><h4 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">umask</td><td align="center">the user fiel-creation mask</td><td align="center">Shell内置命令</td><td align="center">所有用户</td><td align="center">umask [-S]</td><td>显示、设置文件的缺省权限</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-S</td><td>以rwx形式显示新建文件缺省权限</td></tr></tbody></table><blockquote><p>0022 默认访问权限<br>0特殊权限<br>022 — -w- -w-</p><p>777 rwx rwx rwx<br>022 — -w- -w- 逻辑与（减法）</p><p>755 rwx r-x r-x  目录<br>    rw- r– r–  文件 （文件默认没有x权限）   </p><hr><p>umask 077</p><p>777 rwx rwx rwx<br>077 — rwx rwx 逻辑与（减法）</p><p>700 rwx — —  目录<br>    rw- — —  文件</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># umask -S                          # 默认权限为 755</span></span><br><span class="line">u=rwx,g=rx,o=rx</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir lamp                        # 创建目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld lamp</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">2</span> root root <span class="number">4096</span> Dec  <span class="number">7</span> <span class="number">08</span>:<span class="number">46</span> lamp    <span class="comment"># rwxr-xr-x</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch fanbingbing                 # 创建文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld fanbingbing</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">0</span> Dec  <span class="number">7</span> <span class="number">08</span>:<span class="number">47</span> fanbingbing    <span class="comment">#  rw-r--r-- 相比 rwxr-xr-x 缺少 x 权限，因为默认创建的文件不具有可执行权限</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># umask                             # 默认权限为 022</span></span><br><span class="line"><span class="number">0022</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># umask 077                         # 设置默认权限为077 </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch ab                          # 创建文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld ab                         # 777-077 逻辑与得到 700 rwx------ 由于文件不具有x权限 最终得到 rw-------</span></span><br><span class="line"><span class="literal">-rw</span>-------. <span class="number">1</span> root root <span class="number">0</span> Dec  <span class="number">7</span> <span class="number">09</span>:<span class="number">19</span> ab</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir bv                          # 创建目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -ld bv                         # 777-077 逻辑与得到 700 rwx------</span></span><br><span class="line">drwx------. <span class="number">2</span> root root <span class="number">4096</span> Dec  <span class="number">7</span> <span class="number">09</span>:<span class="number">19</span> bv</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># umask -S</span></span><br><span class="line">u=rwx,g=,o=</span><br></pre></td></tr></table></figure><h3 id="文件搜索命令"><a href="#文件搜索命令" class="headerlink" title="文件搜索命令"></a>文件搜索命令</h3><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">find</td><td align="center">/bin/find</td><td align="center">所有用户</td><td align="center">find [搜索范围] [匹配条件]</td><td>文件搜索</td></tr></tbody></table><blockquote><p>find /etc -name init<br>find / size +204800  在根目录下查找大于100MB的文件  +n大于 -n小于  n等于<br>find /home -user shenchao 在根目录下查询所有者为shencaho的文件 -group 根据所属组查找<br>find /etc -cname -5 在/etc 下查找5分钟内被修改过属性的文件和目录  【-amin 访问时间access】、【-cname 文件属性change】、【-mmin 文件内容modify】<br>find /etc -size +163840 -a -size -204800 在etc下查找大于80MB小于100MB的文件<br>                                         -a 两个条件同时满足  -o 两个条件满足任意一个即可<br>find /etc -name inittab -exec ls -l {} ; 在/etc下查找inittab文件并显示其详细信息<br>                                       -exec/-ok命令 {};对搜索结果执行操作<br>-type 根据文件类型查找  f文件,d目录,l软链接文件<br>-inum 根据i节点查找</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -name init         # 在目录/etc中查找文件init , -name参数搜索文件名【精准搜索】</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -iname init        # 在目录/etc中查找文件init , -iname不区分大小写【精准搜索】</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -name *init*       # 在目录/etc中查找文件init,通配符 * 匹配任意字符【模糊搜索】</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -name init*        # 以init开头的文件【模糊搜索】</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -name init???      # 单个字符匹配 ？  匹配三个则三个问号 ？？？   </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find /etc -iname init???     # 单个字符匹配 ？, -iname 搜索时不区分大小写</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># find / -size +204800         # 搜索大于100M的文件 其中 1数据块 = 512字节 = 0.5k 则  100MB=102400KM=204800  （乘以2）</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /home -user chao          # 根据所有者查找，查看chao用户的文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /home -group lampbrother  # 根据所属组查找，查看lampbrother用户组的文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -mmin -30            # 查看30分钟内文件内容被改变过的文件 </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -name init* -a -type f   #查询以init开头的文件  -type 根据文件类型查找  f文件,d目录,l软链接文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -name init* -a -type d   #查询以init开头的目录  -type 根据文件类型查找  f文件,d目录,l软链接文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -name inittab -exec ls -l &#123;&#125; \;</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -name init* -a -type f -exec ls -l &#123;&#125; \;   # 在etc目录下查找以init开头的文件并显示详细信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /etc -name init* -a -type f -ok ls -l &#123;&#125; \;     # -ok有一个询问的过程</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find /home -user shenchao -ok rm &#123;&#125; \;</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># find . -inum 276998 -exec rm &#123;&#125; \;                   # 根据 i 节点查找并删除文件    .表示当前目录</span></span><br></pre></td></tr></table></figure><h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">locate</td><td align="center">/usr/bin/locate</td><td align="center">所有用户</td><td align="center">locate 文件名</td><td>在文件资料库中查找文件</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># locate inittab              # 在文件资料库中查找文件inittab</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># locate locate</span></span><br><span class="line">/var/lib/mlocate/mlocate.db               <span class="comment"># 资料库存放在这里</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># touch /root/yangmi          # 在/root目录下创建空文件yangmi</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># updatedb                    # 更新文件资料库</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># locate yangmi               # 在文件资料库中查找文件yangmi</span></span><br><span class="line">/root/yangmi</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># touch /tmp/zhangbozhi       # 在/tmp目录下创建空文件zhangbozhi</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># updatedb                    # 更新文件资料库</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># locate zhangbozhi           # 存放在/tmp目录下的文件，locate无法找到</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># locate -i yangmi            # -i参数不区分大小写</span></span><br></pre></td></tr></table></figure><h4 id="which"><a href="#which" class="headerlink" title="which"></a>which</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">which</td><td align="center">/usr/bin/which</td><td align="center">所有用户</td><td align="center">which 命令</td><td>搜索命令所在目录及别名信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># which cp   </span></span><br><span class="line">alias <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span>       <span class="comment">#此处可以看到 cp是 cp -i 的别名</span></span><br><span class="line">    /bin/<span class="built_in">cp</span>            <span class="comment">#别名所在的路径</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># which useradd</span></span><br><span class="line">/usr/sbin/useradd</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># which rm</span></span><br><span class="line">alias <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line">    /bin/<span class="built_in">rm</span></span><br></pre></td></tr></table></figure><h4 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">whereis</td><td align="center">/usr/bin/whereis</td><td align="center">所有用户</td><td align="center">whereis [命令名称]</td><td>搜索命令所在目录及帮助文档路径</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># whereis useradd</span></span><br><span class="line">useradd: /usr/sbin/useradd /usr/share/<span class="built_in">man</span>/man8/useradd.<span class="number">8</span>.gz  <span class="comment">#命令所在路径：/usr/sbin/useradd  帮助文件所在路径：/usr/share/man/man8/useradd.8.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># whereis rm</span></span><br><span class="line"><span class="built_in">rm</span>: /bin/<span class="built_in">rm</span> /usr/share/<span class="built_in">man</span>/man1p/<span class="built_in">rm</span>.<span class="number">1</span>p.gz /usr/share/<span class="built_in">man</span>/man1/<span class="built_in">rm</span>.<span class="number">1</span>.gz</span><br></pre></td></tr></table></figure><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">grep</td><td align="center">/bin/grep</td><td align="center">所有用户</td><td align="center">grep -iv [指定字串] [文件]</td><td>在文件中搜索字串匹配的行并输出</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-i</td><td>不区分大小写</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-v</td><td>排除指定字串</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># grep multiuser /etc/inittab       # 在/etc/inittab目录下搜索关键字multiuser并输出所在的行</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># grep -i  multiuser /etc/inittab   # -i 不区分大小写</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># grep -v ^# /etc/inittab           # 过滤掉以#开头的行   linux中#号表示注释</span></span><br></pre></td></tr></table></figure><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><h4 id="man"><a href="#man" class="headerlink" title="man"></a>man</h4><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/鸟哥的linux私房菜/第四章/线上求助.pdf"   title="线上求助"><i class="far fa-hand-point-right fa-fw"></i><span>线上求助</span></a><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">man</td><td align="center">manual</td><td align="center">/usr/bin/man</td><td align="center">所有用户</td><td align="center">man [命令或配置文件]</td><td>获得帮助信息</td></tr></tbody></table><blockquote><p>whatis 命令 查看命令简短信息<br>apropos 配置文件  查看配置文件的信息<br>命令 –help<br>info</p></blockquote><p>在man page中的一些常用的按键：</p><table><thead><tr><th>按键</th><th>进行工作</th></tr></thead><tbody><tr><td>空格键页</td><td>向下翻一页</td></tr><tr><td>page down</td><td>向下翻一页</td></tr><tr><td>page up</td><td>向上翻一页</td></tr><tr><td>home</td><td>去到第一页</td></tr><tr><td>end</td><td>去到最后一页</td></tr><tr><td>/string</td><td>向下查找string这个字符串，如果要查找vbird的话，就输入 /vbird</td></tr><tr><td>?string</td><td>向上查找string这个字符串</td></tr><tr><td>n,N</td><td>利用n,N来查找字符串时，可以用 n 来继续下一个查找（不论是  / 或 ?），可以用 N 来进行反向查找</td></tr><tr><td>q</td><td>结束这次man page</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># man date              # 查看date命令的帮助信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># man services          # 查看配置文件service的帮助信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># whereis passwd        # man5 其中5表示配置文件的帮助  man1 其中1表示命令的帮助</span></span><br><span class="line">passwd: /usr/bin/passwd /etc/passwd /usr/share/<span class="built_in">man</span>/man5/passwd.<span class="number">5</span>.gz /usr/share/<span class="built_in">man</span>/man1/passwd.<span class="number">1</span>.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># man 5 passwd          # 这里用5指定显示配置文件的帮助</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># whatis ls             # whatis 命令 查看命令简短信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># apropos services      # apropos 配置文件  查看配置文件的简短信息</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># touch --help </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># info</span></span><br></pre></td></tr></table></figure><h4 id="help"><a href="#help" class="headerlink" title="help"></a>help</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">help</td><td align="center">Shell内置命令</td><td align="center">所有用户</td><td align="center">help 密令</td><td>获得Shell内置命令的帮助（Shell内置命令是用whereis找不到的命令）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># help umask</span></span><br></pre></td></tr></table></figure><h3 id="用户管理命令"><a href="#用户管理命令" class="headerlink" title="用户管理命令"></a>用户管理命令</h3><h4 id="useradd"><a href="#useradd" class="headerlink" title="useradd"></a>useradd</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">useradd</td><td align="center">/usr/sbin/useradd</td><td align="center">所有用户</td><td align="center">useradd 用户名</td><td>添加新用户</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># useradd yangmi  # 添加新用户yangmi</span></span><br></pre></td></tr></table></figure><h4 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">passwd</td><td align="center">/usr/bin/passwd</td><td align="center">所有用户</td><td align="center">passwd 用户名</td><td>设置用户密码</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># passwd yangmi  # 给用户yangmi设置密码</span></span><br><span class="line">[<span class="type">yangmi</span>@<span class="number">192</span> ~]<span class="variable">$</span> passwd       <span class="comment"># 使用yangmi用户登录,使用passwd修改密码</span></span><br></pre></td></tr></table></figure><h4 id="who"><a href="#who" class="headerlink" title="who"></a>who</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">who</td><td align="center">/usr/bin/sho</td><td align="center">所有用户</td><td align="center">who</td><td>查看登录用户信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># who     # 登录用户名，登录终端 tty本地终端  pts远程终端 ,登录时间，登录Ip地址 </span></span><br><span class="line">root     tty1         <span class="number">2020</span><span class="literal">-12</span><span class="literal">-08</span> <span class="number">07</span>:<span class="number">40</span> (:<span class="number">0</span>)</span><br><span class="line">root     pts/<span class="number">0</span>        <span class="number">2020</span><span class="literal">-12</span><span class="literal">-08</span> <span class="number">07</span>:<span class="number">40</span> (<span class="number">192.168</span>.XX.<span class="number">1</span>)</span><br><span class="line">yangmi   pts/<span class="number">1</span>        <span class="number">2020</span><span class="literal">-12</span><span class="literal">-08</span> <span class="number">08</span>:<span class="number">56</span> (<span class="number">192.168</span>.XX.<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="w"><a href="#w" class="headerlink" title="w"></a>w</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">w</td><td align="center">/usr/bin/w</td><td align="center">所有用户</td><td align="center">w</td><td>查看登录用户详细信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># w    # 09:06:40登录时间, up  1:26 连续运行时间,3 users当前一共3个用户登录,load average: 0.00, 0.04, 0.05 负载均衡的情况</span></span><br><span class="line"> <span class="number">09</span>:<span class="number">06</span>:<span class="number">40</span> up  <span class="number">1</span>:<span class="number">26</span>,  <span class="number">3</span> users,  load average: <span class="number">0.00</span>, <span class="number">0.04</span>, <span class="number">0.05</span></span><br><span class="line">USER     TTY      FROM              LOGIN<span class="selector-tag">@</span>   IDLE   JCPU   PCPU WHAT     <span class="comment"># IDLE表示用户登录空闲多久  PCPU表示当前用户执行操作占用cpu的时间  WHAT当前执行什么操作</span></span><br><span class="line">root     tty1     :<span class="number">0</span>               <span class="number">07</span>:<span class="number">40</span>    <span class="number">1</span>:<span class="number">26</span>m  <span class="number">1.85</span>s  <span class="number">1.85</span>s /usr/bin/Xorg :<span class="number">0</span> <span class="literal">-br</span> <span class="literal">-verbose</span> <span class="literal">-audit</span> <span class="number">4</span> <span class="literal">-auth</span> /var/run/gdm/auth<span class="literal">-for</span><span class="literal">-gdm</span><span class="literal">-MTkNaE</span>/database <span class="literal">-no</span></span><br><span class="line">root     pts/<span class="number">0</span>    <span class="number">192.168</span>.XX.<span class="number">1</span>     <span class="number">07</span>:<span class="number">40</span>    <span class="number">0.00</span>s  <span class="number">0.26</span>s  <span class="number">0.10</span>s w</span><br><span class="line">yangmi   pts/<span class="number">1</span>    <span class="number">192.168</span>.XX.<span class="number">1</span>     <span class="number">08</span>:<span class="number">56</span>    <span class="number">4</span>:<span class="number">57</span>   <span class="number">0.02</span>s  <span class="number">0.02</span>s <span class="literal">-bash</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># uptime</span></span><br><span class="line"> <span class="number">09</span>:<span class="number">08</span>:<span class="number">44</span> up  <span class="number">1</span>:<span class="number">28</span>,  <span class="number">3</span> users,  load average: <span class="number">0.02</span>, <span class="number">0.05</span>, <span class="number">0.05</span></span><br></pre></td></tr></table></figure><h3 id="压缩解压命令"><a href="#压缩解压命令" class="headerlink" title="压缩解压命令"></a>压缩解压命令</h3><h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">gzip</td><td align="center">GUN zip</td><td align="center">/bin/gzip</td><td align="center">所有用户</td><td align="center">gzip 文件</td><td>压缩文件，压缩后文件格式:<code>.gz</code></td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /tmp</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># touch boduo</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># gzip boduo   # 不保留原文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l</span></span><br><span class="line">总用量 <span class="number">128</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">127220</span> <span class="number">12</span>月  <span class="number">8</span> <span class="number">09</span>:<span class="number">19</span> boduo.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir a</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir a/b a/c a/d   # 创建目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># gzip a    # 报错表示gzip只能压缩文件，不能压缩目录</span></span><br><span class="line">gzip: a is a directory -- ignored</span><br></pre></td></tr></table></figure><h4 id="gunzip"><a href="#gunzip" class="headerlink" title="gunzip"></a>gunzip</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">gunzip</td><td align="center">GUN unzip</td><td align="center">/bin/gzip</td><td align="center">所有用户</td><td align="center">gunzip [压缩文件]</td><td>解压缩.gz的压缩文件</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># gunzip boduo.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l</span></span><br><span class="line">总用量 <span class="number">628</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">641020</span> <span class="number">12</span>月  <span class="number">8</span> <span class="number">09</span>:<span class="number">19</span> boduo</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># gzip -d boduo.gz   # 或者使用gzip -d命令</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls -l</span></span><br><span class="line">总用量 <span class="number">628</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--. <span class="number">1</span> root root <span class="number">641020</span> <span class="number">12</span>月  <span class="number">8</span> <span class="number">09</span>:<span class="number">19</span> boduo</span><br></pre></td></tr></table></figure><h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">tar</td><td align="center"></td><td align="center">/bin/tar</td><td align="center">所有用户</td><td align="center">tar 选项[-zcf] [压缩后的文件名] [目录]</td><td>打包目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-c</td><td>打包</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-v</td><td>显示详细信息</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-f</td><td>指定文件名</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-z</td><td>打包同时压缩</td></tr></tbody></table><blockquote><p>tar命令解压缩语法：<br>   -x 解包<br>   -v 显示详细信息<br>   -f 指定压缩文件<br>   -z 解压缩</p><p>压缩后文件格式： .tar .gz</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir japan</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir japan/cang japan/long japan/ze</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -cvf japan.tar japan    #先打包</span></span><br><span class="line">japan/</span><br><span class="line">japan/ze/</span><br><span class="line">japan/long/</span><br><span class="line">japan/cang/</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  boduo  japan  japan.tar</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># gzip japan.tar   #再压缩</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  boduo  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir abc</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># mkdir abc/yangmi abc/zhang</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -zcf abc.tar.gz abc    #打包的同时压缩</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  boduo  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -acf etc.tar.gz /etc</span></span><br><span class="line">tar: 从成员名中删除开头的“/”</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  boduo  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># rm -rf abc</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc.tar.gz  boduo  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -zxvf abc.tar.gz    #解压</span></span><br><span class="line">abc/</span><br><span class="line">abc/yangmi/</span><br><span class="line">abc/zhang/</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls </span></span><br><span class="line">a  abc  abc.tar.gz  boduo  etc.tar.gz  japan  japan.tar.gz</span><br></pre></td></tr></table></figure><h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">zip</td><td align="center"></td><td align="center">/usr/bin/zip</td><td align="center">所有用户</td><td align="center">zip选项[-r] [压缩后文件名] [文件或目录]</td><td>压缩文件或目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-r</td><td>压缩目录</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># cp /etc/cas.conf /tmp/cas</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  boduo  boduo.zip  cas  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># zip cas.zip cas   # 压缩文件，保留原文件</span></span><br><span class="line">  adding: cas (deflated <span class="number">44</span>%)</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  boduo  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># zip -r abc.zip abc   # 压缩目录</span></span><br><span class="line">  adding: abc/ (stored <span class="number">0</span>%)</span><br><span class="line">  adding: abc/yangmi/ (stored <span class="number">0</span>%)</span><br><span class="line">  adding: abc/zhang/ (stored <span class="number">0</span>%)</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  abc.zip  boduo  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br></pre></td></tr></table></figure><h4 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">bzip2</td><td align="center"></td><td align="center">/usr/bin/bzip2</td><td align="center">所有用户</td><td align="center">bzip2 选项[-k] [文件]</td><td>压缩文件。压缩后文件格式<code> .bz2</code></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-k</td><td>产生压缩文件后保留原文件</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># bzip2 -k boduo</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  abc.zip  boduo  boduo.bz2  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -cjf boduo.tar.bz2 boduo</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  abc.zip  boduo  boduo.bz2  boduo.tar.bz2  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br></pre></td></tr></table></figure><h4 id="bunzip2"><a href="#bunzip2" class="headerlink" title="bunzip2"></a>bunzip2</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">bunzip2</td><td align="center"></td><td align="center">/usr/bin/bunzip2</td><td align="center">所有用户</td><td align="center">bunzip2 选项[-k] [压缩文件]</td><td>解压缩</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-k</td><td>产生压缩文件后保留原文件</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># bzip2 -k boduo</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  abc.zip  boduo  boduo.bz2  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -cjf boduo.tar.bz2 boduo</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc  abc.tar.gz  abc.zip  boduo  boduo.bz2  boduo.tar.bz2  boduo.zip  cas  cas.zip  etc.tar.gz  japan  japan.tar.gz</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># tar -xjf boduo.tar.bz2</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">tmp</span>]<span class="comment"># ls</span></span><br><span class="line">a  abc.tar.gz  abc.zip  boduo  boduo.tar.bz2  boduo.zip  cas  cas.zip  etc.tar.gz  japan.tar.gz</span><br></pre></td></tr></table></figure><h3 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h3><h4 id="write"><a href="#write" class="headerlink" title="write"></a>write</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">write</td><td align="center">/usr/bin/write</td><td align="center">所有用户</td><td align="center">write &lt;用户名&gt;</td><td>给用户发信息，以crtl+d保存结束</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># write yangmi    # 给用户yangmi发信息，如果写错需要删除按 ctrl+← 退格键</span></span><br><span class="line"><span class="built_in">ni</span> hao yang    </span><br><span class="line"><span class="built_in">mi</span> aaaaa</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">yangmi</span>@<span class="number">192</span> ~]<span class="variable">$</span>    <span class="comment">#这里用 yangmi 用户登录可以收到root用户发送过来的信息（用户在线才可以收到）</span></span><br><span class="line">Message from root@<span class="number">192.168</span>.<span class="number">88.128</span> on pts/<span class="number">0</span> at <span class="number">08</span>:<span class="number">29</span> ...</span><br><span class="line"><span class="built_in">ni</span> hao yang </span><br><span class="line"><span class="built_in">mi</span> aaa</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="wall"><a href="#wall" class="headerlink" title="wall"></a>wall</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">wall</td><td align="center">write all</td><td align="center">/usr/bin/wall</td><td align="center">所有用户</td><td align="center">wall [message]</td><td>发广播信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># wall yangmi nihao!     #使用root用户发广播信息，root自己也可以收到</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># </span></span><br><span class="line">Broadcast message from root@<span class="number">192.168</span>.<span class="number">88.128</span> (pts/<span class="number">0</span>) (Wed Dec  <span class="number">9</span> <span class="number">08</span>:<span class="number">37</span>:<span class="number">34</span> <span class="number">2020</span>):</span><br><span class="line"></span><br><span class="line">yangmi nihao!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">yangmi</span>@<span class="number">192</span> ~]<span class="variable">$</span>   <span class="comment">#这里是yangmi用户登录，可以接收到广播</span></span><br><span class="line"></span><br><span class="line">Broadcast message from root@<span class="number">192.168</span>.<span class="number">88.128</span> (pts/<span class="number">0</span>) (Wed Dec  <span class="number">9</span> <span class="number">08</span>:<span class="number">37</span>:<span class="number">34</span> <span class="number">2020</span>):</span><br><span class="line"></span><br><span class="line">yangmi nihao!</span><br></pre></td></tr></table></figure><h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">ping</td><td align="center">/bin/ping</td><td align="center">所有用户</td><td align="center">ping 选项[-c指定发送次数] IP地址</td><td>测试网络连通性</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ping 112.80.248.75        # 需要按ctrl+c才能停下来</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ping -c 3 112.80.248.75   # ping 3次后返回</span></span><br></pre></td></tr></table></figure><h4 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h4><table><thead><tr><th align="center">指令名称</th><th align="center">命令英文原意</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">ifconfig</td><td align="center">interfate configure</td><td align="center">/sbin/ifconfig</td><td align="center">root</td><td align="center">ifconfig 网卡名称 IP地址</td><td>查看和设置网卡信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ifconfig</span></span><br></pre></td></tr></table></figure><h4 id="last"><a href="#last" class="headerlink" title="last"></a>last</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">last</td><td align="center">/usr/bin/last</td><td align="center">所有用户</td><td align="center">last</td><td>列出目前与过去登录系统的用户信息</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># last</span></span><br></pre></td></tr></table></figure><h4 id="lastlog"><a href="#lastlog" class="headerlink" title="lastlog"></a>lastlog</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">lastlog</td><td align="center">/usr/bin/lastlog</td><td align="center">所有用户</td><td align="center">lastlog</td><td>检查某特定用户上次登录的时间</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># lastlog     #用户最后一次登录过的信息   【lastlog -u 用户id】  指定用户上次登录的时间</span></span><br></pre></td></tr></table></figure><h4 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">traceroute</td><td align="center">/bin/traceroute</td><td align="center">所有用户</td><td align="center">traceroute</td><td>显示数据包到主机间的路径</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">yangmi</span>@<span class="number">192</span> ~]<span class="variable">$</span> traceroute www.baidu.com</span><br></pre></td></tr></table></figure><h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">netstat</td><td align="center">/bin/netstat</td><td align="center">所有用户</td><td align="center">netstat[选项]</td><td>显示网络相关信息</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-t</td><td>TCP协议</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-u</td><td>UDP协议</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-l</td><td>监听</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-r</td><td>路由</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-n</td><td>显示IP地址和端口号</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># netstat -tlun   # 查看本机监听的端口                                 </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># netstat -an     # 查看本机所有的网络连接</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># netstat -rn     # 查看本机路由表</span></span><br></pre></td></tr></table></figure><h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">setup</td><td align="center">/usr/bin/setup</td><td align="center">root</td><td align="center">setup</td><td>配置网络</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># setup</span></span><br><span class="line">您更改了主机名。</span><br><span class="line">应该现在为系统设置主机名吗？</span><br><span class="line">这样可能会造成有些 X 应用程序无法正常工作。</span><br><span class="line"></span><br><span class="line">您可能必须重新登录。</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># service network restart   # 重启服务</span></span><br><span class="line">正在关闭接口 eth0： </span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>选择网络配置<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux01.png"><br>选择设备配置<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux02.png"><br>选择第一个网卡<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux03.png"><br>设置网络信息<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux04.png"></p><h4 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">mount</td><td align="center">/bin/mount</td><td align="center">所有用户</td><td align="center">mount[-t文件系统]设备文件名挂载点</td><td>挂载命令</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mkdir /mnt/cdrom   # 创建挂载点</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ll /dev/cdrom     # 设备文件名默认sr0</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">3</span> <span class="number">12</span>月  <span class="number">9</span> <span class="number">08</span>:<span class="number">18</span> /dev/cdrom -&gt; sr0</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mount /dev/sr0 /mnt/cdrom</span></span><br><span class="line"><span class="built_in">mount</span>: block device /dev/sr0 is <span class="built_in">write-protected</span>, mounting <span class="built_in">read-only</span></span><br><span class="line"><span class="built_in">mount</span>: /dev/sr0 already mounted or /mnt/cdrom busy</span><br><span class="line"><span class="built_in">mount</span>: according to mtab, /dev/sr0 is already mounted on /mnt/cdrom</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># umount /dev/sr0   #上面发现/dev/sr0已经挂载，需要卸载</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mount /dev/sr0 /mnt/cdrom</span></span><br><span class="line"><span class="built_in">mount</span>: block device /dev/sr0 is <span class="built_in">write-protected</span>, mounting <span class="built_in">read-only</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cd /mnt/cdrom/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">cdrom</span>]<span class="comment"># ls</span></span><br><span class="line">CentOS_BuildTag  EULA  images    Packages                  repodata              RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-Debug</span><span class="literal">-6</span>     RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-Testing</span><span class="literal">-6</span></span><br><span class="line">EFI              GPL   isolinux  RELEASE<span class="literal">-NOTES</span><span class="literal">-en</span><span class="literal">-US</span>.html  RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-6</span>  RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-Security</span><span class="literal">-6</span>  TRANS.TBL</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">cdrom</span>]<span class="comment"># umount /dev/sr0   #这里注意，不能再光盘挂载点卸载,需要退出目录</span></span><br><span class="line">umount: /mnt/cdrom: device is busy.</span><br><span class="line">        (<span class="keyword">In</span> some cases useful info about processes that use</span><br><span class="line">         the device is found by lsof(<span class="number">8</span>) or fuser(<span class="number">1</span>))</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">cdrom</span>]<span class="comment"># cd</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># umount /dev/sr0</span></span><br></pre></td></tr></table></figure><h3 id="关机重启命令"><a href="#关机重启命令" class="headerlink" title="关机重启命令"></a>关机重启命令</h3><h4 id="shuttdown"><a href="#shuttdown" class="headerlink" title="shuttdown"></a>shuttdown</h4><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/鸟哥的linux私房菜/第四章/正确的关机方法.pdf"   title="正确的关机方法"><i class="far fa-hand-point-right fa-fw"></i><span>正确的关机方法</span></a><table><thead><tr><th align="center">指令名称</th><th align="center">指令所在路径</th><th align="center">执行权限</th><th align="center">语法</th><th>功能描述</th></tr></thead><tbody><tr><td align="center">shutdown</td><td align="center"></td><td align="center"></td><td align="center">shutdown [选项] 时间</td><td>关机命令</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-c</td><td>取消前一个关机命令</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-h</td><td>关机</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">-r</td><td>重启</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># shutdown -h now     # 立刻关机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># shutdown -h 21:30   # 系统在今天的 21:30 分会关机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># shutdown -h +10     # 系统再过十分钟后自动关机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># shutdown -r now     # 系统立刻重新开机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># shutdown -c         # 取消关机指令 </span></span><br></pre></td></tr></table></figure><h4 id="其他关机命令"><a href="#其他关机命令" class="headerlink" title="其他关机命令"></a>其他关机命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># halt  # 系统关机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># poweroff  </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># init 0</span></span><br></pre></td></tr></table></figure><h4 id="其他重启命令"><a href="#其他重启命令" class="headerlink" title="其他重启命令"></a>其他重启命令</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># reboot  # 重新开机</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># init 6</span></span><br></pre></td></tr></table></figure><h4 id="系统运行级别"><a href="#系统运行级别" class="headerlink" title="系统运行级别"></a>系统运行级别</h4><table><thead><tr><th align="center">指令名称</th><th align="center">指令描述</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">关机</td></tr><tr><td align="center">1</td><td align="center">单用户</td></tr><tr><td align="center">2</td><td align="center">不完全多用户，不含NFS服务</td></tr><tr><td align="center">3</td><td align="center">完全多用户</td></tr><tr><td align="center">4</td><td align="center">未分配</td></tr><tr><td align="center">5</td><td align="center">图形界面</td></tr><tr><td align="center">6</td><td align="center">重启</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /etc/inittab   #   id:5:initdefault:  当前虚拟机默认系统运行级别是5，可以修改比如：</span></span><br><span class="line"><span class="comment">#   0 - halt (Do NOT set initdefault to this)</span></span><br><span class="line"><span class="comment">#   1 - Single user mode</span></span><br><span class="line"><span class="comment">#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)</span></span><br><span class="line"><span class="comment">#   3 - Full multiuser mode</span></span><br><span class="line"><span class="comment">#   4 - unused</span></span><br><span class="line"><span class="comment">#   5 - X11</span></span><br><span class="line"><span class="comment">#   6 - reboot (Do NOT set initdefault to this)</span></span><br><span class="line">id:<span class="number">5</span>:initdefault:</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># runlevel # 查询系统运行级别</span></span><br><span class="line">N <span class="number">5</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># init 3  #切换到3</span></span><br></pre></td></tr></table></figure><h4 id="logout"><a href="#logout" class="headerlink" title="logout"></a>logout</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># logout   # 退出登录</span></span><br><span class="line">Connection closing...Socket close.</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br><span class="line"></span><br><span class="line">Disconnected from remote host(<span class="number">192.168</span>.<span class="number">88.128</span>) at <span class="number">22</span>:<span class="number">24</span>:<span class="number">14</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">Type</span> `help<span class="string">&#x27; to learn how to use Xshell prompt.</span></span><br></pre></td></tr></table></figure><h3 id="文本编辑器vim"><a href="#文本编辑器vim" class="headerlink" title="文本编辑器vim"></a>文本编辑器vim</h3><h4 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h4><p>Vim是一个功能强大的全屏幕文本编辑器，是Linux/UNIX上最常用的文本编辑器，他的作用是建立、编辑、显示文本文件。Vim没有菜单，只有命令。</p><h4 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h4><p><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux05.png"></p><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">a</td><td align="center">在光标所在字符后插入</td><td align="center">A</td><td align="center">在光标所在行尾插入</td></tr><tr><td align="center">i</td><td align="center">在光标所在字符前插入</td><td align="center">I</td><td align="center">在光标所在行行首插入</td></tr><tr><td align="center">o</td><td align="center">在光标下插入新行</td><td align="center">O</td><td align="center">在光标上插入新行</td></tr></tbody></table><h4 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">：set nu</td><td align="center">设置行号</td><td align="center">：set nonu</td><td align="center">取消行号</td></tr><tr><td align="center">gg</td><td align="center">到第一行</td><td align="center">G</td><td align="center">到最后一行</td></tr><tr><td align="center">nG</td><td align="center">到第n行</td><td align="center">：n</td><td align="center">到第n行</td></tr><tr><td align="center">$</td><td align="center">移至行位</td><td align="center">0</td><td align="center">移至行首</td></tr></tbody></table><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">x</td><td align="center">删除光标所在处字符</td><td align="center">nx</td><td align="center">删除光标所在处后n个字符</td></tr><tr><td align="center">dd</td><td align="center">删除光标所在行，ndd删除n行</td><td align="center">dG</td><td align="center">删除光标所在行到文件末尾内容</td></tr><tr><td align="center">D</td><td align="center">删除光标所在处到行尾内容</td><td align="center">：n1,n2d</td><td align="center">删除指定范围的行</td></tr></tbody></table><h4 id="复制和剪切"><a href="#复制和剪切" class="headerlink" title="复制和剪切"></a>复制和剪切</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">yy</td><td align="center">复制当前行</td><td align="center">nyy</td><td align="center">复制当前行以下n行</td></tr><tr><td align="center">dd</td><td align="center">剪切当前行</td><td align="center">ndd</td><td align="center">剪切当前行以下n行</td></tr><tr><td align="center">p</td><td align="center">粘贴在当前光标所在行下（小写p）</td><td align="center">P</td><td align="center">粘贴在当前光标所在行上（大写p）</td></tr></tbody></table><h4 id="替换和取消"><a href="#替换和取消" class="headerlink" title="替换和取消"></a>替换和取消</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">r</td><td align="center">取代光标所在处字符</td><td align="center">R</td><td align="center">从光标所在处开始替换字符，按ESC取消</td></tr><tr><td align="center">u</td><td align="center">取消上一步操作</td><td align="center"></td><td align="center"></td></tr></tbody></table><h4 id="搜索和搜索替换"><a href="#搜索和搜索替换" class="headerlink" title="搜索和搜索替换"></a>搜索和搜索替换</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">/string</td><td align="center">搜索指定字符串，搜索时忽略大小写：set ic</td><td align="center">n</td><td align="center">搜索指定字符串的下一个出现位置</td></tr><tr><td align="center">：%s/old/new/g</td><td align="center">全文替换指定字符串</td><td align="center">：n1,n2s/old/new/g</td><td align="center">在指定范围内替换指定字符串，/c 替换时有询问操作，/g替换时无询问操作</td></tr></tbody></table><h4 id="保存和退出"><a href="#保存和退出" class="headerlink" title="保存和退出"></a>保存和退出</h4><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">：w</td><td align="center">保存修改</td><td align="center">：w new_filename</td><td align="center">另存为指定文件</td></tr><tr><td align="center">：wq</td><td align="center">保存修改并退出</td><td align="center">ZZ</td><td align="center">快捷键，保存修改并退出</td></tr><tr><td align="center">：q!</td><td align="center">不保存修改退出</td><td align="center">：wq!</td><td align="center">保存修改并退出(文件所有者及root可使用)</td></tr></tbody></table><h4 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h4><table><thead><tr><th align="center">命令</th><th>作用</th></tr></thead><tbody><tr><td align="center">：r 文件名</td><td>导入指定文件内容到当前所编辑的文件之中(光标所在处)，例如导入/etc/issue文件内容到当前所编辑的文件中 :r /etc/issue</td></tr><tr><td align="center">：!which 命令</td><td>在不退出vim的情况下找到命令所在路径，按Enter继续</td></tr><tr><td align="center">：r !命令</td><td>把一个命令的执行结果导入到当前编辑的文件中（光标所在处），例如导入当前时间 ：r !date</td></tr><tr><td align="center">：map 快捷键 触发命令</td><td>定义快捷键，例如当按快捷键<code>ctrl+p</code>的时候在一行的行首添加注释，可以这样写 <code>:map ^P I#&lt;ESC&gt;</code>，其中 <code>^P</code> 需要同时按<code>CTRL+V+P</code>，<code>I#</code>表示在行首插入<code>#</code>,<code>&lt;ESC&gt;</code>表示按<code>ESC</code>结束，</td></tr><tr><td align="center"></td><td>快捷键<code>:map ^B 0x</code> 表示定义快捷键<code>ctrl+B</code>删除行首的第一个字符，其中 <code>^B</code> 需要同时按<code>ctrl+V+B</code>,快捷键<code>:map ^H test@cntaiping.com&lt;ESC&gt;</code> 表示定义快捷键<code>CTRL+H</code>,在光标所在处插入邮箱地址</td></tr><tr><td align="center">:n1,n2s/^/#/g</td><td>连续行注释，例如注释1-4行可以这样写<code>:1,4s/^/#/g</code> ,去掉1-4行注释可以这样写：<code>1,4s/^#//g</code>，在1-4行行首添加<code>//</code>双斜杠注释可以这样写：<code>1,4s/^/\/\//g</code>,其中<code>\/</code>表示转义字符</td></tr><tr><td align="center">替换ab</td><td><code>ab mymail test@test.com</code> 当输入mymail时按回车会自动替换为 <code>test@test.com</code>,重启之后快捷键会失效，可以在<code>.vimrc</code>下定义快捷键，永久有效，普通用户路径：<code>/home/username/.vimrc</code>,root用户路径<code>/root/.vimrc</code></td></tr></tbody></table><h3 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h3><ol><li><p>软件包分类</p><ul><li>源码包：脚本安装包</li><li>二进制包（RPM包、系统默认包）</li></ul></li><li><p>源码包</p><ul><li>源码包的优点</li><li>开源，如果有足够的能力，可以修改源代码。</li><li>可以自由选择所需的功能。</li><li>软件是编译安装，所以更加适合自己的系统，更加稳定，效率也更高。</li><li>卸载方便。</li><li>源码包的缺点<ul><li>安装过程步骤较多，尤其安装较大的软件集合时（如LAMP环境搭建），容易出现拼写错误。</li><li>编译过程时间较长，安装比二进制安装时间长。</li><li>因为是编译安装，安装过程中一旦报错新手很难解决。</li></ul></li></ul></li><li><p>RPM包</p><ul><li>二进制包的优点<ul><li>包管理系统简单，只通过几个命令就可以实现包的安装、升级、查询和卸载。</li><li>安装速度比源码包安装快的多。</li></ul></li><li>二进制包的缺点<ul><li>经过编译，不再可以看到源代码。</li><li>功能选择不如源码包灵活。</li><li>依赖性。</li></ul></li></ul></li></ol><h4 id="rpm命令"><a href="#rpm命令" class="headerlink" title="rpm命令"></a>rpm命令</h4><p>rpm包命名规则</p><blockquote><p>httpd-2.2.15-15.el6.centos.l.i686.rpm   包全名<br>httpd      软件包名<br>2.2.15     软件版本<br>15         软件发布的次数<br>el6.centos 适合的linux平台<br>i686       适合的硬件平台<br>rpm        rpm包扩展名</p></blockquote><p>rpm包路径：<code>CentOS-6.3-i386-bin-DVD1.iso\Packages</code> 目录下<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux10.png"></p><p>rpm包依赖性</p><ul><li>树形依赖：a–&gt;b–&gt;c</li><li>环形依赖：a–&gt;b–&gt;c–&gt;a</li><li>模块依赖：模块依赖查询网站<code>www.rpmfind.net</code></li></ul><h4 id="rpm安装升级与卸载"><a href="#rpm安装升级与卸载" class="headerlink" title="rpm安装升级与卸载"></a>rpm安装升级与卸载</h4><h5 id="包名与包全名"><a href="#包名与包全名" class="headerlink" title="包名与包全名"></a>包名与包全名</h5><ul><li>包全名：操作的包是没有安装的软件包时，使用包全名。而且要注意路径。</li><li>包名：操作已经安装的软件包时，使用包名。是搜索<code>/var/lib/rpm</code>中的数据库</li></ul><h5 id="RPM安装"><a href="#RPM安装" class="headerlink" title="RPM安装"></a>RPM安装</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -ivh 包全名</code></td><td align="center">rpm安装</td><td align="center"><code>-i(install)</code></td><td align="center">安装</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-v(verbose)</code></td><td align="center">显示详细信息</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-h(hash)</code></td><td align="center">显示进度</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>--nodeps</code></td><td align="center">不检测依赖性</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mkdir /mnt/cdrom          # 创建光盘挂载点</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mount /dev/sr0 /mnt/cdrom # 挂载光盘</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cd /mnt/cdrom/Packages/   # rpm包均是在Packages目录下</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -ivh httpd-2.2.15-15.el6.centos.1.i686.rpm  # 使用rpm安装httpd</span></span><br></pre></td></tr></table></figure><h5 id="RPM包升级"><a href="#RPM包升级" class="headerlink" title="RPM包升级"></a>RPM包升级</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -Uvh 包全名</code></td><td align="center">rpm升级</td><td align="center"><code>-U</code></td><td align="center">升级</td></tr></tbody></table><h5 id="RPM包卸载"><a href="#RPM包卸载" class="headerlink" title="RPM包卸载"></a>RPM包卸载</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -e 包全名</code></td><td align="center">rpm卸载</td><td align="center"><code>-e(erase)</code></td><td align="center">卸载</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>--nodeps</code></td><td align="center">不检测依赖性</td></tr></tbody></table><h5 id="查询是否安装"><a href="#查询是否安装" class="headerlink" title="查询是否安装"></a>查询是否安装</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -q 包名</code></td><td align="center">查询包是否安装</td><td align="center"><code>-q</code></td><td align="center">查询（query）</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-a</code></td><td align="center">所有（all）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -q httpd</span></span><br><span class="line">httpd<span class="literal">-2</span>.<span class="number">2.15</span><span class="literal">-53</span>.el6.centos.x86_64    <span class="comment"># 已经安装</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -q httpdfda  #随意写的包名</span></span><br><span class="line">package httpdfda is not installed    <span class="comment"># 未安装</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qa   # 列出所有已经安装的包名</span></span><br><span class="line">cdrdao<span class="literal">-1</span>.<span class="number">2.3</span><span class="literal">-4</span>.el6.x86_64</span><br><span class="line">ibus<span class="literal">-table</span><span class="literal">-additional</span><span class="literal">-1</span>.<span class="number">2.0</span>.<span class="number">20100111</span><span class="literal">-5</span>.el6.noarch</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><h5 id="查询软件包详细信息"><a href="#查询软件包详细信息" class="headerlink" title="查询软件包详细信息"></a>查询软件包详细信息</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -qi 包名</code></td><td align="center">查询软件包详细信息</td><td align="center"><code>-i</code></td><td align="center">查询软件信息（information）</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-p</code></td><td align="center">查询未安装包信息（package包全名）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qi httpd</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qip zip-3.0-1.el6_7.1.x86_64.rpm   # -p参数加包全名，可以看到未安装包的详细信息</span></span><br></pre></td></tr></table></figure><h5 id="查询包中文件安装位置"><a href="#查询包中文件安装位置" class="headerlink" title="查询包中文件安装位置"></a>查询包中文件安装位置</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -ql 包名</code></td><td align="center">查询包中文件安装位置</td><td align="center"><code>-l</code></td><td align="center">列表（list）</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-p</code></td><td align="center">查询未安装包信息（package包全名）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -ql httpd</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qlp zip-3.0-1.el6_7.1.x86_64.rpm    </span></span><br><span class="line"><span class="comment"># -p 查询未安装的包信息，如果安装，则会装到查询出来的位置中</span></span><br></pre></td></tr></table></figure><h5 id="查询文件系统属于哪个RPM包"><a href="#查询文件系统属于哪个RPM包" class="headerlink" title="查询文件系统属于哪个RPM包"></a>查询文件系统属于哪个RPM包</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -qf 系统文件名</code></td><td align="center">查询文件系统属于哪个RPM包</td><td align="center"><code>-f</code></td><td align="center">查询系统文件属于哪个软件包（file）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qf /var/www/icons/small/tar.gif</span></span><br><span class="line">httpd<span class="literal">-2</span>.<span class="number">2.15</span><span class="literal">-53</span>.el6.centos.x86_64</span><br></pre></td></tr></table></figure><h5 id="查询软件包的依赖性"><a href="#查询软件包的依赖性" class="headerlink" title="查询软件包的依赖性"></a>查询软件包的依赖性</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -qR 包名</code></td><td align="center">查询软件包的依赖性</td><td align="center"><code>-R</code></td><td align="center">查询软件包的依赖性（requires）</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-p</code></td><td align="center">查询未安装包信息（package包全名）</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qR httpd  # 以下包必须全部安装完才能安装httpd包</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> <span class="type">Packages</span>]<span class="comment"># rpm -qRp zip-3.0-1.el6_7.1.x86_64.rpm   # -p查询未安装包信息，如果安装，则需要安装以下包</span></span><br></pre></td></tr></table></figure><h5 id="RPM包校验"><a href="#RPM包校验" class="headerlink" title="RPM包校验"></a>RPM包校验</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>rpm -V 已安装的包名</code></td><td align="center">RPM包校验</td><td align="center"><code>-V</code></td><td align="center">校验指定RPM包中的文件（verify）</td></tr></tbody></table><p>验证内容中的8个信息的具体内容如下:</p><table><thead><tr><th align="center">选项</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">S</td><td align="center">文件大小是否改变</td><td align="center">M</td><td align="center">文件的类型或文件的权限(rwx)是否被改变</td></tr><tr><td align="center">5</td><td align="center">文件MD5校验和是否改变(可以看成文件内容是否改变)</td><td align="center">D</td><td align="center">设备的中,从代码是否改变</td></tr><tr><td align="center">L</td><td align="center">文件路径是否改变</td><td align="center">U</td><td align="center">文件的属主(所有者)是否改变</td></tr><tr><td align="center">G</td><td align="center">文件的属组是否改变</td><td align="center">T</td><td align="center">文件的修改时间是否改变</td></tr></tbody></table><p>文件类型：</p><table><thead><tr><th align="center">选项</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">c</td><td align="center">配置文件( config file)</td><td align="center">d</td><td align="center">普通文档( documentation)</td></tr><tr><td align="center">g</td><td align="center">“鬼”文件( ghost file),很少见,就是该文件不应该被这个RPM包包含</td><td align="center">l</td><td align="center">授权文件( license file</td></tr><tr><td align="center">r</td><td align="center">描述文件( read me)</td><td align="center"></td><td align="center"></td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># rpm -V httpd   # 无任何提示说明是初始安装，无任何的修改</span></span><br></pre></td></tr></table></figure><h5 id="RPM包中文件提取"><a href="#RPM包中文件提取" class="headerlink" title="RPM包中文件提取"></a>RPM包中文件提取</h5><p><code>rpm2cpio 全包名 | cpio -idv . 文件绝对路径</code> </p><p><code>rpm2cpio</code> 将rmp包转换为cpio格式的命令</p><p>cpio是一个标准工具，他用于创建软件档案文件和从档案文件中提取文件</p><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>cpio 选项&lt;文件或设备&gt;</code></td><td align="center"></td><td align="center"><code>-i</code></td><td align="center">copy-in模式，还原</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-d</code></td><td align="center">还原时自动新建目录</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-v</code></td><td align="center">显示还原过程</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># rpm -qf /bin/ls  #查询ls命令属于哪个软件包</span></span><br><span class="line">coreutils<span class="literal">-8</span>.<span class="number">4</span><span class="literal">-43</span>.el6.x86_64</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mv /bin/ls /tmp/  # 造成ls命令误删除假象</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls</span></span><br><span class="line"><span class="literal">-bash</span>: <span class="built_in">ls</span>: command not found</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-43.el6.x86_64.rpm | cpio -idv ./bin/ls  #提取rpm包中ls命令到当前目录的/bin/ls下</span></span><br><span class="line">./bin/<span class="built_in">ls</span></span><br><span class="line"><span class="number">25240</span> 块</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cp /root/bin/ls /bin/  # 把ls命令复制到/bin/目录，修复文件丢失</span></span><br></pre></td></tr></table></figure><h4 id="yum在线管理"><a href="#yum在线管理" class="headerlink" title="yum在线管理"></a>yum在线管理</h4><h5 id="IP地址配置和网络yum源"><a href="#IP地址配置和网络yum源" class="headerlink" title="IP地址配置和网络yum源"></a>IP地址配置和网络yum源</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># setup</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># vi /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line"></span><br><span class="line">DEVICE=eth0</span><br><span class="line">HWADDR=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:b3:fb:<span class="number">29</span></span><br><span class="line"><span class="built_in">TYPE</span>=Ethernet</span><br><span class="line">UUID=<span class="number">742</span>f9267<span class="literal">-2297</span><span class="literal">-45d1</span><span class="literal">-b7ad</span><span class="literal">-cd00f88779d6</span></span><br><span class="line">ONBOOT=yes     <span class="comment">#这里将ONBOOT改为yes</span></span><br><span class="line">NM_CONTROLLED=yes</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=<span class="number">192.168</span>.<span class="number">88.128</span></span><br><span class="line">NETMASK=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">GATEWAY=<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line">DNS1=<span class="number">202.106</span>.<span class="number">0.20</span></span><br><span class="line">USERCTL=no</span><br><span class="line">PEERDNS=yes</span><br><span class="line">IPV6INIT=no</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># service network restart # 重启服务</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ifconfig</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># ping www.baidu.com</span></span><br></pre></td></tr></table></figure><p>选择网络配置<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux01.png"><br>选择设备配置<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux02.png"><br>选择第一个网卡<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux03.png"><br>设置网络信息<br><img src="https://cdn.lianjinquan.com/img/posts/linux/02/linux04.png"></p><h5 id="网络yum源"><a href="#网络yum源" class="headerlink" title="网络yum源"></a>网络yum源</h5><table><thead><tr><th align="center">选项</th><th>作用</th></tr></thead><tbody><tr><td align="center"><code>[base]</code></td><td>容器名称，一定要放在[]中</td></tr><tr><td align="center"><code>name</code></td><td>容器说明，可以自己随便写</td></tr><tr><td align="center"><code>mirrorlist</code></td><td>镜像站点，这个可以注释掉</td></tr><tr><td align="center"><code>baseurl</code></td><td>我们的yum源服务器的地址。默认是CentOS的官方的yum源服务器，是可以使用的，如果觉得慢可以改成你喜欢的yum镜像源地址</td></tr><tr><td align="center"><code>enabled</code></td><td>此容器是否生效，如果不写或者写成<code>enable=1</code>都是生效的，写成<code>enable=0</code>就是不生效</td></tr><tr><td align="center"><code>gpgcheck</code></td><td>如果1是指RPM的数字证书生效，如果是0则不生效</td></tr><tr><td align="center"><code>gpgkey</code></td><td>数字证书的公钥文件保存位置。不用修改</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># ls</span></span><br><span class="line">CentOs<span class="literal">-Base</span>.repo  CentOS<span class="literal">-Base</span>.repo  CentOS<span class="literal">-Debuginfo</span>.repo  CentOS<span class="literal">-fasttrack</span>.repo  CentOS<span class="literal">-Media</span>.repo  CentOS<span class="literal">-Vault</span>.repo</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># vi CentOs-Base.repo  # CentOS-Base.repo为网络yum源  CentOS-Media.repo为本地磁盘yum源</span></span><br><span class="line">[<span class="type">base</span>]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http://mirrors.cloud.aliyuncs.com/centos/RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-7</span></span><br><span class="line"></span><br><span class="line">[<span class="type">updates</span>]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http://mirrors.cloud.aliyuncs.com/centos/RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-7</span></span><br><span class="line"></span><br><span class="line">[<span class="type">extras</span>]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://mirrors.cloud.aliyuncs.com/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http://mirrors.cloud.aliyuncs.com/centos/RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-7</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># less CentOs-Base.repo</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>]+  Stopped                 less CentOs<span class="literal">-Base</span>.repo </span><br></pre></td></tr></table></figure><h5 id="查询所有可用软件包列表"><a href="#查询所有可用软件包列表" class="headerlink" title="查询所有可用软件包列表"></a>查询所有可用软件包列表</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum list</code></td><td align="center">查询所有可用软件包列表</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf64m2pjj5o9ggzbg1wxZ</span> <span class="type">yum.repos.d</span>]<span class="comment"># yum list   </span></span><br></pre></td></tr></table></figure><h5 id="搜索软件包"><a href="#搜索软件包" class="headerlink" title="搜索软件包"></a>搜索软件包</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum search [关键字(包名)] </code></td><td align="center">搜索服务器上所有和关键字相关的包</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf64m2pjj5o9ggzbg1wxZ</span> <span class="type">yum.repos.d</span>]<span class="comment"># yum search httpd</span></span><br></pre></td></tr></table></figure><h5 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum -y install [包名]</code></td><td align="center"></td><td align="center"><code>install</code></td><td align="center">安装软件包</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-y</code></td><td align="center">自动回答yes</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf64m2pjj5o9ggzbg1wxZ</span> <span class="type">yum.repos.d</span>]<span class="comment"># yum -y install gcc</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf64m2pjj5o9ggzbg1wxZ</span> <span class="type">yum.repos.d</span>]<span class="comment"># rpm -q gcc </span></span><br></pre></td></tr></table></figure><h5 id="升级软件包"><a href="#升级软件包" class="headerlink" title="升级软件包"></a>升级软件包</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum -y update [包名]</code></td><td align="center"></td><td align="center"><code>update</code></td><td align="center">升级软件包</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-y</code></td><td align="center">自动回答yes</td></tr></tbody></table><h5 id="卸载软件包"><a href="#卸载软件包" class="headerlink" title="卸载软件包"></a>卸载软件包</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th><th align="center">选项</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum -y remove [包名]</code></td><td align="center"></td><td align="center"><code>remove</code></td><td align="center">卸载软件包</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"><code>-y</code></td><td align="center">自动回答yes</td></tr></tbody></table><h5 id="软件包列表"><a href="#软件包列表" class="headerlink" title="软件包列表"></a>软件包列表</h5><table><thead><tr><th align="center">命令</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>yum grouplist</code></td><td align="center">列出所有可用的软件组列表</td></tr><tr><td align="center"><code>yum groupinstall 软件组名</code></td><td align="center">安装指定软件组，组名可以由grouplist查询出来，如果组名之间有空格，用双引号扩起来</td></tr><tr><td align="center"><code>yum groupmove 软件组名</code></td><td align="center">卸载指定软件组</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf64m2pjj5o9ggzbg1wxZ</span> ~]<span class="comment"># yum grouplist</span></span><br></pre></td></tr></table></figure><h5 id="光盘yum源搭建"><a href="#光盘yum源搭建" class="headerlink" title="光盘yum源搭建"></a>光盘yum源搭建</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mount /dev/sr0 /mnt/cdrom  # 挂载光盘</span></span><br><span class="line"><span class="built_in">mount</span>: block device /dev/sr0 is <span class="built_in">write-protected</span>, mounting <span class="built_in">read-only</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /etc/yum.repos.d/ # 进入目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># ls</span></span><br><span class="line">CentOS<span class="literal">-Base</span>.repo  CentOS<span class="literal">-Debuginfo</span>.repo  CentOS<span class="literal">-fasttrack</span>.repo  CentOS<span class="literal">-Media</span>.repo  CentOS<span class="literal">-Vault</span>.repo</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># mv CentOS-Base.repo CentOS-Base.repo.bak   # 让网络yum源失效，把repo扩展名名字改了，只要不是以repo结尾就行</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># mv CentOS-Debuginfo.repo CentOS-Debuginfo.repo.bak </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># mv CentOS-fasttrack.repo CentOS-fasttrack.repo.bak </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># mv CentOS-Vault.repo CentOS-Vault.repo.bak </span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># ls  # 目前只有光盘yum源CentOS-Media.repo生效</span></span><br><span class="line">CentOS<span class="literal">-Base</span>.repo.bak  CentOS<span class="literal">-Debuginfo</span>.repo.bak  CentOS<span class="literal">-fasttrack</span>.repo.bak  CentOS<span class="literal">-Media</span>.repo  CentOS<span class="literal">-Vault</span>.repo.bak</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">yum.repos.d</span>]<span class="comment"># vim CentOS-Media.repo   #修改光盘yum源文件</span></span><br><span class="line">[<span class="type">c6</span>-<span class="type">media</span>]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Media</span><br><span class="line">baseurl=file:///mnt/cdrom/      <span class="comment">#这里改为 mnt/cdrom 地址为你自己的光盘挂载地址</span></span><br><span class="line"><span class="comment">#        file:///media/cdrom/      # 注释掉这个不存在的地址</span></span><br><span class="line"><span class="comment">#        file:///media/cdrecorder/ # 注释掉这个不存在的地址</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">1</span>                           <span class="comment"># 把enabled=0改为enabled=1，让这个yum源配置文件生效</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm<span class="literal">-gpg</span>/RPM<span class="literal">-GPG</span><span class="literal">-KEY</span><span class="literal">-CentOS</span><span class="literal">-6</span></span><br></pre></td></tr></table></figure><h3 id="源码包管理"><a href="#源码包管理" class="headerlink" title="源码包管理"></a>源码包管理</h3><h4 id="源码包和RPM包的区别"><a href="#源码包和RPM包的区别" class="headerlink" title="源码包和RPM包的区别"></a>源码包和RPM包的区别</h4><ol><li><p>区别<br>安装之前的区别：概念上的区别<br>安装之后的区别：安装位置不同</p></li><li><p>RPM包默认安装路径，是安装在默认位置中</p><table><thead><tr><th align="center"></th><th align="center">RPM包默认安装路径</th></tr></thead><tbody><tr><td align="center"><code>/etc/</code></td><td align="center">配置文件安装目录</td></tr><tr><td align="center"><code>/usr/bin/</code></td><td align="center">可执行的命令安装目录</td></tr><tr><td align="center"><code>/usr/lib/</code></td><td align="center">程序所使用的函数库保存位置</td></tr><tr><td align="center"><code>/usr/share/doc/</code></td><td align="center">基本的软件使用手册保存位置</td></tr><tr><td align="center"><code>/usr/share/man/</code></td><td align="center">帮助文件保存位置</td></tr></tbody></table></li><li><p>源码包安装位置<br>安装在指定位置当中，一般是<code>/usr/local/软件名/</code></p></li><li><p>安装位置不同带来的影响<br>RPM包安装的服务可以使用系统服务管理命令(service)来管理，而源码包安装的服务则不能被服务管理命令管理,因为没有安装到默认路径中。所以只能用绝对路径进行服务的管理，例如RPM包安装的Apache的启动方法是：</p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># cd /etc/rc.d/init.d/</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">init.d</span>]<span class="comment"># ls</span></span><br><span class="line">abrt<span class="literal">-ccpp</span>     certmonger  httpd         messagebus      oddjobd      rpcgssd     snmptrapd</span><br><span class="line">abrtd         cpuspeed    ip6tables     netconsole      portreserve  rpcidmapd   spice<span class="literal">-vdagentd</span></span><br><span class="line">abrt<span class="literal">-oops</span>     crond       iptables      netfs           postfix      rpcsvcgssd  sshd</span><br><span class="line">acpid         cups        irqbalance    network         psacct       rsyslog     sssd</span><br><span class="line">atd           dnsmasq     kdump         NetworkManager  quota_nld    sandbox     sysstat</span><br><span class="line">auditd        firstboot   killall       nfs             rdisc        saslauthd   udev<span class="literal">-post</span></span><br><span class="line">autofs        functions   lvm2<span class="literal">-lvmetad</span>  nfslock         restorecond  single      wdaemon</span><br><span class="line">avahi<span class="literal">-daemon</span>  haldaemon   lvm2<span class="literal">-monitor</span>  ntpd            rngd         smartd      wpa_supplicant</span><br><span class="line">bluetooth     halt        mdmonitor     ntpdate         rpcbind      snmpd       ypbind</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">init.d</span>]<span class="comment"># /etc/rc.d/init.d/httpd start  #使用绝对路径启动apache</span></span><br><span class="line">正在启动 httpd：  </span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">init.d</span>]<span class="comment"># service httpd restart  #使用service启动apache</span></span><br><span class="line">停止 httpd：                                               [确定]</span><br><span class="line">正在启动 httpd：                                           [确定]</span><br></pre></td></tr></table></figure><h4 id="源码包安装过程"><a href="#源码包安装过程" class="headerlink" title="源码包安装过程"></a>源码包安装过程</h4><ol><li><p>安装准备</p><ul><li>安装C语言编译器</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># yum -y install gcc # 安装gcc</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># rpm -q gcc</span></span><br><span class="line">gcc<span class="literal">-4</span>.<span class="number">8.5</span><span class="literal">-44</span>.el7.x86_64</span><br></pre></td></tr></table></figure><ul><li>下载源码包<code>http://mirror.bit.edu.cn/apache/httpd/</code>,下载httpd-2.4.46.tar.gz<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux01.png"></li></ul></li><li><p>安装注意事项</p><ul><li>源码包保存位置：<code>/usr/local/src</code></li><li>软件安装位置：<code>/usr/local</code></li><li>如何确定安装过程报错：安装过程停止，并出现error，warning或者no提示，即发生错误</li></ul></li><li><p>安装</p><ul><li>使用winscp上传httpd-2.4.46.tar.gz<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux02.png"></li><li>解压下载到源码包</li></ul></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># tar -axvf httpd-2.4.46.tar.gz  # 解压缩</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># cd httpd-2.4.46 # 进入解压目录</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">httpd</span>-<span class="number">2.4</span><span class="type">.46</span>]<span class="comment"># ls</span></span><br><span class="line">ABOUT_APACHE     BuildAll.dsp    configure.in  include         LICENSE        README            test</span><br><span class="line">acinclude.m4     BuildBin.dsp    docs          INSTALL         Makefile.in    README.cmake      VERSIONING</span><br><span class="line">Apache<span class="literal">-apr2</span>.dsw  buildconf       emacs<span class="literal">-style</span>   InstallBin.dsp  Makefile.win   README.platforms</span><br><span class="line">Apache.dsw       CHANGES         httpd.dep     LAYOUT          modules        ROADMAP</span><br><span class="line">apache_probes.d  CMakeLists.txt  httpd.dsp     libhttpd.dep    NOTICE         server</span><br><span class="line">ap.d             config.layout   httpd.mak     libhttpd.dsp    NWGNUmakefile  srclib</span><br><span class="line">build            configure       httpd.spec    libhttpd.mak    os             support</span><br></pre></td></tr></table></figure><ol start="4"><li><p><code>./config</code>软件配置与检测</p><ul><li>定义需要的功能选项。</li><li>检测系统环境是否符合安装要求</li><li>把定义好的功能选项和检测系统环境的信息都写入Makefile文件，用于后续的编辑。</li></ul></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">httpd</span>-<span class="number">2.4</span><span class="type">.46</span>]<span class="comment"># ./configure --prefix=/usr/local/apache2.4 --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util --with-pcre=/usr/local/pcre</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">httpd</span>-<span class="number">2.4</span><span class="type">.46</span>]<span class="comment"># make # 编译</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">httpd</span>-<span class="number">2.4</span><span class="type">.46</span>]<span class="comment"># make install #编译安装</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">httpd</span>-<span class="number">2.4</span><span class="type">.46</span>]<span class="comment"># /usr/local/apache2.4/bin/apachectl start #启动</span></span><br></pre></td></tr></table></figure><p>启动后访问：<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux03.png"></p><ol start="5"><li>安装报错APR not found解决办法</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># wget http://archive.apache.org/dist/apr/apr-1.4.5.tar.gz #下载包</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># tar -zxf apr-1.4.5.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># cd apr-1.4.5</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="number">1.4</span><span class="type">.5</span>]<span class="comment"># ./configure --prefix=/usr/local/apr </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="number">1.4</span><span class="type">.5</span>]<span class="comment"># make</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="number">1.4</span><span class="type">.5</span>]<span class="comment"># make install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># wget http://archive.apache.org/dist/apr/apr-util-1.3.12.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># tar -zxf apr-util-1.3.12.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># cd apr-util-1.3.12</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="type">util</span>-<span class="number">1.3</span><span class="type">.12</span>]<span class="comment"># ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="type">util</span>-<span class="number">1.3</span><span class="type">.12</span>]<span class="comment"># make</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">apr</span>-<span class="type">util</span>-<span class="number">1.3</span><span class="type">.12</span>]<span class="comment"># make install</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># wget http://jaist.dl.sourceforge.net/project/pcre/pcre/8.10/pcre-8.10.zip</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># unzip -o pcre-8.10.zip</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># cd pcre-8.10</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">pcre</span>-<span class="number">8.10</span>]<span class="comment"># ./configure --prefix=/usr/local/pcre</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">pcre</span>-<span class="number">8.10</span>]<span class="comment"># make</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">pcre</span>-<span class="number">8.10</span>]<span class="comment"># make install</span></span><br></pre></td></tr></table></figure><ol start="6"><li>安装报错pcre-config for libpcre not found<br>执行以下命令：</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># yum -y install pcre-devel</span></span><br></pre></td></tr></table></figure><ol start="7"><li>此次安装的文件如下<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux04.png"></li></ol><h4 id="脚本安装包与软件包选择"><a href="#脚本安装包与软件包选择" class="headerlink" title="脚本安装包与软件包选择"></a>脚本安装包与软件包选择</h4><ol><li><p>脚本安装包</p><ul><li>脚本安装包并不是独立的软件包类型，常见安装的是源码包。</li><li>是人为把安装过程写成了自动安装的脚本，只要执行脚本，定义简单的参数，就可以完成安装。</li><li>非常类似于Windows下软件的安装方式</li></ul></li><li><p>Webmin的作用<br>Webmin是一个基于Web的 Linux系统管理界面。您就可以通过图形化的方式设置用户帐号、 Apache、DNS、文件共享等服务。</p></li><li><p>Webmin安装过程</p><ul><li>下载地址：<code>https://sourceforge.net/projects/webadmin/files/webmin/</code>，下载webmin-1.962.tar.gz<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux05.png"></li><li>使用winscp上传到/root/目录下</li><li>安装</li></ul></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># tar -zxvf webmin-1.962.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> ~]<span class="comment"># cd webmin-1.962</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iZuf6fhk4slpwaz2668zqyZ</span> <span class="type">webmin</span>-<span class="number">1.962</span>]<span class="comment"># ./setup.sh  #一路回车即可</span></span><br><span class="line">Web server port (default <span class="number">10000</span>): </span><br><span class="line">Login name (default admin): admin  <span class="comment">#这里admin</span></span><br><span class="line">Login password:     <span class="comment">#密码这里设置123</span></span><br><span class="line">Password again: </span><br><span class="line">The Perl SSLeay library is not installed. SSL not available.</span><br></pre></td></tr></table></figure><ol start="5"><li>阿里云安全组规则中新增入方向为10000/10000<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux06.png"></li><li>登录<br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux08.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux07.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/03/linux09.png"></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware安装centos6.8</title>
      <link href="/2020/12/01/linux/linux02/"/>
      <url>/2020/12/01/linux/linux02/</url>
      
        <content type="html"><![CDATA[<p>VMware安装centos6</p><a id="more"></a><h1 id="下载centos6-8"><a href="#下载centos6-8" class="headerlink" title="下载centos6.8"></a>下载centos6.8</h1><p><a href="https://vault.centos.org/6.8/isos/x86_64/">centos6.8 64位下载地址</a>,点击CentOS-6.8-x86_64-bin-DVD1.iso下载<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux01.png"></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol><li>点击VMware中的创建新的虚拟机<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux02.png"></li><li>选择典型（推荐）<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux03.png"></li><li>选择稍后安装操作系统<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux04.png"></li><li>客户机操作系统选择Linux,版本选择CentOS6 64位<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux05.png"></li><li>选择安装位置<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux06.png"></li><li>磁盘容量默认20GB<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux07.png"></li><li>点击完成，完成安装<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux08.png"></li><li>安装后界面如下<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux09.png"></li><li>点击虚拟机-设置<ul><li>选择IOS镜像<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux10.png"></li><li>网络适配器选择 NAT模式<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux11.png"></li></ul></li><li>点击开启此虚拟机，选择 Install or upgrand an existing system<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux12.png"></li><li>skip跳过<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux13.png"></li><li>点击next<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux14.png"></li><li>选择中文简体<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux15.png"></li><li>默认选择美国式英语<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux16.png"></li><li>选择基本存储设备<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux17.png"></li><li>选择是，忽略所有数据<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux18.png"></li><li>主机名默认即可<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux19.png"></li><li>选择默认时区<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux20.png"></li><li>设置root账号的密码，本次设置 flzx_3QC (飞流直下三千尺)<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux21.png"></li><li>选择创建自定义布局<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux22.png"></li><li>点击创建-生成分区选择标准分区<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux23.png"><ul><li>/boot分区,固定大小选择200MB<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux24.png"></li><li>/swap分区,固定大小选择1000MB<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux25.png"></li><li>/home分区,固定大小选择2000MB<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux26.png"></li><li><code>/</code>根分区最后分,选择使用全部可用空间<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux27.png"></li><li>最后分区如下<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux28.png"></li></ul></li><li>选择格式化<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux29.png"></li><li>将修改写入磁盘<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux30.png"></li><li>默认即可<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux31.png"></li><li>软件包选择，这里因为是个人的安装，我选择Desktop桌面,服务器推荐安装 Minial 最小化或者Basic server基本服务器<ul><li>Desktop桌面</li><li>Minimal Desktop最小化桌面</li><li>Minimal 最小化</li><li>Basic Server基本服务器</li><li>Database Server 数据库服务器</li><li>Web Server 网页服务器</li><li>Virtual Host 虚拟主机</li><li>software development workstation 软件开发工具站<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux32.png"></li></ul></li><li>等待安装之后，点击重新引导<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux33.png"></li><li>进入欢迎页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux34.png"></li><li>点击同意<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux35.png"></li><li>暂时忽略用户的创建<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux36.png"></li><li>默认即可!<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux37.png"></li><li>kdump可以不勾选<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux38.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux39.png"></li><li>登录桌面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux40.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux41.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux42.png"><br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux43.png"></li><li>配置网络连接，可以上网 System eth0<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux44.png"></li></ol><h1 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h1><h2 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h2><p><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux45.png"><br>使用windows测试IP地址是否可以连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ping 192.168.139.128</span><br><span class="line"></span><br><span class="line">正在 Ping 192.168.139.128 具有 32 字节的数据:</span><br><span class="line">来自 192.168.139.128 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64</span><br><span class="line">来自 192.168.139.128 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64</span><br><span class="line">来自 192.168.139.128 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64</span><br><span class="line">来自 192.168.139.128 的回复: 字节&#x3D;32 时间&lt;1ms TTL&#x3D;64</span><br><span class="line"></span><br><span class="line">192.168.139.128 的 Ping 统计信息:</span><br><span class="line">    数据包: 已发送 &#x3D; 4，已接收 &#x3D; 4，丢失 &#x3D; 0 (0% 丢失)，</span><br><span class="line">往返行程的估计时间(以毫秒为单位):</span><br><span class="line">    最短 &#x3D; 0ms，最长 &#x3D; 0ms，平均 &#x3D; 0ms</span><br></pre></td></tr></table></figure><h2 id="远程登录工具SecureCRT"><a href="#远程登录工具SecureCRT" class="headerlink" title="远程登录工具SecureCRT"></a>远程登录工具SecureCRT</h2><p>选择登录的主机，端口，输入账号密码后即可登录  主机：192.168.139.128  用户名：root 密码：flzx_3QC 端口：22<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux46.png"><br>登录成功页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux47.png"></p><h2 id="远程登录工具Xshell5"><a href="#远程登录工具Xshell5" class="headerlink" title="远程登录工具Xshell5"></a>远程登录工具Xshell5</h2><p>选择登录的主机，端口，输入账号密码后即可登录  主机：192.168.139.128  用户名：root 密码：flzx_3QC 端口：22<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux48.png"><br>登录成功页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux49.png"></p><h2 id="远程登录工具finalshell"><a href="#远程登录工具finalshell" class="headerlink" title="远程登录工具finalshell"></a>远程登录工具finalshell</h2><p>选择登录的主机，端口，输入账号密码后即可登录  主机：192.168.139.128  用户名：root 密码：flzx_3QC 端口：22<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux50.png"><br>登录成功页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux51.png"></p><h2 id="文件拷贝工具Winscp"><a href="#文件拷贝工具Winscp" class="headerlink" title="文件拷贝工具Winscp"></a>文件拷贝工具Winscp</h2><p>选择登录的主机，端口，输入账号密码后即可登录  主机：192.168.139.128  用户名：root 密码：flzx_3QC 协议选择：SFTP 端口：22<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux52.png"><br>登录成功页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux53.png"></p><h2 id="文件拷贝工具xftp"><a href="#文件拷贝工具xftp" class="headerlink" title="文件拷贝工具xftp"></a>文件拷贝工具xftp</h2><p>选择登录的主机，端口，输入账号密码后即可登录  主机：192.168.139.128  用户名：root 密码：flzx_3QC  协议选择：SFTP 端口：22<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux54.png"><br>登录成功页面<br><img src="https://cdn.lianjinquan.com/img/posts/linux/01/linux55.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>maven简介</title>
      <link href="/2020/11/29/maven/maven01/"/>
      <url>/2020/11/29/maven/maven01/</url>
      
        <content type="html"><![CDATA[<p>Maven 是目前最流行的自动化构建工具，对于生产环境下多框架、多模块整合开发有重要作用。Maven 是一款在大型项目开发过程中不可或缺的重要工具。生产环境下开发不再是一个项目一个工程，而是每一个模块创建一个工程，而多个模块整合在一起就需要<br>使用到像 Maven 这样的构建工具。本课程将帮助你了解 Maven 的作用，常用命令，如何配置依赖，以及依赖的范围、依赖的传递性、依赖的排除、生命周期等重要概念，以及继承、聚合这样的 Maven 配置。更会手把手教你在 Eclipse 中玩转 Maven。</p><a id="more"></a><h1 id="为什么要用Maven"><a href="#为什么要用Maven" class="headerlink" title="为什么要用Maven"></a>为什么要用Maven</h1><ol><li>一个项目就是一个工程<br>如果项目非常庞大,就不适合继续使用 package来划分模块。最好是每一个模块对应一个工程,利于分工协作。借助于 Maven就可以将一个项目拆分成多个工程。</li><li>项目中需要的jar包必须手动复制粘贴到WEB-INF/lib目录下<br>带来的问题是:同样的jar包文件重复出现在不同的项目工程中,一方面浪费存储空间,另外也让工程比较臃肿。借助 Maven,可以将jar包仅仅保存在仓库中,有需要使用的工程“引用”这个文件接口,并不需要真的把jar包复制过来。</li><li>jar包需要别人替我们准备好,或到官网下载<br>不同技术的官网提供jar包下载的形式是五花八门。有些技术的官网就是通过 Maven或SVN等专门的工具来提供下载的。如果是以不规范的方式下载的jar包,那么其中的内容很可能也是不规范的。借助于 Maven可以以一种规范的方式下载jar包。因为所有知名框架或第三方工具的jar包已经按照统一的规范存放在了 Maven的中央仓库中。以规范的方式下载的jar包,内容也是可靠的。Tips:”统一的规范”不仅是对IT开发领域非常重要,对于整个人类社会都是非常重要的</li><li>一个jar包依赖的其他jar包需要自己手动加入到项目中<br>FileUpload组件→IO组件。 commons- fileupload-1.3.jar依赖于 commons-IO-2.0.1.jar。如果所有jar包之间的依赖关系都需要程序员自己非常清楚的了解,那么就会极大的增加学习成本。Maven会自动将被依赖的jar包导入进来。</li></ol><h1 id="Maven是什么"><a href="#Maven是什么" class="headerlink" title="Maven是什么"></a>Maven是什么</h1><ol><li><p>Maven是一款服务于Java平台的自动化构建工具。<br>Make→Ant→ Maven→ Gradle</p></li><li><p>构建</p><ul><li>概念:以”Java源文件”、“框架配置文件”、”JSP”、“HTML”、“图片”等资源为“原材料”,去“生产”一个可以运行的项目的过程。</li><li>编译:Java源文件[User.java]→编译→Class字节码文件[User.class]→交给JVM去执行</li><li>部署:一个BS项目最终运行的并不是动态Web工程本身,而是这个动态Web工程”编译的结果”</li><li>Tips:运行时环境:其实是一组jar包的引用,并没有把jar包本身复制到工程中,所以并不是目录。<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven01.png"></li></ul></li><li><p>构建过程中的各个环节</p><ul><li>凊理:将以前编译得到的旧的 class 宇节码文件删除,为下一次编译做准备</li><li>编译:将 Java 源程序编程成 class 宁节码文件</li><li>测试:自动测试,自动调用 junit 程序</li><li>报告:测试程序执行的结果</li><li>打包:动态 Web 工程打 war 包,Java 工程打 jar 包</li><li>安装: Maven 特定的概念—将打包得到的文件复制到“仓库”中的指定位置</li><li>部署:将动态 Web 工程生成的 war 包复制到 Servlet 容器的指定目录下,使其可以运行</li></ul></li><li><p>自动化构建</p></li></ol><h1 id="Maven安装"><a href="#Maven安装" class="headerlink" title="Maven安装"></a>Maven安装</h1><ol><li><p>检查JAVA_HOME环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;echo %JAVA_HOME%</span><br><span class="line">E:\java\jdk1.8.0_251</span><br></pre></td></tr></table></figure></li><li><p>下载<br><a href="http://maven.apache.org/download.cgi">下载apache-maven-3.6.3-src.zip</a><br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven02.png"></p></li><li><p>配置Maven环境变量<br>MAVEN_HOME或者M2_HOME<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven03.png"><br>编辑path<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven04.png"></p></li><li><p>验证<br>执行mvn -v命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;mvn -v</span><br><span class="line">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">Maven home: E:\apache-maven-3.6.3\bin\..</span><br><span class="line">Java version: 1.8.0_251, vendor: Oracle Corporation, runtime: E:\java\jdk1.8.0_251\jre</span><br><span class="line">Default locale: zh_CN, platform encoding: GBK</span><br><span class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;</span><br></pre></td></tr></table></figure></li></ol><h1 id="Maven的核心概念"><a href="#Maven的核心概念" class="headerlink" title="Maven的核心概念"></a>Maven的核心概念</h1><ol><li>约定的目录结构</li><li>POM</li><li>坐标</li><li>依赖</li><li>仓库</li><li>生命周期/插件/目标</li><li>继承</li><li>聚合</li></ol><h1 id="约定的目录结构"><a href="#约定的目录结构" class="headerlink" title="约定的目录结构"></a>约定的目录结构</h1><ol><li><p>创建约定的目录结构</p><ul><li>根目录:工程名</li><li>src目录:源码</li><li>pom.xm文件: Maven工程的核心配置文件</li><li>main目录:存放主程序</li><li>test目录:存放测试程序</li><li>java目录:存放Java源文件</li><li>resources目录:存放框架或其他工具的配置文件<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven05.png"></li></ul></li><li><p>为什么要遵守约定的目录结构呢?<br>Maven要负责我们这个项目的自动化构建,以编译为例, Maven要想自动进行编译,那么它必须知道Java源文件保存在哪里。如果我们自己自定义的东西想要让框架或工具知道,有两种办法</p><ol><li>以配置的方式明确告诉框架<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;param-value&gt;classpath:spring-context.xml&lt;&#x2F;param-value&gt; </span><br></pre></td></tr></table></figure></li><li>遵守框架内部已经存在的约定<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log4j.properties</span><br><span class="line">log4j.xml</span><br></pre></td></tr></table></figure></li></ol></li><li><p>约定&gt;配置&gt;编码</p></li></ol><h1 id="常用-Maven命令"><a href="#常用-Maven命令" class="headerlink" title="常用 Maven命令"></a>常用 Maven命令</h1><p>注意:执行与构建过程相关的 Maven命令,必须进入 pom.xm所在的目录。与构建过程相关:编译、测试、打包、……<br>常用命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mvn clean:清理</span><br><span class="line">mvn compile:编译主程序</span><br><span class="line">mvn test-compile:编译测试程序</span><br><span class="line">mvn test:执行测试</span><br><span class="line">mvn package:打包</span><br><span class="line">myn install:安装</span><br><span class="line">mvn site:生成站点</span><br></pre></td></tr></table></figure><h3 id="编译主程序"><a href="#编译主程序" class="headerlink" title="编译主程序"></a>编译主程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">E:\workspace\demotest&gt;mvn compile</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.demo:demotest &gt;--------------------------</span><br><span class="line">[INFO] Building demotest 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ demotest ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to E:\workspace\demotest\target\classes</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  0.701 s</span><br><span class="line">[INFO] Finished at: 2020-11-29T19:04:54+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="执行清理："><a href="#执行清理：" class="headerlink" title="执行清理："></a>执行清理：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">E:\workspace\demotest&gt;mvn clean</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.demo:demotest &gt;--------------------------</span><br><span class="line">[INFO] Building demotest 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ demotest ---</span><br><span class="line">[INFO] Deleting E:\workspace\demotest\target</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  0.170 s</span><br><span class="line">[INFO] Finished at: 2020-11-29T19:05:12+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">E:\workspace\demotest&gt;mvn package</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.demo:demotest &gt;--------------------------</span><br><span class="line">[INFO] Building demotest 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ demotest ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to E:\workspace\demotest\target\classes</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ demotest ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to E:\workspace\demotest\target\test-classes</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ demotest ---</span><br><span class="line">[INFO] Surefire report directory: E:\workspace\demotest\target\surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running com.demotest.MyTest</span><br><span class="line">helloTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.017 sec</span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line"></span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ demotest ---</span><br><span class="line">[INFO] Building jar: E:\workspace\demotest\target\demotest-0.0.1-SNAPSHOT.jar</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  1.252 s</span><br><span class="line">[INFO] Finished at: 2020-11-29T19:05:26+08:00</span><br></pre></td></tr></table></figure><h3 id="编译测试程序"><a href="#编译测试程序" class="headerlink" title="编译测试程序"></a>编译测试程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">E:\workspace\demotest&gt;mvn test-compile</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.demo:demotest &gt;--------------------------</span><br><span class="line">[INFO] Building demotest 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ demotest ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ demotest ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  0.492 s</span><br><span class="line">[INFO] Finished at: 2020-11-29T19:06:04+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h1 id="关于联网问题"><a href="#关于联网问题" class="headerlink" title="关于联网问题"></a>关于联网问题</h1><ol><li>Maven的核心程序中仅仅定义了抽象的生命周期,但是具体的工作必须由特定的插件来完成。而插件本身并不包含在 Maven的核心程序中。</li><li>当我们执行的 Maven命令需要用到某些插件时, Maven核心程序会首先到本地仓库中查找。</li><li>本地仓库的默认位置:<code>[系统中当前用户的家目录]\.m2\epository</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\.m2\repository</span><br></pre></td></tr></table></figure></li><li>Maven核心程序如果在本地仓库中找不到需要的插件,那么它会自动连接外网,到中央仓库下载</li><li>如果此时无法连接外网,则构建失败</li><li>修改默认本地仓库的位置可以让 Maven核心程序到我们事先准备好的目录下查找插件<br>找到<code>E:\apache-maven-3.6.3\conf\settings.xml</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;localRepository&gt;E:\apache-maven-3.6.3\repository&lt;&#x2F;localRepository&gt;</span><br></pre></td></tr></table></figure></li></ol><h1 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h1><p>含义: Project Object Model项目对象模型。pom.Xm对于 Maven工程是核心配置文件,与构建过程相关的一切设置都在这个文件中进行配置<br>重要程度相当于web.Xm对于动态Web工程。</p><h1 id="坐标"><a href="#坐标" class="headerlink" title="坐标"></a>坐标</h1><p>Maven使用下面三个向量在仓库中唯一定位一个Maven工程<br>groupId:公司或组织名称域名倒序+项目名<br>artifactId：模块名<br>version：版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;version&gt;5.2.10.RELEASE&lt;&#x2F;version&gt;</span><br></pre></td></tr></table></figure><p>Maven工程坐标与仓库中路径对应的关系:<code>[groupId][artifactId][version][artifactId]-[version].jar</code><br><code>E:\apache-maven-3.6.3\repository\org\springframework\spring-core\5.2.10.RELEASE\spring-core-5.2.10.RELEASE.jar</code><br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven06.png"></p><h1 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h1><h2 id="仓库的分类"><a href="#仓库的分类" class="headerlink" title="仓库的分类"></a>仓库的分类</h2><ol><li>本地仓库:当前电脑上部署的仓库目录,为当前电脑上所有 Maven工程服务</li><li>远程仓库<ul><li>私服:搭建在局域网环境中,为局域网范围內的所有 Maven工程服务<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven07.png"></li><li>中央仓库:架设在 Internet上,为全世界所有 Maven工程服务</li><li>中央仓库镜像:为了分担中央仓库的流量,提升用户访问速度</li></ul></li><li>仓库中保存的内容: Maven工程<ul><li>Maven自身所需要的插件</li><li>第三方框架或工具的jar包</li><li>我们自己开发的 Maven工程</li></ul></li></ol><h1 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h1><p>Maven解析依赖信息时会到本地仓库中查找被依赖的jar包，对于我们自己开发的maven工程，使用mvn install命令安装后就可以进入仓库。<br>执行如下 mvn install 命令,demotest工程是我们自己创建的简单工程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">E:\workspace\demotest&gt;mvn install</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] -------------------------&lt; com.demo:demotest &gt;--------------------------</span><br><span class="line">[INFO] Building demotest 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ demotest ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ demotest ---</span><br><span class="line">[WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] Copying 0 resource</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ demotest ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ demotest ---</span><br><span class="line">[INFO] Surefire report directory: E:\workspace\demotest\target\surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running com.demotest.MyTest</span><br><span class="line">helloTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.017 sec</span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line"></span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ demotest ---</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-install-plugin:2.4:install (default-install) @ demotest ---</span><br><span class="line">[INFO] Installing E:\workspace\demotest\target\demotest-0.0.1-SNAPSHOT.jar to E:\apache-maven-3.6.3\repository\com\demo\demotest\0.0.1-SNAPSHOT\demotest-0.0.1-SNAPSHOT.jar</span><br><span class="line">[INFO] Installing E:\workspace\demotest\pom.xml to E:\apache-maven-3.6.3\repository\com\demo\demotest\0.0.1-SNAPSHOT\demotest-0.0.1-SNAPSHOT.pom</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  1.258 s</span><br><span class="line">[INFO] Finished at: 2020-11-29T19:09:52+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>执行完后可以在<code>E:\apache-maven-3.6.3\repository\com\demo\demotest\0.0.1-SNAPSHOT\</code>中找到<br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven08.png"></p><h2 id="依赖的范围"><a href="#依赖的范围" class="headerlink" title="依赖的范围"></a>依赖的范围</h2><p><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven09.png"></p><ol><li><p>compile范围依赖</p><ul><li>对主程序是否有效：有效</li><li>对测试程序是否有效：有效</li><li>是否参与打包：参与</li><li>是否参与部署：参与</li><li>典型例子：spring-core</li></ul></li><li><p>test范围依赖</p><ul><li>对主程序是否有效：无效</li><li>对测试程序是否有效：有效</li><li>是否参与打包：不参与</li><li>是否参与部署：不参与</li><li>典型例子：junit</li></ul></li><li><p>provider范围依赖</p><ul><li>对主程序是否有效：有效</li><li>对测试程序是否有效：有效</li><li>是否参与打包：不参与</li><li>是否参与部署：不参与</li><li>典型例子：servlet-api.jar</li></ul></li></ol><p><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven10.png"></p><h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><ol><li>各个构建环节执行的顺序：不能打乱顺序，必须按照既定的正确顺序来执行。</li><li>maven的核心程序中定义了抽象的生命周期，生命周期中各个阶段的具体任务是由插件来完成的。</li><li>maven核心程序为了更好的实现自动化构建， 按照这一的特点执行生命周期中的各个阶段：不论现在要执行生命周期中的哪一个阶段， 都是从这个生命周期最初的位置开始执行。</li><li>插件和目标<ol><li>生命周期的各个阶段仅仅定义了要执行的任务是什么。</li><li>各个阶段和插件的目标是对应的。</li><li>相似的目标由特定的插件来完成。</li></ol></li><li>可以将目标看做“调用插件功能的命令”</li></ol><h1 id="eclipse使用maven"><a href="#eclipse使用maven" class="headerlink" title="eclipse使用maven"></a>eclipse使用maven</h1><p><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven11.png"><br><img src="https://cdn.lianjinquan.com/img/posts/maven/01/maven12.png"></p><h1 id="maven中java版本"><a href="#maven中java版本" class="headerlink" title="maven中java版本"></a>maven中java版本</h1><p>设置通过Maven创建的工程的JDK版本<code>E:\apache-maven-3.6.3\conf\settings.xml</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">        &lt;id&gt;jdk-1.8&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;activation&gt;</span><br><span class="line">            &lt;activeByDefault&gt;true&lt;&#x2F;activeByDefault&gt;</span><br><span class="line">            &lt;jdk&gt;1.8&lt;&#x2F;jdk&gt;</span><br><span class="line">        &lt;&#x2F;activation&gt;</span><br><span class="line">        &lt;properties&gt;</span><br><span class="line">            &lt;maven.compiler.source&gt;1.8&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">            &lt;maven.compiler.target&gt;1.8&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">            &lt;maven.compiler.compilerVersion&gt;1.8&lt;&#x2F;maven.compiler.compilerVersion&gt;</span><br><span class="line">        &lt;&#x2F;properties&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;profiles&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud系列之微服务架构编码构建</title>
      <link href="/2020/11/17/springcloud/springcloud01/"/>
      <url>/2020/11/17/springcloud/springcloud01/</url>
      
        <content type="html"><![CDATA[<h3 id="springCloud和SpringBoot版本选择"><a href="#springCloud和SpringBoot版本选择" class="headerlink" title="springCloud和SpringBoot版本选择"></a>springCloud和SpringBoot版本选择</h3><h4 id="springBoot版本选择"><a href="#springBoot版本选择" class="headerlink" title="springBoot版本选择"></a>springBoot版本选择</h4><p><a href="https://github.com/spring-projects/spring-boot/releases">SpringBoot</a> 最新版本目前是 V2.4.0<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud01.png"></p><h4 id="springCloud版本选择"><a href="#springCloud版本选择" class="headerlink" title="springCloud版本选择"></a>springCloud版本选择</h4><p>Spring Cloud采用了英国伦敦地铁站的名称来命名,并由地铁站名称字母A-Z依次类推的形式来发布迭代版本。<br>Spring Cloud是一个由许多子项目组成的综合项目,各子项目有不同的发布节奏。为了管理 SpringCloud与各子项目的版本依赖关系，发布了一个清单，其中包括了某个 Spring Cloud版本对应的子项目版本。为了避免 SpringCloud版本号与子项目版本号混淆， Spring Cloud版本采用了名称而非版本号的命名，这些版本的名字采用了伦敦地铁站的名字，根据字母表的顺序来对应版本时间顺序，例如Angel是第一个版本, Brixton是第二个版本。<br>当 Spring Cloud的发布内容积累刭临界点或者—个重大BUG被解决后,会发布一个” service releases”版本,简称SRX版本,比如Greenwich.SR2就是Spring Cloud发布的 Greenwich版本的第2个SRX版本。</p><p><a href="https://github.com/spring-projects/spring-cloud/wiki">SpringCloud</a> 最新版本目前是 2020.0 (code name ilford)<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud02.png"></p><h4 id="boot和cloud的依赖关系"><a href="#boot和cloud的依赖关系" class="headerlink" title="boot和cloud的依赖关系"></a>boot和cloud的依赖关系</h4><p><a href="https://spring.io/projects/spring-cloud#overview">springBoot和springCloud依赖关系选择</a><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud03.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud04.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud05.png"></p><h4 id="更详细的版本对应查看方法"><a href="#更详细的版本对应查看方法" class="headerlink" title="更详细的版本对应查看方法"></a>更详细的版本对应查看方法</h4><p><a href="https://start.spring.io/actuator/info">更详细的版本对应查看方法</a></p><h4 id="IDEA创建父工程project"><a href="#IDEA创建父工程project" class="headerlink" title="IDEA创建父工程project"></a>IDEA创建父工程project</h4><p>约定&gt;配置&gt;编码</p><p>File-New-Project 选择maven</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud06.png"></p><p>填写项目名称</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud07.png"></p><p>填写maven信息</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud08.png"><br>创建之后项目目录如下<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud12.png"></p><h3 id="IDEA一些常用配置"><a href="#IDEA一些常用配置" class="headerlink" title="IDEA一些常用配置"></a>IDEA一些常用配置</h3><h4 id="统一编码为UTF-8"><a href="#统一编码为UTF-8" class="headerlink" title="统一编码为UTF-8"></a>统一编码为UTF-8</h4><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud09.png"></p><h4 id="注解生效激活"><a href="#注解生效激活" class="headerlink" title="注解生效激活"></a>注解生效激活</h4><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud10.png"></p><h4 id="java编译版本选择8"><a href="#java编译版本选择8" class="headerlink" title="java编译版本选择8"></a>java编译版本选择8</h4><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud11.png"></p><h4 id="File-Type过滤"><a href="#File-Type过滤" class="headerlink" title="File Type过滤"></a>File Type过滤</h4><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud13.png"><br>此时项目目录结构如下：<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud14.png"></p><h4 id="父工程pom-xml"><a href="#父工程pom-xml" class="headerlink" title="父工程pom.xml"></a>父工程pom.xml</h4><p>可以删除src目录，只留pom.xml</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud15.png"></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line"></span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">  xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.cs.springcloud&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;myproject&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 统一管理jar包版本 --&gt;</span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">    &lt;junit.version&gt;4.12&lt;/junit.version&gt;</span><br><span class="line">    &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;</span><br><span class="line">    &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;</span><br><span class="line">    &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt;</span><br><span class="line">    &lt;druid.version&gt;1.1.16&lt;/druid.version&gt;</span><br><span class="line">    &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 子模块继承之后，提供作用：锁定版本+子模块不用写groupId和version  --&gt;</span><br><span class="line">  &lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">      &lt;!--  springboot <span class="number">2.2</span>.<span class="number">2</span>    --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!--  springcloud cloud Hoxton.SR1   --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;Hoxton.SR1&lt;/version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!--  springcloud cloud alibaba <span class="number">2.1</span>.<span class="number">0.</span>RELEASE    --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">        &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;mysql.version&#125;&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;druid.version&#125;&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;mybatis.spring.boot.version&#125;&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;lombok.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">  &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">          &lt;addResources&gt;true&lt;/addResources&gt;</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">  &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Maven中dependencyManagement和dependencies的区别"><a href="#Maven中dependencyManagement和dependencies的区别" class="headerlink" title="Maven中dependencyManagement和dependencies的区别"></a>Maven中dependencyManagement和dependencies的区别</h3><p>Maven使用 dependencyManagement元素来提供了一种管理依赖版本号的方式。<br>通常会在一个组织或者项目的最顶层的父pom中看到 dependencyManagement元素。<br>使用 pom. xm中的 dependencyManagement元素能让所有在子项目中引用一个依赖而不用显式的列出版本号。<br>Maven会沿着父子层次向上走,直到找到一个拥有 dependencyManagement元素的项目,然后它就会使用这dependencyManagement元素中指定的版本号。<br>例如在父项目里:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure><p>然后在子项目里就可以添加mysql-connector时可以不指定版本号,例如:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>这样做的好处就是:如果有多个子项目都引用同一样依赖,则可以避免在每个使用的子项目里都声明—个版本号,这样当想升级或切换到另一个版本时,只需要在顶层父容器里更新,<br>而不需要个个子项目的修改;另外如果某个子项目需要另外的一个版本,只需要声明 version 就可。<br>dependencyManagement里只是声明依赖,并不实现引入,因此子项目需要显示的声明需要用的依赖。<br>如果不在子项目中声明依赖,是不会从父项目中继承下来的;只有在子项目中写了该依赖项,并且没有指定具体版本,才会从父项目中继承该项,并且 version和 scope都读取自父pom。<br>如果子项目中指定了版本号,那么会使用子项目中指定的jar版本。</p><h3 id="Maven中跳过单元测试"><a href="#Maven中跳过单元测试" class="headerlink" title="Maven中跳过单元测试"></a>Maven中跳过单元测试</h3><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud16.png"><br>父工程创建完成执行mvn:install将父工程发布到仓库方便子工程继承<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud17.png"></p><h3 id="创建服务提供者provider"><a href="#创建服务提供者provider" class="headerlink" title="创建服务提供者provider"></a>创建服务提供者provider</h3><p>点击项目名右键-New-Module</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud19.png"></p><p>选择Maven，点击next</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud20.png"></p><p>服务提供者名称设置为cloud-provider8001</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud21.png"><br>项目结构如下：<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud22.png"><br>此时父工程的pom.xml中多了如下module模块</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">  &lt;module&gt;cloud-provider-payment8001&lt;/module&gt;</span><br><span class="line">&lt;/modules&gt;</span><br></pre></td></tr></table></figure><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;myproject&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.quan.springcloud&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-provider-payment8001&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1.10&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><h4 id="在resource目录下创建application-yml"><a href="#在resource目录下创建application-yml" class="headerlink" title="在resource目录下创建application.yml"></a>在resource目录下创建application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>    <span class="comment">#当前数据源的操作类型</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span>      <span class="comment"># mysql驱动包</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2020?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin123</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.cs.springcloud.entity</span>     <span class="comment"># 所有Entity别名类所在的包</span></span><br></pre></td></tr></table></figure><h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="简单的表"><a href="#简单的表" class="headerlink" title="简单的表"></a>简单的表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`db2020`</span>.<span class="string">`payment`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">  <span class="string">`serial`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8;</span><br></pre></td></tr></table></figure><h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Payment</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String serial;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResult</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonResult</span><span class="params">(Integer code,String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(code,message,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">create</span><span class="params">(Payment payment)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Payment <span class="title">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h4><p>/resources/mapper/PaymentMapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.cs.springcloud.dao.PaymentDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;BaseResultMap&quot;</span> type=<span class="string">&quot;com.cs.springcloud.entity.Payment&quot;</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span> /&gt;</span><br><span class="line">        &lt;id column=<span class="string">&quot;serial&quot;</span> property=<span class="string">&quot;serial&quot;</span>/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;create&quot;</span> parameterType=<span class="string">&quot;com.cs.springcloud.entity.Payment&quot;</span> useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">        <span class="function">insert into <span class="title">payment</span><span class="params">(serial)</span> <span class="title">value</span> <span class="params">(#&#123;serial&#125;)</span></span>;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;getPaymentById&quot;</span> parameterType=<span class="string">&quot;Long&quot;</span> resultMap=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span><br><span class="line">        select * from payment where id=#&#123;id&#125;;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">create</span><span class="params">(Payment payment)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Payment <span class="title">getPaymentById</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="impl实现类"><a href="#impl实现类" class="headerlink" title="impl实现类"></a>impl实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.dao.PaymentDao;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentDao paymentDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">create</span><span class="params">(Payment payment)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Payment <span class="title">getPaymentById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controlr"><a href="#controlr" class="headerlink" title="controlr"></a>controlr</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result=paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;****插入结果&quot;</span>+result);</span><br><span class="line">        <span class="keyword">if</span>(result &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;插入成功&quot;</span>,result);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>,<span class="string">&quot;插入失败&quot;</span>,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">create</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        Payment payment=paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;****查询结果&quot;</span>+payment);</span><br><span class="line">        <span class="keyword">if</span>(payment != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;查询成功&quot;</span>,payment);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>,<span class="string">&quot;没有对应记录,查询ID&quot;</span>+id,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时项目结构如下：<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud27.png"></p><h3 id="热部署Devtools"><a href="#热部署Devtools" class="headerlink" title="热部署Devtools"></a>热部署Devtools</h3><h4 id="子工程pom-xml"><a href="#子工程pom-xml" class="headerlink" title="子工程pom.xml"></a>子工程pom.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">      &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h4 id="父工程pom-xml-1"><a href="#父工程pom-xml-1" class="headerlink" title="父工程pom.xml"></a>父工程pom.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;fork&gt;true&lt;/fork&gt;</span><br><span class="line">        &lt;addResources&gt;true&lt;/addResources&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">  &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><h4 id="IDEA配置"><a href="#IDEA配置" class="headerlink" title="IDEA配置"></a>IDEA配置</h4><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud23.png"></p><p>快捷键 <code>ctrl+alt+shift+/</code> 选择Registry</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud24.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud25.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud26.png"></p><p>重启IDEA即可<br>如果不生效，则 <code>ctrl+shift+F9</code> 重新编译一下</p><h3 id="创建消费者模块"><a href="#创建消费者模块" class="headerlink" title="创建消费者模块"></a>创建消费者模块</h3><p>项目名右键-new Module-Maven 模块名为 cloud-consumer-order80</p><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;myproject&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.cs.springcloud&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h4 id="启动类-1"><a href="#启动类-1" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMain80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="实体类-1"><a href="#实体类-1" class="headerlink" title="实体类"></a>实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Payment</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String serial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResult</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonResult</span><span class="params">(Integer code,String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(code,message,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="配置config"><a href="#配置config" class="headerlink" title="配置config"></a>配置config</h4><p>RestTemplate提供了多种便捷访问远程Http服务的方法，是—种简单便捷的访冋 Restful服务模板类,是 Spring提供的用于访问冋Rest服务的客户端模板工具集。<br>使用 restTemplate访问 restful接口非常的简单粗暴无脑。(url, requestMap, ResponseBean.class)这三个参数分别代表REST请求地址、请求参数、HTPP晌应转换被转换成的对象类型。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">create</span><span class="params">(Payment payment)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL+<span class="string">&quot;/payment/create&quot;</span>,payment,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL+<span class="string">&quot;/payment/get/&quot;</span>+id,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目工程如下<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud29.png"></p><h3 id="Run-Dashboard配置"><a href="#Run-Dashboard配置" class="headerlink" title="Run Dashboard配置"></a>Run Dashboard配置</h3><p>如果在 View-Tool Windows下没有找到Run Dashboard(Services)<br>打开 <code>E:\myproject\myproject\myproject\.idea\workspace.xml</code><br>添加如下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><p>重启即可<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud28.png"></p><h3 id="工程重构"><a href="#工程重构" class="headerlink" title="工程重构"></a>工程重构</h3><p>系统中有重复部分，重构</p><p>创建新模块 cloud-api-common</p><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cs.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时可以把cloud-provider-payment8001和cloud-consumer-order80中重复的entity包下的类删除，统一放到cloud-api-common中</p><p>然后执行 maven clean 和 maven install</p><p>然后在cloud-provider-payment8001和cloud-consumer-order80的pom中引入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cs.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时项目结构如下：<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/02/springcloud30.png"></p>]]></content>
      
      
      <categories>
          
          <category> springCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud系列之Eureka实现服务注册与发现</title>
      <link href="/2020/11/09/springcloud/eureka/"/>
      <url>/2020/11/09/springcloud/eureka/</url>
      
        <content type="html"><![CDATA[<h3 id="Eureka基础知识"><a href="#Eureka基础知识" class="headerlink" title="Eureka基础知识"></a>Eureka基础知识</h3><h4 id="什么是服务治理"><a href="#什么是服务治理" class="headerlink" title="什么是服务治理"></a>什么是服务治理</h4><p>Spring Cloud 封装了 Netflix 公司开发的 Eureka 模块来 实现服务治理。<br>在传统的 RPC 远程调用框架中，管理每个服务与服务之间的依赖关系非常复杂，管理比较复杂，所以需要使用 服务治理 来管理服务与服务之间的依赖关系，从而实现 服务调用、负载均衡、容错、服务的注册与发现 等。</p><h4 id="什么是服务注册与发现"><a href="#什么是服务注册与发现" class="headerlink" title="什么是服务注册与发现"></a>什么是服务注册与发现</h4><p>Eureka 采用了 <strong>CS</strong> 的设计机构 <strong><code>（C指的是client（客户端软件），S指的是Server（服务端软件）</code>**，Eureka Server 作为服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用 Eureka 的客户端连接到 Eureka Server，并维持</strong>心跳**连接。这样系统的维护人员就可以通过 Eureka Server 来监听系统中各个微服务是否正常运行。在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息（服务地址、通讯地址等）以别名的方式注册到注册中心上。另一方（消费者|服务提供者）会以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再通过本地RPC调用、远程RPC调用等方式来实现通信。</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka01.png"></p><h4 id="Eureka-两个组件"><a href="#Eureka-两个组件" class="headerlink" title="Eureka 两个组件"></a>Eureka 两个组件</h4><h5 id="Eureka-Serve提供服务注册服务"><a href="#Eureka-Serve提供服务注册服务" class="headerlink" title="Eureka Serve提供服务注册服务"></a>Eureka Serve提供服务注册服务</h5><p>各个微服务节点通过配置启动后，会在 EurekaServer中进行注册，这样 Eureka Server中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观看到。</p><h5 id="EurekaClient通过注册中心进行访问"><a href="#EurekaClient通过注册中心进行访问" class="headerlink" title="EurekaClient通过注册中心进行访问"></a>EurekaClient通过注册中心进行访问</h5><p>是一个Java客户端，用于简化 Eureka server的交互，客户端同时也具备一个内置的、使用轮询( round- robin)负载算法的负载均衡器。在应用启动后，将会向 Eureka server发送心跳(默认周期为30秒)。如果 Eureka server在多个心跳周期内没有接收到某个节点的心跳， EurekaServer’将会从服务注册表中把这个服务节点移除(默认90秒)。</p><h3 id="单机-Eureka-Server构建步骤"><a href="#单机-Eureka-Server构建步骤" class="headerlink" title="单机 Eureka Server构建步骤"></a>单机 Eureka Server构建步骤</h3><h4 id="IDEA生成-eurekaServer服务注册中心。"><a href="#IDEA生成-eurekaServer服务注册中心。" class="headerlink" title="IDEA生成 eurekaServer服务注册中心。"></a>IDEA生成 eurekaServer服务注册中心。</h4><p>新建一个module，模块名称定义为：cloud-eureka-server7001，来充当服务注册中心的角色。</p><p>eureka server端依赖如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cs.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-eureka-server7001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cs.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span>   <span class="comment">#eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>   <span class="comment">#false表示不向注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>   <span class="comment">#false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span> </span><br></pre></td></tr></table></figure><h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><p>启动类添加 @EnableEurekaServer 注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaMain7001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><p>通过地址：<code>http://localhost:7001</code> ，如图所示，此时还没有任何服务<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eurake02.png"></p><h4 id="把服务提供者provider注册进服务注册中心"><a href="#把服务提供者provider注册进服务注册中心" class="headerlink" title="把服务提供者provider注册进服务注册中心"></a>把服务提供者provider注册进服务注册中心</h4><p>在服务提供者provider的pom.xml中加入以下依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在服务提供者的application.yml中加入如下配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#表示是否将自己注册进EurekaServer</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从EurekaServer抓取已有的注册信息，集群必须为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span> <span class="comment">#服务注册中心的地址</span></span><br></pre></td></tr></table></figure><p>启动类添加注解 @EnableEurekaClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务提供者</p><p>浏览器输入：<code>http://localhost:7001</code>,此时服务提供者入住进了Eureka Server中，其中服务提供者的spring.application.name的名称就是下面图中的Application名称<br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka09.png"></p><h4 id="把服务消费者consumer注册进服务注册中心"><a href="#把服务消费者consumer注册进服务注册中心" class="headerlink" title="把服务消费者consumer注册进服务注册中心"></a>把服务消费者consumer注册进服务注册中心</h4><p>在服务消费者consumer的pom.xml中加入以下依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在服务消费者的application.yml中加入如下配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#表示是否将自己注册进EurekaServer</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从EurekaServer抓取已有的注册信息，集群必须为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span> <span class="comment">#服务注册中心的地址</span></span><br></pre></td></tr></table></figure><p>启动类添加注解 @EnableEurekaClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMain80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务消费者</p><p>浏览器输入：<code>http://localhost:7001</code>，此时服务消费者入住进了Eureka Server中</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka10.png"></p><h3 id="集群-Eureka-Server构建步骤"><a href="#集群-Eureka-Server构建步骤" class="headerlink" title="集群 Eureka Server构建步骤"></a>集群 Eureka Server构建步骤</h3><p>Eureka Server 集群原理：<strong>相互注册，相互守望。</strong><br>比如有两个 Eureka Server 7001 和 Eureka Server 7002，就是 7001 将自己注册到 7002，同时 7002 将自己注册到 7001 的过程。<br>如果有三个 Eureka Server 的话，就是 7001 将自己注册到 7002、7003， 7002 将自己注册到 7001、7003，7003将自己注册到 7001、7002，相互注册。</p><p>当前集群版环境的搭建，是在一台机器上完成的，由于是在一台机器上模拟 Eureka Server 集群的相互注册，此处需要在 <code>C:\Windows\System32\drivers\etc\hosts</code> 文件下配置一下 IP 和 域名 映射关系，让机器认为它们是不同机器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> eureka7001.com</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> eureka7002.com</span><br></pre></td></tr></table></figure><h4 id="EurekaServer集群环境构建步骤"><a href="#EurekaServer集群环境构建步骤" class="headerlink" title="EurekaServer集群环境构建步骤"></a>EurekaServer集群环境构建步骤</h4><p>创建 Eureka Server 模块</p><p>模块名称定义为：cloud-eureka-server7002，来充当服务注册中心的角色。让它与 cloud-eureka-server7001构成集群模式。</p><p>pom.xml同cloud-eureka-server7001的pom.xml一样</p><p>cloud-eureka-server7001修改 application.yml 配置文件，7001的defaultZone指向的是7002，如果还有7003则用逗号隔开</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>   <span class="comment">#eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>   <span class="comment">#false表示不向注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>   <span class="comment">#false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><p>cloud-eureka-server7001修改 application.yml 配置文件，7002的defaultZone指向的是7001，如果还有7003则用逗号隔开</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7002.com</span>   <span class="comment">#eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>   <span class="comment">#false表示不向注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>   <span class="comment">#false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><p>分别启动7001 和 7002 两个Eureka Server<br>浏览器地址输入 <code>http://localhost:7001/</code>或者<code>http://eureka7001.com:7001/</code><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eurake04.png"></p><p>浏览器地址输入 <code>http://localhost:7002/</code>或者<code>http://eureka7002.com:7002/</code><br><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eurake05.png"></p><h4 id="把服务提供者provider和服务消费者注册进集群中"><a href="#把服务提供者provider和服务消费者注册进集群中" class="headerlink" title="把服务提供者provider和服务消费者注册进集群中"></a>把服务提供者provider和服务消费者注册进集群中</h4><p>只需要修改application.yml的defaultZone即可</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#表示是否将自己注册进EurekaServer</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从EurekaServer抓取已有的注册信息，集群必须为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span> <span class="comment">#集群</span></span><br></pre></td></tr></table></figure><p>依次启动Eureka Server7001、Eureka Server7002，再启动服务提供者，服务消费者</p><p>访问<code>http://localhost:7001/</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka11.png"></p><p>访问<code>http://localhost:7002/</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka12.png"></p><h3 id="服务提供者provider集群Eureka-搭建"><a href="#服务提供者provider集群Eureka-搭建" class="headerlink" title="服务提供者provider集群Eureka 搭建"></a>服务提供者provider集群Eureka 搭建</h3><p>创建 Eureka Client 模块</p><p>模块名称定义为：cloud-provider-payment8002作为服务提供者。让它与另外一个服务提供者cloud-provider-payment8001构成集群模式。代码同cloud-provider-payment8001的一样，注意端口不同就可以。</p><p>依次启动服务注册中心Eureka Server7001、Eureka Server7002，再启动服务提供者cloud-provider-payment8001、cloud-provider-payment8002，最后启动服务消费者cloud-consumer-order80</p><p>访问<code>http://localhost:7001/</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka14.png"></p><p>访问<code>http://localhost:7002/</code></p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka13.png"></p><p>服务提供者cloud-consumer-order80改造</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.cs.springcloud.entity.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;<span class="comment">//指定服务提供者的名称</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">create</span><span class="params">(Payment payment)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL+<span class="string">&quot;/payment/create&quot;</span>,payment,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL+<span class="string">&quot;/payment/get/&quot;</span>+id,CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ApplicationContextConfig中添加@LoadBalanced开启负载均衡功能，轮询调用服务提供者的服务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="actuator微服务信息完善"><a href="#actuator微服务信息完善" class="headerlink" title="actuator微服务信息完善"></a>actuator微服务信息完善</h3><p>主机名称：服务名称修改:  instance-id</p><p>访问信息有IP信息提示:prefer-ip-address</p><p>修改服务提供者cloud-provider-payment8001和cloud-provider-payment8002的application.yml添加instance-id修改服务名称</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#表示是否将自己注册进EurekaServer</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从EurekaServer抓取已有的注册信息，集群必须为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">provider8001</span>  <span class="comment"># 主机服务名称</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>  <span class="comment">#显示IP信息</span></span><br></pre></td></tr></table></figure><p>访问<code>http://localhost:7001/</code>可以发现服务名称被修改为provider8001，provider8002</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka16.png"></p><p>访问<code>http://localhost:8001/actuator/health</code>得到如下结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;status&quot;:&quot;UP&quot;&#125;</span><br></pre></td></tr></table></figure><p>当鼠标悬浮在provider8002在浏览器左下角会显示IP地址</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka17.png"></p><h3 id="服务发现Discovery"><a href="#服务发现Discovery" class="headerlink" title="服务发现Discovery"></a>服务发现Discovery</h3><p>对于注册进eureka里面的服务，可以通过服务发现来获得该服务的信息</p><p>修改服务提供者cloud-provider-payment8002</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(value = &quot;/payment/discovery&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">discovery</span><span class="params">()</span></span>&#123;</span><br><span class="line">       List&lt;String&gt; services=discoveryClient.getServices();</span><br><span class="line">       <span class="keyword">for</span>(String element:services)&#123;</span><br><span class="line">           System.out.println(element);</span><br><span class="line">       &#125;</span><br><span class="line">       List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (ServiceInstance instance:instances)&#123;</span><br><span class="line">           System.out.println(instance.getServiceId()+<span class="string">&quot;\t&quot;</span>+instance.getHost()+<span class="string">&quot;\t&quot;</span>+instance.getPort()+<span class="string">&quot;\t&quot;</span>+instance.getUri());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.discoveryClient;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在启动类上添加@EnableDiscoveryClient注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cs.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8002</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8002.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用postman访问<code>localhost:8002/payment/discovery</code>得到如下信息</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;services&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;cloud-payment-service&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cloud-order-service&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;order&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台输出如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cloud-payment-service</span><br><span class="line">cloud-order-service</span><br><span class="line">CLOUD-PAYMENT-SERVICE    <span class="number">192.168</span>.<span class="number">0.103</span>    <span class="number">8002</span>    http:<span class="comment">//192.168.0.103:8002</span></span><br><span class="line">CLOUD-PAYMENT-SERVICE    <span class="number">192.168</span>.<span class="number">0.103</span>    <span class="number">8001</span>    http:<span class="comment">//192.168.0.103:8001</span></span><br></pre></td></tr></table></figure><h3 id="eureka自我保护"><a href="#eureka自我保护" class="headerlink" title="eureka自我保护"></a>eureka自我保护</h3><p>保护模式主要用于—组客户端和 Eureka Server之间存在网络分区场景下的保护。一旦进入保护模式Eureka Server将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务。如果在 Eureka Server的首页看到以下这段提示,则说明 Eureka进入了保护模式</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka18.png"></p><p>一句话：某时刻某一个服务不可用了，Eureka不会立刻清理，依旧会对该微服务的信息进行保存。属于CAP里面的AP分支。</p><p>为什么会产生 Eureka自我保护机制?</p><p>为了防止 EurekaClient可以正常运行，但是与 EurekaServer网络不通情况下， EurekaServer不会立刻将 EurekaClient服务剔除。</p><p>什么是自我保护模式?</p><p>默认情况下，如果 EurekaServer在一定时间内没有接收到某个微服务实例的心跳，EurekaServer将会注销该实例(默认90秒)。但是当网络分区故障发生(延时、卡顿、拥挤)时，微服务与 EurekaServer之间无法正常通信，以上行为可能变得非常危险了——因为微服务本身其实是健康的，此时本不应该注销这个微服务。 Eureka通过“自我保护模式”来解决这个问题—一当 EurekaServer节点在短时间内丢失过多客户端时(可能发生了网络分区故障)，那么这个节点就会进入自我保护模式。</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka19.png"></p><p>在自我保护模式中，Eureka server会保护服务注册表中的信息，不再注销任何服务实例。<br>它的设计哲学就是宁可保留错误的服务注册信息，也不盲目注销任何可能健康的服务实例。一句话讲解:好死不如赖活着<br>综上，自我保护模式是一种应对网络异常的安全保护措施。它的架构哲学是宁可同时保留所有微服(健康的微服务和不健康的微服<br>务都会保留)也不盲目注销任何健康的微服务。使用自我保护模式,可以让Eureka集群更加的健壮、稳定。</p><p>怎么禁止自我保护机制？</p><p>自我保护机制默认是开启的，</p><p>出现如下提示表示Eureka自我保护机制关闭。</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka20.png"></p><p>修改服务注册中心cloud-eureka-server7001的application.yml添加</p><p>eureka.server.enable-self-preservation  是否开启自我保护模式，默认为true。</p><p>eureka.server.eviction-interval-timer-in-ms </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>   <span class="comment">#eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>   <span class="comment">#false表示不向注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>   <span class="comment">#false表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> <span class="comment">#关闭自我保护机制，保证不可用服务被及时剔除</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span> <span class="comment">#eureka server清理无效节点的时间间隔，默认60000毫秒，即60秒 </span></span><br></pre></td></tr></table></figure><p>修改服务提供者cloud-provider-payment8001的application.yml</p><p>添加 eureka.instance.lease-expiration-duration-in-seconds和eureka.instance.lease-renewal-interval-in-seconds</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#表示是否将自己注册进EurekaServer</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># 是否从EurekaServer抓取已有的注册信息，集群必须为true才能配合ribbon使用负载均衡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">provider8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Eureka客户端向服务端发送心跳的时间间隔，单位为秒（默认30秒）</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span> <span class="comment"># 此处只为测试用的</span></span><br><span class="line">    <span class="comment"># Eureka服务端在收到最后一次心跳后等待时间上限，单位为秒（默认是90秒），超时将剔除服务</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">2</span> <span class="comment"># 此处只为测试用的</span></span><br></pre></td></tr></table></figure><p>启动服务注册中心cloud-eureka-server7001和服务提供者cloud-provider-payment8001</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka21.png"></p><p>当把服务提供者cloud-provider-payment8001的服务停掉以后， Eureka会立刻删除cloud-provider-payment8001</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka22.png"></p><h3 id="Eureka停更说明"><a href="#Eureka停更说明" class="headerlink" title="Eureka停更说明"></a>Eureka停更说明</h3><p><code>https://github.com/Netflix/eureka/wiki</code></p><p><strong>大概意思是：</strong> Eureka 2.0 的开源工作已经停止，依赖于开源库里面的 Eureka 2.x 分支构建的项目或者相关代码，风险自负！</p><p><img src="https://cdn.lianjinquan.com/img/posts/springcloud/01/eureka23.png"></p>]]></content>
      
      
      <categories>
          
          <category> springCloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>运行时数据区概述及线程</title>
      <link href="/2020/10/11/jvm/jvm03/"/>
      <url>/2020/10/11/jvm/jvm03/</url>
      
        <content type="html"><![CDATA[<p>运行时数据区概述及线程</p><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>运行时数据区，也就是下图这部分，它是类加载完成后的阶段<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/03/jvm01.png"><br>当我们通过前面的：类的加载-&gt; 验证 -&gt; 准备 -&gt; 解析 -&gt; 初始化 这几个阶段完成后，就会用到执行引擎对我们的类进行使用，同时执行引擎将会使用到我们运行时数据区<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/03/jvm02.png"><br>也就是大厨做饭，我们把大厨后面的东西（切好的菜，刀，调料），比作是运行时数据区。而厨师可以类比于执行引擎，将通过准备的东西进行制作成精美的菜品<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/03/jvm03.png"></p><p>内存是非常重要的系统资源，是硬盘和CPU的中间仓库及桥梁，承载着操作系统和应用程序的实时运行JVM内存布局规定了Java在运行过程中内存申请、分配、管理的策略，保证了JVM的高效稳定运行。不同的JVM对于内存的划分方式和管理机制存在着部分差异。</p><p>我们通过磁盘或者网络IO得到的数据，都需要先加载到内存中，然后CPU从内存中获取数据进行读取，也就是说内存充当了CPU和磁盘之间的桥梁</p><p>运行时数据区的完整图<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/03/jvm04.png"></p><p>Java虚拟机定义了若干种程序运行期间会使用到的运行时数据区，其中有一些会随着虚拟机启动而创建，随着虚拟机退出而销毁。另外一些则是与线程一一对应的，这些与线程对应的数据区域会随着线程开始和结束而创建和销毁。</p><p>灰色的为单独线程私有的，红色的为多个线程共享的。即：</p><ul><li>每个线程：独立包括程序计数器、栈、本地栈。</li><li>线程间共享：堆、堆外内存（永久代或元空间、代码缓存）<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/03/jvm05.png"></li></ul><h1 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h1><p>线程是一个程序里的运行单元。JVM允许一个应用有多个线程并行的执行。 在Hotspot JVM里，每个线程都与操作系统的本地线程直接映射。<br>当一个Java线程准备好执行以后，此时一个操作系统的本地线程也同时创建。Java线程执行终止后，本地线程也会回收。<br>操作系统负责所有线程的安排调度到任何一个可用的CPU上。一旦本地线程初始化成功，它就会调用Java线程中的run（）方法。</p><h1 id="JVM系统线程"><a href="#JVM系统线程" class="headerlink" title="JVM系统线程"></a>JVM系统线程</h1><p>如果你使用console或者是任何一个调试工具，都能看到在后台有许多线程在运行。这些后台线程不包括调用public static void main（String[]）的main线程以及所有这个main线程自己创建的线程。</p><p>这些主要的后台系统线程在Hotspot JVM里主要是以下几个：</p><ul><li>虚拟机线程：这种线程的操作是需要JVM达到安全点才会出现。这些操作必须在不同的线程中发生的原因是他们都需要JVM达到安全点，这样堆才不会变化。这种线程的执行类型包括”stop-the-world”的垃圾收集，线程栈收集，线程挂起以及偏向锁撤销。</li><li>周期任务线程：这种线程是时间周期事件的体现（比如中断），他们一般用于周期性操作的调度执行。</li><li>GC线程：这种线程对在JVM里不同种类的垃圾收集行为提供了支持。</li><li>编译线程：这种线程在运行时会将字节码编译成到本地代码。</li><li>信号调度线程：这种线程接收信号并发送给JVM，在它内部通过调用适当的方法进行处理。</li></ul>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机栈</title>
      <link href="/2020/10/11/jvm/jvm04/"/>
      <url>/2020/10/11/jvm/jvm04/</url>
      
        <content type="html"><![CDATA[<p>虚拟机栈</p><a id="more"></a><h1 id="虚拟机栈概述"><a href="#虚拟机栈概述" class="headerlink" title="虚拟机栈概述"></a>虚拟机栈概述</h1><p>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。 优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。<br>有不少Java开发人员一提到Java内存结构，就会非常粗粒度地将JVM中的内存区理解为仅有Java堆（heap）和Java战（stack）？为什么？<br>首先栈是运行时的单位，而堆是存储的单位。</p><ul><li>栈解决程序的运行问题，即程序如何执行，或者说如何处理数据。</li><li>堆解决的是数据存储的问题，即数据怎么放，放哪里。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/04/jvm01.png"></li></ul><h1 id="Java虚拟机栈是什么"><a href="#Java虚拟机栈是什么" class="headerlink" title="Java虚拟机栈是什么"></a>Java虚拟机栈是什么</h1><p>Java虚拟机栈（Java Virtual Machine Stack），早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧（Stack Frame），对应着一次次的Java方法调用。</p><p>是线程私有的<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/04/jvm02.png"></p>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>类加载子系统</title>
      <link href="/2020/09/20/jvm/jvm02/"/>
      <url>/2020/09/20/jvm/jvm02/</url>
      
        <content type="html"><![CDATA[<p>类加载子系统</p><a id="more"></a><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/虚拟机类加载机制.pdf"   title="虚拟机类加载机制"><i class="far fa-hand-point-right fa-fw"></i><span>虚拟机类加载机制</span></a><h1 id="类加载子系统概述"><a href="#类加载子系统概述" class="headerlink" title="类加载子系统概述"></a>类加载子系统概述</h1><p><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm01.png"><br>完整图如下<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm02.png"></p><p>如果自己想手写一个Java虚拟机的话，主要考虑哪些结构呢？</p><ul><li>类加载器</li><li>执行引擎</li></ul><h1 id="类加载器子系统作用"><a href="#类加载器子系统作用" class="headerlink" title="类加载器子系统作用"></a>类加载器子系统作用</h1><ul><li><p>类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识。</p></li><li><p>ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</p></li><li><p>加载的类信息存放于一块称为方法区的内存空间。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量（这部分常量信息是Class文件中常量池部分的内存映射）<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm03.png"></p></li><li><p>class file存在于本地硬盘上，可以理解为设计师画在纸上的模板，而最终这个模板在执行的时候是要加载到JVM当中来根据这个文件实例化出n个一模一样的实例。</p></li><li><p>class file加载到JVM中，被称为DNA元数据模板，放在方法区。</p></li><li><p>在.class文件-&gt;JVM-&gt;最终成为元数据模板，此过程就要一个运输工具（类装载器Class Loader），扮演一个快递员的角色。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm04.png"></p></li></ul><h1 id="类的加载过程"><a href="#类的加载过程" class="headerlink" title="类的加载过程"></a>类的加载过程</h1><p>例如下面的一段简单的代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class HelloLoader &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;我已经被加载啦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它的加载过程是怎么样的呢?<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm05.png"><br>完整的流程图如下所示<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm06.png"></p><h1 id="加载阶段"><a href="#加载阶段" class="headerlink" title="加载阶段"></a>加载阶段</h1><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类的加载过程-加载.pdf"   title="加载"><i class="far fa-hand-point-right fa-fw"></i><span>加载</span></a><ul><li>通过一个类的全限定名获取定义此类的二进制字节流</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li><li>在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口</li></ul><h2 id="加载class文件的方式"><a href="#加载class文件的方式" class="headerlink" title="加载class文件的方式"></a>加载class文件的方式</h2><ul><li>从本地系统中直接加载</li><li>通过网络获取，典型场景：Web Applet</li><li>从zip压缩包中读取，成为日后jar、war格式的基础</li><li>运行时计算生成，使用最多的是：动态代理技术</li><li>由其他文件生成，典型场景：JSP应用从专有数据库中提取.class文件，比较少见</li><li>从加密文件中获取，典型的防Class文件被反编译的保护措施</li></ul><h1 id="链接阶段"><a href="#链接阶段" class="headerlink" title="链接阶段"></a>链接阶段</h1><h2 id="验证-Verify"><a href="#验证-Verify" class="headerlink" title="验证 Verify"></a>验证 Verify</h2><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类的加载过程-验证.pdf"   title="验证"><i class="far fa-hand-point-right fa-fw"></i><span>验证</span></a><p>目的在于确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全。<br>主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm07.png"></p><p>如果出现不合法的字节码文件，那么将会验证不通过。<br>同时我们可以通过安装IDEA的插件，来查看我们的Class文件。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm08.png"><br>安装完成后，我们编译完一个class文件后，点击 View-Show Bytecode With Jclasslib 即可显示我们安装的插件来查看字节码方法了<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm09.png"></p><h2 id="准备-Prepare"><a href="#准备-Prepare" class="headerlink" title="准备 Prepare"></a>准备 Prepare</h2><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类的加载过程-准备.pdf"   title="准备"><i class="far fa-hand-point-right fa-fw"></i><span>准备</span></a><p>为类变量分配内存并且设置该类变量的默认初始值，即零值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class HelloApp &#123;</span><br><span class="line">    private static int a &#x3D; 1;  &#x2F;&#x2F; 准备阶段为0，在下个阶段，也就是初始化的时候才是1</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的变量a在准备阶段会赋初始值，但不是1，而是0。这里不包含用final修饰的static，因为final在编译的时候就会分配了，准备阶段会显式初始化；这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中。</p><h2 id="解析-Resolve"><a href="#解析-Resolve" class="headerlink" title="解析 Resolve"></a>解析 Resolve</h2><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类的加载过程-解析.pdf"   title="解析"><i class="far fa-hand-point-right fa-fw"></i><span>解析</span></a><p>将常量池内的符号引用转换为直接引用的过程。事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行。<br>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。<br>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等</p><h1 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h1><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类的加载过程-初始化.pdf"   title="初始化"><i class="far fa-hand-point-right fa-fw"></i><span>初始化</span></a><ul><li>初始化阶段就是执行类构造器法<code>&lt;clinit&gt;（）</code>的过程。</li><li>此方法不需定义，是javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来。也就是说，当我们代码中包含static变量的时候，就会有clinit方法。</li><li>构造器方法中指令按语句在源文件中出现的顺序执行。 </li><li><code>&lt;clinit&gt;（）</code>不同于类的构造器。（关联：构造器是虚拟机视角下的<code>&lt;init&gt;（）</code>）</li><li>若该类具有父类，JVM会保证子类的<code>&lt;clinit&gt;（）</code>执行前，父类的<code>&lt;clinit&gt;（）</code>已经执行完毕。</li></ul><p>任何一个类在声明后，内部至少存在一个类的构造器，默认是空参构造器（init）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class ClassInitTest &#123;</span><br><span class="line">    private static int num &#x3D; 1;</span><br><span class="line">    static &#123;</span><br><span class="line">        num &#x3D; 2;</span><br><span class="line">        number &#x3D; 20;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        &#x2F;&#x2F;System.out.println(number);  &#x2F;&#x2F;报错，非法的前向引用</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int number &#x3D; 10;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(ClassInitTest.num); &#x2F;&#x2F; 2</span><br><span class="line">        System.out.println(ClassInitTest.number); &#x2F;&#x2F; 10</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于涉及到父类时候的变量赋值过程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class ClinitTest1 &#123;</span><br><span class="line">    static class Father &#123;</span><br><span class="line">        public static int A &#x3D; 1;</span><br><span class="line">        static &#123;</span><br><span class="line">            A &#x3D; 2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Son extends Father &#123;</span><br><span class="line">        public static int b &#x3D; A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(Son.b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们输出结果为 2，也就是说首先加载ClinitTest1的时候，会找到main方法，然后执行Son的初始化，但是Son继承了Father，因此还需要执行Father的初始化，同时将A赋值为2。我们通过反编译得到Father的加载过程，首先我们看到原来的值被赋值成1，然后又被赋值成2，最后返回</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iconst_1</span><br><span class="line">putstatic #2 &lt;com&#x2F;atguigu&#x2F;java&#x2F;chapter02&#x2F;ClinitTest1$Father.A&gt;</span><br><span class="line">iconst_2</span><br><span class="line">putstatic #2 &lt;com&#x2F;atguigu&#x2F;java&#x2F;chapter02&#x2F;ClinitTest1$Father.A&gt;</span><br><span class="line">return</span><br></pre></td></tr></table></figure><p>虚拟机必须保证一个类的<code>&lt;clinit&gt;（）</code>方法在多线程下被同步加锁。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class DeadThreadTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;\t 线程t1开始&quot;);</span><br><span class="line">            new DeadThread();</span><br><span class="line">        &#125;, &quot;t1&quot;).start();</span><br><span class="line"></span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;\t 线程t2开始&quot;);</span><br><span class="line">            new DeadThread();</span><br><span class="line">        &#125;, &quot;t2&quot;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class DeadThread &#123;</span><br><span class="line">    static &#123;</span><br><span class="line">        if (true) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;\t 初始化当前类&quot;);</span><br><span class="line">            while(true) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码，输出结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">线程t1开始</span><br><span class="line">线程t2开始</span><br><span class="line">线程t2 初始化当前类</span><br></pre></td></tr></table></figure><p>从上面可以看出初始化后，只能够执行一次初始化，这也就是同步加锁的过程</p><h1 id="类加载器的分类"><a href="#类加载器的分类" class="headerlink" title="类加载器的分类"></a>类加载器的分类</h1><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/类加载器.pdf"   title="虚拟机类加载机制"><i class="far fa-hand-point-right fa-fw"></i><span>虚拟机类加载机制</span></a><ul><li>JVM支持两种类型的类加载器,分别为引导类加载器（Bootstrap ClassLoader）和自定义类加载器（User-Defined ClassLoader）。 Bootstrap ClassLoader由C/C++实现的，User-Defined ClassLoader由java语言实现。<br>从概念上来讲，自定义类加载器一般指的是程序中由开发人员自定义的一类类加载器，但是Java虚拟机规范却没有这么定义，而是将所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器。<br>无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终只有3个，如下所示：<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm10.png"><br>这里的四者之间是包含关系，不是上层和下层，也不是子系统的继承关系。</li></ul><p>我们通过一个类，获取它不同的加载器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F; 获取系统类加载器</span><br><span class="line">        ClassLoader systemClassLoader &#x3D; ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);&#x2F;&#x2F;sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 获取其上层的：扩展类加载器</span><br><span class="line">        ClassLoader extClassLoader &#x3D; systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);&#x2F;&#x2F;sun.misc.Launcher$ExtClassLoader@1540e19d</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 试图获取 根加载器,获取其上层获取不到引导类加载器 </span><br><span class="line">        ClassLoader bootstrapClassLoader &#x3D; extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);&#x2F;&#x2F;null</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 获取自定义加载器,对于用户自定义类来说,默认使用系统类加载器进行加载</span><br><span class="line">        ClassLoader classLoader &#x3D; ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);&#x2F;&#x2F;sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 获取String类型的加载器，String是使用引导类加载器来加载的  --&gt; java的核心类库都是使用引导类加载器来加载的</span><br><span class="line">        ClassLoader classLoader1 &#x3D; String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);&#x2F;&#x2F;null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="虚拟机自带的加载器"><a href="#虚拟机自带的加载器" class="headerlink" title="虚拟机自带的加载器"></a>虚拟机自带的加载器</h1><h2 id="启动类加载器（引导类加载器，Bootstrap-ClassLoader）"><a href="#启动类加载器（引导类加载器，Bootstrap-ClassLoader）" class="headerlink" title="启动类加载器（引导类加载器，Bootstrap ClassLoader）"></a>启动类加载器（引导类加载器，Bootstrap ClassLoader）</h2><ul><li>这个类加载使用C/C++语言实现的，嵌套在JVM内部。</li><li>它用来加载Java的核心库（JAVAHOME/jre/1ib/rt.jar、resources.jar或sun.boot.class.path路径下的内容），用于提供JVM自身需要的类</li><li>并不继承自ava.lang.ClassLoader，没有父加载器。</li><li>加载扩展类和应用程序类加载器，并指定为他们的父类加载器。</li><li>出于安全考虑，Bootstrap启动类加载器只加载包名为java、javax、sun等开头的类</li></ul><h2 id="扩展类加载器（Extension-ClassLoader）"><a href="#扩展类加载器（Extension-ClassLoader）" class="headerlink" title="扩展类加载器（Extension ClassLoader）"></a>扩展类加载器（Extension ClassLoader）</h2><ul><li>Java语言编写，由sun.misc.Launcher$ExtClassLoader实现。</li><li>派生于ClassLoader类</li><li>父类加载器为启动类加载器</li><li>从java.ext.dirs系统属性所指定的目录中加载类库，或从JDK的安装目录的jre/1ib/ext子目录（扩展目录）下加载类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载。</li></ul><h2 id="应用程序类加载器（系统类加载器，AppClassLoader）"><a href="#应用程序类加载器（系统类加载器，AppClassLoader）" class="headerlink" title="应用程序类加载器（系统类加载器，AppClassLoader）"></a>应用程序类加载器（系统类加载器，AppClassLoader）</h2><ul><li>java语言编写，由sun.misc.LaunchersAppClassLoader实现</li><li>派生于ClassLoader类</li><li>父类加载器为扩展类加载器</li><li>它负责加载环境变量classpath或系统属性java.class.path指定路径下的类库</li><li>该类加载是程序中默认的类加载器，一般来说，Java应用的类都是由它来完成加载</li><li>通过classLoader#getSystemclassLoader（）方法可以获取到该类加载器</li></ul><h2 id="用户自定义类加载器"><a href="#用户自定义类加载器" class="headerlink" title="用户自定义类加载器"></a>用户自定义类加载器</h2><p>在Java的日常应用程序开发中，类的加载几乎是由上述3种类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方式。<br>为什么要自定义类加载器？</p><ul><li>隔离加载类</li><li>修改类加载的方式</li><li>扩展加载源</li><li>防止源码泄漏</li></ul><p>用户自定义类加载器实现步骤：</p><ul><li>开发人员可以通过继承抽象类ava.1ang.ClassLoader类的方式，实现自己的类加载器，以满足一些特殊的需求</li><li>在JDK1.2之前，在自定义类加载器时，总会去继承ClassLoader类并重写1oadClass（）方法，从而实现自定义的类加载类，但是在JDK1.2之后已不再建议用户去覆盖1oadclass（）方法，而是建议把自定义的类加载逻辑写在findclass（）方法中</li><li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承URIClassLoader类，这样就可以避免自己去编写findclass（）方法及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li></ul><h2 id="查看根加载器所能加载的目录"><a href="#查看根加载器所能加载的目录" class="headerlink" title="查看根加载器所能加载的目录"></a>查看根加载器所能加载的目录</h2><p>刚刚我们通过概念了解到了，根加载器只能够加载 java /lib目录下的class，我们通过下面代码验证一下</p><p>启动类加载器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import java.net.URL;</span><br><span class="line">import java.security.Provider;</span><br><span class="line"></span><br><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;*********启动类加载器************&quot;);</span><br><span class="line">        &#x2F;&#x2F; 获取BootstrapClassLoader 能够加载的API的路径</span><br><span class="line">        URL[] urls &#x3D; sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">        for (URL url : urls) &#123;</span><br><span class="line">            System.out.println(url.toExternalForm());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 从上面路径中，随意选择一个类，来看看他的类加载器是什么：得到的是null，说明是(引导类加载器)根加载器</span><br><span class="line">        ClassLoader classLoader &#x3D; Provider.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到的结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*********启动类加载器************</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;resources.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;rt.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;sunrsasign.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;jsse.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;jce.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;charsets.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;lib&#x2F;jfr.jar</span><br><span class="line">file:&#x2F;E:&#x2F;java&#x2F;jdk1.8.0_251&#x2F;jre&#x2F;classes</span><br><span class="line">null</span><br></pre></td></tr></table></figure><p>扩展类加载器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;*********扩展类加载器************&quot;);</span><br><span class="line">        String extDirs &#x3D; System.getProperty(&quot;java.ext.dirs&quot;);</span><br><span class="line">        for (String path : extDirs.split(&quot;;&quot;))&#123;</span><br><span class="line">            System.out.println(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到的结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*********扩展类加载器************</span><br><span class="line">E:\Java\jdk1.8.0_251\jre\lib\ext</span><br><span class="line">C:\Windows\Sun\Java\lib\ext</span><br></pre></td></tr></table></figure><h1 id="关于ClassLoader"><a href="#关于ClassLoader" class="headerlink" title="关于ClassLoader"></a>关于ClassLoader</h1><p>ClassLoader类，它是一个抽象类，其后所有的类加载器都继承自ClassLoader（不包括启动类加载器）<br>sun.misc.Launcher 它是一个java虚拟机的入口应用<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm11.png"></p><p>获取ClassLoader的途径</p><ul><li>获取当前ClassLoader：clazz.getClassLoader()</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            ClassLoader classLoader&#x3D; Class.forName(&quot;java.lang.String&quot;).getClassLoader();</span><br><span class="line">            System.out.println(classLoader);&#x2F;&#x2F;null</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>获取当前线程上下文的ClassLoader：Thread.currentThread().getContextClassLoader()</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       ClassLoader classLoader&#x3D; Thread.currentThread().getContextClassLoader();</span><br><span class="line">       System.out.println(classLoader);&#x2F;&#x2F;sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>获取系统的ClassLoader：ClassLoader.getSystemClassLoader()</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       ClassLoader classLoader&#x3D; ClassLoader.getSystemClassLoader();</span><br><span class="line">       System.out.println(classLoader);&#x2F;&#x2F;sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>获取调用者的ClassLoader：DriverManager.getCallerClassLoader()</li></ul><h1 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h1><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/双亲委派模型.pdf"   title="双亲委派模型"><i class="far fa-hand-point-right fa-fw"></i><span>双亲委派模型</span></a><a class="btn-beautify button--animated outline pink larger" href="https://cdn.lianjinquan.com/pdf/深入理解java虚拟机/第七章/破坏双亲委派模型.pdf"   title="破坏双亲委派模型"><i class="far fa-hand-point-right fa-fw"></i><span>破坏双亲委派模型</span></a><p>Java虚拟机对class文件采用的是按需加载的方式，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且加载某个类的class文件时，Java虚拟机采用的是双亲委派模式，即把请求交由父类处理，它是一种任务委派模式。</p><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><ul><li>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</li><li>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</li><li>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm12.png"></li></ul><h2 id="双亲委派机制举例"><a href="#双亲委派机制举例" class="headerlink" title="双亲委派机制举例"></a>双亲委派机制举例</h2><p>当我们加载jdbc.jar 用于实现数据库连接的时候，首先我们需要知道的是 jdbc.jar是基于SPI接口进行实现的，所以在加载的时候，会进行双亲委派，最终从根加载器中加载 SPI核心类，然后在加载SPI接口类，接着在进行反向委派，通过线程上下文类加载器进行实现类 jdbc.jar的加载。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/02/jvm13.png"></p><h2 id="沙箱安全机制"><a href="#沙箱安全机制" class="headerlink" title="沙箱安全机制"></a>沙箱安全机制</h2><p>自定义string类，但是在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java\lang\String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的string类。这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</p><h2 id="双亲委派机制的优势"><a href="#双亲委派机制的优势" class="headerlink" title="双亲委派机制的优势"></a>双亲委派机制的优势</h2><p>通过上面的例子，我们可以知道，双亲机制可以</p><ul><li>避免类的重复加载</li><li>保护程序安全，防止核心API被随意篡改</li><li>自定义类：java.lang.String</li><li>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</li></ul><h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><h2 id="如何判断两个class对象是否相同"><a href="#如何判断两个class对象是否相同" class="headerlink" title="如何判断两个class对象是否相同"></a>如何判断两个class对象是否相同</h2><p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p><ol><li>类的完整类名必须一致，包括包名。</li><li>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同。</li></ol><p>换句话说，在JvM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的。</p><p>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的。如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区中。当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的。</p><h2 id="类的主动使用和被动使用"><a href="#类的主动使用和被动使用" class="headerlink" title="类的主动使用和被动使用"></a>类的主动使用和被动使用</h2><p>Java程序对类的使用方式分为：主动使用和被动使用。<br>主动使用，又分为七种情况：</p><ol><li>创建类的实例</li><li>访问某个类或接口的静态变量，或者对该静态变量赋值</li><li>调用类的静态方法I</li><li>反射（比如：Class.forName（”com.atguigu.Test”））</li><li>初始化一个类的子类</li><li>Java虚拟机启动时被标明为启动类的类</li><li>JDK7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF getStatic、REF putStatic、REF invokeStatic句柄对应的类没有初始化，则初始化</li></ol><p>除了以上七种情况，其他使用Java类的方式都被看作是对类的被动使用，都不会导致类的初始化。</p>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM与Java体系结构</title>
      <link href="/2020/09/19/jvm/jvm01/"/>
      <url>/2020/09/19/jvm/jvm01/</url>
      
        <content type="html"><![CDATA[<p>JVM与Java体系结构</p><a id="more"></a><h1 id="JVM内存与垃圾回收篇概述"><a href="#JVM内存与垃圾回收篇概述" class="headerlink" title="JVM内存与垃圾回收篇概述"></a>JVM内存与垃圾回收篇概述</h1><p><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-01.png"><br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-02.png"><br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-03.png"><br>每个语言都需要转换成字节码文件，最后转换的字节码文件都能通过Java虚拟机进行运行和处理<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-04.png"></p><h1 id="字节码"><a href="#字节码" class="headerlink" title="字节码"></a>字节码</h1><ol><li>我们平时说的java字节码，指的是用java语言编译成的字节码。准确的说任何能在jvm平台上执行的字节码格式都是一样的。所以应该统称为：jvm字节码。</li><li>不同的编译器，可以编译出相同的字节码文件，字节码文件也可以在不同的JVM上运行。</li><li>Java虚拟机与Java语言并没有必然的联系，它只与特定的二进制文件格式—Class文件格式所关联，Class文件中包含了Java虚拟机指令集（或者称为字节码、Bytecodes）和符号表，还有一些其他辅助信息。</li></ol><h1 id="多语言混合编程"><a href="#多语言混合编程" class="headerlink" title="多语言混合编程"></a>多语言混合编程</h1><ol><li>Java平台上的多语言混合编程正成为主流，通过特定领域的语言去解决特定领域的问题是当前软件开发应对日趋复杂的项目需求的一个方向。</li><li>试想一下，在一个项目之中，并行处理用clojure语言编写，展示层使用JRuby/Rails，中间层则是Java，每个应用层都将使用不同的编程语言来完成，而且，接口对每一层的开发者都是透明的，各种语言之间的交互不存在任何困难，就像使用自己语言的原生API一样方便，因为它们最终都运行在一个虚拟机之上。</li><li>对这些运行于Java虚拟机之上、Java之外的语言，来自系统级的、底层的支持正在迅速增强，以JSR-292为核心的一系列项目和功能改进（如Da Vinci Machine项目、Nashorn引擎、InvokeDynamic指令、java.lang.invoke包等），推动Java虚拟机从“Java语言的虚拟机”向 “多语言虚拟机”的方向发展。</li></ol><h1 id="Java发展的重大事件"><a href="#Java发展的重大事件" class="headerlink" title="Java发展的重大事件"></a>Java发展的重大事件</h1><ol><li>1990年，在Sun计算机公司中，由Patrick Naughton、MikeSheridan及James Gosling领导的小组Green Team，开发出的新的程序语言，命名为oak，后期命名为Java</li><li>1995年，Sun正式发布Java和HotJava产品，Java首次公开亮相。</li><li>1996年1月23日sun Microsystems发布了JDK 1.0。</li><li>1998年，JDK1.2版本发布。同时，sun发布了JSP/Servlet、EJB规范，以及将Java分成了J2EE、J2SE和J2ME。这表明了Java开始向企业、桌面应用和移动设备应用3大领域挺进。</li><li>2000年，JDK1.3发布，Java HotSpot Virtual Machine正式发布，成为Java的默认虚拟机。</li><li>2002年，JDK1.4发布，古老的Classic虚拟机退出历史舞台。</li><li>2003年年底，Java平台的scala正式发布，同年Groovy也加入了Java阵营。</li><li>2004年，JDK1.5发布。同时JDK1.5改名为JavaSE5.0。</li><li>2006年，JDK6发布。同年，Java开源并建立了openJDK。顺理成章，Hotspot虚拟机也成为了openJDK中的默认虚拟机。</li><li>2007年，Java平台迎来了新伙伴Clojure。</li><li>2008年，oracle收购了BEA，得到了JRockit虚拟机。</li><li>2009年，Twitter宣布把后台大部分程序从Ruby迁移到scala，这是Java平台的又一次大规模应用。</li><li>2010年，oracle收购了sun，获得Java商标和最真价值的HotSpot虚拟机。此时，oracle拥有市场占用率最高的两款虚拟机HotSpot和JRockit，并计划在未来对它们进行整合：HotRockit</li><li>2011年，JDK7发布。在JDK1.7u4中，正式启用了新的垃圾回收器G1。</li><li>2017年，JDK9发布。将G1设置为默认Gc，替代CMS</li><li>同年，IBM的J9开源，形成了现在的open J9社区</li><li>2018年，Android的Java侵权案判决，Google赔偿oracle计88亿美元</li><li>同年，oracle宣告JavagE成为历史名词JDBC、JMS、Servlet赠予Eclipse基金会</li><li>同年，JDK11发布，LTS版本的JDK，发布革命性的zGc，调整JDK授权许可</li><li>2019年，JDK12发布，加入RedHat领导开发的shenandoah GC<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-05.png"><br>在JDK11之前，oracleJDK中还会存在一些openJDK中没有的、闭源的功能。但在JDK11中，我们可以认为openJDK和oracleJDK代码实质上已经完全一致的程度。</li></ol><h1 id="虚拟机与Java虚拟机"><a href="#虚拟机与Java虚拟机" class="headerlink" title="虚拟机与Java虚拟机"></a>虚拟机与Java虚拟机</h1><h2 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h2><ul><li>所谓虚拟机（Virtual Machine），就是一台虚拟的计算机。它是一款软件，用来执行一系列虚拟计算机指令。大体上，虚拟机可以分为系统虚拟机和程序虚拟机。</li><li>大名鼎鼎的Visual Box，Mware就属于系统虚拟机，它们完全是对物理计算机的仿真，提供了一个可运行完整操作系统的软件平台。</li><li>程序虚拟机的典型代表就是Java虚拟机，它专门为执行单个计算机程序而设计，在Java虚拟机中执行的指令我们称为Java字节码指令。</li><li>无论是系统虚拟机还是程序虚拟机，在上面运行的软件都被限制于虚拟机提供的资源中。</li></ul><h2 id="Java虚拟机"><a href="#Java虚拟机" class="headerlink" title="Java虚拟机"></a>Java虚拟机</h2><ul><li>Java虚拟机是一台执行Java字节码的虚拟计算机，它拥有独立的运行机制，其运行的Java字节码也未必由Java语言编译而成。</li><li>JVM平台的各种语言可以共享Java虚拟机带来的跨平台性、优秀的垃圾回器，以及可靠的即时编译器。</li><li>Java技术的核心就是Java虚拟机（JVM，Java Virtual Machine），因为所有的Java程序都运行在Java虚拟机内部。</li><li>Java虚拟机就是二进制字节码的运行环境，负责装载字节码到其内部，解释/编译为对应平台上的机器指令执行。每一条Java指令，Java虚拟机规范中都有详细定义，如怎么取操作数，怎么处理操作数，处理结果放在哪里。</li></ul><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>一次编译，到处运行</li><li>自动内存管理</li><li>自动垃圾回收功能</li></ul><h1 id="JVM的位置"><a href="#JVM的位置" class="headerlink" title="JVM的位置"></a>JVM的位置</h1><p>JVM是运行在操作系统之上的，它与硬件没有直接的交互<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-06.png"></p><p>Java的体系结构<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-07.png"></p><h1 id="JVM整体结构"><a href="#JVM整体结构" class="headerlink" title="JVM整体结构"></a>JVM整体结构</h1><ul><li>HotSpot VM是目前市面上高性能虚拟机的代表作之一。</li><li>它采用解释器与即时编译器并存的架构。</li><li>在今天，Java程序的运行性能早已脱胎换骨，已经达到了可以和C/C++程序一较高下的地步。<br><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-08.png"><br>执行引擎包含三部分：解释器，及时编译器，垃圾回收器</li></ul><h1 id="Java代码执行流程"><a href="#Java代码执行流程" class="headerlink" title="Java代码执行流程"></a>Java代码执行流程</h1><p><img src="https://cdn.lianjinquan.com/img/posts/jvm/01/jvm-09.png"><br>只是能生成被Java虚拟机所能解释的字节码文件，那么理论上就可以自己设计一套代码了</p><h1 id="JVM的架构模型"><a href="#JVM的架构模型" class="headerlink" title="JVM的架构模型"></a>JVM的架构模型</h1><p>Java编译器输入的指令流基本上是一种基于栈的指令集架构，另外一种指令集架构则是基于寄存器的指令集架构。具体来说：这两种架构之间的区别：</p><h2 id="基于栈式架构的特点"><a href="#基于栈式架构的特点" class="headerlink" title="基于栈式架构的特点"></a>基于栈式架构的特点</h2><ul><li>设计和实现更简单，适用于资源受限的系统；</li><li>避开了寄存器的分配难题：使用零地址指令方式分配。</li><li>指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现。</li><li>不需要硬件支持，可移植性更好，更好实现跨平台</li></ul><h2 id="基于寄存器架构的特点"><a href="#基于寄存器架构的特点" class="headerlink" title="基于寄存器架构的特点"></a>基于寄存器架构的特点</h2><ul><li>典型的应用是x86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机。</li><li>指令集架构则完全依赖硬件，可移植性差</li><li>性能优秀和执行更高效</li><li>花费更少的指令去完成一项操作。</li><li>在大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主方水洋</li></ul><h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><p>同样执行2+3这种逻辑操作，其指令分别如下</p><ul><li>基于栈的计算流程（以Java虚拟机为例）</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iconst_2 &#x2F;&#x2F;常量2入栈</span><br><span class="line">istore_1</span><br><span class="line">iconst_3 &#x2F;&#x2F; 常量3入栈</span><br><span class="line">istore_2</span><br><span class="line">iload_1</span><br><span class="line">iload_2</span><br><span class="line">iadd &#x2F;&#x2F;常量2&#x2F;3出栈，执行相加</span><br><span class="line">istore_0 &#x2F;&#x2F; 结果5入栈</span><br></pre></td></tr></table></figure><ul><li>而基于寄存器的计算流程</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov eax,2 &#x2F;&#x2F;将eax寄存器的值设为1</span><br><span class="line">add eax,3 &#x2F;&#x2F;使eax寄存器的值加3</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。</p><h1 id="字节码反编译"><a href="#字节码反编译" class="headerlink" title="字节码反编译"></a>字节码反编译</h1><p>我们编写一个简单的代码，然后查看一下字节码的反编译后的结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class StackStruTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int i &#x3D; 2 + 3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们找到编译后的 class文件，使用下列命令进行反编译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -v StackStruTest.class</span><br></pre></td></tr></table></figure><p>得到的文件为:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public static void main(java.lang.String[]);</span><br><span class="line">   descriptor: ([Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">   flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">   Code:</span><br><span class="line">     stack&#x3D;2, locals&#x3D;4, args_size&#x3D;1</span><br><span class="line">        0: iconst_2</span><br><span class="line">        1: istore_1</span><br><span class="line">        2: iconst_3</span><br><span class="line">        3: istore_2</span><br><span class="line">        4: iload_1</span><br><span class="line">        5: iload_2</span><br><span class="line">        6: iadd</span><br><span class="line">        7: istore_3</span><br><span class="line">        8: return</span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line 9: 0</span><br><span class="line">       line 10: 2</span><br><span class="line">       line 11: 4</span><br><span class="line">       line 12: 8</span><br><span class="line">     LocalVariableTable:</span><br><span class="line">       Start  Length  Slot  Name   Signature</span><br><span class="line">           0       9     0  args   [Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">           2       7     1     i   I</span><br><span class="line">           4       5     2     j   I</span><br><span class="line">           8       1     3     k   I</span><br></pre></td></tr></table></figure><h1 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h1><ul><li>跨平台性</li><li>指令集小</li><li>指令多</li><li>执行性能比寄存器差</li></ul><h1 id="JVM生命周期"><a href="#JVM生命周期" class="headerlink" title="JVM生命周期"></a>JVM生命周期</h1><h2 id="虚拟机的启动"><a href="#虚拟机的启动" class="headerlink" title="虚拟机的启动"></a>虚拟机的启动</h2><p>Java虚拟机的启动是通过引导类加载器（bootstrap class loader）创建一个初始类（initial class）来完成的，这个类是由虚拟机的具体实现指定的。</p><h2 id="虚拟机的执行"><a href="#虚拟机的执行" class="headerlink" title="虚拟机的执行"></a>虚拟机的执行</h2><ul><li>一个运行中的Java虚拟机有着一个清晰的任务：执行Java程序。</li><li>程序开始执行时他才运行，程序结束时他就停止。</li><li>执行一个所谓的Java程序的时候，真真正正在执行的是一个叫做Java虚拟机的进程。</li></ul><h2 id="虚拟机的退出"><a href="#虚拟机的退出" class="headerlink" title="虚拟机的退出"></a>虚拟机的退出</h2><p>有如下的几种情况：</p><ul><li>程序正常执行结束</li><li>程序在执行过程中遇到了异常或错误而异常终止</li><li>由于操作系统用现错误而导致Java虚拟机进程终止</li><li>某线程调用Runtime类或system类的exit方法，或Runtime类的halt方法，并且Java安全管理器也允许这次exit或halt操作。</li><li>除此之外，JNI（Java Native Interface）规范描述了用JNI Invocation API来加载或卸载 Java虚拟机时，Java虚拟机的退出情况。</li></ul><h1 id="JVM发展历程"><a href="#JVM发展历程" class="headerlink" title="JVM发展历程"></a>JVM发展历程</h1><h2 id="Sun-Classic-VM"><a href="#Sun-Classic-VM" class="headerlink" title="Sun Classic VM"></a>Sun Classic VM</h2><ul><li>早在1996年Java1.0版本的时候，Sun公司发布了一款名为sun classic VM的Java虚拟机，它同时也是世界上第一款商用Java虚拟机，JDK1.4时完全被淘汰。</li><li>这款虚拟机内部只提供解释器。现在还有及时编译器，因此效率比较低，而及时编译器会把热点代码缓存起来，那么以后使用热点代码的时候，效率就比较高。</li><li>如果使用JIT编译器，就需要进行外挂。但是一旦使用了JIT编译器，JIT就会接管虚拟机的执行系统。解释器就不再工作。解释器和编译器不能配合工作。</li><li>现在hotspot内置了此虚拟机。</li></ul><h2 id="Exact-VM"><a href="#Exact-VM" class="headerlink" title="Exact VM"></a>Exact VM</h2><ul><li>为了解决上一个虚拟机问题，jdk1.2时，sun提供了此虚拟机。 Exact Memory Management：准确式内存管理</li><li>也可以叫Non-Conservative/Accurate Memory Management</li><li>虚拟机可以知道内存中某个位置的数据具体是什么类型。|</li><li>具备现代高性能虚拟机的维形</li><li>热点探测（寻找出热点代码进行缓存）</li><li>编译器与解释器混合工作模式</li><li>只在solaris平台短暂使用，其他平台上还是classic vm，英雄气短，终被Hotspot虚拟机替换</li></ul><h2 id="HotSpot-VM"><a href="#HotSpot-VM" class="headerlink" title="HotSpot VM"></a>HotSpot VM</h2><p>HotSpot历史</p><ul><li>最初由一家名为“Longview Technologies”的小公司设计</li><li>1997年，此公司被sun收购；2009年，Sun公司被甲骨文收购。</li><li>JDK1.3时，HotSpot VM成为默认虚拟机</li><li>目前Hotspot占有绝对的市场地位，称霸武林。</li><li>不管是现在仍在广泛使用的JDK6，还是使用比例较多的JDK8中，默认的虚拟机都是HotSpot</li><li>Sun/oracle JDK和openJDK的默认虚拟机</li><li>从服务器、桌面到移动端、嵌入式都有应用。</li><li>名称中的HotSpot指的就是它的热点代码探测技术。</li><li>通过计数器找到最具编译价值代码，触发即时编译或栈上替换</li><li>通过编译器与解释器协同工作，在最优化的程序响应时间与最佳执行性能中取得平衡</li></ul><h2 id="JRockit"><a href="#JRockit" class="headerlink" title="JRockit"></a>JRockit</h2><ul><li>专注于服务器端应用</li><li>它可以不太关注程序启动速度，因此JRockit内部不包含解析器实现，全部代码都靠即时编译器编译后执行。</li><li>大量的行业基准测试显示，JRockit JVM是世界上最快的JVM。</li><li>使用JRockit产品，客户已经体验到了显著的性能提高（一些超过了70%）和硬件成本的减少（达50%）。</li><li>优势：全面的Java运行时解决方案组合</li><li>JRockit面向延迟敏感型应用的解决方案JRockit Real Time提供以毫秒或微秒级的JVM响应时间，适合财务、军事指挥、电信网络的需要MissionControl服务套件，它是一组以极低的开销来监控、管理和分析生产环境中的应用程序的工具。</li><li>2008年，JRockit被oracle收购。</li><li>oracle表达了整合两大优秀虚拟机的工作，大致在JDK8中完成。整合的方式是在HotSpot的基础上，移植JRockit的优秀特性。</li></ul><h2 id="IBM的J9"><a href="#IBM的J9" class="headerlink" title="IBM的J9"></a>IBM的J9</h2><ul><li>全称：IBM Technology for Java Virtual Machine，简称IT4J，内部代号：J9</li><li>市场定位与HotSpot接近，服务器端、桌面应用、嵌入式等多用途VM广泛用于IBM的各种Java产品。</li><li>目前，有影响力的三大商用虚拟机之一，也号称是世界上最快的Java虚拟机。</li><li>2017年左右，IBM发布了开源J9VM，命名为openJ9，交给EClipse基金会管理，也称为Eclipse OpenJ9</li><li>OpenJDK -&gt; 是JDK开源了，包括了虚拟机</li></ul><h2 id="KVM和CDC-CLDC-Hotspot"><a href="#KVM和CDC-CLDC-Hotspot" class="headerlink" title="KVM和CDC / CLDC Hotspot"></a>KVM和CDC / CLDC Hotspot</h2><ul><li>oracle在Java ME产品线上的两款虚拟机为：CDC/CLDC HotSpot Implementation VM KVM（Kilobyte）是CLDC-HI早期产品目前移动领域地位尴尬，智能机被Angroid和ioS二分天下。</li><li>KVM简单、轻量、高度可移植，面向更低端的设备上还维持自己的一片市场</li><li>智能控制器、传感器</li><li>老人手机、经济欠发达地区的功能手机</li><li>所有的虚拟机的原则：一次编译，到处运行。</li></ul><h2 id="Azul-VM"><a href="#Azul-VM" class="headerlink" title="Azul VM"></a>Azul VM</h2><ul><li>前面三大“高性能Java虚拟机”使用在通用硬件平台上这里Azu1VW和BEALiquid VM是与特定硬件平台绑定、软硬件配合的专有虚拟机</li><li>高性能Java虚拟机中的战斗机。</li><li>Azul VM是Azu1Systems公司在HotSpot基础上进行大量改进，运行于Azul Systems公司的专有硬件Vega系统上的ava虚拟机。</li><li>每个Azu1VM实例都可以管理至少数十个CPU和数百GB内存的硬件资源，并提供在巨大内存范围内实现可控的GC时间的垃圾收集器、专有硬件优化的线程调度等优秀特性。</li><li>2010年，AzulSystems公司开始从硬件转向软件，发布了自己的zing JVM，可以在通用x86平台上提供接近于Vega系统的特性。</li></ul><h2 id="Liquid-VM"><a href="#Liquid-VM" class="headerlink" title="Liquid VM"></a>Liquid VM</h2><ul><li>高性能Java虚拟机中的战斗机。</li><li>BEA公司开发的，直接运行在自家Hypervisor系统上Liquid VM即是现在的JRockit VE（Virtual Edition），</li><li>Liquid VM不需要操作系统的支持，或者说它自己本身实现了一个专用操作系统的必要功能，如线程调度、文件系统、网络支持等。</li><li>随着JRockit虚拟机终止开发，Liquid vM项目也停止了。</li></ul><h2 id="Apache-Marmony"><a href="#Apache-Marmony" class="headerlink" title="Apache Marmony"></a>Apache Marmony</h2><ul><li>Apache也曾经推出过与JDK1.5和JDK1.6兼容的Java运行平台Apache Harmony。</li><li>它是IElf和Inte1联合开发的开源JVM，受到同样开源的openJDK的压制，Sun坚决不让Harmony获得JCP认证，最终于2011年退役，IBM转而参与OpenJDK</li><li>虽然目前并没有Apache Harmony被大规模商用的案例，但是它的Java类库代码吸纳进了Android SDK。</li></ul><h2 id="Micorsoft-JVM"><a href="#Micorsoft-JVM" class="headerlink" title="Micorsoft JVM"></a>Micorsoft JVM</h2><ul><li>微软为了在IE3浏览器中支持Java Applets，开发了Microsoft JVM。</li><li>只能在window平台下运行。但确是当时Windows下性能最好的Java VM。</li><li>1997年，sun以侵犯商标、不正当竞争罪名指控微软成功，赔了sun很多钱。微软windowsXPSP3中抹掉了其VM。现在windows上安装的jdk都是HotSpot。</li></ul><h2 id="Taobao-JVM"><a href="#Taobao-JVM" class="headerlink" title="Taobao JVM"></a>Taobao JVM</h2><ul><li>由AliJVM团队发布。阿里，国内使用Java最强大的公司，覆盖云计算、金融、物流、电商等众多领域，需要解决高并发、高可用、分布式的复合问题。有大量的开源产品。</li><li>基于openJDK开发了自己的定制版本AlibabaJDK，简称AJDK。是整个阿里Java体系的基石。</li><li>基于openJDK Hotspot VM发布的国内第一个优化、深度定制且开源的高性能服务器版Java虚拟机。</li><li>创新的GCIH（GCinvisible heap）技术实现了off-heap，即将生命周期较长的Java对象从heap中移到heap之外，并且Gc不能管理GCIH内部的Java对象，以此达到降低GC的回收频率和提升Gc的回收效率的目的。</li><li>GCIH中的对象还能够在多个Java虚拟机进程中实现共享</li><li>使用crc32指令实现JvM intrinsic降低JNI的调用开销</li><li>PMU hardware的Java profiling tool和诊断协助功能</li><li>针对大数据场景的ZenGc</li><li>taobao vm应用在阿里产品上性能高，硬件严重依赖inte1的cpu，损失了兼容性，但提高了性能，目前已经在淘宝、天猫上线，把oracle官方JvM版本全部替换了。</li></ul><h2 id="Dalvik-VM"><a href="#Dalvik-VM" class="headerlink" title="Dalvik VM"></a>Dalvik VM</h2><ul><li>谷歌开发的，应用于Android系统，并在Android2.2中提供了JIT，发展迅猛。</li><li>Dalvik y只能称作虚拟机，而不能称作“Java虚拟机”，它没有遵循 Java虚拟机规范</li><li>不能直接执行Java的Class文件</li><li>基于寄存器架构，不是jvm的栈架构。</li><li>执行的是编译以后的dex（Dalvik Executable）文件。执行效率比较高。</li><li>它执行的dex（Dalvik Executable）文件可以通过class文件转化而来，使用Java语法编写应用程序，可以直接使用大部分的Java API等。</li><li>Android 5.0使用支持提前编译（Ahead of Time Compilation，AoT）的ART VM替换Dalvik VM。</li></ul><h2 id="Graal-VM"><a href="#Graal-VM" class="headerlink" title="Graal VM"></a>Graal VM</h2><ul><li>2018年4月，oracle Labs公开了GraalvM，号称 “Run Programs Faster Anywhere”，勃勃野心。与1995年java的”write once，run anywhere”遥相呼应。</li><li>GraalVM在HotSpot VM基础上增强而成的跨语言全栈虚拟机，可以作为“任何语言” 的运行平台使用。语言包括：Java、Scala、Groovy、Kotlin；C、C++、Javascript、Ruby、Python、R等</li><li>支持不同语言中混用对方的接口和对象，支持这些语言使用已经编写好的本地库文件</li><li>工作原理是将这些语言的源代码或源代码编译后的中间格式，通过解释器转换为能被Graal VM接受的中间表示。Graal VM提供Truffle工具集快速构建面向一种新语言的解释器。在运行时还能进行即时编译优化，获得比原生编译器更优秀的执行效率。</li><li>如果说HotSpot有一天真的被取代，Graalvm希望最大。但是Java的软件生态没有丝毫变化。</li></ul><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>具体JVM的内存结构，其实取决于其实现，不同厂商的JVM，或者同一厂商发布的不同版本，都有可能存在一定差异。主要以oracle HotSpot VM为默认虚拟机。</p>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IntelliJ IDEA创建第一个Spring Boot项目</title>
      <link href="/2020/09/17/springboot/springboot01/"/>
      <url>/2020/09/17/springboot/springboot01/</url>
      
        <content type="html"><![CDATA[<p>IntelliJ IDEA创建第一个Spring Boot项目</p><a id="more"></a><h3 id="IDEA创建项目"><a href="#IDEA创建项目" class="headerlink" title="IDEA创建项目"></a>IDEA创建项目</h3><p><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot01.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot02.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot03.png"><br><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot04.png"><br>配置maven<br><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot05.png"><br>启动项目<br><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot07.png"></p><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p><img src="https://cdn.lianjinquan.com/img/posts/springboot/01/springboot08.png"></p><h3 id="启动类-DemoApplication"><a href="#启动类-DemoApplication" class="headerlink" title="启动类 DemoApplication"></a>启动类 DemoApplication</h3><p>一个带有main()方法的类，用于启动应用程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.quan.demo;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class DemoApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><p>Maven构建说明文件</p><ol><li>springboot父级依赖,spring-boot-starter-parent是一个特殊的starter,它用来提供相关的Maven默认依赖，使用它之后，常用的包依赖可以省去version标签。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.3.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br></pre></td></tr></table></figure>打开 <code>E:\apache-maven-3.6.3\repository\org\springframework\boot\spring-boot-dependencies\2.3.3.RELEASE\spring-boot-dependencies-2.3.3.RELEASE.pom</code><br>可以看到springboot提供的jar包依赖，<br><a href="https://cdn.lianjinquan.com/img/posts/springboot/01/test.txt">https://cdn.lianjinquan.com/img/posts/springboot/01/test.txt</a><br>如果你不想使用某个依赖默认的版本，您还可以通过覆盖自己的项目中的属性来覆盖各个依赖项,如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">       &lt;activemq.version&gt;5.7.0&lt;&#x2F;activemq.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>pom.xml<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.3.3.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.quan&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;demo&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;name&gt;demo&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;description&gt;Demo project for Spring Boot&lt;&#x2F;description&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.junit.vintage&lt;&#x2F;groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;junit-vintage-engine&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;&#x2F;exclusions&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>一个空的properties文件，你可以根据需要添加配置属性。</p><ol><li><p>application.properties</p></li><li><p>application.yml</p></li></ol><h3 id="测试类DemoApplicationTests"><a href="#测试类DemoApplicationTests" class="headerlink" title="测试类DemoApplicationTests"></a>测试类DemoApplicationTests</h3><p>一个空的Junit测试类，它加载了一个使用Spring Boot字典配置功能的Spring应用程序上下文。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.quan.demo;</span><br><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class DemoApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> springBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tomcat的安装与配置</title>
      <link href="/2020/09/15/tomcat/tomcat01/"/>
      <url>/2020/09/15/tomcat/tomcat01/</url>
      
        <content type="html"><![CDATA[<p>Tomcat的下载，安装，配置，部署，优化</p><a id="more"></a><h3 id="jdk的环境变量配置"><a href="#jdk的环境变量配置" class="headerlink" title="jdk的环境变量配置"></a>jdk的环境变量配置</h3><p>在’系统变量’中, 新建JAVA_HOME<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/java-home.png"><br>在PATH中添加 <code>%JAVA_HOME%\bin</code><br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/java-path.png"><br>在’系统变量’中, 新建CLASSPATH,变量值为 <code>.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</code><br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/classpath.png"><br>测试java是否配置成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br><span class="line">java version &quot;1.8.0_261&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_261-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.261-b12, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载"></a>Tomcat下载</h3><p>进入tomcat官网，选择<a href="https://tomcat.apache.org/download-90.cgi">tomcat9</a>点击64-bit Windows zip (pgp, sha512)下载<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcat-download.png"><br>下载到E盘，解压<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcat9.png"></p><h3 id="Tomcat配置环境变量"><a href="#Tomcat配置环境变量" class="headerlink" title="Tomcat配置环境变量"></a>Tomcat配置环境变量</h3><p>在’系统变量’中, 新建变量名：CATALINA_HOME，变量值：E:\apache-tomcat-9.0.37<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcat-home.png"><br>在PATH中添加 <code>%CATALINA_HOME%\bin</code><br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcat-path.png"></p><h3 id="启动Tomcat的2中方法"><a href="#启动Tomcat的2中方法" class="headerlink" title="启动Tomcat的2中方法"></a>启动Tomcat的2中方法</h3><ol><li>打开cmd,输入startup启动tomcat<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;startup</span><br><span class="line">Using CATALINA_BASE:   &quot;E:\apache-tomcat-9.0.37&quot;</span><br><span class="line">Using CATALINA_HOME:   &quot;E:\apache-tomcat-9.0.37&quot;</span><br><span class="line">Using CATALINA_TMPDIR: &quot;E:\apache-tomcat-9.0.37\temp&quot;</span><br><span class="line">Using JRE_HOME:        &quot;E:\java\jdk1.8.0_251&quot;</span><br><span class="line">Using CLASSPATH:       &quot;E:\apache-tomcat-9.0.37\bin\bootstrap.jar;E:\apache-tomcat-9.0.37\bin\tomcat-juli.jar&quot;</span><br></pre></td></tr></table></figure></li><li>进入E:\apache-tomcat-9.0.37\bin，双击startup.bat启动,双击shutdown.bat关闭<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/start-tomcat.png"></li></ol><h3 id="验证是否启动成功"><a href="#验证是否启动成功" class="headerlink" title="验证是否启动成功"></a>验证是否启动成功</h3><p>在浏览器输入<a href="http://localhost:8080/">http://localhost:8080</a>  看到如下页面则启动成功<br><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcat-startup.png"></p><h3 id="tomcat的目录结构"><a href="#tomcat的目录结构" class="headerlink" title="tomcat的目录结构"></a>tomcat的目录结构</h3><p><img src="https://cdn.lianjinquan.com/img/posts/tomcat/tomcattree.png"></p><h3 id="Tomcat部署项目的三种方法"><a href="#Tomcat部署项目的三种方法" class="headerlink" title="Tomcat部署项目的三种方法"></a>Tomcat部署项目的三种方法</h3><h3 id="启动Tomcat后乱码"><a href="#启动Tomcat后乱码" class="headerlink" title="启动Tomcat后乱码"></a>启动Tomcat后乱码</h3><p>找到打开 <code>E:\apache-tomcat-9.0.37\conf\logging.properties</code> 文件<br>把 <code>java.util.logging.ConsoleHandler.encoding = UTF-8</code> 设置为 <code>java.util.logging.ConsoleHandler.encoding = GBK</code></p><h3 id="Tomcat的默认Connector配置"><a href="#Tomcat的默认Connector配置" class="headerlink" title="Tomcat的默认Connector配置"></a>Tomcat的默认Connector配置</h3><p>打开 <code>E:\apache-tomcat-9.0.37\conf\server.xml</code> 可以看到tomcat默认端口port是8080，协议类型protocol是HTTP/1.1，连接超时时间connectionTimeout是20000毫秒，安全通信（https）转发端口redirectPort是8443</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port&#x3D;&quot;8080&quot; protocol&#x3D;&quot;HTTP&#x2F;1.1&quot;</span><br><span class="line">          connectionTimeout&#x3D;&quot;20000&quot;</span><br><span class="line">          redirectPort&#x3D;&quot;8443&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><h3 id="tomcat并发优化"><a href="#tomcat并发优化" class="headerlink" title="tomcat并发优化"></a>tomcat并发优化</h3><h3 id="tomcat内存优化"><a href="#tomcat内存优化" class="headerlink" title="tomcat内存优化"></a>tomcat内存优化</h3>]]></content>
      
      
      <categories>
          
          <category> tomcat </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>超实用的下载视频工具</title>
      <link href="/2020/09/13/python/python01/"/>
      <url>/2020/09/13/python/python01/</url>
      
        <content type="html"><![CDATA[<p>You-Get是python的一个开源库，使用you-get你只需要取得视频所在网页链接地址就可以很轻松的下载下来，目前you-get所支持的网站包含国内外几十个网站(youtube、twitter、腾讯、爱奇艺、优酷、bilibili等)，基本上可以满足你的需求。</p><a id="more"></a><h3 id="Windows安装Python"><a href="#Windows安装Python" class="headerlink" title="Windows安装Python"></a>Windows安装Python</h3><ol><li><p>进入python官网，选择<a href="https://www.python.org/downloads/">dowload</a>然后选择windows如下图<br><img src="https://cdn.lianjinquan.com/img/python/youget/download-python.png" alt="下载python"></p></li><li><p>安装Python<br><img src="https://cdn.lianjinquan.com/img/python/youget/python-1.png" alt="安装python-1"><br>请务必要勾选Add Python 3.8 to PATH，这样可以将 Python 命令工具所在目录添加到系统 Path 环境变量中，以后开发程序或者运行 Python 命令会非常方便。<br><img src="https://cdn.lianjinquan.com/img/python/youget/python-2.png" alt="安装python-2"><br>点击“Next”继续，选择安装目录。<br><img src="https://cdn.lianjinquan.com/img/python/youget/python-3.png" alt="安装python-3"><br>选择好你常用的安装目录，点击“Install”，等待几分钟就可以完成安装。</p></li><li><p>安装成功后。使用python -version检测一下，是否安装成功。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python --version</span><br><span class="line">Python 3.8.5</span><br></pre></td></tr></table></figure></li></ol><h3 id="安装You-Get"><a href="#安装You-Get" class="headerlink" title="安装You-Get"></a>安装You-Get</h3><p>打开Windows的命令提示符（win+r 输入cmd）输入一下命令安装you-get</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install you-get</span><br></pre></td></tr></table></figure><h3 id="升级You-Get"><a href="#升级You-Get" class="headerlink" title="升级You-Get"></a>升级You-Get</h3><p>根据您选择安装的选项you-get，可以通过以下方式进行升级：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade you-get</span><br></pre></td></tr></table></figure><h3 id="查看下载视频详情"><a href="#查看下载视频详情" class="headerlink" title="查看下载视频详情"></a>查看下载视频详情</h3><p>收到感兴趣的视频后，您可能需要使用–info/ -i选项查看所有可用的质量和格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ you-get -i https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ix411c7mk&#x2F;?spm_id_from&#x3D;333.788.videocard.1</span><br><span class="line">site:                Bilibili</span><br><span class="line">title:               “吔屎啦，梁非凡”非凡哥原版片段</span><br><span class="line">streams:             # Available quality and codecs</span><br><span class="line">    [ DASH ] ____________________________________</span><br><span class="line">    - format:        dash-flv480</span><br><span class="line">      container:     mp4</span><br><span class="line">      quality:       清晰 480P</span><br><span class="line">      size:          9.0 MiB (9428834 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;dash-flv480 [URL]</span><br><span class="line"></span><br><span class="line">    - format:        dash-flv360</span><br><span class="line">      container:     mp4</span><br><span class="line">      quality:       流畅 360P</span><br><span class="line">      size:          6.0 MiB (6242812 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;dash-flv360 [URL]</span><br><span class="line"></span><br><span class="line">    [ DEFAULT ] _________________________________</span><br><span class="line">    - format:        flv480</span><br><span class="line">      container:     flv</span><br><span class="line">      quality:       清晰 480P</span><br><span class="line">      size:          11.6 MiB (12194537 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;flv480 [URL]</span><br><span class="line"></span><br><span class="line">    - format:        flv360</span><br><span class="line">      container:     flv</span><br><span class="line">      quality:       流畅 360P</span><br><span class="line">      size:          7.9 MiB (8259558 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;flv360 [URL]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="下载视频"><a href="#下载视频" class="headerlink" title="下载视频"></a>下载视频</h3><p>标记的格式DEFAULT是您将默认获得的格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ you-get https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ix411c7mk&#x2F;?spm_id_from&#x3D;333.788.videocard.1</span><br><span class="line">site:                Bilibili</span><br><span class="line">title:               “吔屎啦，梁非凡”非凡哥原版片段</span><br><span class="line">stream:</span><br><span class="line">    - format:        flv480</span><br><span class="line">      container:     flv</span><br><span class="line">      quality:       清晰 480P</span><br><span class="line">      size:          11.6 MiB (12194537 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;flv480 [URL]</span><br><span class="line"></span><br><span class="line">you-get: Skipping .\“吔屎啦，梁非凡”非凡哥原版片段.flv: file already exists</span><br><span class="line"></span><br><span class="line">Downloading “吔屎啦，梁非凡”非凡哥原版片段.cmt.xml ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者，如果您喜欢其他格式（mp4），则只需使用you-get显示的选项即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ you-get --format&#x3D;dash-flv480 https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ix411c7mk&#x2F;?spm_id_from&#x3D;333.788.videocard.1</span><br><span class="line">site:                Bilibili</span><br><span class="line">title:               “吔屎啦，梁非凡”非凡哥原版片段</span><br><span class="line">stream:</span><br><span class="line">    - format:        dash-flv480</span><br><span class="line">      container:     mp4</span><br><span class="line">      quality:       清晰 480P</span><br><span class="line">      size:          9.0 MiB (9428834 bytes)</span><br><span class="line">    # download-with: you-get --format&#x3D;dash-flv480 [URL]</span><br><span class="line"></span><br><span class="line">Downloading “吔屎啦，梁非凡”非凡哥原版片段.mp4 ...</span><br><span class="line"> 100% (  9.0&#x2F;  9.0MB) ├████████████████████████████████████████┤[2&#x2F;2]   12 MB&#x2F;s</span><br><span class="line"></span><br><span class="line">Downloading “吔屎啦，梁非凡”非凡哥原版片段.cmt.xml ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意</p><ul><li>目前，我们大多数受支持的网站尚未实现格式选择；在这种情况下，默认的下载格式是质量最高的格式。</li><li>ffmpeg 是必需的依赖项，用于下载和加入分多个部分（例如，在优酷等某些网站上）流式传输的视频，以及用于1080p或高分辨率的YouTube视频。</li><li>如果您不想you-get在下载后加入视频部分，请使用–no-merge/ -n选项。</li></ul><h3 id="下载其他内容"><a href="#下载其他内容" class="headerlink" title="下载其他内容"></a>下载其他内容</h3><p>如果您已经有了想要的确切资源的URL，则可以使用以下方法直接下载它：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ you-get https:&#x2F;&#x2F;cdn.lianjinquan.com&#x2F;img&#x2F;background&#x2F;2029675.jpg</span><br><span class="line">Site:       lianjinquan.com</span><br><span class="line">Title:      2029675</span><br><span class="line">Type:       JPEG Image (image&#x2F;jpeg)</span><br><span class="line">Size:       1.25 MiB (1308244 Bytes)</span><br><span class="line"></span><br><span class="line">Downloading 2029675.jpg ...</span><br><span class="line"> 100% (  1.2&#x2F;  1.2MB) ├████████████████████████████████████████┤[1&#x2F;1]   11 MB&#x2F;s</span><br></pre></td></tr></table></figure><h3 id="暂停并继续下载"><a href="#暂停并继续下载" class="headerlink" title="暂停并继续下载"></a>暂停并继续下载</h3><p>您可以使用Ctrl+C中断下载</p><h3 id="下载路径"><a href="#下载路径" class="headerlink" title="下载路径"></a>下载路径</h3><p>使用–output-dir/ -o选项设置路径，并使用–output-filename/ -O设置下载文件的名称：</p><p>下载到E盘video目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ you-get -o E:&#x2F;video https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1ix411c7mk&#x2F;?spm_id_from&#x3D;333.788.videocard.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql数据库设计规范</title>
      <link href="/2020/09/12/mysql/mysql01/"/>
      <url>/2020/09/12/mysql/mysql01/</url>
      
        <content type="html"><![CDATA[<p>在使用MySQL数据库的时候需要遵循一定规范，扬长避短。本规范旨在帮助或指导开发、测试、数据库操作人员等做出适合线上业务的数据库设计和规范化操作。在数据库变更和处理流程、数据库表设计、SQL编写等方面予以规范。</p><a id="more"></a><h3 id="基础规范"><a href="#基础规范" class="headerlink" title="基础规范"></a>基础规范</h3><ol><li>【强制】数据库表结构字符集统一使用UTF8mb4。</li><li>【强制】新建表，必须显式指定主键。</li><li>【强制】不在数据库中存储图片、大文件等大数据。</li><li>【强制】所有表名、表字段必须添加注释。</li><li>【强制】无特殊需求，必须统一使用INNODB存储引擎。</li></ol><h3 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h3><ol><li>【强制】数据库名、表名、字段名必须统一使用小写字母，采用26个英文字母和0-9的自然数组合，命名不能只含数字，加上下划线“_”组成，不建议加数字。</li><li>【强制】特殊情况下，需要数字与字母组合一起命名时，名称必须用英文字母开头，采用可体现业务模块含义的单词或缩写，单词中间用“_”分割，单词只能由英文字母、数字组成，不能只含数字。正例: service_level2</li><li>【强制】禁止使用大小写字母混合方式命名数据库名、表名、字段名。</li><li>【强制】数据库名、表名、字段名禁止使用拼音或夹带拼音。</li><li>【强制】数据库名、表名、字段名禁止使用MySQL保留字、关键字。</li><li>【强制】数据库名、表名、字段名的命名，英文单词组合个数不超过5个，字符数不超过32个字符，须见名知意，允许使用英文缩写。</li><li>【强制】数据库名，必须能体现业务方向或业务系统，其名称含义能达到见名知意效果。正例: vehicle_center（库名）。</li><li>【强制】 数据库表名，必须能体现业务方向或业务系统，最好是加上“业务名称_表的作用”，其名称含义简单易懂，能达到见名知意效果。正例: user_login（表名）</li><li>【强制】表字段命名应能体现被设计对象的属性含义或作用，并且需要有完整的注释说明；</li><li>【强制】数据库索引命名标准,pk主键、uk_xx唯一键、idx_xx普通索引(xx代表字段名)；idx_xx_xx复合索引(xx代表字段名);</li><li>【强制】数据库视图命名标准,v_xx(xx代表业务主体内容)；</li></ol><h3 id="表结构设计规范"><a href="#表结构设计规范" class="headerlink" title="表结构设计规范"></a>表结构设计规范</h3><ol><li>【强制】新建表时必须显式指定主键，类型为int或bigint，且为auto_increment。</li><li>【强制】创建表时必须显式指定字符集为utf8mb4。</li><li>【强制】创建表时必须显式指定表存储引擎类型，如无特殊需求，一律使用InnoDB。</li><li>【强制】新建表时，表里每个字段必须要有comment注释。</li><li>【强制】对已有表做表字段追加，所追加字段必须有注释说明。</li><li>【强制】表设计过程中，单表不应有过多热点字段。</li><li>【建议】核心表（如用户表，金钱相关的表）须有行数据的创建时间字段create_time和最后更新时间字段update_time。</li><li>【建议】表中所有字段必须都是NOT NULL属性，业务可以根据需要定义DEFAULT值。</li><li>【建议】不建议使用text/blob，如在满足长度的情况下，建议用varchar代替text，如无法避免text、blob，应独立出来一张表。</li><li>【强制】禁止存储图片。</li><li>【强制】禁止使用外键。</li></ol><h3 id="字段类型选择与优化"><a href="#字段类型选择与优化" class="headerlink" title="字段类型选择与优化"></a>字段类型选择与优化</h3><ol><li>【强制】表中的自增列auto_increment属性，推荐使用int、bigint类型。</li><li>【强制】涉及金额、费率等字段,应统一使用decimal。</li><li>【强制】业务字段中存在状态status判断的、类型type等字段推荐使用tinytint。</li><li>【建议】业务中IP地址字段推荐使用int类型。</li><li>【建议】文本数据尽量用varchar存储,字符数不要超过2000。</li><li>【建议】时间类型尽量选取timestamp。</li><li>【强制】涉及地理位置信息,应统一使用geoetry。</li></ol><p>详细存储大小参加下图：<br> <img src="/images/mysql%E5%AD%98%E5%82%A8%E5%A4%A7%E5%B0%8F.png" alt="baidu"></p><h3 id="索引规范与设计"><a href="#索引规范与设计" class="headerlink" title="索引规范与设计"></a>索引规范与设计</h3><ol><li>【强制】InnoDB存储引擎表，索引类型必须为BTREE。</li><li>【强制】主键的名称以“pk_”开头，唯一键以“uk_”或“uq_”开头，普通索引以“idx_”开头，idx_xx(普通索引),idx_xx_xx(复合索引),xx代表后缀，以字段的名称或缩写作为后缀, 命名一律使用小写格式。</li><li>【强制】索引建立的规则表应遵循列数据随机率要高于%70以上，count(distinct (column))/count(*)值越接近于1，越适合建索引，索引越高效。</li><li>【建议】在建立索引时，应多考虑建立联合索引，并把区分度最高的字段放在最前面。</li><li>【建议】在多表join的SQL里，保证被驱动表的连接列上有索引，这样join执行效率最高。</li><li>【强制】业务表含有唯一约束列，必须为其创建唯一键或者复合唯一键。</li><li>【建议】不要在更新频繁的列上建索引。</li><li>【建议】建表或加索引时，保证表里互相不存在重复、冗余索引。</li><li>【强制】单表不宜建过多索引，索引个数不能超过7个。</li></ol><h3 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h3><ol><li>【强制】分区表的分区字段（partition-key）必须有索引，或者是组合索引的首列。</li><li>【强制】单个分区表中的分区（包括子分区）个数不能超过1024。</li><li>【强制】访问分区表的SQL必须包含分区键。</li><li>【强制】对于分区表执行alter table操作，必须在业务低峰期执行。</li></ol><h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><ol><li>【强制】数据库本身库、表、列所有字符集必须保持一致，为utf8mb4</li><li>【强制】前端程序字符集或者环境变量中的字符集，与数据库、表的字符集必须一致，统一为utf8或utf8mb4。</li></ol><h3 id="规范建表语句示例"><a href="#规范建表语句示例" class="headerlink" title="规范建表语句示例"></a>规范建表语句示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> (</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">BIGINT</span> ( <span class="number">11</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`user_id`</span> <span class="built_in">BIGINT</span> ( <span class="number">11</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户 id&#x27;</span>,</span><br><span class="line">    <span class="string">`username`</span> <span class="built_in">VARCHAR</span> ( <span class="number">45</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;真实姓名&#x27;</span>,</span><br><span class="line">    <span class="string">`email`</span> <span class="built_in">VARCHAR</span> ( <span class="number">30</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户邮箱&#x27;</span>,</span><br><span class="line">    <span class="string">`nickname`</span> <span class="built_in">VARCHAR</span> ( <span class="number">45</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">    <span class="string">`avatar`</span> <span class="built_in">INT</span> ( <span class="number">11</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;头像&#x27;</span>,</span><br><span class="line">    <span class="string">`birthday`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;生日&#x27;</span>,</span><br><span class="line">    <span class="string">`sex`</span> <span class="built_in">TINYINT</span> ( <span class="number">4</span> ) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    <span class="string">`short_introduce`</span> <span class="built_in">VARCHAR</span> ( <span class="number">150</span> ) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;一句话介绍自己，最多50个汉字&#x27;</span>,</span><br><span class="line">    <span class="string">`user_resume`</span> <span class="built_in">VARCHAR</span> ( <span class="number">300</span> ) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户提交的简历存放地址&#x27;</span>,</span><br><span class="line">    <span class="string">`user_register_ip`</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户注册时的源 ip&#x27;</span>,</span><br><span class="line">    <span class="string">`create_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户记录创建的时间&#x27;</span>,</span><br><span class="line">    <span class="string">`update_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户资料修改的时间&#x27;</span>,</span><br><span class="line">    <span class="string">`user_review_status`</span> <span class="built_in">TINYINT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户资料审核状态， 1为通过，2为审核中，3为未通过，4为还未提交审核&#x27;</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> ( <span class="string">`id`</span> ),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx_user_id`</span> ( <span class="string">`user_id`</span> ),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_username`</span> ( <span class="string">`username`</span> ),</span><br><span class="line">   <span class="keyword">KEY</span> <span class="string">`idx_create_time`</span> ( <span class="string">`create_time`</span>, <span class="string">`user_review_status`</span> ) </span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8mb4 <span class="keyword">COMMENT</span> = <span class="string">&#x27;网站用户基本信息&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="SQL使用规范"><a href="#SQL使用规范" class="headerlink" title="SQL使用规范"></a>SQL使用规范</h3><h3 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h3><ol><li>【强制】SELECT语句必须指定具体字段名称，禁止写成“*”。</li><li>【强制】SELECT语句表名前必须加上库名。正例：select vin,status,manufacture_time from vcd.tm_vehicle;  vcd为库名</li><li>【强制】SELECT语句查询数据输出行数比较多的情况下，需要加limit 限制输出的行数。</li><li>【建议】SELECT语句尽量避免嵌套多个语句。</li><li>【强制】禁止在生产数据库做复杂运算。</li><li>【建议】SELECT语句避免在索引列上使用函数或计算。</li><li>【建议】SELECT语句不要使用UNION，推荐使用UNION ALL，并且UNION子句个数限制在5个以内。</li><li>【建议】in值列表限制在500以内。正例：select… where userid in(….500个以内…)，这么做是为了减少底层扫描，减轻数据库压力从而加速查询。</li><li>【强制】where条件里等号左右字段类型必须一致，否则无法利用索引。</li><li>【建议】SELECT|UPDATE|DELETE|REPLACE要有WHERE子句，且WHERE子句的条件必需使用索引查找。</li><li>【强制】WHERE 子句中禁止只使用全模糊的LIKE条件进行查找，必须有其他等值或范围查询条件，否则无法利用索引。</li><li>【建议】索引列不要使用函数或表达式，否则无法利用索引。正例：where length(name)=’Admin’或where user_id+2=10023。</li><li>【建议】减少使用or语句，可将or语句优化为union，然后在各个where条件上建立索引。如where a=1 or b=2优化为where a=1… union …where b=2, key(a),key(b)</li><li>【建议】分页查询，当limit起点较高时，可先用过滤条件进行过滤。正例：select a,b,c from t1 limit 10000,20;   优化为:Select a,b,c from t1 where id&gt;10000 limit 20;</li></ol><h3 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h3><ol><li>【建议】不建议跨db的join语句查询。</li><li>【强制】禁止在业务的更新类SQL语句中使用join，比如update t1 join t2…</li><li>【建议】不建议使用子查询，建议将子查询SQL拆开结合程序多次查询，或使用join来代替子查询。</li><li>【建议】线上环境，多表join不要超过5个表。</li><li>【建议】多表连接查询推荐使用别名，且SELECT列表中要用别名引用字段，数据库.表格式，如“select a from db1.table1 alias1 where …”</li><li>【建议】在多表join中，尽量选取结果集较小的表作为驱动表，来join其他表。</li></ol><h3 id="排序和分组"><a href="#排序和分组" class="headerlink" title="排序和分组"></a>排序和分组</h3><ol><li>【建议】减少使用order by，和业务沟通能不排序就不排序，或将排序放到程序端去做。Order by、group by、distinct这些语句较为耗费CPU，数据库的CPU资源是极其宝贵的。</li><li>【建议】order by、group by、distinct这些SQL尽量利用索引直接检索出排序好的数据。如where a=1 order by可以利用key(a,b)。</li><li>【建议】包含了order by、group by、distinct这些查询的语句，where条件过滤出来的结果集请保持在1000行以内，否则SQL会很慢。</li><li>【强制】禁用update|delete t1 … where a=XX limit XX; 这种带limit的更新语句。因为会导致主从不一致，导致数据错乱。建议加上order by PK</li><li>【强制】禁止使用关联子查询，如update t1 set … where name in(select name from user where…);效率极其低下。</li><li>【强制】禁用procedure、function、trigger、views、event、外键约束。因为他们消耗数据库资源，降低数据库集群可扩展性。推荐都在程序端实现。</li><li>【强制】禁用insert into …on duplicate key update… 在高并发环境下，会造成主从不一致。</li><li>【强制】禁止联表更新语句，如update t1,t2 where t1.id=t2.id…</li><li>【强制】insert语句指定具体字段名称，不要写成insert into t1 values(…)。</li></ol>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql免安装版配置</title>
      <link href="/2020/09/12/mysql/mysql02/"/>
      <url>/2020/09/12/mysql/mysql02/</url>
      
        <content type="html"><![CDATA[<p>在使用MySQL数据库的时候需要遵循一定规范，扬长避短。本规范旨在帮助或指导开发、测试、数据库操作人员等做出适合线上业务的数据库设计和规范化操作。在数据库变更和处理流程、数据库表设计、SQL编写等方面予以规范。</p><a id="more"></a><h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p><a href="https://dev.mysql.com/downloads/mysql/">下载</a> MySQL Community Server 8.0.22<br><img src="https://cdn.lianjinquan.com/img/posts/mysql/01/mysql01.png"><br>不需要登录，选择直接下载<br><img src="https://cdn.lianjinquan.com/img/posts/mysql/01/mysql02.png"><br>下载完成后解压到E:\mysql-8.0.22目录下</p><h1 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h1><p><img src="https://cdn.lianjinquan.com/img/posts/mysql/01/mysql03.png"></p><h1 id="编辑my-ini"><a href="#编辑my-ini" class="headerlink" title="编辑my.ini"></a>编辑my.ini</h1><p>在 E:\mysql-8.0.22 目录下创建文件 my.ini ,编辑如下信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line"> </span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port &#x3D; 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir&#x3D;E:\mysql-8.0.22</span><br><span class="line"># 设置 mysql数据库的数据的存放目录，MySQL 8+ 不需要以下配置，系统自己生成即可，否则有可能报错</span><br><span class="line"># datadir&#x3D;E:\mysql-8.0.22\sqldata</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections&#x3D;20</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br></pre></td></tr></table></figure><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>以管理员身份打开cmd，执行如下命令：mysqld –initialize –console, 执行完成后会输出root的默认初始密码,<code>ZwBI-,;qg9Nu</code> 就是初始密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;mysqld --initialize --console</span><br><span class="line">2020-11-19T14:00:38.231692Z 0 [System] [MY-013169] [Server] E:\mysql-8.0.22\bin\mysqld.exe (mysqld 8.0.22) initializing of server in progress as process 14512</span><br><span class="line">2020-11-19T14:00:38.240065Z 0 [Warning] [MY-013242] [Server] --character-set-server: &#39;utf8&#39; is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.</span><br><span class="line">2020-11-19T14:00:38.252615Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2020-11-19T14:00:41.959448Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2020-11-19T14:00:47.437016Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: ZwBI-,;qg9Nu</span><br></pre></td></tr></table></figure><p>安装命令：mysqld install</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;mysqld install</span><br><span class="line">Service successfully installed.</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><p>启动命令：net start mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;net start mysql</span><br><span class="line">MySQL 服务正在启动 ..</span><br><span class="line">MySQL 服务已经启动成功。</span><br></pre></td></tr></table></figure><h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><p>登录本机mysl命令：mysql -u root -p</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;mysql -u root -p</span><br><span class="line">Enter password: ************</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.22</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h1 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h1><p>修改root密码为：admin123，执行如下命令: alter user ‘root’@’localhost’ identified by ‘admin123’;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;admin123&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure><h1 id="navicat登录"><a href="#navicat登录" class="headerlink" title="navicat登录"></a>navicat登录</h1><p><img src="https://cdn.lianjinquan.com/img/posts/mysql/01/mysql04.png"></p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
